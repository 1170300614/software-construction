<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head> <body onload="start()"><div style="background:#5c5c5f; color:#FFF"> <p align="center">&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;[&#x6DF1;&#x5BB9;Pubmed&#x6587;&#x732E;&#x68C0;&#x7D22;] &nbsp 1. &#x6B64;&#x5904;&#x53F3;&#x952E;&#xFF1A;&#x9009;&#x83DC;&#x5355;&#x3010;&#x7FFB;&#x6210;&#x4E2D;&#x6587;&#xFF08;&#x7B80;&#x4F53;&#xFF09;&#x3011; &nbsp &nbsp &nbsp  2. &#x7FFB;&#x8BD1;&#x540E;&#xFF0C;&#x6B64;&#x5904;&#x53F3;&#x952E;&#xFF1A;&#x9009;&#x83DC;&#x5355;&#x3010;&#x6253;&#x5370;...&#x3011;&#x6210;PDF&#x683C;&#x5F0F; <br>&#x5EFA;&#x8BAE;&#x5C4F;&#x5E55;&#x5206;&#x8FA8;&#x7387;&#xFF1A;1920X1080&#xFF1B;&#x5982;&#x679C;&#x5C4F;&#x5E55;&#x592A;&#x5C0F;&#xFF0C;&#x53EF;&#x4EE5;&#x6309;Ctrl + &#x6216; Ctrl -&#x7F29;&#x653E;&#x7F51;&#x9875;&#x3002;</p></div><style type="text/css"> .txt { white-space:nowrap; }	 #f0 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f1 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f2 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f3 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f4 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f5 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f6 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f7 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f8 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f9 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f10 { font-family:sans-serif; font-weight:normal; font-style:normal; }  #f11 { font-family:sans-serif; font-weight:normal; font-style:normal; }  #f12 { font-family:sans-serif; font-weight:normal; font-style:normal; } 	#f13 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f14 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f15 { font-family:sans-serif; font-weight:normal; font-style:normal; } 	#f16 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f17 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f18 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f19 { font-family:sans-serif; font-weight:normal; font-style:normal; }		#f20 { font-family:sans-serif; font-weight:normal; font-style:normal; }		</style><img id="background" style="position:absolute; left:0px; top:50px;" width="1440" height="1080" src="page1.png"> <img id="background" style="position:absolute; left:1440px; top:50px;" width="1440" height="1080" src="page-000001.png">
<div class="txt" style="position:absolute; left:1105px; top:68px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:203px; top:362px;"><span id="f9" style="font-size:55px;vertical-align:baseline;color:rgba(0,0,0,1);">Chapter 3: Abstract Data Type (ADT) and</span></div>
<div class="txt" style="position:absolute; left:254px; top:429px;"><span id="f9" style="font-size:55px;vertical-align:baseline;color:rgba(0,0,0,1);">Object-Oriented Programming (OOP)</span></div>
<div class="txt" style="position:absolute; left:230px; top:500px;"><span id="f19" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:596px; top:719px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Xu Hanchuan</span></div>
<div class="txt" style="position:absolute; left:585px; top:772px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(255,98,176,1);">xhc@hit.edu.cn</span></div>
<div class="txt" style="position:absolute; left:607px; top:877px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">April 3, 2019</span></div>
<img id="background" style="position:absolute; left:0px; top:1050px;" width="1440" height="1080" src="page2.png"> <img id="background" style="position:absolute; left:1440px; top:1050px;" width="1440" height="1080" src="page-000002.png">
<div class="txt" style="position:absolute; left:33px; top:1157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Outline</span></div>
<div class="txt" style="position:absolute; left:999px; top:1068px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:1297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Objective of this lecture</span></div>
<div class="txt" style="position:absolute; left:76px; top:1369px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">What is and why equality?</span></div>
<div class="txt" style="position:absolute; left:76px; top:1441px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Three ways to regard equality</span></div>
<div class="txt" style="position:absolute; left:76px; top:1513px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">== </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">vs. </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals()</span></div>
<div class="txt" style="position:absolute; left:76px; top:1585px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality of immutable types</span></div>
<div class="txt" style="position:absolute; left:76px; top:1657px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">contract</span></div>
<div class="txt" style="position:absolute; left:76px; top:1729px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality of Mutable Types</span></div>
<div class="txt" style="position:absolute; left:76px; top:1801px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Final Rule for </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:76px; top:1873px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Autoboxing and Equality</span></div>
<img id="background" style="position:absolute; left:0px; top:2050px;" width="1440" height="1080" src="page3.png"> <img id="background" style="position:absolute; left:1440px; top:2050px;" width="1440" height="1080" src="page-000003.png">
<div class="txt" style="position:absolute; left:33px; top:2157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Objective of this lecture</span></div>
<div class="txt" style="position:absolute; left:999px; top:2068px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:2297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Understand equality defined in terms of the abstraction function,</span></div>
<div class="txt" style="position:absolute; left:112px; top:2342px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">an equivalence relation, and observations. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">等价性的三种理解</span></div>
<div class="txt" style="position:absolute; left:76px; top:2414px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Differentiate between reference equality and object equality </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">引用</span></div>
<div class="txt" style="position:absolute; left:112px; top:2462px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">等价和对象等价的区别</span></div>
<div class="txt" style="position:absolute; left:76px; top:2537px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Differentiate between strict observational and behavioral equality</span></div>
<div class="txt" style="position:absolute; left:112px; top:2582px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">for mutable types. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可变类型的观察性等价和行为性等价的区别</span></div>
<div class="txt" style="position:absolute; left:76px; top:2657px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Understand the Object contract and be able to implement equality</span></div>
<div class="txt" style="position:absolute; left:112px; top:2702px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">correctly for mutable and immutable types. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">理解</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Object</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类的契约，</span></div>
<div class="txt" style="position:absolute; left:112px; top:2750px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">能够正确实现可变类型和不可变类型的等价</span></div>
<img id="background" style="position:absolute; left:0px; top:3050px;" width="1440" height="1080" src="page4.png"> <img id="background" style="position:absolute; left:1440px; top:3050px;" width="1440" height="1080" src="page-000004.png">
<div class="txt" style="position:absolute; left:1105px; top:3068px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:266px; top:3465px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">1 What is and why equality?</span></div>
<img id="background" style="position:absolute; left:0px; top:4050px;" width="1440" height="1080" src="page5.png"> <img id="background" style="position:absolute; left:1440px; top:4050px;" width="1440" height="1080" src="page-000005.png">
<div class="txt" style="position:absolute; left:33px; top:4157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality operation on an ADT</span></div>
<div class="txt" style="position:absolute; left:999px; top:4068px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:4297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">ADT is </span><span id="f15" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">data abstraction </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">by creating types that are characterized by</span></div>
<div class="txt" style="position:absolute; left:112px; top:4347px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">their operations, not by their representation.</span></div>
<div class="txt" style="position:absolute; left:76px; top:4417px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For an abstract data type, the </span><span id="f15" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">abstraction function </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">explains how to</span></div>
<div class="txt" style="position:absolute; left:112px; top:4467px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">interpret a concrete representation value as a value of the abstract</span></div>
<div class="txt" style="position:absolute; left:112px; top:4515px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">type, and we saw how the choice of abstraction function determines</span></div>
<div class="txt" style="position:absolute; left:112px; top:4563px;"><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">how to write the code implementing each of the ADT’s operations</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:112px; top:4606px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">AF</span><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">决定了</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">ADT</span><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">中各操作的实现</span></div>
<div class="txt" style="position:absolute; left:76px; top:4681px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">The abstraction function (AF) gives a way to cleanly define the</span></div>
<div class="txt" style="position:absolute; left:112px; top:4726px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">equality operation on an ADT. </span><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可通过</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">AF</span><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">判定</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">ADT</span><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">中操作的等价</span></div>
<img id="background" style="position:absolute; left:0px; top:5050px;" width="1440" height="1080" src="page6.png"> <img id="background" style="position:absolute; left:1440px; top:5050px;" width="1440" height="1080" src="page-000006.png">
<div class="txt" style="position:absolute; left:33px; top:5156px;"><span id="f10" style="font-size:56px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">of values in a data type?</span></div>
<div class="txt" style="position:absolute; left:999px; top:5068px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:5297px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the physical world, every object is distinct </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">at some level, even</span></div>
<div class="txt" style="position:absolute; left:112px; top:5347px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">two snowflakes are different, even if the distinction is just the</span></div>
<div class="txt" style="position:absolute; left:112px; top:5390px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">position they occupy in space.</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">现实世界中任何对象都是独一无二的</span></div>
<div class="txt" style="position:absolute; left:76px; top:5465px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">So two physical objects are never truly “equal” to each other; they</span></div>
<div class="txt" style="position:absolute; left:112px; top:5510px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">only have degrees of similarity. </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">现实世界中任意两个对象是不相等的</span></div>
<div class="txt" style="position:absolute; left:76px; top:5585px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the world of human language, however, and in the world of</span></div>
<div class="txt" style="position:absolute; left:112px; top:5635px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">mathematical concepts, you can have multiple names for the same</span></div>
<div class="txt" style="position:absolute; left:112px; top:5678px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">thing</span><span id="f34" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在数学概念中，可以用多个名字指代相同的事物</span></div>
<div class="txt" style="position:absolute; left:76px; top:5753px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">So it’s natural to ask when two expressions represent the same thing:</span></div>
<div class="txt" style="position:absolute; left:112px; top:5803px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">1+2, √9, and 3 are alternative expressions for the same ideal</span></div>
<div class="txt" style="position:absolute; left:112px; top:5846px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">mathematical value. </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">什么情况下两个概念是相同的？</span></div>
<img id="background" style="position:absolute; left:0px; top:6050px;" width="1440" height="1080" src="page7.png"> <img id="background" style="position:absolute; left:1440px; top:6050px;" width="1440" height="1080" src="page-000007.png">
<div class="txt" style="position:absolute; left:1105px; top:6068px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:214px; top:6465px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">2 Three ways to regard equality</span></div>
<img id="background" style="position:absolute; left:0px; top:7050px;" width="1440" height="1080" src="page8.png"> <img id="background" style="position:absolute; left:1440px; top:7050px;" width="1440" height="1080" src="page-000008.png">
<div class="txt" style="position:absolute; left:33px; top:7157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Using AF or using a relation</span></div>
<div class="txt" style="position:absolute; left:999px; top:7068px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:7297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using an abstraction function </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. Recall that an abstraction function</span></div>
<div class="txt" style="position:absolute; left:112px; top:7346px;"><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">AF</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">: </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">R → A </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">maps concrete instances of a data type to their</span></div>
<div class="txt" style="position:absolute; left:112px; top:7394px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">corresponding abstract values. To use </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">AF </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">as a definition for equality,</span></div>
<div class="txt" style="position:absolute; left:112px; top:7442px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">we would say that </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">a </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">b </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">if and only if </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">AF(a)=AF(b).</span></div>
<div class="txt" style="position:absolute; left:76px; top:7513px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using a relation </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. An </span><span id="f34" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">equivalence </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is a relation </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">E </span><span id="f38" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">⊆ </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">T x T </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">that is:</span></div>
<div class="txt" style="position:absolute; left:112px; top:7576px;"><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Reflexive</span><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">自反的</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E(t,t) </span><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">∀</span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t</span><span id="f51" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">∈</span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">T</span></div>
<div class="txt" style="position:absolute; left:112px; top:7636px;"><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">symmetric</span><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">对称的</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E(t,u) </span><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">⇒ </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E(u,t)</span></div>
<div class="txt" style="position:absolute; left:112px; top:7697px;"><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">transitive</span><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">传递的</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E(t,u) </span><span id="f51" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">∧ </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E(u,v) </span><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">⇒ </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E(t,v)</span></div>
<div class="txt" style="position:absolute; left:112px; top:7761px;"><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">To use </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">as a definition for equality, we would say that </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">a </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">b </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">if and</span></div>
<div class="txt" style="position:absolute; left:148px; top:7804px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">only if </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">E(a,b)</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:76px; top:7870px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">These two notions are equivalent.</span></div>
<div class="txt" style="position:absolute; left:112px; top:7937px;"><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">An equivalence relation induces an abstraction function (the relation</span></div>
<div class="txt" style="position:absolute; left:148px; top:7980px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">partitions T, so AF maps each element to its partition class).</span></div>
<div class="txt" style="position:absolute; left:112px; top:8041px;"><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The relation induced by an abstraction function is an equivalence relation.</span></div>
<img id="background" style="position:absolute; left:0px; top:8050px;" width="1440" height="1080" src="page9.png"> <img id="background" style="position:absolute; left:1440px; top:8050px;" width="1440" height="1080" src="page-000009.png">
<div class="txt" style="position:absolute; left:33px; top:8157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Using observation</span></div>
<div class="txt" style="position:absolute; left:999px; top:8068px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:8297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A third way we can talk about the equality between abstract values is</span></div>
<div class="txt" style="position:absolute; left:112px; top:8347px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in terms of what an outsider (a client) can observe about them:</span></div>
<div class="txt" style="position:absolute; left:76px; top:8417px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using observation</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">We can say that two objects are equal when</span></div>
<div class="txt" style="position:absolute; left:112px; top:8467px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">they cannot be distinguished by observation </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">– </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">every operation we</span></div>
<div class="txt" style="position:absolute; left:112px; top:8510px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">can apply produces the same result for both objects. </span><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">从观察的角度</span></div>
<div class="txt" style="position:absolute; left:112px; top:8558px;"><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，对两个对象的任何同一操作都会得到相同的结果</span></div>
<div class="txt" style="position:absolute; left:112px; top:8627px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Consider the set expressions </span><span id="f37" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{1,2} </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f37" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{2,1}</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">. Using the observer</span></div>
<div class="txt" style="position:absolute; left:148px; top:8667px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">operations available for sets, cardinality</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">基数 </span><span id="f44" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">|…| </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and membership </span><span id="f47" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">∈</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">,</span></div>
<div class="txt" style="position:absolute; left:148px; top:8714px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">these expressions are indistinguishable:</span></div>
<div class="txt" style="position:absolute; left:148px; top:8770px;"><span id="f44" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">|{1,2}| = 2 </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">|{2,1}| = 2</span></div>
<div class="txt" style="position:absolute; left:148px; top:8815px;"><span id="f44" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">1 </span><span id="f47" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">∈ </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">{1,2} </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">is true, and </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">1 </span><span id="f47" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">∈ </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">{2,1} </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">is true</span></div>
<div class="txt" style="position:absolute; left:148px; top:8861px;"><span id="f44" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">2 </span><span id="f47" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">∈ </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">{1,2} </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">is true, and </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">2 </span><span id="f47" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">∈ </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">{2,1} </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">is true</span></div>
<div class="txt" style="position:absolute; left:148px; top:8907px;"><span id="f44" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">3 </span><span id="f47" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">∈ </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">{1,2} </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">is false, and </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">3 </span><span id="f47" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">∈ </span><span id="f37" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">{2,1} </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">is false</span></div>
<div class="txt" style="position:absolute; left:76px; top:8964px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">In terms of ADT, “observation” means calling operations on the</span></div>
<div class="txt" style="position:absolute; left:112px; top:9014px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">objects. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">So </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">two objects are equal if and only if they cannot be</span></div>
<div class="txt" style="position:absolute; left:112px; top:9062px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">distinguished by calling any operations of the abstract data type</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<img id="background" style="position:absolute; left:0px; top:10778px;" width="1440" height="1080" src="page10.png"> <img id="background" style="position:absolute; left:1440px; top:10778px;" width="1440" height="1080" src="page-000010.png">
<div class="txt" style="position:absolute; left:33px; top:10885px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example: Duration</span></div>
<div class="txt" style="position:absolute; left:999px; top:10796px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:11025px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Here’s a simple example of an immutable ADT.</span></div>
<div class="txt" style="position:absolute; left:76px; top:11601px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Now which of the following values should be considered equal?</span></div>
<div class="txt" style="position:absolute; left:746px; top:11684px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Think in terms of both the abstraction-</span></div>
<div class="txt" style="position:absolute; left:746px; top:11727px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">function definition of equality, and the</span></div>
<div class="txt" style="position:absolute; left:746px; top:11770px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">observational equality definition.</span></div>
<img id="background" style="position:absolute; left:0px; top:11970px;" width="1440" height="1080" src="page11.png"> <img id="background" style="position:absolute; left:1440px; top:11970px;" width="1440" height="1080" src="page-000011.png">
<div class="txt" style="position:absolute; left:1105px; top:11988px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:432px; top:12384px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">3 </span><span id="f13" style="font-size:47px;vertical-align:baseline;color:rgba(0,0,0,1);">== </span><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">vs. </span><span id="f13" style="font-size:47px;vertical-align:baseline;color:rgba(0,0,0,1);">equals()</span></div>
<img id="background" style="position:absolute; left:0px; top:13162px;" width="1440" height="1080" src="page12.png"> <img id="background" style="position:absolute; left:1440px; top:13162px;" width="1440" height="1080" src="page-000012.png">
<div class="txt" style="position:absolute; left:33px; top:13269px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">== vs. equals()</span></div>
<div class="txt" style="position:absolute; left:999px; top:13180px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:13409px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Java has two different operations for testing</span></div>
<div class="txt" style="position:absolute; left:112px; top:13459px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">equality, with different semantics.</span></div>
<div class="txt" style="position:absolute; left:112px; top:13523px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">The </span><span id="f19" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">== </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">operator compares references.</span></div>
<div class="txt" style="position:absolute; left:148px; top:13567px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It tests referential equality. Two references are</span></div>
<div class="txt" style="position:absolute; left:148px; top:13610px;"><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">== </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">if they point to the same storage in memory.</span></div>
<div class="txt" style="position:absolute; left:148px; top:13653px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">In terms of the snapshot diagrams, two references</span></div>
<div class="txt" style="position:absolute; left:148px; top:13696px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">are </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">== </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">if their arrows point to the same object</span></div>
<div class="txt" style="position:absolute; left:148px; top:13740px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">bubble.</span></div>
<div class="txt" style="position:absolute; left:112px; top:13800px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">The equals() operation compares object contents </span><span id="f33" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">in other words, object</span></div>
<div class="txt" style="position:absolute; left:148px; top:13844px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equality.</span></div>
<div class="txt" style="position:absolute; left:76px; top:13909px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The equals operation has to be defined appropriately for every</span></div>
<div class="txt" style="position:absolute; left:112px; top:13959px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">abstract data type.</span></div>
<div class="txt" style="position:absolute; left:76px; top:14029px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f33" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When we define a new data type, it’s our responsibility to decide</span></div>
<div class="txt" style="position:absolute; left:112px; top:14079px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">what object equality means for values of the data type, and</span></div>
<div class="txt" style="position:absolute; left:112px; top:14123px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implement the </span><span id="f23" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">operation appropriately. </span><span id="f47" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">定义新数据类型</span></div>
<div class="txt" style="position:absolute; left:112px; top:14171px;"><span id="f47" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">时，需要考虑等价的含义，然后实现</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f47" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法。</span></div>
<img id="background" style="position:absolute; left:0px; top:14354px;" width="1440" height="1080" src="page13.png"> <img id="background" style="position:absolute; left:1440px; top:14354px;" width="1440" height="1080" src="page-000013.png">
<div class="txt" style="position:absolute; left:999px; top:14372px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:33px; top:14461px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The == operator vs. equals method</span></div>
<div class="txt" style="position:absolute; left:76px; top:14601px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For primitive data type you </span><span id="f15" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">must </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">use ==</span></div>
<div class="txt" style="position:absolute; left:76px; top:14673px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For object reference types</span></div>
<div class="txt" style="position:absolute; left:112px; top:14739px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The == operator provides </span><span id="f23" style="font-size:33px;vertical-align:baseline;color:rgba(0,0,0,1);">identity semantics</span></div>
<div class="txt" style="position:absolute; left:112px; top:14800px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">In java</span><span id="f23" style="font-size:33px;vertical-align:baseline;color:rgba(0,0,0,1);">, == </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">just tests reference identity, it doesn’t compare object contents.</span></div>
<div class="txt" style="position:absolute; left:112px; top:14860px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Exactly as implemented by </span><span id="f32" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Object.equals, </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Even if </span><span id="f32" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Object.equals</span></div>
<div class="txt" style="position:absolute; left:148px; top:14904px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">has been overridden</span></div>
<div class="txt" style="position:absolute; left:112px; top:14964px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">This is seldom what you want!</span></div>
<div class="txt" style="position:absolute; left:112px; top:15025px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You should (almost) always use .equals</span></div>
<div class="txt" style="position:absolute; left:76px; top:15090px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using </span><span id="f32" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">== </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">on an object reference is a </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">bad smell in code</span></div>
<div class="txt" style="position:absolute; left:220px; top:15173px;"><span id="f32" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuilder a = new StringBuilder("yes");</span></div>
<div class="txt" style="position:absolute; left:220px; top:15229px;"><span id="f32" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuilder b = new StringBuilder("yes");</span></div>
<div class="txt" style="position:absolute; left:220px; top:15279px;"><span id="f32" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">if (a==b) { // </span><span id="f57" style="font-size:11px;vertical-align:baseline;color:rgba(255,0,0,1);">a bug!!</span></div>
<div class="txt" style="position:absolute; left:282px; top:15330px;"><span id="f32" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println</span><span id="f60" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">(“a and b are the same");</span></div>
<div class="txt" style="position:absolute; left:220px; top:15380px;"><span id="f32" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:15546px;" width="1440" height="1080" src="page14.png"> <img id="background" style="position:absolute; left:1440px; top:15546px;" width="1440" height="1080" src="page-000014.png">
<div class="txt" style="position:absolute; left:33px; top:15653px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What does this print?</span></div>
<div class="txt" style="position:absolute; left:999px; top:15564px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:147px; top:15793px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public class Name {</span></div>
<div class="txt" style="position:absolute; left:199px; top:15831px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">private final String first, last;</span></div>
<div class="txt" style="position:absolute; left:199px; top:15870px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f15" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">Name</span><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">(String first, String last) {</span></div>
<div class="txt" style="position:absolute; left:252px; top:15908px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">if (first == null || last == null)</span></div>
<div class="txt" style="position:absolute; left:322px; top:15947px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">throw new NullPointerException();</span></div>
<div class="txt" style="position:absolute; left:252px; top:15985px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">this.first = first;</span></div>
<div class="txt" style="position:absolute; left:252px; top:16023px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">this.last = last;</span></div>
<div class="txt" style="position:absolute; left:199px; top:16062px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:199px; top:16100px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public boolean </span><span id="f15" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">equals</span><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">(Name o) {</span></div>
<div class="txt" style="position:absolute; left:252px; top:16139px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">return first.equals(o.first) &amp;&amp; last.equals(o.last);</span></div>
<div class="txt" style="position:absolute; left:199px; top:16177px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:199px; top:16216px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public int </span><span id="f15" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode</span><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">() {</span></div>
<div class="txt" style="position:absolute; left:252px; top:16254px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">return 31 * first.hashCode() + last.hashCode();</span></div>
<div class="txt" style="position:absolute; left:199px; top:16292px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:199px; top:16331px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) {</span></div>
<div class="txt" style="position:absolute; left:252px; top:16369px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Set&lt;Name&gt; s = new HashSet&lt;&gt;();</span></div>
<div class="txt" style="position:absolute; left:252px; top:16407px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">s.add(new Name("Mickey", "Mouse"));</span></div>
<div class="txt" style="position:absolute; left:252px; top:16446px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(s.contains(new Name("Mickey", "Mouse")));</span></div>
<div class="txt" style="position:absolute; left:199px; top:16484px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:147px; top:16523px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:575px; top:16522px;"><span id="f62" style="font-size:48px;vertical-align:baseline;color:rgba(255,0,0,1);">true or fasle</span><span id="f64" style="font-size:48px;vertical-align:baseline;color:rgba(255,0,0,1);">？</span></div>
<img id="background" style="position:absolute; left:0px; top:16738px;" width="1440" height="1080" src="page15.png"> <img id="background" style="position:absolute; left:1440px; top:16738px;" width="1440" height="1080" src="page-000015.png">
<div class="txt" style="position:absolute; left:33px; top:16845px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">How about this?</span></div>
<div class="txt" style="position:absolute; left:999px; top:16756px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:167px; top:16973px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public class Name {</span></div>
<div class="txt" style="position:absolute; left:217px; top:17009px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">private final String first, last;</span></div>
<div class="txt" style="position:absolute; left:217px; top:17045px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f15" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">Name</span><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">(String first, String last) {</span></div>
<div class="txt" style="position:absolute; left:266px; top:17081px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">if (first == null || last == null)</span></div>
<div class="txt" style="position:absolute; left:332px; top:17117px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">throw new NullPointerException();</span></div>
<div class="txt" style="position:absolute; left:266px; top:17153px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">this.first = first;</span></div>
<div class="txt" style="position:absolute; left:266px; top:17189px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">this.last = last;</span></div>
<div class="txt" style="position:absolute; left:217px; top:17225px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:217px; top:17261px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(255,0,0,1);">@Override </span><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public boolean </span><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(255,0,0,1);">equals(Object o) </span><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:266px; top:17297px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">if (!(o instanceof Name))</span></div>
<div class="txt" style="position:absolute; left:349px; top:17333px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">return false;</span></div>
<div class="txt" style="position:absolute; left:266px; top:17369px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">Name n = (Name) o;</span></div>
<div class="txt" style="position:absolute; left:266px; top:17405px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">return n.first.equals(first) &amp;&amp; n.last.equals(last);</span></div>
<div class="txt" style="position:absolute; left:217px; top:17441px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:217px; top:17477px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public int hashCode() {</span></div>
<div class="txt" style="position:absolute; left:266px; top:17513px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">return 31 * first.hashCode() + last.hashCode();</span></div>
<div class="txt" style="position:absolute; left:217px; top:17549px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:217px; top:17585px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) {</span></div>
<div class="txt" style="position:absolute; left:266px; top:17621px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">Set&lt;Name&gt; s = new HashSet&lt;&gt;();</span></div>
<div class="txt" style="position:absolute; left:266px; top:17657px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">s.add(new Name("Mickey", "Mouse"));</span></div>
<div class="txt" style="position:absolute; left:266px; top:17693px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(s.contains(new Name("Mickey", "Mouse")));</span></div>
<div class="txt" style="position:absolute; left:217px; top:17729px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:167px; top:17765px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:620px; top:17751px;"><span id="f41" style="font-size:48px;vertical-align:baseline;color:rgba(255,0,0,1);">true or fasle</span><span id="f43" style="font-size:48px;vertical-align:baseline;color:rgba(255,0,0,1);">？</span></div>
<img id="background" style="position:absolute; left:0px; top:17930px;" width="1440" height="1080" src="page16.png"> <img id="background" style="position:absolute; left:1440px; top:17930px;" width="1440" height="1080" src="page-000016.png">
<div class="txt" style="position:absolute; left:33px; top:18037px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Tips for overriding a method</span></div>
<div class="txt" style="position:absolute; left:999px; top:17948px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:18177px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you want to override a method:</span></div>
<div class="txt" style="position:absolute; left:112px; top:18244px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Make sure signatures match</span></div>
<div class="txt" style="position:absolute; left:112px; top:18300px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Use </span><span id="f20" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">@Override </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">so compiler has your back </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">让</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">compiler </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">协助检查覆盖方法</span></div>
<div class="txt" style="position:absolute; left:148px; top:18344px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和被覆盖的方法签名是否完全一致</span></div>
<div class="txt" style="position:absolute; left:112px; top:18408px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f33" style="font-size:33px;vertical-align:baseline;color:rgba(0,0,0,1);">Do </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">copy-and-paste declarations (or let IDE do it for you)</span></div>
<img id="background" style="position:absolute; left:0px; top:19122px;" width="1440" height="1080" src="page17.png"> <img id="background" style="position:absolute; left:1440px; top:19122px;" width="1440" height="1080" src="page-000017.png">
<div class="txt" style="position:absolute; left:1105px; top:19140px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:240px; top:19537px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">4 Equality of immutable types</span></div>
<img id="background" style="position:absolute; left:0px; top:20314px;" width="1440" height="1080" src="page18.png"> <img id="background" style="position:absolute; left:1440px; top:20314px;" width="1440" height="1080" src="page-000018.png">
<div class="txt" style="position:absolute; left:33px; top:20421px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality of Immutable Types</span></div>
<div class="txt" style="position:absolute; left:999px; top:20332px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:20561px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method is defined by </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, and its default</span></div>
<div class="txt" style="position:absolute; left:112px; top:20611px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementation looks like this:</span></div>
<div class="txt" style="position:absolute; left:76px; top:20969px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The default meaning of </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is the same as referential equality.</span></div>
<div class="txt" style="position:absolute; left:76px; top:21041px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For immutable data types, this is almost always wrong.</span></div>
<div class="txt" style="position:absolute; left:76px; top:21113px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">We have to override the </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method, replacing it with our</span></div>
<div class="txt" style="position:absolute; left:112px; top:21163px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">own implementation.</span></div>
<img id="background" style="position:absolute; left:0px; top:21506px;" width="1440" height="1080" src="page19.png"> <img id="background" style="position:absolute; left:1440px; top:21506px;" width="1440" height="1080" src="page-000019.png">
<div class="txt" style="position:absolute; left:37px; top:21614px;"><span id="f10" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">for this example</span></div>
<div class="txt" style="position:absolute; left:76px; top:21753px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f10" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">for the class </span><span id="f10" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Duration</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">:</span></div>
<div class="txt" style="position:absolute; left:999px; top:21524px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:22113px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">How about this code?</span></div>
<div class="txt" style="position:absolute; left:406px; top:22314px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,255,255,1);">???</span></div>
<div class="txt" style="position:absolute; left:76px; top:22401px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Why?</span></div>
<div class="txt" style="position:absolute; left:754px; top:22105px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Even though d2 and o2 end up referring</span></div>
<div class="txt" style="position:absolute; left:754px; top:22148px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to the very same object in memory, you</span></div>
<div class="txt" style="position:absolute; left:754px; top:22191px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">still get different results for them from</span></div>
<div class="txt" style="position:absolute; left:754px; top:22234px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<img id="background" style="position:absolute; left:0px; top:22698px;" width="1440" height="1080" src="page20.png"> <img id="background" style="position:absolute; left:1440px; top:22698px;" width="1440" height="1080" src="page-000020.png">
<div class="txt" style="position:absolute; left:33px; top:22805px;"><span id="f10" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What’s going on?</span></div>
<div class="txt" style="position:absolute; left:999px; top:22716px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:22945px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The class </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Duration </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">has overloaded the </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method, because</span></div>
<div class="txt" style="position:absolute; left:112px; top:22994px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the method signature was not identical to </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">’s.</span></div>
<div class="txt" style="position:absolute; left:76px; top:23065px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">We actually have two </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">methods in </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Duration </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">:</span></div>
<div class="txt" style="position:absolute; left:112px; top:23131px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">An implicit </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals(Object) </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">inherited from </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Object</span></div>
<div class="txt" style="position:absolute; left:112px; top:23192px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The new </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals(Duration</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">) .</span></div>
<div class="txt" style="position:absolute; left:76px; top:23621px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Java compiler selects between overloaded operations using the</span></div>
<div class="txt" style="position:absolute; left:112px; top:23671px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">compile-time </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">type of the parameters.</span></div>
<img id="background" style="position:absolute; left:0px; top:23890px;" width="1440" height="1080" src="page21.png"> <img id="background" style="position:absolute; left:1440px; top:23890px;" width="1440" height="1080" src="page-000021.png">
<div class="txt" style="position:absolute; left:33px; top:23997px;"><span id="f10" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What’s going on?</span></div>
<div class="txt" style="position:absolute; left:999px; top:23908px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:24137px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If we pass an </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reference, as in </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">d1.equals(o2) </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, we end up</span></div>
<div class="txt" style="position:absolute; left:112px; top:24186px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">calling the </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals(Object) </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementation.</span></div>
<div class="txt" style="position:absolute; left:76px; top:24257px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If we pass a </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Duration </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reference, as in </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">d1.equals(d2) </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, we end up</span></div>
<div class="txt" style="position:absolute; left:112px; top:24306px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">calling the </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals(Duration) </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">version.</span></div>
<div class="txt" style="position:absolute; left:76px; top:24377px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This happens even though </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">o2 </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">d2 </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">both point to the same object</span></div>
<div class="txt" style="position:absolute; left:112px; top:24422px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">at runtime! Equality has become inconsistent. </span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">即使</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">o2</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">d2</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在运行时</span></div>
<div class="txt" style="position:absolute; left:112px; top:24470px;"><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">指向了统一对象，但结果不同，出现了等价的不一致问题</span></div>
<img id="background" style="position:absolute; left:0px; top:25082px;" width="1440" height="1080" src="page22.png"> <img id="background" style="position:absolute; left:1440px; top:25082px;" width="1440" height="1080" src="page-000022.png">
<div class="txt" style="position:absolute; left:33px; top:25189px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Overload vs. override</span></div>
<div class="txt" style="position:absolute; left:999px; top:25100px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:25329px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It’s easy to make a mistake in the method signature, and overload a</span></div>
<div class="txt" style="position:absolute; left:112px; top:25379px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method when you meant to override it.</span></div>
<div class="txt" style="position:absolute; left:76px; top:25449px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Java’s annotation </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">@Override </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">should be used whenever your</span></div>
<div class="txt" style="position:absolute; left:112px; top:25499px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">intention is to override a method in your superclass.</span></div>
<div class="txt" style="position:absolute; left:76px; top:25569px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">With this annotation, the Java compiler will check that a method</span></div>
<div class="txt" style="position:absolute; left:112px; top:25619px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">with the same signature actually exists in the superclass, and give</span></div>
<div class="txt" style="position:absolute; left:112px; top:25667px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">you a compiler error if you’ve made a mistake in the signature.</span></div>
<img id="background" style="position:absolute; left:0px; top:26274px;" width="1440" height="1080" src="page23.png"> <img id="background" style="position:absolute; left:1440px; top:26274px;" width="1440" height="1080" src="page-000023.png">
<div class="txt" style="position:absolute; left:33px; top:26380px;"><span id="f10" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Override Example</span></div>
<div class="txt" style="position:absolute; left:999px; top:26292px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:122px; top:26522px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public final class PhoneNumber {</span></div>
<div class="txt" style="position:absolute; left:181px; top:26608px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short areaCode;</span></div>
<div class="txt" style="position:absolute; left:181px; top:26651px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short prefix;</span></div>
<div class="txt" style="position:absolute; left:181px; top:26694px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short lineNumber;</span></div>
<div class="txt" style="position:absolute; left:181px; top:26781px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">@Override</span></div>
<div class="txt" style="position:absolute; left:181px; top:26824px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public boolean equals(Object o) {</span></div>
<div class="txt" style="position:absolute; left:240px; top:26867px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if (!(o </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">instanceof </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">PhoneNumber))</span></div>
<div class="txt" style="position:absolute; left:299px; top:26910px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return false;</span></div>
<div class="txt" style="position:absolute; left:240px; top:26997px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">PhoneNumber pn = (PhoneNumber) o;</span></div>
<div class="txt" style="position:absolute; left:240px; top:27040px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">pn.lineNumber == lineNumber</span></div>
<div class="txt" style="position:absolute; left:378px; top:27083px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">&amp;&amp; pn.prefix == prefix</span></div>
<div class="txt" style="position:absolute; left:378px; top:27126px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">&amp;&amp; pn.areaCode == areaCode;</span></div>
<div class="txt" style="position:absolute; left:181px; top:27170px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:181px; top:27213px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">...</span></div>
<div class="txt" style="position:absolute; left:122px; top:27256px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:27466px;" width="1440" height="1080" src="page24.png"> <img id="background" style="position:absolute; left:1440px; top:27466px;" width="1440" height="1080" src="page-000024.png">
<div class="txt" style="position:absolute; left:33px; top:27573px;"><span id="f10" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">instanceof</span></div>
<div class="txt" style="position:absolute; left:999px; top:27484px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:27713px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f10" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">instanceof </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">operator tests whether an object is an instance of a</span></div>
<div class="txt" style="position:absolute; left:112px; top:27763px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">particular type.</span></div>
<div class="txt" style="position:absolute; left:76px; top:27833px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using </span><span id="f10" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">instanceof </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">dynamic type checking, </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">not the static type</span></div>
<div class="txt" style="position:absolute; left:112px; top:27883px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">checking.</span></div>
<div class="txt" style="position:absolute; left:76px; top:27953px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In general, using </span><span id="f10" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">instanceof </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in object-oriented programming is a</span></div>
<div class="txt" style="position:absolute; left:112px; top:28003px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">bad smell. It should be disallowed anywhere except for</span></div>
<div class="txt" style="position:absolute; left:112px; top:28051px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementing equals.</span></div>
<div class="txt" style="position:absolute; left:76px; top:28121px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f35" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This prohibition also includes other ways of inspecting objects’</span></div>
<div class="txt" style="position:absolute; left:112px; top:28171px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">runtime types.</span></div>
<div class="txt" style="position:absolute; left:112px; top:28235px;"><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">getClass() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is also disallowed.</span></div>
<div class="txt" style="position:absolute; left:112px; top:28353px;"><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">除了用于实现</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">方法，尽可能避免使用 </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">instanceof</span><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">getClass()</span><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">在运行</span></div>
<div class="txt" style="position:absolute; left:112px; top:28396px;"><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">时检测对象的类型，存在安全隐患，可以使用更安全的替代方法！</span></div>
<img id="background" style="position:absolute; left:0px; top:28658px;" width="1440" height="1080" src="page25.png"> <img id="background" style="position:absolute; left:1440px; top:28658px;" width="1440" height="1080" src="page-000025.png">
<div class="txt" style="position:absolute; left:1105px; top:28676px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:367px; top:29072px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">5 The </span><span id="f13" style="font-size:47px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">contract</span></div>
<img id="background" style="position:absolute; left:0px; top:29850px;" width="1440" height="1080" src="page26.png"> <img id="background" style="position:absolute; left:1440px; top:29850px;" width="1440" height="1080" src="page-000026.png">
<div class="txt" style="position:absolute; left:999px; top:29868px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:33px; top:29956px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The contract of </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">in </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">Object</span></div>
<div class="txt" style="position:absolute; left:76px; top:30097px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When you override the equals method of Object, you must adhere</span></div>
<div class="txt" style="position:absolute; left:112px; top:30142px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to its general contract: </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">重写</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Object</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类中</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">时，需要满足约定：</span></div>
<div class="txt" style="position:absolute; left:112px; top:30211px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">must define an equivalence relation </span><span id="f35" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that is, a relation that is</span></div>
<div class="txt" style="position:absolute; left:148px; top:30251px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">reflexive, symmetric, and transitive; </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">满足等价性</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">自反，对称，传递</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:112px; top:30315px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">must be consistent: repeated calls to the method must yield the</span></div>
<div class="txt" style="position:absolute; left:148px; top:30359px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">same result provided no information used in equals comparisons on the</span></div>
<div class="txt" style="position:absolute; left:148px; top:30398px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object is modified; </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">一致性，在比较中用到的信息没有被修改的情况下，多</span></div>
<div class="txt" style="position:absolute; left:148px; top:30441px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">次比较结果应始终相同</span></div>
<div class="txt" style="position:absolute; left:112px; top:30505px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">for a non-null reference </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">x </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">, </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">x.equals(null) </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should return </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">false</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">;</span></div>
<div class="txt" style="position:absolute; left:112px; top:30566px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode must produce the same result for two objects that are deemed</span></div>
<div class="txt" style="position:absolute; left:148px; top:30605px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">equal by the equals method. </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">使用</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">方法判定相等的两个对象，其</span></div>
<div class="txt" style="position:absolute; left:148px; top:30649px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">必须产生相同的结果。</span></div>
<img id="background" style="position:absolute; left:0px; top:31042px;" width="1440" height="1080" src="page27.png"> <img id="background" style="position:absolute; left:1440px; top:31042px;" width="1440" height="1080" src="page-000027.png">
<div class="txt" style="position:absolute; left:33px; top:31148px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">contract</span></div>
<div class="txt" style="position:absolute; left:999px; top:31060px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:31289px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The equals method implements an </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">equivalence relation</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">:</span></div>
<div class="txt" style="position:absolute; left:112px; top:31356px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Reflexive</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: For any non-null reference value x, x.equals(x) must return</span></div>
<div class="txt" style="position:absolute; left:148px; top:31395px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">true. </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">自反性</span></div>
<div class="txt" style="position:absolute; left:112px; top:31459px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Symmetric</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: For any non-null reference values x and y, x.equals(y) must</span></div>
<div class="txt" style="position:absolute; left:148px; top:31499px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">return true if and only if y.equals(x) returns true. </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对称性</span></div>
<div class="txt" style="position:absolute; left:112px; top:31563px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Transitive</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: For any non-null reference values x, y, z, if x.equals(y) returns</span></div>
<div class="txt" style="position:absolute; left:148px; top:31602px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">true and y.equals(z) returns true, then x.equals(z) mus return true. </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">传递性</span></div>
<div class="txt" style="position:absolute; left:112px; top:31667px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Consistent</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: For any non-null reference values x and y, multiple</span></div>
<div class="txt" style="position:absolute; left:148px; top:31710px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">invocations of x.equals(y) consistently return true or consistently return</span></div>
<div class="txt" style="position:absolute; left:148px; top:31753px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">false, provided no information used in equals comparisons on the objects</span></div>
<div class="txt" style="position:absolute; left:148px; top:31792px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is modified. </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">一致性</span></div>
<div class="txt" style="position:absolute; left:112px; top:31853px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For any non-null reference value x, x.equals(null) must return false. </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">空值</span></div>
<div class="txt" style="position:absolute; left:148px; top:31896px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">处理</span></div>
<div class="txt" style="position:absolute; left:76px; top:31966px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f83" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is a global equivalence relation over all objects. </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">是所</span></div>
<div class="txt" style="position:absolute; left:112px; top:32011px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">有对象的全局等价关系</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对所有对象都生效</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<img id="background" style="position:absolute; left:0px; top:32234px;" width="1440" height="1080" src="page28.png"> <img id="background" style="position:absolute; left:1440px; top:32234px;" width="1440" height="1080" src="page-000028.png">
<div class="txt" style="position:absolute; left:33px; top:32340px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">contract in English</span></div>
<div class="txt" style="position:absolute; left:999px; top:32252px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:32481px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reflexive </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">every object is equal to itself</span></div>
<div class="txt" style="position:absolute; left:76px; top:32553px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Symmetric </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">if a.equals(b) then b.equals(a)</span></div>
<div class="txt" style="position:absolute; left:76px; top:32625px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Transitive </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">if a.equals(b) and b.equals(c), then a.equals(c)</span></div>
<div class="txt" style="position:absolute; left:76px; top:32697px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Consistent</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">equal objects stay equal unless mutated</span></div>
<div class="txt" style="position:absolute; left:76px; top:32769px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f34" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“Non</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-</span><span id="f34" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">null” </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">a.equals(null) returns false</span></div>
<div class="txt" style="position:absolute; left:76px; top:32841px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Taken together these ensure that equals is a global </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">equivalence</span></div>
<div class="txt" style="position:absolute; left:112px; top:32891px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">relation </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">over all objects</span></div>
<img id="background" style="position:absolute; left:0px; top:33426px;" width="1440" height="1080" src="page29.png"> <img id="background" style="position:absolute; left:1440px; top:33426px;" width="1440" height="1080" src="page-000029.png">
<div class="txt" style="position:absolute; left:999px; top:33444px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:33px; top:33533px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Breaking the Equivalence Relation</span></div>
<div class="txt" style="position:absolute; left:76px; top:33673px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">We have to make sure that the definition of equality implemented</span></div>
<div class="txt" style="position:absolute; left:112px; top:33722px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">by </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is actually an equivalence relation as defined earlier:</span></div>
<div class="txt" style="position:absolute; left:112px; top:33771px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reflexive, symmetric, and transitive.</span></div>
<div class="txt" style="position:absolute; left:112px; top:33836px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If it isn’t, then operations that depend on equality (like sets, searching)</span></div>
<div class="txt" style="position:absolute; left:148px; top:33879px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">will behave erratically and unpredictably.</span></div>
<div class="txt" style="position:absolute; left:112px; top:33939px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You don’t want to program with a data type in which sometimes </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">a </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">equals</span></div>
<div class="txt" style="position:absolute; left:148px; top:33982px;"><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">b </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">, but </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">b </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">doesn’t equal </span><span id="f16" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">a </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:112px; top:34043px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Subtle and painful bugs will result.</span></div>
<div class="txt" style="position:absolute; left:246px; top:34419px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(50,50,50,1);">Which property of the equivalence relation is violated?</span></div>
<img id="background" style="position:absolute; left:0px; top:34618px;" width="1440" height="1080" src="page30.png"> <img id="background" style="position:absolute; left:1440px; top:34618px;" width="1440" height="1080" src="page-000030.png">
<div class="txt" style="position:absolute; left:33px; top:34725px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Breaking Hash Tables</span></div>
<div class="txt" style="position:absolute; left:999px; top:34636px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:34865px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">A hash table is a representation for a mapping: an abstract data type</span></div>
<div class="txt" style="position:absolute; left:112px; top:34910px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">that maps keys to values. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">哈希表实现了键</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">-</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">值之间的映射</span></div>
<div class="txt" style="position:absolute; left:112px; top:34980px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Hash tables offer constant time lookup, so they tend to perform better than</span></div>
<div class="txt" style="position:absolute; left:148px; top:35023px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">trees or lists. Keys don’t have to be ordered, or have any particular</span></div>
<div class="txt" style="position:absolute; left:148px; top:35062px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">property, except for offering equals and hashCode. </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">哈希表的查询时间为常</span></div>
<div class="txt" style="position:absolute; left:148px; top:35106px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">数</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">线性</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，性能优于</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">trees</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">或</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">lists</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，且不需要排好序或其他特殊要求，除了需</span></div>
<div class="txt" style="position:absolute; left:148px; top:35149px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">要提供</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">方法。</span></div>
<img id="background" style="position:absolute; left:0px; top:35810px;" width="1440" height="1080" src="page31.png"> <img id="background" style="position:absolute; left:1440px; top:35810px;" width="1440" height="1080" src="page-000031.png">
<div class="txt" style="position:absolute; left:33px; top:35917px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Breaking Hash Tables</span></div>
<div class="txt" style="position:absolute; left:999px; top:35828px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:36057px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">How a hash table works:</span></div>
<div class="txt" style="position:absolute; left:112px; top:36124px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It contains an array that is initialized to a size corresponding to the number</span></div>
<div class="txt" style="position:absolute; left:148px; top:36163px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of elements that we expect to be inserted. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">包含一个数组</span></div>
<div class="txt" style="position:absolute; left:112px; top:36227px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When a key and a value are presented for insertion, we compute the</span></div>
<div class="txt" style="position:absolute; left:148px; top:36271px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">hashcode </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of the key, and convert it into an index in the array’s range (e.g.,</span></div>
<div class="txt" style="position:absolute; left:148px; top:36310px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">by a modulo division). The value is then inserted at that index. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">键值对中的</span></div>
<div class="txt" style="position:absolute; left:148px; top:36353px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">key</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">被映射为</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，对应到数组的</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">index</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">， </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">决定了数据被存储</span></div>
<div class="txt" style="position:absolute; left:148px; top:36396px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">到数组的那个位置</span></div>
<div class="txt" style="position:absolute; left:76px; top:36466px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">The rep invariant of a hash table includes the fundamental</span></div>
<div class="txt" style="position:absolute; left:112px; top:36516px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">constraint that keys are in the </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">slots </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">determined by their hash codes.</span></div>
<img id="background" style="position:absolute; left:0px; top:37002px;" width="1440" height="1080" src="page32.png"> <img id="background" style="position:absolute; left:1440px; top:37002px;" width="1440" height="1080" src="page-000032.png">
<div class="txt" style="position:absolute; left:33px; top:37109px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Breaking Hash Tables</span></div>
<div class="txt" style="position:absolute; left:999px; top:37020px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:37249px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Hashcodes are designed so that the keys will be spread evenly over</span></div>
<div class="txt" style="position:absolute; left:112px; top:37294px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the indices. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">h</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">ashcode</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">设计时会尽量确保均匀分布到数组</span></div>
<div class="txt" style="position:absolute; left:76px; top:37369px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">But occasionally a conflict occurs, and two keys are placed at the</span></div>
<div class="txt" style="position:absolute; left:112px; top:37419px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">same index. So rather than holding a single value at an index, a hash</span></div>
<div class="txt" style="position:absolute; left:112px; top:37466px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">table actually holds a list of key/value pairs, usually called a </span><span id="f28" style="font-size:37px;vertical-align:baseline;color:rgba(255,0,0,1);">hash</span></div>
<div class="txt" style="position:absolute; left:112px; top:37510px;"><span id="f28" style="font-size:37px;vertical-align:baseline;color:rgba(255,0,0,1);">bucket</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">当多个</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">key</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">散列到同一个</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">index</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">时</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">冲突</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，哈希表维护一个列表</span></div>
<div class="txt" style="position:absolute; left:112px; top:37558px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">来记录这些键值对</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(bucket)</span></div>
<img id="background" style="position:absolute; left:0px; top:38194px;" width="1440" height="1080" src="page33.png"> <img id="background" style="position:absolute; left:1440px; top:38194px;" width="1440" height="1080" src="page-000033.png">
<div class="txt" style="position:absolute; left:33px; top:38301px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Breaking Hash Tables</span></div>
<div class="txt" style="position:absolute; left:999px; top:38212px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:38441px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A key/value pair is implemented in Java simply as an object with two</span></div>
<div class="txt" style="position:absolute; left:112px; top:38491px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">fields.</span></div>
<div class="txt" style="position:absolute; left:76px; top:38561px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">On insertion, you add a pair to the list in the array slot determined by</span></div>
<div class="txt" style="position:absolute; left:112px; top:38606px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the hash code. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">首先利用</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode()</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">产生的</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">确定</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">slot(index)</span></div>
<div class="txt" style="position:absolute; left:76px; top:38681px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For lookup, you hash the key, find the right slot, and then examine each</span></div>
<div class="txt" style="position:absolute; left:112px; top:38726px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">of the pairs until one is found whose key equals the query key. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">再用</span></div>
<div class="txt" style="position:absolute; left:112px; top:38774px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法在</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">bucket</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">中找到匹配的</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">key</span></div>
<img id="background" style="position:absolute; left:0px; top:39386px;" width="1440" height="1080" src="page34.png"> <img id="background" style="position:absolute; left:1440px; top:39386px;" width="1440" height="1080" src="page-000034.png">
<div class="txt" style="position:absolute; left:33px; top:39493px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Breaking Hash Tables</span></div>
<div class="txt" style="position:absolute; left:999px; top:39404px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:870px; top:39521px;"><span id="f12" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Bucket</span></div>
<div class="txt" style="position:absolute; left:507px; top:40241px;"><span id="f12" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Slot</span></div>
<div class="txt" style="position:absolute; left:492px; top:40373px;"><span id="f12" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Hashcode</span></div>
<div class="txt" style="position:absolute; left:53px; top:40417px;"><span id="f12" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Hash Function </span><span id="f16" style="font-size:37px;vertical-align:baseline;color:rgba(255,0,0,1);">散列函数</span></div>
<img id="background" style="position:absolute; left:0px; top:40578px;" width="1440" height="1080" src="page35.png"> <img id="background" style="position:absolute; left:1440px; top:40578px;" width="1440" height="1080" src="page-000035.png">
<div class="txt" style="position:absolute; left:33px; top:40684px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">contract</span></div>
<div class="txt" style="position:absolute; left:999px; top:40596px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:40825px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Whenever it is invoked on the same object more than once during an</span></div>
<div class="txt" style="position:absolute; left:112px; top:40875px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">execution of an application, the hashCode method must consistently</span></div>
<div class="txt" style="position:absolute; left:112px; top:40923px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">return the same integer, provided no information used in equals</span></div>
<div class="txt" style="position:absolute; left:112px; top:40969px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">comparisons on the object is modified</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">只要比较操作用到的信息没有被修</span></div>
<div class="txt" style="position:absolute; left:112px; top:41014px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">改，那么对这同一个对象调用多次，</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode()</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">方法必须始终返回相同整数。</span></div>
<div class="txt" style="position:absolute; left:112px; top:41078px;"><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">This integer need not remain consistent from one execution of an application</span></div>
<div class="txt" style="position:absolute; left:148px; top:41117px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to another execution of the same application. </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">不要求程序的多次执行时相同</span></div>
<div class="txt" style="position:absolute; left:76px; top:41187px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If two objects are equal according to the equals(Object) method, then</span></div>
<div class="txt" style="position:absolute; left:112px; top:41237px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">calling the hashCode method on each of the two objects must</span></div>
<div class="txt" style="position:absolute; left:112px; top:41283px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">produce the same integer result. </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">如果</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">比较相等，则要求</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">相</span></div>
<div class="txt" style="position:absolute; left:112px; top:41328px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">等；如果</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">不等，则</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">是否相等均可，但最好不等</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">提升性能</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:112px; top:41392px;"><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It is not required that if two objects are unequal according to the</span></div>
<div class="txt" style="position:absolute; left:148px; top:41436px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">equals(Object) method, then calling the hashCode method on each of the two</span></div>
<div class="txt" style="position:absolute; left:148px; top:41479px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objects must produce distinct integer results. However, the programmer</span></div>
<div class="txt" style="position:absolute; left:148px; top:41522px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should be aware that producing distinct integer results for unequal objects</span></div>
<div class="txt" style="position:absolute; left:148px; top:41565px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">may improve the performance of hash tables.</span></div>
<img id="background" style="position:absolute; left:0px; top:41770px;" width="1440" height="1080" src="page36.png"> <img id="background" style="position:absolute; left:1440px; top:41770px;" width="1440" height="1080" src="page-000036.png">
<div class="txt" style="position:absolute; left:33px; top:41876px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">contract in English</span></div>
<div class="txt" style="position:absolute; left:999px; top:41788px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:42017px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Equal objects </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">must </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">have equal hash codes</span></div>
<div class="txt" style="position:absolute; left:112px; top:42084px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If you override equals you must override hashCode</span></div>
<div class="txt" style="position:absolute; left:112px; top:42140px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">两个对象</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">操作相等，则</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">必须相等。因此，重写</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">时，必</span></div>
<div class="txt" style="position:absolute; left:112px; top:42184px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">须重写</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">。</span></div>
<div class="txt" style="position:absolute; left:76px; top:42253px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Unequal objects </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">should </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">have different hash codes </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">能够提升性能</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">避免</span></div>
<div class="txt" style="position:absolute; left:112px; top:42298px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">了调用不必要的</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">操作</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:112px; top:42358px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Take all value fields into account when constructing it </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">构造</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">时考</span></div>
<div class="txt" style="position:absolute; left:148px; top:42402px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">虑对象的所有字段，以避免不相等对象产生相同</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span></div>
<div class="txt" style="position:absolute; left:76px; top:42468px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Hash code must not change unless object mutated. </span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">除非对象可变，否</span></div>
<div class="txt" style="position:absolute; left:112px; top:42517px;"><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">则</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">不能修改</span></div>
<img id="background" style="position:absolute; left:0px; top:42962px;" width="1440" height="1080" src="page37.png"> <img id="background" style="position:absolute; left:1440px; top:42962px;" width="1440" height="1080" src="page-000037.png">
<div class="txt" style="position:absolute; left:33px; top:43068px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Overriding </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:999px; top:42980px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:43209px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A simple and drastic way to ensure that the contract is met is for</span></div>
<div class="txt" style="position:absolute; left:112px; top:43259px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to always return some constant value, so every object’s</span></div>
<div class="txt" style="position:absolute; left:112px; top:43302px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">hash code is the same. </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">最简单方法：让所有对象的</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">为同一</span></div>
<div class="txt" style="position:absolute; left:112px; top:43350px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">常量，符合</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">contract</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，但降低了</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashTable</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">效率</span></div>
<div class="txt" style="position:absolute; left:112px; top:43420px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">This satisfies the Object contract, but it would have a disastrous</span></div>
<div class="txt" style="position:absolute; left:148px; top:43463px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">performance effect, since every key will be stored in the same slot, and</span></div>
<div class="txt" style="position:absolute; left:148px; top:43506px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">every lookup will degenerate to a linear search along a long list.</span></div>
<div class="txt" style="position:absolute; left:76px; top:43572px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The standard is to compute a hash code for each component of the</span></div>
<div class="txt" style="position:absolute; left:112px; top:43622px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">object that is used in the determination of equality (usually by</span></div>
<div class="txt" style="position:absolute; left:112px; top:43670px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">calling the hashCode method of each component), and then</span></div>
<div class="txt" style="position:absolute; left:112px; top:43713px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">combining these, throwing in a few arithmetic operations. </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">通过</span></div>
<div class="txt" style="position:absolute; left:112px; top:43761px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">equals</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">计算中用到的所有字段的</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">组合出新的</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode</span></div>
<div class="txt" style="position:absolute; left:76px; top:43836px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For Duration , this is easy, because the abstract value of the class is</span></div>
<div class="txt" style="position:absolute; left:112px; top:43886px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">already an integer value:</span></div>
<img id="background" style="position:absolute; left:0px; top:44154px;" width="1440" height="1080" src="page38.png"> <img id="background" style="position:absolute; left:1440px; top:44154px;" width="1440" height="1080" src="page-000038.png">
<div class="txt" style="position:absolute; left:33px; top:44261px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Breaking Hash Tables</span></div>
<div class="txt" style="position:absolute; left:999px; top:44172px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:44401px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Why the Object contract requires equal objects to have the same</span></div>
<div class="txt" style="position:absolute; left:112px; top:44451px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">hashcode?</span></div>
<div class="txt" style="position:absolute; left:112px; top:44516px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If two equal objects had distinct hashcodes, they might be placed in</span></div>
<div class="txt" style="position:absolute; left:148px; top:44559px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">different slots.</span></div>
<div class="txt" style="position:absolute; left:112px; top:44619px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">So if you attempt to lookup a value using a key equal to the one with</span></div>
<div class="txt" style="position:absolute; left:148px; top:44663px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">which it was inserted, the lookup may fail.</span></div>
<div class="txt" style="position:absolute; left:76px; top:44728px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f24" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">’s default </span><span id="f28" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementation is consistent with</span></div>
<div class="txt" style="position:absolute; left:112px; top:44778px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">its default </span><span id="f28" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">:</span></div>
<div class="txt" style="position:absolute; left:269px; top:45132px;"><span id="f36" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">大部分语言中都是采用对象的内存地址作为默认</span><span id="f39" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span></div>
<img id="background" style="position:absolute; left:0px; top:45346px;" width="1440" height="1080" src="page39.png"> <img id="background" style="position:absolute; left:1440px; top:45346px;" width="1440" height="1080" src="page-000039.png">
<div class="txt" style="position:absolute; left:33px; top:45453px;"><span id="f10" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">In our example…</span></div>
<div class="txt" style="position:absolute; left:999px; top:45364px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:45593px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Duration </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, since we haven’t overridden the default</span></div>
<div class="txt" style="position:absolute; left:112px; top:45642px;"><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">yet, we’re currently breaking the </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">contract:</span></div>
<div class="txt" style="position:absolute; left:76px; top:45929px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">d1 and d2 are </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equal() </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, but they have different hash codes.</span></div>
<div class="txt" style="position:absolute; left:76px; top:46001px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">How to fix it?</span></div>
<img id="background" style="position:absolute; left:0px; top:46538px;" width="1440" height="1080" src="page40.png"> <img id="background" style="position:absolute; left:1440px; top:46538px;" width="1440" height="1080" src="page-000040.png">
<div class="txt" style="position:absolute; left:33px; top:46644px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Overriding </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:999px; top:46556px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:46785px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Recent versions of Java now have a utility method</span></div>
<div class="txt" style="position:absolute; left:112px; top:46834px;"><span id="f17" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,255,1);">Objects.hash() </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">that makes it easier to implement a hash code</span></div>
<div class="txt" style="position:absolute; left:112px; top:46878px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">involving multiple fields. </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">此方法可以根据多个字段生成</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashcode</span></div>
<div class="txt" style="position:absolute; left:76px; top:47025px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Note that if you don’t override </span><span id="f11" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">at all, you’ll get the one</span></div>
<div class="txt" style="position:absolute; left:112px; top:47074px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">from </span><span id="f11" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, which is based on the address of the object.</span></div>
<div class="txt" style="position:absolute; left:76px; top:47145px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you have overridden </span><span id="f11" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, this will mean that you will have</span></div>
<div class="txt" style="position:absolute; left:112px; top:47195px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">almost certainly violated the contract. So as a general rule:</span></div>
<div class="txt" style="position:absolute; left:173px; top:47338px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">Always override </span><span id="f11" style="font-size:26px;vertical-align:baseline;color:rgba(192,0,0,1);">hashCode() </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">when you override </span><span id="f11" style="font-size:26px;vertical-align:baseline;color:rgba(192,0,0,1);">equals()</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">.</span></div>
<img id="background" style="position:absolute; left:0px; top:47730px;" width="1440" height="1080" src="page41.png"> <img id="background" style="position:absolute; left:1440px; top:47730px;" width="1440" height="1080" src="page-000041.png">
<div class="txt" style="position:absolute; left:33px; top:47837px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What does this print?</span></div>
<div class="txt" style="position:absolute; left:999px; top:47748px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:48625px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Name </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">overrides </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">but not </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">! The two </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Name </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">instances</span></div>
<div class="txt" style="position:absolute; left:112px; top:48675px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">are thus unequal.</span></div>
<img id="background" style="position:absolute; left:0px; top:48922px;" width="1440" height="1080" src="page42.png"> <img id="background" style="position:absolute; left:1440px; top:48922px;" width="1440" height="1080" src="page-000042.png">
<div class="txt" style="position:absolute; left:33px; top:49029px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">How do you fix it?</span></div>
<div class="txt" style="position:absolute; left:999px; top:48940px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:49169px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace the overloaded equals method with an overriding equals</span></div>
<div class="txt" style="position:absolute; left:112px; top:49219px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method.</span></div>
<img id="background" style="position:absolute; left:0px; top:50114px;" width="1440" height="1080" src="page43.png"> <img id="background" style="position:absolute; left:1440px; top:50114px;" width="1440" height="1080" src="page-000043.png">
<div class="txt" style="position:absolute; left:33px; top:50220px;"><span id="f10" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">override example</span></div>
<div class="txt" style="position:absolute; left:999px; top:50132px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:88px; top:50396px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public final class PhoneNumber {</span></div>
<div class="txt" style="position:absolute; left:147px; top:50482px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short areaCode;</span></div>
<div class="txt" style="position:absolute; left:147px; top:50525px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short prefix;</span></div>
<div class="txt" style="position:absolute; left:147px; top:50568px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short lineNumber;</span></div>
<div class="txt" style="position:absolute; left:147px; top:50655px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">@Override</span></div>
<div class="txt" style="position:absolute; left:147px; top:50698px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public int hashCode() {</span></div>
<div class="txt" style="position:absolute; left:226px; top:50741px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int result = </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">17; </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// Nonzero is good</span></div>
<div class="txt" style="position:absolute; left:226px; top:50784px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">result = </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">31 </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* result + areaCode; // Constant must be odd</span></div>
<div class="txt" style="position:absolute; left:226px; top:50828px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">result = </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">31 </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* result + prefix; // " " " "</span></div>
<div class="txt" style="position:absolute; left:226px; top:50871px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">result = </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">31 </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* result + lineNumber; // " " " "</span></div>
<div class="txt" style="position:absolute; left:226px; top:50957px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return result;</span></div>
<div class="txt" style="position:absolute; left:147px; top:51001px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:147px; top:51044px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">...</span></div>
<div class="txt" style="position:absolute; left:88px; top:51087px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:51306px;" width="1440" height="1080" src="page44.png"> <img id="background" style="position:absolute; left:1440px; top:51306px;" width="1440" height="1080" src="page-000044.png">
<div class="txt" style="position:absolute; left:33px; top:51412px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Alternative </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">override</span></div>
<div class="txt" style="position:absolute; left:76px; top:51553px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Less efficient, but otherwise equally good!</span></div>
<div class="txt" style="position:absolute; left:999px; top:51324px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:102px; top:51701px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public final class PhoneNumber {</span></div>
<div class="txt" style="position:absolute; left:161px; top:51788px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short areaCode;</span></div>
<div class="txt" style="position:absolute; left:161px; top:51831px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short prefix;</span></div>
<div class="txt" style="position:absolute; left:161px; top:51874px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private final short lineNumber;</span></div>
<div class="txt" style="position:absolute; left:161px; top:51960px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">@Override</span></div>
<div class="txt" style="position:absolute; left:161px; top:52004px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public int hashCode() {</span></div>
<div class="txt" style="position:absolute; left:240px; top:52047px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">short[] hashArray = {areaCode,prefix,lineNumber};</span></div>
<div class="txt" style="position:absolute; left:240px; top:52090px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(50,50,205,1);">return Arrays.hashCode(hashArray);</span></div>
<div class="txt" style="position:absolute; left:161px; top:52133px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:161px; top:52176px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">...</span></div>
<div class="txt" style="position:absolute; left:102px; top:52220px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:52498px;" width="1440" height="1080" src="page45.png"> <img id="background" style="position:absolute; left:1440px; top:52498px;" width="1440" height="1080" src="page-000045.png">
<div class="txt" style="position:absolute; left:33px; top:52605px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Recommended reading materials</span></div>
<div class="txt" style="position:absolute; left:999px; top:52516px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:52745px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Item 10: Obey the general contract when overriding equals</span></div>
<div class="txt" style="position:absolute; left:76px; top:52817px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Item 11: Always override hashCode when you override equals</span></div>
<div class="txt" style="position:absolute; left:76px; top:52886px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">《</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Effective Java</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">》 </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Third Edition</span></div>
<img id="background" style="position:absolute; left:0px; top:53690px;" width="1440" height="1080" src="page46.png"> <img id="background" style="position:absolute; left:1440px; top:53690px;" width="1440" height="1080" src="page-000046.png">
<div class="txt" style="position:absolute; left:1105px; top:53708px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:270px; top:54105px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">6 Equality of Mutable Types</span></div>
<img id="background" style="position:absolute; left:0px; top:54882px;" width="1440" height="1080" src="page47.png"> <img id="background" style="position:absolute; left:1440px; top:54882px;" width="1440" height="1080" src="page-000047.png">
<div class="txt" style="position:absolute; left:33px; top:54989px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality of Mutable Types</span></div>
<div class="txt" style="position:absolute; left:999px; top:54900px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:55129px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality: </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">two objects are equal when they cannot be distinguished</span></div>
<div class="txt" style="position:absolute; left:112px; top:55179px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">by observation.</span></div>
<div class="txt" style="position:absolute; left:76px; top:55249px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">With mutable objects, there are two ways to interpret this:</span></div>
<div class="txt" style="position:absolute; left:112px; top:55316px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">observational equality </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">means that two references cannot be distinguished</span></div>
<div class="txt" style="position:absolute; left:148px; top:55359px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">by code that doesn’t change the state of either object, i.e., by calling only</span></div>
<div class="txt" style="position:absolute; left:148px; top:55402px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">observer, producer, and creator methods. This tests whether the two</span></div>
<div class="txt" style="position:absolute; left:148px; top:55441px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">references “</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">look</span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">” the same in the current state of the program. </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">观察等价：</span></div>
<div class="txt" style="position:absolute; left:148px; top:55485px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">在不改变对象状态的情况下</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">不使用</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">mutator)</span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，无法区分对象</span></div>
<div class="txt" style="position:absolute; left:112px; top:55549px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">behavioral equality </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">means that two references cannot be distinguished by</span></div>
<div class="txt" style="position:absolute; left:148px; top:55592px;"><span id="f45" style="font-size:33px;vertical-align:baseline;color:rgba(0,0,0,1);">any code</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">, even if a mutator is called on one but not the other. This tests</span></div>
<div class="txt" style="position:absolute; left:148px; top:55635px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">whether the two references will “</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">behave</span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">” the same, in this and all future</span></div>
<div class="txt" style="position:absolute; left:148px; top:55675px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">states. </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">行为等价：改变一个对象而不改变另外一个时，仍然无法区分对象</span></div>
<div class="txt" style="position:absolute; left:76px; top:55744px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Note: for immutable objects</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, observational and behavioral equality</span></div>
<div class="txt" style="position:absolute; left:112px; top:55794px;"><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">are identical, because there aren’t any mutator methods.</span></div>
<img id="background" style="position:absolute; left:0px; top:56074px;" width="1440" height="1080" src="page48.png"> <img id="background" style="position:absolute; left:1440px; top:56074px;" width="1440" height="1080" src="page-000048.png">
<div class="txt" style="position:absolute; left:33px; top:56181px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality in Java for mutable type</span></div>
<div class="txt" style="position:absolute; left:999px; top:56092px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:56318px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For mutable objects, it’s tempting to use observational equality. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对于</span></div>
<div class="txt" style="position:absolute; left:112px; top:56366px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可变对象，使用观察等价性貌似可行，但是会带来潜在的问题。</span></div>
<div class="txt" style="position:absolute; left:76px; top:56441px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Java uses observational equality for most of its mutable data types</span></div>
<div class="txt" style="position:absolute; left:112px; top:56490px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(such as </span><span id="f24" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Collections</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">), but other mutable classes (like</span></div>
<div class="txt" style="position:absolute; left:112px; top:56538px;"><span id="f24" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuilder </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">) use behavioral equality.</span></div>
<div class="txt" style="position:absolute; left:76px; top:56609px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If two distinct </span><span id="f24" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">List </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects contain the same sequence of elements,</span></div>
<div class="txt" style="position:absolute; left:112px; top:56658px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">then </span><span id="f24" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reports that they are equal.</span></div>
<div class="txt" style="position:absolute; left:76px; top:56729px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">But using observational equality leads to subtle bugs, and in fact</span></div>
<div class="txt" style="position:absolute; left:112px; top:56779px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">allows us to easily break the rep invariants of other collection data</span></div>
<div class="txt" style="position:absolute; left:112px; top:56827px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">structures.</span></div>
<img id="background" style="position:absolute; left:0px; top:57266px;" width="1440" height="1080" src="page49.png"> <img id="background" style="position:absolute; left:1440px; top:57266px;" width="1440" height="1080" src="page-000049.png">
<div class="txt" style="position:absolute; left:33px; top:57373px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">An example</span></div>
<div class="txt" style="position:absolute; left:999px; top:57284px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:57513px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Suppose we make a List , and then drop it into a Set :</span></div>
<div class="txt" style="position:absolute; left:76px; top:57729px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">We can check that the set contains the list we put in it, and it does:</span></div>
<img id="background" style="position:absolute; left:0px; top:58458px;" width="1440" height="1080" src="page50.png"> <img id="background" style="position:absolute; left:1440px; top:58458px;" width="1440" height="1080" src="page-000050.png">
<div class="txt" style="position:absolute; left:33px; top:58565px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">An example</span></div>
<div class="txt" style="position:absolute; left:999px; top:58476px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:58705px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">But now we mutate the list:</span></div>
<div class="txt" style="position:absolute; left:76px; top:58777px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">And it no longer appears in the set!</span></div>
<div class="txt" style="position:absolute; left:76px; top:58849px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It’s worse than that, in fact: when we iterate over the members of</span></div>
<div class="txt" style="position:absolute; left:112px; top:58898px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the set, we still find the list in there, but </span><span id="f21" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">contains() </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">says it’s not</span></div>
<div class="txt" style="position:absolute; left:112px; top:58947px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">there.</span></div>
<img id="background" style="position:absolute; left:0px; top:59650px;" width="1440" height="1080" src="page51.png"> <img id="background" style="position:absolute; left:1440px; top:59650px;" width="1440" height="1080" src="page-000051.png">
<div class="txt" style="position:absolute; left:33px; top:59757px;"><span id="f10" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What’s going on?</span></div>
<div class="txt" style="position:absolute; left:999px; top:59668px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:59897px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">List&lt;String&gt; </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is a mutable object. In the standard Java</span></div>
<div class="txt" style="position:absolute; left:112px; top:59946px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementation of collection classes like </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">List </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">mutations affect</span></div>
<div class="txt" style="position:absolute; left:112px; top:59994px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">the result of </span><span id="f23" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,255,1);">equals() </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">and </span><span id="f23" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode() </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">.</span></div>
<div class="txt" style="position:absolute; left:76px; top:60065px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When the list is first put into the </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">HashSet </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, it is stored in the hash</span></div>
<div class="txt" style="position:absolute; left:112px; top:60114px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">bucket corresponding to its </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">result at that time.</span></div>
<div class="txt" style="position:absolute; left:76px; top:60185px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When the list is subsequently mutated, its </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">changes,</span></div>
<div class="txt" style="position:absolute; left:112px; top:60234px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">but </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">HashSet </span><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">doesn’t realize it should be moved to a different</span></div>
<div class="txt" style="position:absolute; left:112px; top:60283px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">bucket. So it can never be found again.</span></div>
<div class="txt" style="position:absolute; left:76px; top:60353px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">can be affected by mutation, we</span></div>
<div class="txt" style="position:absolute; left:112px; top:60403px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">can break the rep invariant of a hash table that uses that object as a</span></div>
<div class="txt" style="position:absolute; left:112px; top:60451px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">key.</span></div>
<div class="txt" style="position:absolute; left:112px; top:60516px;"><span id="f56" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Note: Great care must be exercised if mutable objects are used as set</span></div>
<div class="txt" style="position:absolute; left:148px; top:60559px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">elements. The behavior of a set is not specified if the value of an object is</span></div>
<div class="txt" style="position:absolute; left:148px; top:60602px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">changed in a manner that affects equals comparisons while the object is an</span></div>
<div class="txt" style="position:absolute; left:148px; top:60641px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">element in the set. </span><span id="f63" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">格外关注：可变对象作为集合元素的时候，对象值的变</span></div>
<div class="txt" style="position:absolute; left:148px; top:60685px;"><span id="f63" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">化会对相等比较产生影响。</span></div>
<img id="background" style="position:absolute; left:0px; top:60842px;" width="1440" height="1080" src="page52.png"> <img id="background" style="position:absolute; left:1440px; top:60842px;" width="1440" height="1080" src="page-000052.png">
<div class="txt" style="position:absolute; left:999px; top:60860px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:33px; top:60949px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Lessons learned from this example</span></div>
<div class="txt" style="position:absolute; left:76px; top:61086px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">should implement behavioral equality. </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Equals()</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">应该实</span></div>
<div class="txt" style="position:absolute; left:112px; top:61134px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">现行为等价</span></div>
<div class="txt" style="position:absolute; left:76px; top:61209px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In general, that means that two references should be </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">if</span></div>
<div class="txt" style="position:absolute; left:112px; top:61254px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and only if they are aliases for the same object. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">两个引用相等意味着</span></div>
<div class="txt" style="position:absolute; left:112px; top:61302px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">它们指向了同一个对象</span></div>
<div class="txt" style="position:absolute; left:76px; top:61377px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">So mutable objects should just inherit </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:112px; top:61422px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">from </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可变类型应该继承</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Object</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类的</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:76px; top:61497px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For clients that need a notion of observational equality (whether</span></div>
<div class="txt" style="position:absolute; left:112px; top:61547px;"><span id="f58" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">two mutable objects “look” the same in the current state), it’s better</span></div>
<div class="txt" style="position:absolute; left:112px; top:61590px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to define a new method, e.g., </span><span id="f13" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">similar()</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">客户端如果需要判断两个</span></div>
<div class="txt" style="position:absolute; left:112px; top:61638px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对象的观察等价性，可以重新定义一个方法</span></div>
<img id="background" style="position:absolute; left:0px; top:62034px;" width="1440" height="1080" src="page53.png"> <img id="background" style="position:absolute; left:1440px; top:62034px;" width="1440" height="1080" src="page-000053.png">
<div class="txt" style="position:absolute; left:1105px; top:62052px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:169px; top:62362px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">7 The Final Rule for </span><span id="f13" style="font-size:47px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">and</span></div>
<div class="txt" style="position:absolute; left:522px; top:62449px;"><span id="f13" style="font-size:47px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode()</span></div>
<img id="background" style="position:absolute; left:0px; top:63226px;" width="1440" height="1080" src="page54.png"> <img id="background" style="position:absolute; left:1440px; top:63226px;" width="1440" height="1080" src="page-000054.png">
<div class="txt" style="position:absolute; left:999px; top:63244px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:33px; top:63332px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The Final Rule for </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:76px; top:63473px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For immutable types :</span></div>
<div class="txt" style="position:absolute; left:112px; top:63539px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should compare abstract values. This is the same as saying</span></div>
<div class="txt" style="position:absolute; left:148px; top:63583px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() should provide behavioral equality.</span></div>
<div class="txt" style="position:absolute; left:112px; top:63643px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should map the abstract value to an integer.</span></div>
<div class="txt" style="position:absolute; left:112px; top:63700px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">So immutable types must override both </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals()</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode()</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">不可</span></div>
<div class="txt" style="position:absolute; left:148px; top:63743px;"><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">变类型应该重写</span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:76px; top:63813px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For mutable types :</span></div>
<div class="txt" style="position:absolute; left:112px; top:63879px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should compare references, just like </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">== </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">. Again, this is the same</span></div>
<div class="txt" style="position:absolute; left:148px; top:63922px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">as saying </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should provide behavioral equality.</span></div>
<div class="txt" style="position:absolute; left:112px; top:63983px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should map the reference into an integer.</span></div>
<div class="txt" style="position:absolute; left:112px; top:64043px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">So mutable types should not override </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">hashCode() </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">at all,</span></div>
<div class="txt" style="position:absolute; left:148px; top:64087px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and should simply use the default implementations provided by </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:148px; top:64130px;"><span id="f73" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Java doesn’t follow this rule for its collections, unfortunately, leading to</span></div>
<div class="txt" style="position:absolute; left:148px; top:64169px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the pitfalls that we saw above. </span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">可变类型不应该重写</span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">hashCode()</span></div>
<div class="txt" style="position:absolute; left:148px; top:64213px;"><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，采用</span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Object</span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">默认实现的即可。</span></div>
<img id="background" style="position:absolute; left:0px; top:64418px;" width="1440" height="1080" src="page55.png"> <img id="background" style="position:absolute; left:1440px; top:64418px;" width="1440" height="1080" src="page-000055.png">
<div class="txt" style="position:absolute; left:1105px; top:64436px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:288px; top:64833px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">8 Autoboxing and Equality</span></div>
<img id="background" style="position:absolute; left:0px; top:65610px;" width="1440" height="1080" src="page56.png"> <img id="background" style="position:absolute; left:1440px; top:65610px;" width="1440" height="1080" src="page-000056.png">
<div class="txt" style="position:absolute; left:33px; top:65717px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Autoboxing and Equality</span></div>
<div class="txt" style="position:absolute; left:999px; top:65628px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:65857px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Primitive types and their object type equivalents, e.g., </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">int </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and</span></div>
<div class="txt" style="position:absolute; left:112px; top:65906px;"><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:76px; top:65977px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you create two Integer objects with the same value, they’ll be</span></div>
<div class="txt" style="position:absolute; left:112px; top:66026px;"><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">equals() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to each other.</span></div>
<div class="txt" style="position:absolute; left:462px; top:66084px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer x= Integer.valueOf(300);</span></div>
<div class="txt" style="position:absolute; left:462px; top:66122px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer y= Integer.valueOf(300);</span></div>
<div class="txt" style="position:absolute; left:462px; top:66160px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">x.equals(y) </span><span id="f11" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">→</span><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">true</span></div>
<div class="txt" style="position:absolute; left:76px; top:66241px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">But what if </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">x==y</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">? ----- </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">False </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(because of referential equality)</span></div>
<div class="txt" style="position:absolute; left:76px; top:66313px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">But what if </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">(int) x == (int) y</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">? ----</span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">True</span></div>
<div class="txt" style="position:absolute; left:76px; top:66385px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f39" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">What’s the result of this code?</span></div>
<img id="background" style="position:absolute; left:0px; top:66802px;" width="1440" height="1080" src="page57.png"> <img id="background" style="position:absolute; left:1440px; top:66802px;" width="1440" height="1080" src="page-000057.png">
<div class="txt" style="position:absolute; left:33px; top:66909px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Autoboxing and Equality</span></div>
<div class="txt" style="position:absolute; left:999px; top:66820px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:405px; top:67072px;"><span id="f14" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer x= Integer.valueOf(3);</span></div>
<div class="txt" style="position:absolute; left:405px; top:67110px;"><span id="f14" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer y= Integer.valueOf(3);</span></div>
<div class="txt" style="position:absolute; left:405px; top:67148px;"><span id="f14" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">x.equals(y) </span><span id="f11" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">→</span><span id="f14" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">true</span></div>
<div class="txt" style="position:absolute; left:76px; top:67265px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">But what if </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">x==y</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">? ----- </span><span id="f18" style="font-size:24px;vertical-align:baseline;color:rgba(192,0,0,1);">True</span></div>
<div class="txt" style="position:absolute; left:76px; top:67337px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">To improve performance, Java caches Integer objects from -127 to</span></div>
<div class="txt" style="position:absolute; left:112px; top:67387px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">127.</span></div>
<img id="background" style="position:absolute; left:0px; top:67994px;" width="1440" height="1080" src="page58.png"> <img id="background" style="position:absolute; left:1440px; top:67994px;" width="1440" height="1080" src="page-000058.png">
<div class="txt" style="position:absolute; left:1105px; top:68012px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:563px; top:68409px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Summary</span></div>
<img id="background" style="position:absolute; left:0px; top:69186px;" width="1440" height="1080" src="page59.png"> <img id="background" style="position:absolute; left:1440px; top:69186px;" width="1440" height="1080" src="page-000059.png">
<div class="txt" style="position:absolute; left:33px; top:69293px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Summary</span></div>
<div class="txt" style="position:absolute; left:999px; top:69204px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:69433px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality is one part of implementing an abstract data type (ADT).</span></div>
<div class="txt" style="position:absolute; left:112px; top:69500px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality should be an equivalence relation (reflexive, symmetric,</span></div>
<div class="txt" style="position:absolute; left:148px; top:69543px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">transitive).</span></div>
<div class="txt" style="position:absolute; left:112px; top:69603px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Equality and hash code must be consistent with each other, so that data</span></div>
<div class="txt" style="position:absolute; left:148px; top:69647px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">structures that use hash tables (like HashSet and HashMap ) work</span></div>
<div class="txt" style="position:absolute; left:148px; top:69690px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">properly.</span></div>
<div class="txt" style="position:absolute; left:112px; top:69751px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">The abstraction function </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(192,0,0,1);">is the basis for equality in immutable data</span></div>
<div class="txt" style="position:absolute; left:148px; top:69794px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(192,0,0,1);">types.</span></div>
<div class="txt" style="position:absolute; left:112px; top:69854px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Reference equality </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(192,0,0,1);">is the basis for equality in mutable data types; this is</span></div>
<div class="txt" style="position:absolute; left:148px; top:69898px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(192,0,0,1);">the only way to ensure consistency over time and avoid breaking rep</span></div>
<div class="txt" style="position:absolute; left:148px; top:69941px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(192,0,0,1);">invariants of hash tables.</span></div>
<img id="background" style="position:absolute; left:0px; top:70378px;" width="1440" height="1080" src="page60.png"> <img id="background" style="position:absolute; left:1440px; top:70378px;" width="1440" height="1080" src="page-000060.png">
<div class="txt" style="position:absolute; left:33px; top:70485px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Summary</span></div>
<div class="txt" style="position:absolute; left:999px; top:70396px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">3.5 Equality in ADT and OOP</span></div>
<div class="txt" style="position:absolute; left:76px; top:70625px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Safe from bugs</span></div>
<div class="txt" style="position:absolute; left:112px; top:70692px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Correct implementation of equality and hash codes is necessary for use</span></div>
<div class="txt" style="position:absolute; left:148px; top:70735px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">with collection data types like sets and maps. It’s also highly desirable for</span></div>
<div class="txt" style="position:absolute; left:148px; top:70778px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">writing tests. Since every object in Java inherits the Object</span></div>
<div class="txt" style="position:absolute; left:148px; top:70821px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">implementations, immutable types must override them.</span></div>
<div class="txt" style="position:absolute; left:76px; top:70887px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Easy to understand</span></div>
<div class="txt" style="position:absolute; left:112px; top:70954px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Clients and other programmers who read our specs will expect our types</span></div>
<div class="txt" style="position:absolute; left:148px; top:70997px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to implement an appropriate equality operation, and will be surprised and</span></div>
<div class="txt" style="position:absolute; left:148px; top:71040px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">confused if we do not.</span></div>
<div class="txt" style="position:absolute; left:76px; top:71106px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Ready for change</span></div>
<div class="txt" style="position:absolute; left:112px; top:71173px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Correctly-implemented equality for immutable types separates equality of</span></div>
<div class="txt" style="position:absolute; left:148px; top:71216px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">reference from equality of abstract value, hiding from clients our decisions</span></div>
<div class="txt" style="position:absolute; left:148px; top:71259px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">about whether values are shared. Choosing behavioral rather than</span></div>
<div class="txt" style="position:absolute; left:148px; top:71302px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">observational equality for mutable types helps avoid unexpected aliasing</span></div>
<div class="txt" style="position:absolute; left:148px; top:71346px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">bugs.</span></div>
<img id="background" style="position:absolute; left:0px; top:71570px;" width="1440" height="1080" src="page61.png"> <img id="background" style="position:absolute; left:1440px; top:71570px;" width="1440" height="1080" src="page-000061.png">
<div class="txt" style="position:absolute; left:1105px; top:71588px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:590px; top:71985px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">The end</span></div>
<div class="txt" style="position:absolute; left:607px; top:72244px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">April 3, 2019</span></div>
</body></html>