<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head> <body onload="start()"><div style="background:#5c5c5f; color:#FFF"> <p align="center">&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;[&#x6DF1;&#x5BB9;Pubmed&#x6587;&#x732E;&#x68C0;&#x7D22;] &nbsp 1. &#x6B64;&#x5904;&#x53F3;&#x952E;&#xFF1A;&#x9009;&#x83DC;&#x5355;&#x3010;&#x7FFB;&#x6210;&#x4E2D;&#x6587;&#xFF08;&#x7B80;&#x4F53;&#xFF09;&#x3011; &nbsp &nbsp &nbsp  2. &#x7FFB;&#x8BD1;&#x540E;&#xFF0C;&#x6B64;&#x5904;&#x53F3;&#x952E;&#xFF1A;&#x9009;&#x83DC;&#x5355;&#x3010;&#x6253;&#x5370;...&#x3011;&#x6210;PDF&#x683C;&#x5F0F; <br>&#x5EFA;&#x8BAE;&#x5C4F;&#x5E55;&#x5206;&#x8FA8;&#x7387;&#xFF1A;1920X1080&#xFF1B;&#x5982;&#x679C;&#x5C4F;&#x5E55;&#x592A;&#x5C0F;&#xFF0C;&#x53EF;&#x4EE5;&#x6309;Ctrl + &#x6216; Ctrl -&#x7F29;&#x653E;&#x7F51;&#x9875;&#x3002;</p></div><style type="text/css"> .txt { white-space:nowrap; }	 #f0 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f1 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f2 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f3 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f4 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f5 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f6 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f7 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f8 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f9 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f10 { font-family:sans-serif; font-weight:normal; font-style:normal; }  #f11 { font-family:sans-serif; font-weight:normal; font-style:normal; }  #f12 { font-family:sans-serif; font-weight:normal; font-style:normal; } 	#f13 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f14 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f15 { font-family:sans-serif; font-weight:normal; font-style:normal; } 	#f16 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f17 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f18 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f19 { font-family:sans-serif; font-weight:normal; font-style:normal; }		#f20 { font-family:sans-serif; font-weight:normal; font-style:normal; }		</style><img id="background" style="position:absolute; left:0px; top:50px;" width="1440" height="1080" src="page1.png"> <img id="background" style="position:absolute; left:1440px; top:50px;" width="1440" height="1080" src="page-000001.png">
<div class="txt" style="position:absolute; left:1105px; top:68px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:263px; top:275px;"><span id="f9" style="font-size:55px;vertical-align:baseline;color:rgba(0,0,0,1);">Chapter 8: Software Construction for</span></div>
<div class="txt" style="position:absolute; left:562px; top:342px;"><span id="f9" style="font-size:55px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance</span></div>
<div class="txt" style="position:absolute; left:174px; top:413px;"><span id="f17" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance</span></div>
<div class="txt" style="position:absolute; left:497px; top:500px;"><span id="f17" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Optimization</span></div>
<div class="txt" style="position:absolute; left:596px; top:719px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Xu Hanchuan</span></div>
<div class="txt" style="position:absolute; left:585px; top:772px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(255,98,176,1);">xhc@hit.edu.cn</span></div>
<div class="txt" style="position:absolute; left:604px; top:877px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">May 19, 2019</span></div>
<img id="background" style="position:absolute; left:0px; top:1050px;" width="1440" height="1080" src="page2.png"> <img id="background" style="position:absolute; left:1440px; top:1050px;" width="1440" height="1080" src="page-000002.png">
<div class="txt" style="position:absolute; left:33px; top:1157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Outline</span></div>
<div class="txt" style="position:absolute; left:749px; top:1061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:1297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">1 Code Tuning Strategies and Process</span></div>
<div class="txt" style="position:absolute; left:76px; top:1369px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">2 Common Sources of Inefficiency</span></div>
<div class="txt" style="position:absolute; left:76px; top:1441px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">3 Code Tuning for Object Creation and Reuse</span></div>
<div class="txt" style="position:absolute; left:112px; top:1508px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(Creational) Prototype pattern creates objects by cloning an existing object.</span></div>
<div class="txt" style="position:absolute; left:112px; top:1568px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(Creational) Singleton pattern restricts object creation for a class to only</span></div>
<div class="txt" style="position:absolute; left:148px; top:1611px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">one instance.</span></div>
<div class="txt" style="position:absolute; left:112px; top:1672px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(Structural) Flyweight reduces the cost of creating and manipulating a</span></div>
<div class="txt" style="position:absolute; left:148px; top:1715px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">large number of similar objects.</span></div>
<div class="txt" style="position:absolute; left:112px; top:1776px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Object Pool Pattern</span></div>
<div class="txt" style="position:absolute; left:112px; top:1836px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Avoiding Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:112px; top:1897px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Object Initialization</span></div>
<img id="background" style="position:absolute; left:0px; top:2050px;" width="1440" height="1080" src="page3.png"> <img id="background" style="position:absolute; left:1440px; top:2050px;" width="1440" height="1080" src="page-000003.png">
<div class="txt" style="position:absolute; left:33px; top:2157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Outline</span></div>
<div class="txt" style="position:absolute; left:749px; top:2061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:2297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">4 Code Tuning for Strings</span></div>
<div class="txt" style="position:absolute; left:76px; top:2369px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">5 Code Tuning for Logics, Loops, Data Type, Expressions</span></div>
<div class="txt" style="position:absolute; left:76px; top:2441px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">6 Code Tuning for I/O and Logging</span></div>
<div class="txt" style="position:absolute; left:76px; top:2513px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">7 Code Tuning for Data Structure and Algorithms</span></div>
<img id="background" style="position:absolute; left:0px; top:3050px;" width="1440" height="1080" src="page4.png"> <img id="background" style="position:absolute; left:1440px; top:3050px;" width="1440" height="1080" src="page-000004.png">
<div class="txt" style="position:absolute; left:1105px; top:3068px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:246px; top:3379px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">1 Code-Tuning Strategies and</span></div>
<div class="txt" style="position:absolute; left:600px; top:3465px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Process</span></div>
<img id="background" style="position:absolute; left:0px; top:4050px;" width="1440" height="1080" src="page5.png"> <img id="background" style="position:absolute; left:1440px; top:4050px;" width="1440" height="1080" src="page-000005.png">
<div class="txt" style="position:absolute; left:33px; top:4157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What is code tuning ?</span></div>
<div class="txt" style="position:absolute; left:749px; top:4061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:4297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Code tuning </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is the practice of modifying correct code in ways that</span></div>
<div class="txt" style="position:absolute; left:112px; top:4342px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">make it run more efficiently. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">代码调优是修改正确的代码以实现更高</span></div>
<div class="txt" style="position:absolute; left:112px; top:4390px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">效地运行。</span></div>
<div class="txt" style="position:absolute; left:76px; top:4465px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“Tuning” </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">refers to </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">small-scale changes </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">that affect a single class, a</span></div>
<div class="txt" style="position:absolute; left:112px; top:4510px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">single routine, or, more commonly, a few lines of code. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">调优通常是</span></div>
<div class="txt" style="position:absolute; left:112px; top:4558px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">指小规模的改变</span></div>
<div class="txt" style="position:absolute; left:76px; top:4633px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“Tuning” does not refer to large</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-scale design changes, or other</span></div>
<div class="txt" style="position:absolute; left:112px; top:4683px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">higher-level means of improving performance.</span></div>
<div class="txt" style="position:absolute; left:76px; top:4753px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance: time and space complexity.</span></div>
<img id="background" style="position:absolute; left:0px; top:5050px;" width="1440" height="1080" src="page6.png"> <img id="background" style="position:absolute; left:1440px; top:5050px;" width="1440" height="1080" src="page-000006.png">
<div class="txt" style="position:absolute; left:749px; top:5061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:5157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Consider these options first before tuning</span></div>
<div class="txt" style="position:absolute; left:76px; top:5297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Once you’ve chosen efficiency as a priority, whether its emphasis is</span></div>
<div class="txt" style="position:absolute; left:112px; top:5347px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">on speed or on size, you should consider several options before</span></div>
<div class="txt" style="position:absolute; left:112px; top:5390px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">choosing to improve either speed or size at the code level. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在代码层面</span></div>
<div class="txt" style="position:absolute; left:112px; top:5438px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">调优之前，应首先考虑以下策略：</span></div>
<div class="txt" style="position:absolute; left:112px; top:5508px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Program requirements</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">: </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Asking for more than is needed leads to trouble (e.g.,</span></div>
<div class="txt" style="position:absolute; left:148px; top:5547px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">return 1ms, is it always? On average? 99%?) </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">不要过分强调不需要的性能</span></div>
<div class="txt" style="position:absolute; left:112px; top:5607px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">System design</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">: </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">High-level architecture design </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">高层的架构设计</span></div>
<div class="txt" style="position:absolute; left:112px; top:5668px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Class and function design</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">: </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">data types and algorithm performance </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">更换数据</span></div>
<div class="txt" style="position:absolute; left:148px; top:5711px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">类型或算法</span></div>
<div class="txt" style="position:absolute; left:112px; top:5776px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Operating-system interactions</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">: </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Hidden OS calls within libraries which are</span></div>
<div class="txt" style="position:absolute; left:148px; top:5815px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">maybe slow or fat </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">是否由类库中隐藏的对</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">OS</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">的调用导致的问题</span></div>
<div class="txt" style="position:absolute; left:112px; top:5875px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Code compilation</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">: </span><span id="f63" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">“Automatic” optimization </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">优化编译器</span></div>
<div class="txt" style="position:absolute; left:112px; top:5936px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Hardware: </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">update HW would be much easier </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">升级硬件</span></div>
<div class="txt" style="position:absolute; left:112px; top:5997px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Code tuning </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">代码调优是最后的选择</span></div>
<img id="background" style="position:absolute; left:0px; top:6050px;" width="1440" height="1080" src="page7.png"> <img id="background" style="position:absolute; left:1440px; top:6050px;" width="1440" height="1080" src="page-000007.png">
<div class="txt" style="position:absolute; left:749px; top:6061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:6157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The Pareto Principle of program optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:6297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Pareto Principle (80/20 rule) states that you can get 80 percent</span></div>
<div class="txt" style="position:absolute; left:112px; top:6347px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">of the result with 20 percent of the effort.</span></div>
<div class="txt" style="position:absolute; left:112px; top:6412px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Barry Boehm reports that 20 percent of a program’s routines consume 80</span></div>
<div class="txt" style="position:absolute; left:148px; top:6451px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">percent of its execution time. </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">20</span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">％的程序消耗了</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">80</span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">％的执行时间</span></div>
<div class="txt" style="position:absolute; left:112px; top:6515px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Donald Knuth found that less than 4 percent of a program usually</span></div>
<div class="txt" style="position:absolute; left:148px; top:6559px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">accounts for more than 50 percent of its run time.</span></div>
<div class="txt" style="position:absolute; left:76px; top:6624px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The target of code-tuning is to find hotspots (the 20%) and</span></div>
<div class="txt" style="position:absolute; left:112px; top:6670px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">optimize them. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">调优的目标就是找到</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">20%</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的热点，并优化</span></div>
<div class="txt" style="position:absolute; left:76px; top:6816px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f45" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“The best is the enemy of the good”. Working toward perfection</span></div>
<div class="txt" style="position:absolute; left:112px; top:6866px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">may prevent completion. Complete it first, and then perfect it. The</span></div>
<div class="txt" style="position:absolute; left:112px; top:6910px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">part that needs to be perfect is usually small. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">完美是优良的敌人，努</span></div>
<div class="txt" style="position:absolute; left:112px; top:6961px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">力做到完美，可能会妨碍软件的完成。先解决有无问题，再解决优劣</span></div>
<div class="txt" style="position:absolute; left:112px; top:7006px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">问题。</span></div>
<img id="background" style="position:absolute; left:0px; top:7050px;" width="1440" height="1080" src="page8.png"> <img id="background" style="position:absolute; left:1440px; top:7050px;" width="1440" height="1080" src="page-000008.png">
<div class="txt" style="position:absolute; left:33px; top:7157px;"><span id="f10" style="font-size:60px;vertical-align:baseline;color:rgba(192,0,0,1);">What Tuning is Not</span></div>
<div class="txt" style="position:absolute; left:749px; top:7061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:7294px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reducing lines of code </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">减少代码行×</span></div>
<div class="txt" style="position:absolute; left:112px; top:7364px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Not an indicator of efficient code</span></div>
<div class="txt" style="position:absolute; left:76px; top:7427px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A guess at what might improve things </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">根据猜测进行优化×</span></div>
<div class="txt" style="position:absolute; left:112px; top:7496px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Know what you’re trying, and measure results</span></div>
<div class="txt" style="position:absolute; left:76px; top:7559px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Optimizing as you go </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">随时随地优化×</span></div>
<div class="txt" style="position:absolute; left:112px; top:7629px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Wait until finished, then go back to improve, as optimizing while</span></div>
<div class="txt" style="position:absolute; left:148px; top:7672px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">programming is often a waste</span></div>
<div class="txt" style="position:absolute; left:76px; top:7735px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A “first choice” for improvement </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">优化排在第一位×</span></div>
<div class="txt" style="position:absolute; left:112px; top:7804px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Worry about other details/design first</span></div>
<img id="background" style="position:absolute; left:0px; top:8050px;" width="1440" height="1080" src="page9.png"> <img id="background" style="position:absolute; left:1440px; top:8050px;" width="1440" height="1080" src="page-000009.png">
<div class="txt" style="position:absolute; left:33px; top:8157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) LoC vs. Efficiency</span></div>
<div class="txt" style="position:absolute; left:749px; top:8061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:8297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reducing the lines of code in a high-level language</span></div>
<div class="txt" style="position:absolute; left:112px; top:8347px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">improves the speed or size of the resulting machine</span></div>
<div class="txt" style="position:absolute; left:112px; top:8395px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">code</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">false!</span></div>
<div class="txt" style="position:absolute; left:1108px; top:8281px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for(i=0;i&lt;5;i++)</span></div>
<div class="txt" style="position:absolute; left:1187px; top:8325px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">A[i] = i;</span></div>
<div class="txt" style="position:absolute; left:1108px; top:8368px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-----------------</span></div>
<div class="txt" style="position:absolute; left:1252px; top:8411px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">A[0]=0</span></div>
<div class="txt" style="position:absolute; left:112px; top:8460px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">This certainly doesn’t imply the conclusion that increasing the</span></div>
<div class="txt" style="position:absolute; left:1252px; top:8454px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">A[1]=1</span></div>
<div class="txt" style="position:absolute; left:148px; top:8503px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">number of lines of high-level language code always improves</span></div>
<div class="txt" style="position:absolute; left:1252px; top:8497px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">A[2]=2</span></div>
<div class="txt" style="position:absolute; left:148px; top:8546px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">speed or reduces size.</span></div>
<div class="txt" style="position:absolute; left:1252px; top:8541px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">A[3]=3</span></div>
<div class="txt" style="position:absolute; left:112px; top:8607px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It does imply that regardless of the aesthetic appeal of writing</span></div>
<div class="txt" style="position:absolute; left:1252px; top:8584px;"><span id="f45" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">A[4]=4</span></div>
<div class="txt" style="position:absolute; left:148px; top:8650px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">something with the fewest lines of code, </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">there’s no</span></div>
<div class="txt" style="position:absolute; left:148px; top:8693px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">predictable relationship between the number of lines of</span></div>
<div class="txt" style="position:absolute; left:148px; top:8737px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">code in a high-</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">level language and a program’s ultimate size</span></div>
<div class="txt" style="position:absolute; left:148px; top:8776px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">and speed. </span><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">代码行数与程序的资源占用和运行速度之间没有必</span></div>
<div class="txt" style="position:absolute; left:148px; top:8819px;"><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">然的联系</span></div>
<img id="background" style="position:absolute; left:0px; top:9050px;" width="1440" height="1080" src="page10.png"> <img id="background" style="position:absolute; left:1440px; top:9050px;" width="1440" height="1080" src="page-000010.png">
<div class="txt" style="position:absolute; left:749px; top:9061px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:9157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Tuning by Profiling and Measuring</span></div>
<div class="txt" style="position:absolute; left:65px; top:9272px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Profiling helps determine where code is spending time (hotspots)</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">性</span></div>
<div class="txt" style="position:absolute; left:101px; top:9320px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">能分析有助于发现热点</span></div>
<div class="txt" style="position:absolute; left:65px; top:9394px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Profiling provides basis for </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">measurement: </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">determine whether</span></div>
<div class="txt" style="position:absolute; left:101px; top:9440px;"><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“improvement” really improved anything. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">性能分析为度量改进后的效</span></div>
<div class="txt" style="position:absolute; left:101px; top:9488px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">果提供了基础。</span></div>
<div class="txt" style="position:absolute; left:65px; top:9562px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Code tuning is based on precise measurements. </span><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">代码调优应基于精确地度量</span></div>
<div class="txt" style="position:absolute; left:101px; top:9629px;"><span id="f36" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">You must always measure performance to know whether your changes</span></div>
<div class="txt" style="position:absolute; left:137px; top:9672px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">helped or hurt your program. </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The rules of the game change every time you</span></div>
<div class="txt" style="position:absolute; left:137px; top:9716px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">change languages, compilers, versions of compilers, libraries, versions of</span></div>
<div class="txt" style="position:absolute; left:137px; top:9759px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">libraries, processor, amount of memory on the machine.</span></div>
<div class="txt" style="position:absolute; left:101px; top:9819px;"><span id="f36" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f44" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When you tune code, you’re implicitly signing up to re</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">-profile each</span></div>
<div class="txt" style="position:absolute; left:137px; top:9863px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">optimization every time you change your compiler brand, compiler version,</span></div>
<div class="txt" style="position:absolute; left:137px; top:9902px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">library version, and so. </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">每次调优都意味着需要重新性能分析</span></div>
<div class="txt" style="position:absolute; left:101px; top:9966px;"><span id="f36" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f44" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If you don’t </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">reprofile, an optimization that improves performance under one</span></div>
<div class="txt" style="position:absolute; left:137px; top:10009px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">version of a compiler or library might well degrade performance when you</span></div>
<div class="txt" style="position:absolute; left:137px; top:10049px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">change the build environment. </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">否则，在一种环境下的调优，在其他环境下有</span></div>
<div class="txt" style="position:absolute; left:137px; top:10092px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">可能反而降低性能</span></div>
<img id="background" style="position:absolute; left:0px; top:12270px;" width="1440" height="1080" src="page11.png"> <img id="background" style="position:absolute; left:1440px; top:12270px;" width="1440" height="1080" src="page-000011.png">
<div class="txt" style="position:absolute; left:749px; top:12281px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:12377px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(3) Tuning until code complete</span></div>
<div class="txt" style="position:absolute; left:76px; top:12514px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">You should optimize as you go</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">false! </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">不应该随时优化</span></div>
<div class="txt" style="position:absolute; left:76px; top:12589px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">One theory is that if you strive to write the fastest and smallest</span></div>
<div class="txt" style="position:absolute; left:112px; top:12639px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">possible code as you write each function, your program will be fast</span></div>
<div class="txt" style="position:absolute; left:112px; top:12687px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and small. This approach creates a forest-for-the-trees situation in</span></div>
<div class="txt" style="position:absolute; left:112px; top:12735px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">which programmers ignore significant global optimizations because</span></div>
<div class="txt" style="position:absolute; left:112px; top:12778px;"><span id="f32" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">they’re too busy with micro</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-optimizations. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">忙于微观的优化，会导致</span></div>
<div class="txt" style="position:absolute; left:112px; top:12826px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">忽略了全局的优化</span></div>
<div class="txt" style="position:absolute; left:76px; top:12901px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Here are the main problems with optimizing as you go along:</span></div>
<div class="txt" style="position:absolute; left:112px; top:12968px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It’s almost impossible to identify performance bottlenecks before a</span></div>
<div class="txt" style="position:absolute; left:148px; top:13007px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">program is working completely. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">完成开发之前，难以发现瓶颈</span></div>
<div class="txt" style="position:absolute; left:112px; top:13071px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">In the rare case in which developers identify the bottlenecks correctly,</span></div>
<div class="txt" style="position:absolute; left:148px; top:13115px;"><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">they overkill the bottlenecks they’ve identified and allowed others to</span></div>
<div class="txt" style="position:absolute; left:148px; top:13154px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">become critical. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">即使发现并纠正了瓶颈，也可能造成其他的瓶颈</span></div>
<div class="txt" style="position:absolute; left:112px; top:13218px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Focusing on optimization during initial development detracts from</span></div>
<div class="txt" style="position:absolute; left:148px; top:13258px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">achieving other maybe more important program objectives. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">早期关注优化</span></div>
<div class="txt" style="position:absolute; left:148px; top:13301px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，会忽略更重要的目标</span></div>
<img id="background" style="position:absolute; left:0px; top:13492px;" width="1440" height="1080" src="page12.png"> <img id="background" style="position:absolute; left:1440px; top:13492px;" width="1440" height="1080" src="page-000012.png">
<div class="txt" style="position:absolute; left:33px; top:13599px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(4) Fast vs. Correct</span></div>
<div class="txt" style="position:absolute; left:749px; top:13503px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:13736px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A fast program is just as important as a correct one</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">false! </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">正确最重要</span></div>
<div class="txt" style="position:absolute; left:76px; top:13811px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It’s hardly ever true that programs need to be fast or small before</span></div>
<div class="txt" style="position:absolute; left:112px; top:13861px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">they need to be correct.</span></div>
<div class="txt" style="position:absolute; left:112px; top:13926px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For a certain class of projects, speed or size is a major concern. This class is</span></div>
<div class="txt" style="position:absolute; left:148px; top:13969px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the minority, is much smaller than most people think, and is getting smaller</span></div>
<div class="txt" style="position:absolute; left:148px; top:14012px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">all the time. For these projects, the performance risks must be addressed by</span></div>
<div class="txt" style="position:absolute; left:148px; top:14051px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">up-front design</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">只有很少的项目把性能摆在首位</span></div>
<div class="txt" style="position:absolute; left:112px; top:14116px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For other projects, early optimization poses a significant threat to overall</span></div>
<div class="txt" style="position:absolute; left:148px; top:14155px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">software quality, including performance. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对多数程序而言，早期优化会影响</span></div>
<div class="txt" style="position:absolute; left:148px; top:14198px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">包括性能在内的整体质量</span></div>
<div class="txt" style="position:absolute; left:76px; top:14268px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">Code correctness/robustness/readability/maintainability/etc. is</span></div>
<div class="txt" style="position:absolute; left:112px; top:14318px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">usually more important than efficiency.</span></div>
<div class="txt" style="position:absolute; left:76px; top:14385px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Always start with well-written code, and only tune at the end </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">起始于</span></div>
<div class="txt" style="position:absolute; left:112px; top:14433px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">书写良好的代码，只在最后进行调优</span></div>
<img id="background" style="position:absolute; left:0px; top:14714px;" width="1440" height="1080" src="page13.png"> <img id="background" style="position:absolute; left:1440px; top:14714px;" width="1440" height="1080" src="page-000013.png">
<div class="txt" style="position:absolute; left:33px; top:14821px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">When to Tune</span></div>
<div class="txt" style="position:absolute; left:749px; top:14725px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:14961px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Use a high-quality design.</span></div>
<div class="txt" style="position:absolute; left:76px; top:15033px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Make the program right.</span></div>
<div class="txt" style="position:absolute; left:76px; top:15105px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Make it modular and easily modifiable so that it’s easy to work on</span></div>
<div class="txt" style="position:absolute; left:112px; top:15155px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">later.</span></div>
<div class="txt" style="position:absolute; left:76px; top:15225px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When it’s complete and correct, check the performance. If the</span></div>
<div class="txt" style="position:absolute; left:112px; top:15275px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">program lumbers, make it fast and small.</span></div>
<div class="txt" style="position:absolute; left:76px; top:15345px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Don’t optimize until you know you need to.</span></div>
<div class="txt" style="position:absolute; left:76px; top:15489px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Jackson’s Rules of Optimization:</span></div>
<div class="txt" style="position:absolute; left:112px; top:15556px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Rule 1. Don’t do it.</span></div>
<div class="txt" style="position:absolute; left:112px; top:15616px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Rule 2 (for experts only). Don’t do it yet— </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that is, not until you have a</span></div>
<div class="txt" style="position:absolute; left:148px; top:15660px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">perfectly clear and un-optimized solution.</span></div>
<img id="background" style="position:absolute; left:0px; top:15936px;" width="1440" height="1080" src="page14.png"> <img id="background" style="position:absolute; left:1440px; top:15936px;" width="1440" height="1080" src="page-000014.png">
<div class="txt" style="position:absolute; left:33px; top:16043px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Code Tuning Process</span></div>
<div class="txt" style="position:absolute; left:749px; top:15947px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:16183px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Develop the software using well-</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">designed code that’s easy to</span></div>
<div class="txt" style="position:absolute; left:112px; top:16228px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">understand and modify.</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">使用精心设计的代码来开发软件，这些代码</span></div>
<div class="txt" style="position:absolute; left:112px; top:16276px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">很容易理解和修改。</span></div>
<div class="txt" style="position:absolute; left:76px; top:16351px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If performance is poor:</span></div>
<div class="txt" style="position:absolute; left:112px; top:16418px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Save a working version of the code so that you can get back to the “last</span></div>
<div class="txt" style="position:absolute; left:148px; top:16457px;"><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">known good state.” </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">保存可工作版本</span></div>
<div class="txt" style="position:absolute; left:112px; top:16517px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Measure the system to find hot spots. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">评价系统，发现热点</span></div>
<div class="txt" style="position:absolute; left:112px; top:16582px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Determine whether the weak performance comes from inadequate design,</span></div>
<div class="txt" style="position:absolute; left:148px; top:16621px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">data types, or algorithms and whether code tuning is appropriate. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">确定问</span></div>
<div class="txt" style="position:absolute; left:148px; top:16665px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">题根源（设计、数据类型、算法？） ，调优是否适合</span></div>
<div class="txt" style="position:absolute; left:112px; top:16725px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Tune the bottleneck identified in the last step. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">调优</span></div>
<div class="txt" style="position:absolute; left:112px; top:16785px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Measure each improvement one at a time. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">每次的改进都要度量效果</span></div>
<div class="txt" style="position:absolute; left:112px; top:16850px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If an improvement doesn’t improve the code, revert to the previous code.</span></div>
<div class="txt" style="position:absolute; left:148px; top:16889px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">如果无效，回到之前的版本</span></div>
<div class="txt" style="position:absolute; left:76px; top:16959px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Repeat.</span></div>
<img id="background" style="position:absolute; left:0px; top:17158px;" width="1440" height="1080" src="page15.png"> <img id="background" style="position:absolute; left:1440px; top:17158px;" width="1440" height="1080" src="page-000015.png">
<div class="txt" style="position:absolute; left:1105px; top:17176px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:176px; top:17573px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">2 Common Sources of Inefficiency</span></div>
<img id="background" style="position:absolute; left:0px; top:18380px;" width="1440" height="1080" src="page16.png"> <img id="background" style="position:absolute; left:1440px; top:18380px;" width="1440" height="1080" src="page-000016.png">
<div class="txt" style="position:absolute; left:33px; top:18487px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) I/O</span></div>
<div class="txt" style="position:absolute; left:749px; top:18391px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:18627px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">One of the most significant sources of inefficiency is unnecessary</span></div>
<div class="txt" style="position:absolute; left:112px; top:18672px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">I/O. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">不必要的</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">I/O</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">操作</span></div>
<div class="txt" style="position:absolute; left:76px; top:18747px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you have a choice of working with a file in memory vs. on disk, in</span></div>
<div class="txt" style="position:absolute; left:112px; top:18797px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">a database, or across a network, use an in-memory data unless space</span></div>
<div class="txt" style="position:absolute; left:112px; top:18840px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is critical. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在允许的情况下，尽量使用内存运算</span></div>
<img id="background" style="position:absolute; left:0px; top:19602px;" width="1440" height="1080" src="page17.png"> <img id="background" style="position:absolute; left:1440px; top:19602px;" width="1440" height="1080" src="page-000017.png">
<div class="txt" style="position:absolute; left:33px; top:19704px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Paging </span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">分页</span></div>
<div class="txt" style="position:absolute; left:749px; top:19613px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:19849px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An operation that causes the operating system to swap pages of</span></div>
<div class="txt" style="position:absolute; left:112px; top:19899px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory is much slower than an operation that works on only one</span></div>
<div class="txt" style="position:absolute; left:112px; top:19942px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">page of memory. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">导致</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">OS</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">进行内存分页操作的程序的运算速度，比不</span></div>
<div class="txt" style="position:absolute; left:112px; top:19990px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">分页的慢很多</span></div>
<div class="txt" style="position:absolute; left:76px; top:20065px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Sometimes a simple change makes a huge difference.</span></div>
<div class="txt" style="position:absolute; left:76px; top:20137px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., one programmer wrote an initialization loop that produced</span></div>
<div class="txt" style="position:absolute; left:112px; top:20187px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">many page faults on a system that used 4K pages.</span></div>
<div class="txt" style="position:absolute; left:1359px; top:20242px;"><span id="f40" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">4K</span></div>
<div class="txt" style="position:absolute; left:62px; top:20623px;"><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It switches rows </span><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">MAX_ROWS * MAX_COLUMNS </span><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">times.</span></div>
<img id="background" style="position:absolute; left:0px; top:20824px;" width="1440" height="1080" src="page18.png"> <img id="background" style="position:absolute; left:1440px; top:20824px;" width="1440" height="1080" src="page-000018.png">
<div class="txt" style="position:absolute; left:749px; top:20835px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:20931px;"><span id="f8" style="font-size:60px;vertical-align:top;line-height:75%;color:rgba(0,0,0,1);">Paging</span></div>
<div class="txt" style="position:absolute; left:1378px; top:20977px;"><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">4K</span></div>
<div class="txt" style="position:absolute; left:76px; top:21071px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The programmer restructured the loop this way:</span></div>
<div class="txt" style="position:absolute; left:76px; top:21431px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This code still causes a page fault every time it switches rows, but it</span></div>
<div class="txt" style="position:absolute; left:112px; top:21481px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">switches rows only </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">MAX_ROWS </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">times instead of MAX_ROWS *</span></div>
<div class="txt" style="position:absolute; left:112px; top:21529px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">MAX_COLUMNS times.</span></div>
<div class="txt" style="position:absolute; left:76px; top:21599px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The specific performance penalty varies significantly. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">On a machine</span></div>
<div class="txt" style="position:absolute; left:112px; top:21649px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">with limited memory, the second code sample to be about 1000 times</span></div>
<div class="txt" style="position:absolute; left:112px; top:21697px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">faster than the first code sample. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">On machines with more memory,</span></div>
<div class="txt" style="position:absolute; left:112px; top:21745px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the difference to be as small as a factor of 2, and it doesn’t show up at</span></div>
<div class="txt" style="position:absolute; left:112px; top:21793px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">all except for very large values of MAX_ROWS and</span></div>
<div class="txt" style="position:absolute; left:112px; top:21836px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">MAX_COLUMNS. </span><span id="f32" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">内存越小，效果越明显</span></div>
<img id="background" style="position:absolute; left:0px; top:22046px;" width="1440" height="1080" src="page19.png"> <img id="background" style="position:absolute; left:1440px; top:22046px;" width="1440" height="1080" src="page-000019.png">
<div class="txt" style="position:absolute; left:33px; top:22153px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(3) System Calls</span></div>
<div class="txt" style="position:absolute; left:749px; top:22057px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:22290px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Calls to system routines are often expensive. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">系统子程序调用代价高</span></div>
<div class="txt" style="position:absolute; left:112px; top:22360px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">System routines include input/output operations to disk, keyboard, screen,</span></div>
<div class="txt" style="position:absolute; left:148px; top:22403px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">printer, or other device; memory-management routines; and certain utility</span></div>
<div class="txt" style="position:absolute; left:148px; top:22442px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">routines. </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">部分系统子程序中包含了不易发觉的耗时的</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">IO</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">操作等</span></div>
<div class="txt" style="position:absolute; left:76px; top:22512px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If </span><span id="f37" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">they’re expensive, consider these options:</span></div>
<div class="txt" style="position:absolute; left:112px; top:22579px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Write your own services</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">. Sometimes you need only a small part of the</span></div>
<div class="txt" style="position:absolute; left:148px; top:22622px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">functionality offered by a system routine and can build your own from</span></div>
<div class="txt" style="position:absolute; left:148px; top:22665px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">lower level system routines. Writing your own replacement gives you</span></div>
<div class="txt" style="position:absolute; left:148px; top:22704px;"><span id="f44" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">something that’s faster, smaller, and better suited to your needs. </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">自己写服务</span></div>
<div class="txt" style="position:absolute; left:148px; top:22748px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，只实现必须的部分</span></div>
<div class="txt" style="position:absolute; left:112px; top:22808px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Avoid going to the system. </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">避免调用系统中的方法</span></div>
<div class="txt" style="position:absolute; left:112px; top:22872px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Work with the system vendor to make the call faster. </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Most vendors want</span></div>
<div class="txt" style="position:absolute; left:148px; top:22916px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to improve their products and are glad to learn about parts of their systems</span></div>
<div class="txt" style="position:absolute; left:148px; top:22959px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">with weak performance. (They may seem a little grouchy about it at first,</span></div>
<div class="txt" style="position:absolute; left:148px; top:22998px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">but they really are interested.) </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">让系统供应商优化其开发的被调用程序</span></div>
<img id="background" style="position:absolute; left:0px; top:23268px;" width="1440" height="1080" src="page20.png"> <img id="background" style="position:absolute; left:1440px; top:23268px;" width="1440" height="1080" src="page-000020.png">
<div class="txt" style="position:absolute; left:749px; top:23279px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:23375px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(4) Relative Performance Costs of Operations</span></div>
<img id="background" style="position:absolute; left:0px; top:24490px;" width="1440" height="1080" src="page21.png"> <img id="background" style="position:absolute; left:1440px; top:24490px;" width="1440" height="1080" src="page-000021.png">
<div class="txt" style="position:absolute; left:749px; top:24501px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:24597px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Relative Performance Costs of Common Operations</span></div>
<div class="txt" style="position:absolute; left:669px; top:25055px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Most of the common operations are about the</span></div>
<div class="txt" style="position:absolute; left:669px; top:25099px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">same price</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">routine calls, assignments,</span></div>
<div class="txt" style="position:absolute; left:669px; top:25142px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">integer arithmetic, and floating-point</span></div>
<div class="txt" style="position:absolute; left:669px; top:25185px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">arithmetic are all roughly equal.</span></div>
<div class="txt" style="position:absolute; left:669px; top:25228px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Transcendental math functions are extremely</span></div>
<div class="txt" style="position:absolute; left:669px; top:25271px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">expensive. Polymorphic routine calls are a bit</span></div>
<div class="txt" style="position:absolute; left:669px; top:25315px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">more expensive than other kinds of routine</span></div>
<div class="txt" style="position:absolute; left:669px; top:25358px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">calls.</span></div>
<div class="txt" style="position:absolute; left:669px; top:25401px;"><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">In every case, improving speed comes from</span></div>
<div class="txt" style="position:absolute; left:669px; top:25445px;"><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">replacing an expensive operation with a</span></div>
<div class="txt" style="position:absolute; left:669px; top:25484px;"><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">cheaper one. </span><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">多数调优情况下，通过使用低开</span></div>
<div class="txt" style="position:absolute; left:669px; top:25527px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">销的操作替代高开销的操作，</span></div>
<img id="background" style="position:absolute; left:0px; top:25712px;" width="1440" height="1080" src="page22.png"> <img id="background" style="position:absolute; left:1440px; top:25712px;" width="1440" height="1080" src="page-000022.png">
<div class="txt" style="position:absolute; left:1105px; top:25730px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:171px; top:26041px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">3 Code Tuning for Object Creation</span></div>
<div class="txt" style="position:absolute; left:564px; top:26127px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">and reuse</span></div>
<div class="txt" style="position:absolute; left:538px; top:26386px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Singleton Pattern</span></div>
<div class="txt" style="position:absolute; left:533px; top:26443px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:521px; top:26501px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(3) Object Pool Pattern</span></div>
<div class="txt" style="position:absolute; left:432px; top:26559px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(4) Avoiding Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:516px; top:26616px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(5) Object Initialization</span></div>
<img id="background" style="position:absolute; left:0px; top:26934px;" width="1440" height="1080" src="page23.png"> <img id="background" style="position:absolute; left:1440px; top:26934px;" width="1440" height="1080" src="page-000023.png">
<div class="txt" style="position:absolute; left:1105px; top:26952px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:393px; top:27263px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Singleton Pattern</span></div>
<div class="txt" style="position:absolute; left:575px; top:27344px;"><span id="f13" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">单例模式</span></div>
<img id="background" style="position:absolute; left:0px; top:28156px;" width="1440" height="1080" src="page24.png"> <img id="background" style="position:absolute; left:1440px; top:28156px;" width="1440" height="1080" src="page-000024.png">
<div class="txt" style="position:absolute; left:33px; top:28263px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Singleton objects</span></div>
<div class="txt" style="position:absolute; left:749px; top:28167px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:28400px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Some classes have conceptually one instance </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">某些类在概念上只有一个</span></div>
<div class="txt" style="position:absolute; left:112px; top:28448px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">实例</span></div>
<div class="txt" style="position:absolute; left:112px; top:28518px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Many printers, but only one print spooler</span></div>
<div class="txt" style="position:absolute; left:112px; top:28578px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">One file system</span></div>
<div class="txt" style="position:absolute; left:112px; top:28639px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">One window manager</span></div>
<div class="txt" style="position:absolute; left:112px; top:28699px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">An accounting system will be dedicated to serving one company.</span></div>
<div class="txt" style="position:absolute; left:76px; top:28765px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Naïve: create many objects that represent the same conceptual</span></div>
<div class="txt" style="position:absolute; left:112px; top:28815px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">instance</span></div>
<div class="txt" style="position:absolute; left:76px; top:28882px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Better: only create one object and reuse it </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">只创建一个对象，然后复用</span></div>
<div class="txt" style="position:absolute; left:112px; top:28948px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Encapsulate the code that manages the reuse </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对管理重用的代码进行封装</span></div>
<img id="background" style="position:absolute; left:0px; top:29378px;" width="1440" height="1080" src="page25.png"> <img id="background" style="position:absolute; left:1440px; top:29378px;" width="1440" height="1080" src="page-000025.png">
<div class="txt" style="position:absolute; left:749px; top:29389px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:29480px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Singleton pattern </span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">单例模式</span></div>
<div class="txt" style="position:absolute; left:76px; top:29625px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Intent</span></div>
<div class="txt" style="position:absolute; left:112px; top:29692px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Ensure a class only has one instance, and provide a global point of access</span></div>
<div class="txt" style="position:absolute; left:148px; top:29731px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to it. </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">确保类只有一个实例，并提供一个全局访问点</span></div>
<div class="txt" style="position:absolute; left:76px; top:29801px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Applicability</span></div>
<div class="txt" style="position:absolute; left:112px; top:29867px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">There must be exactly one instance of a class, and it must be accessible to</span></div>
<div class="txt" style="position:absolute; left:148px; top:29907px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">clients from a well-known access point. </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">只能有一个类的实例，并且客户端</span></div>
<div class="txt" style="position:absolute; left:148px; top:29950px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">可以从众所周知的访问点访问它</span></div>
<div class="txt" style="position:absolute; left:112px; top:30014px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When the sole instance should be extensible by subclassing, and clients</span></div>
<div class="txt" style="position:absolute; left:148px; top:30058px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should be able to use an extended instance without modifying their code.</span></div>
<div class="txt" style="position:absolute; left:148px; top:30100px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">当唯一的实例可以通过子类扩展时，客户端应该能够使用扩展实例而不修</span></div>
<div class="txt" style="position:absolute; left:148px; top:30140px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">改它们的代码</span></div>
<img id="background" style="position:absolute; left:0px; top:30600px;" width="1440" height="1080" src="page26.png"> <img id="background" style="position:absolute; left:1440px; top:30600px;" width="1440" height="1080" src="page-000026.png">
<div class="txt" style="position:absolute; left:33px; top:30707px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Singleton pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:30611px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:30847px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Benefit:</span></div>
<div class="txt" style="position:absolute; left:112px; top:30910px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Controlled access to sole instance. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对唯一实例的受控访问</span></div>
<div class="txt" style="position:absolute; left:112px; top:30974px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Reduced name space.(The Singleton pattern is an improvement over</span></div>
<div class="txt" style="position:absolute; left:148px; top:31013px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">global variables). </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">缩小命名空间</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对全局变量的一种改进</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:112px; top:31078px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Class encapsulates code to ensure reuse of the object; no need to burden</span></div>
<div class="txt" style="position:absolute; left:148px; top:31117px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">client </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">类通过封装确保对象的复用，不用让客户端考虑</span></div>
<div class="txt" style="position:absolute; left:112px; top:31182px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Reuse implies better performance</span></div>
<div class="txt" style="position:absolute; left:148px; top:31238px;"><span id="f39" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">For frequently used objects, you can save the time it takes to create a new object;</span></div>
<div class="txt" style="position:absolute; left:184px; top:31273px;"><span id="f19" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">节省创建时间</span></div>
<div class="txt" style="position:absolute; left:148px; top:31323px;"><span id="f39" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">As the number of </span><span id="f46" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">new </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">operations decreased, the use of system memory can be</span></div>
<div class="txt" style="position:absolute; left:184px; top:31358px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">reduced. </span><span id="f19" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">降低内存消耗</span></div>
<div class="txt" style="position:absolute; left:148px; top:31407px;"><span id="f39" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Therefore, for the core components of the system and frequently used objects, the</span></div>
<div class="txt" style="position:absolute; left:184px; top:31442px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">use of singleton pattern can effectively improve system performance. </span><span id="f19" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">对于系统的</span></div>
<div class="txt" style="position:absolute; left:184px; top:31481px;"><span id="f19" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">核心组件和经常使用的对象，使用单例模式可以有效地提高系统性能。</span></div>
<img id="background" style="position:absolute; left:0px; top:31822px;" width="1440" height="1080" src="page27.png"> <img id="background" style="position:absolute; left:1440px; top:31822px;" width="1440" height="1080" src="page-000027.png">
<div class="txt" style="position:absolute; left:33px; top:31929px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Singleton pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:31833px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:32066px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Class is responsible for tracking its sole instance </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类负责管理其唯一</span></div>
<div class="txt" style="position:absolute; left:112px; top:32114px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">实例</span></div>
<div class="txt" style="position:absolute; left:112px; top:32180px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Make constructor private </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">使构造器</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">private</span></div>
<div class="txt" style="position:absolute; left:112px; top:32244px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Provide static method/field to allow access to the only instance of the class</span></div>
<div class="txt" style="position:absolute; left:148px; top:32284px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">提供</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">static</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">方法和字段允许对唯一实例的调用</span></div>
<div class="txt" style="position:absolute; left:76px; top:32353px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Structure</span></div>
<div class="txt" style="position:absolute; left:802px; top:32638px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">return uniqueInstance</span></div>
<img id="background" style="position:absolute; left:0px; top:33044px;" width="1440" height="1080" src="page28.png"> <img id="background" style="position:absolute; left:1440px; top:33044px;" width="1440" height="1080" src="page-000028.png">
<div class="txt" style="position:absolute; left:749px; top:33055px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:33151px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Implementing the Singleton method</span></div>
<div class="txt" style="position:absolute; left:54px; top:33279px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In Java, just define a </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">static </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">and </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">private instance </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">field, and a </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">private</span></div>
<div class="txt" style="position:absolute; left:90px; top:33329px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">constructor</span></div>
<div class="txt" style="position:absolute; left:88px; top:33416px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class Singleton {</span></div>
<div class="txt" style="position:absolute; left:166px; top:33460px;"><span id="f26" style="font-size:14px;vertical-align:baseline;color:rgba(255,0,0,1);">private static Singleton instance = new Singleton();</span></div>
<div class="txt" style="position:absolute; left:166px; top:33518px;"><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">private Singleton() {…} </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">//clients can’t access the constructor</span></div>
<div class="txt" style="position:absolute; left:166px; top:33604px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f26" style="font-size:14px;vertical-align:baseline;color:rgba(255,0,0,1);">static </span><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Singleton getInstance() {</span></div>
<div class="txt" style="position:absolute; left:246px; top:33663px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return instance;</span></div>
<div class="txt" style="position:absolute; left:166px; top:33721px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:166px; top:33779px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// other operations and data</span></div>
<div class="txt" style="position:absolute; left:88px; top:33823px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:88px; top:33881px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">//Client code</span></div>
<div class="txt" style="position:absolute; left:88px; top:33939px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Singleton s = Singleton.getInstance();</span></div>
<div class="txt" style="position:absolute; left:54px; top:34048px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Java semantics guarantee object is created immediately before first use</span></div>
<img id="background" style="position:absolute; left:0px; top:34266px;" width="1440" height="1080" src="page29.png"> <img id="background" style="position:absolute; left:1440px; top:34266px;" width="1440" height="1080" src="page-000029.png">
<div class="txt" style="position:absolute; left:749px; top:34277px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:34373px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Implementing the Singleton method</span></div>
<div class="txt" style="position:absolute; left:76px; top:34513px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">To further improve performance, </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">lazy load </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">technique can be used to</span></div>
<div class="txt" style="position:absolute; left:112px; top:34563px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">avoid the situation that it may take much time to create the sole</span></div>
<div class="txt" style="position:absolute; left:112px; top:34611px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">instance at startup and the instance will be created when it is first</span></div>
<div class="txt" style="position:absolute; left:112px; top:34654px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">used. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">延迟加载，不在启动时创建实例，在首次访问时创建</span></div>
<div class="txt" style="position:absolute; left:201px; top:34741px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class Singleton {</span></div>
<div class="txt" style="position:absolute; left:240px; top:34784px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private static Singleton instance;</span></div>
<div class="txt" style="position:absolute; left:240px; top:34842px;"><span id="f33" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">private Singleton() {…}</span></div>
<div class="txt" style="position:absolute; left:237px; top:34896px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">public static Singleton getInstance() {</span></div>
<div class="txt" style="position:absolute; left:312px; top:34950px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">if (instance == null)</span></div>
<div class="txt" style="position:absolute; left:375px; top:35004px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">instance = new Singleton();</span></div>
<div class="txt" style="position:absolute; left:316px; top:35058px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">return instance;</span></div>
<div class="txt" style="position:absolute; left:257px; top:35112px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:257px; top:35166px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// other operations and data</span></div>
<div class="txt" style="position:absolute; left:201px; top:35220px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:35305px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Pay attention to the usage in multi-thread program (see 10-1)</span></div>
<img id="background" style="position:absolute; left:0px; top:35488px;" width="1440" height="1080" src="page30.png"> <img id="background" style="position:absolute; left:1440px; top:35488px;" width="1440" height="1080" src="page-000030.png">
<div class="txt" style="position:absolute; left:1105px; top:35506px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:383px; top:35817px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:575px; top:35898px;"><span id="f13" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">享元模式</span></div>
<img id="background" style="position:absolute; left:0px; top:36710px;" width="1440" height="1080" src="page31.png"> <img id="background" style="position:absolute; left:1440px; top:36710px;" width="1440" height="1080" src="page-000031.png">
<div class="txt" style="position:absolute; left:749px; top:36721px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:36817px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight Pattern - Motivation</span></div>
<div class="txt" style="position:absolute; left:76px; top:36957px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">How can a document editor use objects to represent characters?</span></div>
<div class="txt" style="position:absolute; left:76px; top:37029px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The drawback of such a design is its cost.</span></div>
<div class="txt" style="position:absolute; left:76px; top:37101px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Even moderate-sized documents may require hundreds of thousands</span></div>
<div class="txt" style="position:absolute; left:112px; top:37151px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">of character objects, which will consume lots of memory and may</span></div>
<div class="txt" style="position:absolute; left:112px; top:37194px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">incur unacceptable run-time overhead. </span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">单独为每个字符创建实例，</span></div>
<div class="txt" style="position:absolute; left:112px; top:37242px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">会耗费大量内存</span></div>
<img id="background" style="position:absolute; left:0px; top:37932px;" width="1440" height="1080" src="page32.png"> <img id="background" style="position:absolute; left:1440px; top:37932px;" width="1440" height="1080" src="page-000032.png">
<div class="txt" style="position:absolute; left:33px; top:38039px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:37943px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:38179px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Flyweight pattern describes </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">how to share objects to allow their</span></div>
<div class="txt" style="position:absolute; left:112px; top:38224px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">use at fine granularities without prohibitive cost. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">享元模式描述了</span></div>
<div class="txt" style="position:absolute; left:112px; top:38272px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">如何共享对象，有效支持细粒度的使用而不会产生过高的成本</span></div>
<div class="txt" style="position:absolute; left:112px; top:38341px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">flyweight </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is a shared object that can be used in multiple contexts</span></div>
<div class="txt" style="position:absolute; left:148px; top:38381px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">simultaneously</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">. flyweight</span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">是一个共享对象，可在多个情境下同时使用</span></div>
<div class="txt" style="position:absolute; left:112px; top:38445px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Use sharing to support large numbers of fine-grained objects efficiently.</span></div>
<div class="txt" style="position:absolute; left:76px; top:38511px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">flyweight pattern</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, there is the concept of </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Intrinsic and</span></div>
<div class="txt" style="position:absolute; left:112px; top:38561px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Extrinsic state.</span></div>
<div class="txt" style="position:absolute; left:112px; top:38622px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Intrinsic states(</span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">内在状态</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">) </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">are things that are constant and are stored in the</span></div>
<div class="txt" style="position:absolute; left:148px; top:38665px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">memory, can be shared. </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">内在状态：不变的状态，可以共享</span></div>
<div class="txt" style="position:absolute; left:112px; top:38726px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Extrinsic states( </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">外在状态</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">) </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">are things that are not constant and need to be</span></div>
<div class="txt" style="position:absolute; left:148px; top:38773px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">calculated on the fly, and are therefore not stored in the memory, can not</span></div>
<div class="txt" style="position:absolute; left:148px; top:38812px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">be shared. </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">外在状态：状态是不固定的，使用时需要计算，不可共享</span></div>
<div class="txt" style="position:absolute; left:112px; top:38877px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., in a game, the shapes of the aliens are all the same, but their color will</span></div>
<div class="txt" style="position:absolute; left:148px; top:38920px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">change based on how mad each are. The shapes of the aliens will be</span></div>
<div class="txt" style="position:absolute; left:148px; top:38963px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Intrinsic, and the color of the alien will be Extrinsic.</span></div>
<img id="background" style="position:absolute; left:0px; top:39154px;" width="1440" height="1080" src="page33.png"> <img id="background" style="position:absolute; left:1440px; top:39154px;" width="1440" height="1080" src="page-000033.png">
<div class="txt" style="position:absolute; left:33px; top:39261px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:39165px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:39401px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight</span></div>
<div class="txt" style="position:absolute; left:112px; top:39468px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Declares an interface through which flyweights can receive and act on</span></div>
<div class="txt" style="position:absolute; left:148px; top:39511px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">extrinsic state.</span></div>
<div class="txt" style="position:absolute; left:76px; top:39574px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">ConcreteFlyweight (E.g.,Character) </span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">保存可共享的状态，对象可共享</span></div>
<div class="txt" style="position:absolute; left:112px; top:39643px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Implements the Flyweight interface and adds storage for intrinsic state, if</span></div>
<div class="txt" style="position:absolute; left:148px; top:39686px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">any. A </span><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ConcreteFlyweight </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object must be sharable. Any state it stores must</span></div>
<div class="txt" style="position:absolute; left:148px; top:39730px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">be intrinsic; that is, it must be independent of the </span><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ConcreteFlyweight </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object's</span></div>
<div class="txt" style="position:absolute; left:148px; top:39773px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">context.</span></div>
<img id="background" style="position:absolute; left:0px; top:40376px;" width="1440" height="1080" src="page34.png"> <img id="background" style="position:absolute; left:1440px; top:40376px;" width="1440" height="1080" src="page-000034.png">
<div class="txt" style="position:absolute; left:33px; top:40483px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:40387px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:40620px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">UnsharedConcreteFlyweight (E.g., Row, Column) </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">不可共享</span></div>
<div class="txt" style="position:absolute; left:112px; top:40690px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Not all Flyweight subclasses need to be shared. The Flyweight interface</span></div>
<div class="txt" style="position:absolute; left:148px; top:40733px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">enables sharing; it doesn't enforce it.</span></div>
<div class="txt" style="position:absolute; left:112px; top:40793px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It's common for UnsharedConcreteFlyweight objects to have</span></div>
<div class="txt" style="position:absolute; left:148px; top:40837px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ConcreteFlyweight objects as children at some level in the flyweight object</span></div>
<div class="txt" style="position:absolute; left:148px; top:40880px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">structure (as the Row and Column classes have).</span></div>
<img id="background" style="position:absolute; left:0px; top:41598px;" width="1440" height="1080" src="page35.png"> <img id="background" style="position:absolute; left:1440px; top:41598px;" width="1440" height="1080" src="page-000035.png">
<div class="txt" style="position:absolute; left:33px; top:41705px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:41609px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:41845px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">FlyweightFactory</span></div>
<div class="txt" style="position:absolute; left:112px; top:41908px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Creates and manages flyweight objects. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">创建和管理</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">flyweight </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象</span></div>
<div class="txt" style="position:absolute; left:112px; top:41972px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Ensures that flyweights are shared properly. When a client requests a</span></div>
<div class="txt" style="position:absolute; left:148px; top:42015px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">flyweight, the FlyweightFactory object supplies an existing instance or</span></div>
<div class="txt" style="position:absolute; left:148px; top:42055px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">creates one, if none exists. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">给客户端提供</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">flyweight</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象</span></div>
<div class="txt" style="position:absolute; left:112px; top:42119px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">In general, FlyweightFatory class is just an indexer that allows you to</span></div>
<div class="txt" style="position:absolute; left:148px; top:42162px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">retrieve the flyweight object when given an index number, since you may</span></div>
<div class="txt" style="position:absolute; left:148px; top:42202px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">have many flyweight objects in your application. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">起到索引器的作用</span></div>
<img id="background" style="position:absolute; left:0px; top:42820px;" width="1440" height="1080" src="page36.png"> <img id="background" style="position:absolute; left:1440px; top:42820px;" width="1440" height="1080" src="page-000036.png">
<div class="txt" style="position:absolute; left:33px; top:42927px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:42831px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:43067px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Client</span></div>
<div class="txt" style="position:absolute; left:112px; top:43130px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Maintains a reference to flyweight(s). </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">通过索引获取</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">flyweight</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">引用</span></div>
<div class="txt" style="position:absolute; left:112px; top:43190px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Computes or stores the extrinsic state of flyweight(s). </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">调用方法计算外在状态</span></div>
<img id="background" style="position:absolute; left:0px; top:44042px;" width="1440" height="1080" src="page37.png"> <img id="background" style="position:absolute; left:1440px; top:44042px;" width="1440" height="1080" src="page-000037.png">
<div class="txt" style="position:absolute; left:33px; top:44149px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example</span></div>
<div class="txt" style="position:absolute; left:749px; top:44053px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:44289px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Creating aliens of different shapes and colors</span></div>
<div class="txt" style="position:absolute; left:112px; top:44356px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The AlienFactory class stores and retrieves different types of aliens using</span></div>
<div class="txt" style="position:absolute; left:148px; top:44399px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">its getAlien and saveAlien methods.</span></div>
<div class="txt" style="position:absolute; left:112px; top:44459px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The Alien interface defines the shape property as the intrinsic state and</span></div>
<div class="txt" style="position:absolute; left:148px; top:44503px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the getColor method as the extrinsic state.</span></div>
<div class="txt" style="position:absolute; left:112px; top:44563px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The LargeAlien and the LittleAlien classes are the flyweight objects where</span></div>
<div class="txt" style="position:absolute; left:148px; top:44606px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">each has its own shape intrinsic state and ways of calculating</span></div>
<div class="txt" style="position:absolute; left:148px; top:44650px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the getColor extrinsic state.</span></div>
<img id="background" style="position:absolute; left:0px; top:45264px;" width="1440" height="1080" src="page38.png"> <img id="background" style="position:absolute; left:1440px; top:45264px;" width="1440" height="1080" src="page-000038.png">
<div class="txt" style="position:absolute; left:33px; top:45371px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example</span></div>
<div class="txt" style="position:absolute; left:749px; top:45275px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:99px; top:45500px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public enum Color {Red, Green, Blank, Blue, Yellow}</span></div>
<div class="txt" style="position:absolute; left:99px; top:45602px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">interface Alien </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:178px; top:45645px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String shape</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">=null; </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">//intrinsic state</span></div>
<div class="txt" style="position:absolute; left:178px; top:45688px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String getShape();</span></div>
<div class="txt" style="position:absolute; left:178px; top:45732px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Color getColor(int madLevel); </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">//extrinsic state</span></div>
<div class="txt" style="position:absolute; left:99px; top:45775px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:46486px;" width="1440" height="1080" src="page39.png"> <img id="background" style="position:absolute; left:1440px; top:46486px;" width="1440" height="1080" src="page-000039.png">
<div class="txt" style="position:absolute; left:33px; top:46593px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example</span></div>
<div class="txt" style="position:absolute; left:749px; top:46497px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:54px; top:46722px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class LargeAlien implements Alien</span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:132px; top:46766px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private String shape = "Large Shape";</span></div>
<div class="txt" style="position:absolute; left:132px; top:46809px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public String getShape(){</span></div>
<div class="txt" style="position:absolute; left:211px; top:46852px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return shape; }</span></div>
<div class="txt" style="position:absolute; left:902px; top:46766px;"><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">//intrinsic state</span></div>
<div class="txt" style="position:absolute; left:132px; top:46938px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public Color getColor(int madLevel){</span></div>
<div class="txt" style="position:absolute; left:211px; top:46982px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if (madLevel == 0)</span></div>
<div class="txt" style="position:absolute; left:290px; top:47025px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Color.Green;</span></div>
<div class="txt" style="position:absolute; left:211px; top:47068px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">else if (madLevel == 1)</span></div>
<div class="txt" style="position:absolute; left:290px; top:47111px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Color.Red;</span></div>
<div class="txt" style="position:absolute; left:211px; top:47154px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">else</span></div>
<div class="txt" style="position:absolute; left:290px; top:47198px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Color.Blue;</span></div>
<div class="txt" style="position:absolute; left:132px; top:47241px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:54px; top:47284px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:922px; top:46938px;"><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">//extrinsic state</span></div>
<img id="background" style="position:absolute; left:0px; top:47708px;" width="1440" height="1080" src="page40.png"> <img id="background" style="position:absolute; left:1440px; top:47708px;" width="1440" height="1080" src="page-000040.png">
<div class="txt" style="position:absolute; left:33px; top:47815px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example</span></div>
<div class="txt" style="position:absolute; left:749px; top:47719px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:65px; top:47944px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class LittleAlien implements Alien </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:144px; top:47988px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private String shape = "Little Shape"; </span><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">//intrinsic state</span></div>
<div class="txt" style="position:absolute; left:144px; top:48074px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public String getShape() {</span></div>
<div class="txt" style="position:absolute; left:223px; top:48117px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return shape;</span></div>
<div class="txt" style="position:absolute; left:144px; top:48160px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:144px; top:48247px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public Color getColor(int madLevel) </span><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">{//extrinsic state</span></div>
<div class="txt" style="position:absolute; left:223px; top:48290px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if (madLevel == 0)</span></div>
<div class="txt" style="position:absolute; left:302px; top:48333px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Color.Red;</span></div>
<div class="txt" style="position:absolute; left:223px; top:48376px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">else if (madLevel == 1)</span></div>
<div class="txt" style="position:absolute; left:302px; top:48420px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Color.Blue;</span></div>
<div class="txt" style="position:absolute; left:223px; top:48463px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">else</span></div>
<div class="txt" style="position:absolute; left:302px; top:48506px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Color.Green;</span></div>
<div class="txt" style="position:absolute; left:144px; top:48549px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:65px; top:48592px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:48930px;" width="1440" height="1080" src="page41.png"> <img id="background" style="position:absolute; left:1440px; top:48930px;" width="1440" height="1080" src="page-000041.png">
<div class="txt" style="position:absolute; left:33px; top:49037px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example</span></div>
<div class="txt" style="position:absolute; left:749px; top:48941px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:60px; top:49170px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class AlienFactory </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:159px; top:49214px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private Map&lt;String,Alien&gt; alienMap = new HashMap&lt;&gt;();</span></div>
<div class="txt" style="position:absolute; left:159px; top:49300px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public void saveAlien(String index, Alien alien)</span></div>
<div class="txt" style="position:absolute; left:159px; top:49343px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:243px; top:49386px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">alienMap.put(index,alien);</span></div>
<div class="txt" style="position:absolute; left:159px; top:49430px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:159px; top:49516px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public Alien getAlien(String index)</span></div>
<div class="txt" style="position:absolute; left:159px; top:49559px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:238px; top:49602px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return alienMap.get(index);</span></div>
<div class="txt" style="position:absolute; left:159px; top:49646px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:60px; top:49689px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:50152px;" width="1440" height="1080" src="page42.png"> <img id="background" style="position:absolute; left:1440px; top:50152px;" width="1440" height="1080" src="page-000042.png">
<div class="txt" style="position:absolute; left:33px; top:50259px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example</span></div>
<div class="txt" style="position:absolute; left:749px; top:50163px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:62px; top:50382px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public class program {</span></div>
<div class="txt" style="position:absolute; left:124px; top:50415px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) {</span></div>
<div class="txt" style="position:absolute; left:140px; top:50482px;"><span id="f16" style="font-size:11px;vertical-align:baseline;color:rgba(0,0,255,1);">//create aliens and store in factory</span></div>
<div class="txt" style="position:absolute; left:140px; top:50516px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">AlienFactory factory = new AlienFactory();</span></div>
<div class="txt" style="position:absolute; left:140px; top:50550px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">factory.saveAlien("LargeAlien", new LargeAlien());</span></div>
<div class="txt" style="position:absolute; left:140px; top:50583px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">factory.saveAlien("LittleAlien", new LittleAlien());</span></div>
<div class="txt" style="position:absolute; left:140px; top:50650px;"><span id="f16" style="font-size:11px;vertical-align:baseline;color:rgba(0,0,255,1);">//now access the flyweight objects</span></div>
<div class="txt" style="position:absolute; left:140px; top:50684px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">Alien a = factory.getAlien("LargeAlien");</span></div>
<div class="txt" style="position:absolute; left:140px; top:50718px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">Alien b = factory.getAlien("LittleAlien");</span></div>
<div class="txt" style="position:absolute; left:140px; top:50785px;"><span id="f16" style="font-size:11px;vertical-align:baseline;color:rgba(0,0,255,1);">//show intrinsic states, all accessed in memory without calculations</span></div>
<div class="txt" style="position:absolute; left:140px; top:50818px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Showing intrinsic states...");</span></div>
<div class="txt" style="position:absolute; left:140px; top:50852px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Alien of type LargeAlien is " + a.getShape());</span></div>
<div class="txt" style="position:absolute; left:140px; top:50886px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Alien of type LittleAlien is " + b.getShape());</span></div>
<div class="txt" style="position:absolute; left:140px; top:50953px;"><span id="f16" style="font-size:11px;vertical-align:baseline;color:rgba(0,0,255,1);">//show extrinsic states, need calculations</span></div>
<div class="txt" style="position:absolute; left:140px; top:50986px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Showing extrinsic states...");</span></div>
<div class="txt" style="position:absolute; left:140px; top:51020px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Alien of type LargeAlien is " + a.getColor(0).toString());</span></div>
<div class="txt" style="position:absolute; left:140px; top:51054px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Alien of type LargeAlien is " + a.getColor(1).toString());</span></div>
<div class="txt" style="position:absolute; left:140px; top:51087px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Alien of type LittleAlien is " + b.getColor(0).toString());</span></div>
<div class="txt" style="position:absolute; left:140px; top:51121px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">System.</span><span id="f48" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">out.println("Alien of type LittleAlien is " + b.getColor(1).toString());</span></div>
<div class="txt" style="position:absolute; left:109px; top:51155px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:62px; top:51188px;"><span id="f11" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:51374px;" width="1440" height="1080" src="page43.png"> <img id="background" style="position:absolute; left:1440px; top:51374px;" width="1440" height="1080" src="page-000043.png">
<div class="txt" style="position:absolute; left:33px; top:51481px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:51385px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:51621px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Flyweight pattern's effectiveness depends heavily on how and</span></div>
<div class="txt" style="position:absolute; left:112px; top:51671px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">where it's used.</span></div>
<div class="txt" style="position:absolute; left:76px; top:51741px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Applicability</span></div>
<div class="txt" style="position:absolute; left:112px; top:51808px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">An application uses a large number of objects. Storage costs are high</span></div>
<div class="txt" style="position:absolute; left:148px; top:51847px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">because of the sheer quantity of objects.</span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">应用程序使用了大量的对象，由于</span></div>
<div class="txt" style="position:absolute; left:148px; top:51890px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象的数量庞大，存储成本很高</span></div>
<div class="txt" style="position:absolute; left:112px; top:51955px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Most object state can be made extrinsic. Many groups of objects may be</span></div>
<div class="txt" style="position:absolute; left:148px; top:51998px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">replaced by relatively few shared objects once extrinsic state is removed.</span></div>
<div class="txt" style="position:absolute; left:148px; top:52040px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象的大多数状态是外部状态，一旦删除了外部状态，可以用相对较少的</span></div>
<div class="txt" style="position:absolute; left:148px; top:52080px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">共享对象替代很多组对象</span></div>
<div class="txt" style="position:absolute; left:112px; top:52145px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f56" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The application doesn‘t depend on object identity. Since flyweight objects</span></div>
<div class="txt" style="position:absolute; left:148px; top:52188px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">may be shared, identity tests will return true for conceptually distinct</span></div>
<div class="txt" style="position:absolute; left:148px; top:52227px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objects. </span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">应用程序不依赖于对象标识</span></div>
<img id="background" style="position:absolute; left:0px; top:52596px;" width="1440" height="1080" src="page44.png"> <img id="background" style="position:absolute; left:1440px; top:52596px;" width="1440" height="1080" src="page-000044.png">
<div class="txt" style="position:absolute; left:1105px; top:52614px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:386px; top:52925px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(3) Prototype Pattern</span></div>
<div class="txt" style="position:absolute; left:575px; top:53006px;"><span id="f13" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">原型模式</span></div>
<img id="background" style="position:absolute; left:0px; top:53818px;" width="1440" height="1080" src="page45.png"> <img id="background" style="position:absolute; left:1440px; top:53818px;" width="1440" height="1080" src="page-000045.png">
<div class="txt" style="position:absolute; left:33px; top:53925px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Prototype pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:53829px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:65px; top:54053px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Specify the kinds of objects to create using a prototypical instance, and</span></div>
<div class="txt" style="position:absolute; left:101px; top:54099px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">create new objects by copying this prototype. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">通过复制已有原型对象新</span></div>
<div class="txt" style="position:absolute; left:101px; top:54147px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">创建对象</span></div>
<div class="txt" style="position:absolute; left:65px; top:54222px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The prototype design pattern allows you to avoid expensive</span></div>
<div class="txt" style="position:absolute; left:101px; top:54271px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">initialization routines when you construct objects that are very similar.</span></div>
<div class="txt" style="position:absolute; left:101px; top:54319px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The goal is to minimize the amount of work needed in creating new</span></div>
<div class="txt" style="position:absolute; left:101px; top:54363px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects when the initialization routines are expensive. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">目标：创建或初</span></div>
<div class="txt" style="position:absolute; left:101px; top:54411px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">始化对象代价高时，可通过此模式创建相似对象，降低开销</span></div>
<div class="txt" style="position:absolute; left:65px; top:54486px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The concept of the prototype pattern is similar to a word document</span></div>
<div class="txt" style="position:absolute; left:101px; top:54535px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">template (prototype), where you create the template only once, then all</span></div>
<div class="txt" style="position:absolute; left:101px; top:54583px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the objects that you create afterwards uses the template as the starting</span></div>
<div class="txt" style="position:absolute; left:101px; top:54627px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">point to avoid repeating the work again. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类似于文档模板，创建一次，</span></div>
<div class="txt" style="position:absolute; left:101px; top:54675px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">多次被复制使用，作为撰写文档的起点。</span></div>
<img id="background" style="position:absolute; left:0px; top:55040px;" width="1440" height="1080" src="page46.png"> <img id="background" style="position:absolute; left:1440px; top:55040px;" width="1440" height="1080" src="page-000046.png">
<div class="txt" style="position:absolute; left:33px; top:55147px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Prototype pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:55051px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:63px; top:55275px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The key to the prototype pattern is that you will create your first object</span></div>
<div class="txt" style="position:absolute; left:99px; top:55325px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">with the expensive initializations, then store the values as a prototype</span></div>
<div class="txt" style="position:absolute; left:99px; top:55369px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in the repository.</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">原型模式在初始化创建第一个对象时开销大，然后将</span></div>
<div class="txt" style="position:absolute; left:99px; top:55417px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">这些值作为原型存储在存储库中。</span></div>
<div class="txt" style="position:absolute; left:63px; top:55492px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When you need create the same object again you can just get the copy</span></div>
<div class="txt" style="position:absolute; left:99px; top:55541px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">of the prototype from the repository with all the values prepopulated.</span></div>
<div class="txt" style="position:absolute; left:99px; top:55588px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">需要再次创建相同或类似对象时，只需从存储库中获取所有值已经预填</span></div>
<div class="txt" style="position:absolute; left:99px; top:55633px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">充的原型副本。</span></div>
<img id="background" style="position:absolute; left:0px; top:56262px;" width="1440" height="1080" src="page47.png"> <img id="background" style="position:absolute; left:1440px; top:56262px;" width="1440" height="1080" src="page-000047.png">
<div class="txt" style="position:absolute; left:33px; top:56369px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Prototype pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:56273px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:54px; top:56498px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Applicability</span></div>
<div class="txt" style="position:absolute; left:90px; top:56565px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Use the Prototype pattern when a system should be independent of how its</span></div>
<div class="txt" style="position:absolute; left:126px; top:56604px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">products are created, composed, and represented; </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">当一个系统应该独立于它的</span></div>
<div class="txt" style="position:absolute; left:126px; top:56649px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">产品创建、构成和表示时</span></div>
<div class="txt" style="position:absolute; left:90px; top:56712px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">when the classes to instantiate are specified at run-time, for example, by</span></div>
<div class="txt" style="position:absolute; left:126px; top:56751px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">dynamic loading; </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">当要实例化的类是在运行时刻指定时</span></div>
<div class="txt" style="position:absolute; left:90px; top:56816px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to avoid building a class hierarchy of factories that parallels the class</span></div>
<div class="txt" style="position:absolute; left:126px; top:56855px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">hierarchy of products;</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">为了避免创建一个与产品类层次平行的工厂类层次时</span></div>
<div class="txt" style="position:absolute; left:90px; top:56919px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">when instances of a class can have one of only a few different combinations of</span></div>
<div class="txt" style="position:absolute; left:126px; top:56963px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">state. It may be more convenient to install a corresponding number of</span></div>
<div class="txt" style="position:absolute; left:126px; top:57006px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">prototypes and clone them rather than instantiating the class manually, each</span></div>
<div class="txt" style="position:absolute; left:126px; top:57045px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">time with the appropriate state.</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">当一个类的实例只能有几个不同状态组合中的</span></div>
<div class="txt" style="position:absolute; left:126px; top:57091px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">一种时，建立相应数目的原型并克隆它们，可能比每次用合适的状态手工实例</span></div>
<div class="txt" style="position:absolute; left:126px; top:57133px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">化该类更方便一些。</span></div>
<img id="background" style="position:absolute; left:0px; top:57484px;" width="1440" height="1080" src="page48.png"> <img id="background" style="position:absolute; left:1440px; top:57484px;" width="1440" height="1080" src="page-000048.png">
<div class="txt" style="position:absolute; left:33px; top:57591px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Prototype pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:57495px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:65px; top:57725px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">PrototypeManager </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">class is just a manager class that is used to add</span></div>
<div class="txt" style="position:absolute; left:101px; top:57775px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and retrieve prototypes by an index number, it has the following</span></div>
<div class="txt" style="position:absolute; left:101px; top:57823px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">variable and methods:</span></div>
<div class="txt" style="position:absolute; left:101px; top:57888px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">prototypeList </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">variable is the collection that stores all the prototypes</span></div>
<div class="txt" style="position:absolute; left:101px; top:57949px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">addPrototype </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">method allows you to add a prototype to the collection and</span></div>
<div class="txt" style="position:absolute; left:137px; top:57992px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">assigning it an index number</span></div>
<div class="txt" style="position:absolute; left:101px; top:58052px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">getPrototype </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">method allows you to retrieve a prototype from the collection</span></div>
<div class="txt" style="position:absolute; left:137px; top:58095px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">using an index number</span></div>
<img id="background" style="position:absolute; left:0px; top:58706px;" width="1440" height="1080" src="page49.png"> <img id="background" style="position:absolute; left:1440px; top:58706px;" width="1440" height="1080" src="page-000049.png">
<div class="txt" style="position:absolute; left:33px; top:58813px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Prototype pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:58717px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:63px; top:58941px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Prototype </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">interface specifies the methods that all prototype classes</span></div>
<div class="txt" style="position:absolute; left:99px; top:58991px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">must implement.</span></div>
<div class="txt" style="position:absolute; left:99px; top:59056px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It has the </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">clone </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">method that returns an Prototype interface.</span></div>
<div class="txt" style="position:absolute; left:63px; top:59122px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">ConcretePrototype </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">class is the actual prototype class, it</span></div>
<div class="txt" style="position:absolute; left:99px; top:59172px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implements the Prototype interface and has the following property and</span></div>
<div class="txt" style="position:absolute; left:99px; top:59220px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method:</span></div>
<div class="txt" style="position:absolute; left:99px; top:59285px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">copyProperty variable </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">holds the information that is prepopulated. If the</span></div>
<div class="txt" style="position:absolute; left:135px; top:59328px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">variable value is changed then the new instances created will have the new</span></div>
<div class="txt" style="position:absolute; left:135px; top:59371px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">value.</span></div>
<div class="txt" style="position:absolute; left:99px; top:59432px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">clone </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">method will make a copy of itself and return it. If the copyProperty is a</span></div>
<div class="txt" style="position:absolute; left:135px; top:59475px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">value type (such as int or string) then you can just use </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">shallow copy</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">. If</span></div>
<div class="txt" style="position:absolute; left:135px; top:59518px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the copyProperty is a reference type (such as an object that contains other</span></div>
<div class="txt" style="position:absolute; left:135px; top:59562px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objects) then you will need to make </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">deep copy </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of the variable.</span></div>
<img id="background" style="position:absolute; left:0px; top:59928px;" width="1440" height="1080" src="page50.png"> <img id="background" style="position:absolute; left:1440px; top:59928px;" width="1440" height="1080" src="page-000050.png">
<div class="txt" style="position:absolute; left:33px; top:60035px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Clone() in Java</span></div>
<div class="txt" style="position:absolute; left:749px; top:59939px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:60175px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Object cloning refers to creation of exact copy of an object. It creates a</span></div>
<div class="txt" style="position:absolute; left:112px; top:60225px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">new instance of the class of current object and initializes all its fields</span></div>
<div class="txt" style="position:absolute; left:112px; top:60268px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">with exactly the contents of the corresponding fields of this object. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对</span></div>
<div class="txt" style="position:absolute; left:112px; top:60316px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">象</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">clone</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">意味着创建一个具有相同内容的副本</span></div>
<div class="txt" style="position:absolute; left:76px; top:60391px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Creating a copy </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">using clone() method</span></div>
<div class="txt" style="position:absolute; left:112px; top:60458px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The class whose object’s copy is to be made must have a public clone</span></div>
<div class="txt" style="position:absolute; left:148px; top:60497px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">method in it or in one of its parent class. </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">类中要声明</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">clone()</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">方法</span></div>
<div class="txt" style="position:absolute; left:112px; top:60561px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Every class that implements clone() should call super.clone() to obtain the</span></div>
<div class="txt" style="position:absolute; left:148px; top:60601px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">cloned object reference. </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">实现</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">clone()</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">时，要调用</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">super.clone()(in Object)</span></div>
<div class="txt" style="position:absolute; left:112px; top:60665px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The class must also implement java.lang.Cloneable interface whose object</span></div>
<div class="txt" style="position:absolute; left:148px; top:60708px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">clone we want to create otherwise it will throw</span></div>
<div class="txt" style="position:absolute; left:148px; top:60752px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">CloneNotSupportedException </span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">when clone method is called on that class’s</span></div>
<div class="txt" style="position:absolute; left:148px; top:60791px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object. </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">类需要实现 </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">java.lang.Cloneable</span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">接口</span></div>
<div class="txt" style="position:absolute; left:76px; top:60860px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Syntax:</span></div>
<div class="txt" style="position:absolute; left:112px; top:60927px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">protected Object clone() throws CloneNotSupportedException</span></div>
<img id="background" style="position:absolute; left:0px; top:61150px;" width="1440" height="1080" src="page51.png"> <img id="background" style="position:absolute; left:1440px; top:61150px;" width="1440" height="1080" src="page-000051.png">
<div class="txt" style="position:absolute; left:749px; top:61161px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:61257px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">clone with shallow copy</span></div>
<div class="txt" style="position:absolute; left:76px; top:61394px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Shallow copy(</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">浅拷贝</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">) </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is a method of copying an object(field-by-field</span></div>
<div class="txt" style="position:absolute; left:112px; top:61447px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">copy, field-for-field copy, or field copy). In that case a new object B is</span></div>
<div class="txt" style="position:absolute; left:112px; top:61490px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">created, and the fields values of A are copied over to B. </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">复制对象</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">A</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的</span></div>
<div class="txt" style="position:absolute; left:112px; top:61538px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">所有字段到对象</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">B</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">中</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">.</span></div>
<div class="txt" style="position:absolute; left:112px; top:61608px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If the field value is a primitive type it copies the value of the primitive</span></div>
<div class="txt" style="position:absolute; left:148px; top:61647px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">type. </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">基本数据类型采用复制值的形式</span></div>
<div class="txt" style="position:absolute; left:112px; top:61711px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If the field value is a reference to an object (e.g., a memory address) it</span></div>
<div class="txt" style="position:absolute; left:148px; top:61755px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">copies the reference, hence referring to the same object as A does. The</span></div>
<div class="txt" style="position:absolute; left:148px; top:61798px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">referenced objects are thus shared, so if one of these objects is modified</span></div>
<div class="txt" style="position:absolute; left:148px; top:61837px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(from A or B), the change is visible in the other. </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对对象的引用，则复制引</span></div>
<div class="txt" style="position:absolute; left:148px; top:61880px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">用，此时</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">A</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">B</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">共享对同一对象的引用。</span></div>
<div class="txt" style="position:absolute; left:112px; top:61945px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Shallow copies are simple and typically cheap, as they can be usually</span></div>
<div class="txt" style="position:absolute; left:148px; top:61984px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">implemented by simply copying the bits exactly. </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">实现简单</span></div>
<img id="background" style="position:absolute; left:0px; top:62372px;" width="1440" height="1080" src="page52.png"> <img id="background" style="position:absolute; left:1440px; top:62372px;" width="1440" height="1080" src="page-000052.png">
<div class="txt" style="position:absolute; left:749px; top:62383px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:62479px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">clone with shallow copy</span></div>
<div class="txt" style="position:absolute; left:65px; top:62620px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// An object reference of this class is</span></div>
<div class="txt" style="position:absolute; left:65px; top:62663px;"><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class Test</span></div>
<div class="txt" style="position:absolute; left:65px; top:62706px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:144px; top:62749px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int x, y;</span></div>
<div class="txt" style="position:absolute; left:65px; top:62792px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:874px; top:62620px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">contained by Test</span></div>
<div class="txt" style="position:absolute; left:65px; top:62879px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// Contains a reference of Test and implements</span></div>
<div class="txt" style="position:absolute; left:65px; top:62922px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// clone with shallow copy.</span></div>
<div class="txt" style="position:absolute; left:65px; top:62965px;"><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class ShallowCopyTest implements Cloneable</span></div>
<div class="txt" style="position:absolute; left:65px; top:63009px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:144px; top:63052px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int a;</span></div>
<div class="txt" style="position:absolute; left:144px; top:63095px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int b;</span></div>
<div class="txt" style="position:absolute; left:144px; top:63138px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Test c = new Test();</span></div>
<div class="txt" style="position:absolute; left:144px; top:63181px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public Object clone() throws CloneNotSupportedException</span></div>
<div class="txt" style="position:absolute; left:144px; top:63225px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:223px; top:63268px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return super.clone();</span></div>
<div class="txt" style="position:absolute; left:144px; top:63311px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:65px; top:63354px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:63594px;" width="1440" height="1080" src="page53.png"> <img id="background" style="position:absolute; left:1440px; top:63594px;" width="1440" height="1080" src="page-000053.png">
<div class="txt" style="position:absolute; left:749px; top:63605px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:63701px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">clone with shallow copy</span></div>
<div class="txt" style="position:absolute; left:42px; top:63830px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String args[]) throws</span></div>
<div class="txt" style="position:absolute; left:615px; top:63874px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">CloneNotSupportedException</span></div>
<div class="txt" style="position:absolute; left:121px; top:63917px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{ ShallowCopyTest t1 = new ShallowCopyTest();</span></div>
<div class="txt" style="position:absolute; left:180px; top:63960px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.a = 10;</span></div>
<div class="txt" style="position:absolute; left:180px; top:64003px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.b = 20;</span></div>
<div class="txt" style="position:absolute; left:180px; top:64046px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.c.x = 30;</span></div>
<div class="txt" style="position:absolute; left:180px; top:64090px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.c.y = 40;</span></div>
<div class="txt" style="position:absolute; left:180px; top:64176px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">ShallowCopyTest t2 = (ShallowCopyTest) t1.clone();</span></div>
<div class="txt" style="position:absolute; left:180px; top:64262px;"><span id="f29" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">t2.a = 100;</span></div>
<div class="txt" style="position:absolute; left:180px; top:64306px;"><span id="f29" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">t2.c.x = 300;</span></div>
<div class="txt" style="position:absolute; left:180px; top:64392px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(t1.a + " " + t1.b + " " +</span></div>
<div class="txt" style="position:absolute; left:555px; top:64435px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.c.x + " " + t1.c.y);</span></div>
<div class="txt" style="position:absolute; left:180px; top:64478px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(t2.a + " " + t2.b + " " +</span></div>
<div class="txt" style="position:absolute; left:555px; top:64522px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t2.c.x + " " + t2.c.y);</span></div>
<div class="txt" style="position:absolute; left:121px; top:64565px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:64816px;" width="1440" height="1080" src="page54.png"> <img id="background" style="position:absolute; left:1440px; top:64816px;" width="1440" height="1080" src="page-000054.png">
<div class="txt" style="position:absolute; left:33px; top:64923px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">clone with deep copy</span></div>
<div class="txt" style="position:absolute; left:749px; top:64827px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:65060px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An alternative is a deep copy(</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">深拷贝</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">), meaning that fields are</span></div>
<div class="txt" style="position:absolute; left:112px; top:65113px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">dereferenced:</span></div>
<div class="txt" style="position:absolute; left:112px; top:65178px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">rather than references to objects being copied, new copy objects are</span></div>
<div class="txt" style="position:absolute; left:148px; top:65217px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">created for any referenced objects, and references to these placed in B. </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">被</span></div>
<div class="txt" style="position:absolute; left:148px; top:65260px;"><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">复制对象中引用了某对象时，需要创建新的被引用对象</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">不是共享</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:112px; top:65325px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The result is different from the result a shallow copy gives in that the</span></div>
<div class="txt" style="position:absolute; left:148px; top:65368px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objects referenced by the copy B are distinct from those referenced by A,</span></div>
<div class="txt" style="position:absolute; left:148px; top:65407px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and independent. </span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">A</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">B</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">完全独立</span></div>
<div class="txt" style="position:absolute; left:112px; top:65472px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Deep copies are more expensive, due to needing to create additional</span></div>
<div class="txt" style="position:absolute; left:148px; top:65515px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objects, and can be substantially more complicated, due to references</span></div>
<div class="txt" style="position:absolute; left:148px; top:65554px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">possibly forming a complicated graph. </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">实现复杂，当存在复杂的引用关系</span></div>
<div class="txt" style="position:absolute; left:148px; top:65597px;"><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">图时更加难以实现</span></div>
<img id="background" style="position:absolute; left:0px; top:66038px;" width="1440" height="1080" src="page55.png"> <img id="background" style="position:absolute; left:1440px; top:66038px;" width="1440" height="1080" src="page-000055.png">
<div class="txt" style="position:absolute; left:33px; top:66145px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">clone with deep copy</span></div>
<div class="txt" style="position:absolute; left:749px; top:66049px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:79px; top:66295px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// An object reference of this class is</span></div>
<div class="txt" style="position:absolute; left:79px; top:66338px;"><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class Test</span></div>
<div class="txt" style="position:absolute; left:79px; top:66381px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:157px; top:66424px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int x, y;</span></div>
<div class="txt" style="position:absolute; left:79px; top:66467px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:890px; top:66295px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">contained by Test</span></div>
<div class="txt" style="position:absolute; left:79px; top:66554px;"><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class DeepCopyTest implements Cloneable</span></div>
<div class="txt" style="position:absolute; left:79px; top:66597px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:138px; top:66640px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int a, b;</span></div>
<div class="txt" style="position:absolute; left:138px; top:66684px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Test c = new Test();</span></div>
<div class="txt" style="position:absolute; left:157px; top:66770px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public Object clone() throws CloneNotSupportedException</span></div>
<div class="txt" style="position:absolute; left:157px; top:66813px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:237px; top:66856px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">DeepCopyTest t = (DeepCopyTest)super.clone();</span></div>
<div class="txt" style="position:absolute; left:237px; top:66900px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t.c = new Test();</span></div>
<div class="txt" style="position:absolute; left:237px; top:66943px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return t;</span></div>
<div class="txt" style="position:absolute; left:157px; top:66986px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:79px; top:67029px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:67260px;" width="1440" height="1080" src="page56.png"> <img id="background" style="position:absolute; left:1440px; top:67260px;" width="1440" height="1080" src="page-000056.png">
<div class="txt" style="position:absolute; left:33px; top:67367px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">clone with deep copy</span></div>
<div class="txt" style="position:absolute; left:749px; top:67271px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:65px; top:67508px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String args[]) throws</span></div>
<div class="txt" style="position:absolute; left:637px; top:67551px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">CloneNotSupportedException</span></div>
<div class="txt" style="position:absolute; left:144px; top:67594px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{ DeepCopyTest t1 = new DeepCopyTest();</span></div>
<div class="txt" style="position:absolute; left:203px; top:67637px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.a = 10;</span></div>
<div class="txt" style="position:absolute; left:203px; top:67680px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.b = 20;</span></div>
<div class="txt" style="position:absolute; left:203px; top:67724px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.c.x = 30;</span></div>
<div class="txt" style="position:absolute; left:203px; top:67767px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.c.y = 40;</span></div>
<div class="txt" style="position:absolute; left:203px; top:67853px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">DeepCopyTest t3 = (DeepCopyTest)t1.clone();</span></div>
<div class="txt" style="position:absolute; left:203px; top:67940px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t3.a = 100;</span></div>
<div class="txt" style="position:absolute; left:203px; top:67983px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t3.c.x = 300;</span></div>
<div class="txt" style="position:absolute; left:203px; top:68069px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(t1.a + " " + t1.b + " " +</span></div>
<div class="txt" style="position:absolute; left:578px; top:68113px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t1.c.x + " " + t1.c.y);</span></div>
<div class="txt" style="position:absolute; left:203px; top:68156px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(t3.a + " " + t3.b + " " +</span></div>
<div class="txt" style="position:absolute; left:578px; top:68199px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">t3.c.x + " " + t3.c.y);</span></div>
<div class="txt" style="position:absolute; left:144px; top:68242px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:68482px;" width="1440" height="1080" src="page57.png"> <img id="background" style="position:absolute; left:1440px; top:68482px;" width="1440" height="1080" src="page-000057.png">
<div class="txt" style="position:absolute; left:33px; top:68589px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example of Prototype</span></div>
<div class="txt" style="position:absolute; left:749px; top:68493px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:54px; top:68715px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public </span><span id="f13" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">class PrototypeManager </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:152px; top:68758px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private Map&lt;String,Prototype&gt; prototypeMap = new HashMap&lt;&gt;();</span></div>
<div class="txt" style="position:absolute; left:152px; top:68845px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public void addPrototype(String index, Prototype prototype)</span></div>
<div class="txt" style="position:absolute; left:152px; top:68888px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:217px; top:68931px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">prototypeMap.put(index,prototype);</span></div>
<div class="txt" style="position:absolute; left:152px; top:68974px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:152px; top:69061px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public Prototype get Prototype(String index)</span></div>
<div class="txt" style="position:absolute; left:152px; top:69104px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">{</span></div>
<div class="txt" style="position:absolute; left:231px; top:69147px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return prototypeMap.get(index).clone();</span></div>
<div class="txt" style="position:absolute; left:152px; top:69190px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:54px; top:69234px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:69704px;" width="1440" height="1080" src="page58.png"> <img id="background" style="position:absolute; left:1440px; top:69704px;" width="1440" height="1080" src="page-000058.png">
<div class="txt" style="position:absolute; left:33px; top:69811px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example of Prototype</span></div>
<div class="txt" style="position:absolute; left:749px; top:69715px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:70051px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class program {</span></div>
<div class="txt" style="position:absolute; left:155px; top:70095px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) {</span></div>
<div class="txt" style="position:absolute; left:175px; top:70181px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">PrototypeManager </span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">manager = new </span><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">PrototypeManager</span><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">();</span></div>
<div class="txt" style="position:absolute; left:175px; top:70224px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">//add prototypes into manager</span></div>
<div class="txt" style="position:absolute; left:175px; top:70267px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">manager.addPrototype</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(…);</span></div>
<div class="txt" style="position:absolute; left:175px; top:70311px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">manager.addPrototype</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(…);</span></div>
<div class="txt" style="position:absolute; left:175px; top:70354px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">manager.addPrototype</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(…);</span></div>
<div class="txt" style="position:absolute; left:175px; top:70397px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">……</span></div>
<div class="txt" style="position:absolute; left:175px; top:70483px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Prototype a = manager.getPrototype</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(…);</span></div>
<div class="txt" style="position:absolute; left:175px; top:70570px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">//other codes</span></div>
<div class="txt" style="position:absolute; left:175px; top:70613px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:70656px;"><span id="f10" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:70926px;" width="1440" height="1080" src="page59.png"> <img id="background" style="position:absolute; left:1440px; top:70926px;" width="1440" height="1080" src="page-000059.png">
<div class="txt" style="position:absolute; left:749px; top:70937px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:71033px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">prototype pattern vs. flyweight pattern</span></div>
<div class="txt" style="position:absolute; left:76px; top:71173px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Similarities</span></div>
<div class="txt" style="position:absolute; left:112px; top:71240px;"><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Both of them uses a manager to store and retrieve the objects in the</span></div>
<div class="txt" style="position:absolute; left:148px; top:71283px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">collection.</span></div>
<div class="txt" style="position:absolute; left:76px; top:71349px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Differences</span></div>
<div class="txt" style="position:absolute; left:112px; top:71415px;"><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The prototype pattern is used to create new objects that are similar in</span></div>
<div class="txt" style="position:absolute; left:148px; top:71455px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">nature (hence it‘s a creational pattern),</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">原型模式用于创建本质上相似的新</span></div>
<div class="txt" style="position:absolute; left:148px; top:71498px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象（因此它是一种创建模式），</span></div>
<div class="txt" style="position:absolute; left:112px; top:71562px;"><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">while the flyweight pattern is used to allow the application to point to the</span></div>
<div class="txt" style="position:absolute; left:148px; top:71606px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">same instance of the object to save memory (hence it's a structural</span></div>
<div class="txt" style="position:absolute; left:148px; top:71645px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">pattern). </span><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">flyweight</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">模式用于允许应用程序指向对象的同一个实例以节省内</span></div>
<div class="txt" style="position:absolute; left:148px; top:71688px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">存（因此它是一种结构模式）。</span></div>
<img id="background" style="position:absolute; left:0px; top:72148px;" width="1440" height="1080" src="page60.png"> <img id="background" style="position:absolute; left:1440px; top:72148px;" width="1440" height="1080" src="page-000060.png">
<div class="txt" style="position:absolute; left:1105px; top:72166px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:362px; top:72563px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(4) Object Pool Pattern</span></div>
<img id="background" style="position:absolute; left:0px; top:73370px;" width="1440" height="1080" src="page61.png"> <img id="background" style="position:absolute; left:1440px; top:73370px;" width="1440" height="1080" src="page-000061.png">
<div class="txt" style="position:absolute; left:33px; top:73477px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Object reuse</span></div>
<div class="txt" style="position:absolute; left:749px; top:73381px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:73617px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects are expensive to create.</span></div>
<div class="txt" style="position:absolute; left:112px; top:73684px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Where it is reasonable to reuse the same object, you should do so. You need</span></div>
<div class="txt" style="position:absolute; left:148px; top:73723px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to be aware of when not to call new. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">重复使用，避免重新创建</span></div>
<div class="txt" style="position:absolute; left:76px; top:73793px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">One fairly obvious situation is when you have already used an object</span></div>
<div class="txt" style="position:absolute; left:112px; top:73842px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and can discard it before you are about to create another object of the</span></div>
<div class="txt" style="position:absolute; left:112px; top:73886px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">same class. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">已经有了一个对象，并不再使用时，可让程序其他部分继续</span></div>
<div class="txt" style="position:absolute; left:112px; top:73934px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">使用</span></div>
<div class="txt" style="position:absolute; left:112px; top:74003px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You should look at the object and consider whether it is possible to reset the</span></div>
<div class="txt" style="position:absolute; left:148px; top:74047px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">fields and then reuse the object, rather than throw it away and create another.</span></div>
<div class="txt" style="position:absolute; left:112px; top:74107px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">This can be particularly important for objects that are constantly used and</span></div>
<div class="txt" style="position:absolute; left:148px; top:74150px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">discarded: for example, in graphics processing, objects such as Rectangles,</span></div>
<div class="txt" style="position:absolute; left:148px; top:74194px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Points, Colors, and Fonts are used and discarded all the time.</span></div>
<div class="txt" style="position:absolute; left:112px; top:74254px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Recycling these types of objects can certainly improve performance.</span></div>
<div class="txt" style="position:absolute; left:112px; top:74311px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">回收再利用</span></div>
<img id="background" style="position:absolute; left:0px; top:74592px;" width="1440" height="1080" src="page62.png"> <img id="background" style="position:absolute; left:1440px; top:74592px;" width="1440" height="1080" src="page-000062.png">
<div class="txt" style="position:absolute; left:33px; top:74699px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Object Pool Pattern</span></div>
<div class="txt" style="position:absolute; left:749px; top:74603px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:74839px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The object pool pattern is a software creational design pattern that</span></div>
<div class="txt" style="position:absolute; left:112px; top:74889px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">uses a set of initialized objects kept ready to use </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">a "pool" </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">rather</span></div>
<div class="txt" style="position:absolute; left:112px; top:74937px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than allocating and destroying them on demand.</span></div>
<div class="txt" style="position:absolute; left:76px; top:75007px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">database connection pool, printer pool</span></div>
<div class="txt" style="position:absolute; left:76px; top:75079px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A client of the pool will request an object from the pool and perform</span></div>
<div class="txt" style="position:absolute; left:112px; top:75129px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">operations on the returned object.</span></div>
<div class="txt" style="position:absolute; left:76px; top:75199px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When the client has finished, it returns the object to the pool rather</span></div>
<div class="txt" style="position:absolute; left:112px; top:75244px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than destroying it; this can be done manually or automatically. </span><span id="f33" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">使用</span></div>
<div class="txt" style="position:absolute; left:112px; top:75292px;"><span id="f33" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">时从</span><span id="f38" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">pool</span><span id="f33" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">中取出，用完后归还，类似工具箱</span></div>
<img id="background" style="position:absolute; left:0px; top:75814px;" width="1440" height="1080" src="page63.png"> <img id="background" style="position:absolute; left:1440px; top:75814px;" width="1440" height="1080" src="page-000063.png">
<div class="txt" style="position:absolute; left:749px; top:75825px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:75921px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Object Pool Pattern vs Flyweight Pattern</span></div>
<div class="txt" style="position:absolute; left:76px; top:76058px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">原理不同：</span></div>
<div class="txt" style="position:absolute; left:112px; top:76124px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object pool</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的原理是复用，</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">pool</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">中</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">被取出后，只能由一个</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">client</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">使用；</span></div>
<div class="txt" style="position:absolute; left:112px; top:76184px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的原理是共享，一个</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">可被多个</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">client</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">同时使用。</span></div>
<div class="txt" style="position:absolute; left:76px; top:76251px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">对象性质不同：</span></div>
<div class="txt" style="position:absolute; left:112px; top:76317px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object pool</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">中的对象是同质的，对于</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">client</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">来说，可以用</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">pool</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">中的任何一个</span></div>
<div class="txt" style="position:absolute; left:148px; top:76360px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">。如：需要</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">connection</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">时可以从</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">connection pool</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">中任意的拿一个出来</span></div>
<div class="txt" style="position:absolute; left:148px; top:76403px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">使用；</span></div>
<div class="txt" style="position:absolute; left:112px; top:76464px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的每一个实例的内部属性相同，但是外部属性不同，是异质的。</span></div>
<div class="txt" style="position:absolute; left:148px; top:76507px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">使用时，是去</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">FlyweightFactory</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">中找一个特定的对象出来（如果</span></div>
<div class="txt" style="position:absolute; left:148px; top:76550px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">没有的话，就创建一个）。</span></div>
<div class="txt" style="position:absolute; left:76px; top:76617px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">应用场合不同</span></div>
<div class="txt" style="position:absolute; left:112px; top:76683px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object pool</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">对应的场景是对象被频繁创建、使用，然后销毁。每个对象的生</span></div>
<div class="txt" style="position:absolute; left:148px; top:76726px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">命期都很短。同一时刻内，系统中存在的对象数也比较小。</span></div>
<div class="txt" style="position:absolute; left:112px; top:76786px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Flyweight</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">对应的情况是在同一时刻内，系统中存在大量对象。</span></div>
<img id="background" style="position:absolute; left:0px; top:77036px;" width="1440" height="1080" src="page64.png"> <img id="background" style="position:absolute; left:1440px; top:77036px;" width="1440" height="1080" src="page-000064.png">
<div class="txt" style="position:absolute; left:749px; top:77047px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:77143px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Reusable containers / collections</span></div>
<div class="txt" style="position:absolute; left:76px; top:77283px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Most container objects (e.g., Vectors, Hashtables) can be reused</span></div>
<div class="txt" style="position:absolute; left:112px; top:77328px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">rather than created and thrown away. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对容器对象进行重用</span></div>
<div class="txt" style="position:absolute; left:112px; top:77398px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">While you are not using the retained objects, you are holding onto more</span></div>
<div class="txt" style="position:absolute; left:148px; top:77441px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">memory than if you simply discarded those objects, and this reduces the</span></div>
<div class="txt" style="position:absolute; left:148px; top:77484px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">memory available to create other objects.</span></div>
<div class="txt" style="position:absolute; left:112px; top:77545px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You need to balance the need to have some free memory available against</span></div>
<div class="txt" style="position:absolute; left:148px; top:77588px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the need to improve performance by reusing objects.</span></div>
<div class="txt" style="position:absolute; left:112px; top:77648px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">But generally, the space taken by retaining objects for later reuse is</span></div>
<div class="txt" style="position:absolute; left:148px; top:77692px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">significant only for very large collections, and you should certainly know</span></div>
<div class="txt" style="position:absolute; left:148px; top:77735px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">which ones these are in your application.</span></div>
<img id="background" style="position:absolute; left:0px; top:78258px;" width="1440" height="1080" src="page65.png"> <img id="background" style="position:absolute; left:1440px; top:78258px;" width="1440" height="1080" src="page-000065.png">
<div class="txt" style="position:absolute; left:749px; top:78269px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:78365px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Reusable containers / collections</span></div>
<div class="txt" style="position:absolute; left:76px; top:78505px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//An instance of the vector pool manager which contains 25 vectors</span></div>
<div class="txt" style="position:absolute; left:76px; top:78563px;"><span id="f13" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static VectorPoolMgr vectorPoolMgr = new VectorPoolMgr(25);</span></div>
<div class="txt" style="position:absolute; left:76px; top:78620px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">...</span></div>
<div class="txt" style="position:absolute; left:76px; top:78678px;"><span id="f13" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public void someMethod( ) {</span></div>
<div class="txt" style="position:absolute; left:112px; top:78732px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//Get a new Vector. We only use the vector to do some stuff</span></div>
<div class="txt" style="position:absolute; left:112px; top:78785px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//within this method, and then we dump the vector (i.e., it</span></div>
<div class="txt" style="position:absolute; left:112px; top:78839px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//is not returned or assigned to a state variable)</span></div>
<div class="txt" style="position:absolute; left:112px; top:78893px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//so this is a perfect candidate for reusing Vectors.</span></div>
<div class="txt" style="position:absolute; left:112px; top:78947px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//Use a factory method instead of 'new Vector( )'</span></div>
<div class="txt" style="position:absolute; left:112px; top:79000px;"><span id="f13" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">Vector v = vectorPoolMgr.getVector( );</span></div>
<div class="txt" style="position:absolute; left:112px; top:79054px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">... //do vector manipulation stuff</span></div>
<div class="txt" style="position:absolute; left:112px; top:79108px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//and the extra work is that we have to explicitly tell the</span></div>
<div class="txt" style="position:absolute; left:112px; top:79162px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">//pool manager that we have finished with the vector</span></div>
<div class="txt" style="position:absolute; left:112px; top:79216px;"><span id="f13" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">vectorPoolMgr.returnVector(v);</span></div>
<div class="txt" style="position:absolute; left:76px; top:79273px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:79480px;" width="1440" height="1080" src="page66.png"> <img id="background" style="position:absolute; left:1440px; top:79480px;" width="1440" height="1080" src="page-000066.png">
<div class="txt" style="position:absolute; left:749px; top:79491px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:79582px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Canonicalizing Objects</span><span id="f12" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">规范化</span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">/</span><span id="f12" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">标准化对象</span></div>
<div class="txt" style="position:absolute; left:76px; top:79727px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Canonicalizing objects</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">: replacing multiple copies of an object with just</span></div>
<div class="txt" style="position:absolute; left:112px; top:79772px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">a few objects. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">规范化的对象：用少量对象替代一个对象的大量副本</span></div>
<div class="txt" style="position:absolute; left:76px; top:79847px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For example:</span></div>
<div class="txt" style="position:absolute; left:148px; top:79910px;"><span id="f28" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Boolean t1 = new Boolean(true);</span></div>
<div class="txt" style="position:absolute; left:148px; top:79956px;"><span id="f28" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(t1==Boolean.TRUE);</span></div>
<div class="txt" style="position:absolute; left:148px; top:80007px;"><span id="f28" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(t1.equals(Boolean.TRUE));</span></div>
<div class="txt" style="position:absolute; left:970px; top:79955px;"><span id="f16" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">➔</span><span id="f28" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">false</span></div>
<div class="txt" style="position:absolute; left:970px; top:80003px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">➔</span><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">true</span></div>
<div class="txt" style="position:absolute; left:76px; top:80135px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If Booleans had been canonicalized, all Boolean comparisons could be</span></div>
<div class="txt" style="position:absolute; left:112px; top:80185px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">done by identity: </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">comparison by identity is always faster than</span></div>
<div class="txt" style="position:absolute; left:112px; top:80233px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">comparison by equality, </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">because identity comparisons are simply</span></div>
<div class="txt" style="position:absolute; left:112px; top:80276px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">pointer comparisons. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">==</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">” 比较比</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">快，通过规范化可实现用</span></div>
<div class="txt" style="position:absolute; left:112px; top:80324px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">==</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">”比较替代</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">比较</span></div>
<img id="background" style="position:absolute; left:0px; top:80702px;" width="1440" height="1080" src="page67.png"> <img id="background" style="position:absolute; left:1440px; top:80702px;" width="1440" height="1080" src="page-000067.png">
<div class="txt" style="position:absolute; left:749px; top:80713px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:80809px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example: Integer canonicalization</span></div>
<div class="txt" style="position:absolute; left:76px; top:80949px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you use just a few </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects in some defined way, you</span></div>
<div class="txt" style="position:absolute; left:112px; top:80998px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">repeatedly create the </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects with values </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">1, 2, 3, </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">etc.,</span></div>
<div class="txt" style="position:absolute; left:112px; top:81046px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and also access the </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">integerValue() </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to compare them.</span></div>
<div class="txt" style="position:absolute; left:76px; top:81117px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Otherwise, you can canonicalize a few </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">integer </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects, improving</span></div>
<div class="txt" style="position:absolute; left:112px; top:81166px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">performance in several ways: eliminating the extra </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer</span></div>
<div class="txt" style="position:absolute; left:112px; top:81215px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">creations and the garbage collections of these objects when they are</span></div>
<div class="txt" style="position:absolute; left:112px; top:81258px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">discarded, and allowing comparison by identity. </span><span id="f37" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">创建常用整数，并</span></div>
<div class="txt" style="position:absolute; left:112px; top:81306px;"><span id="f37" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">保留</span></div>
<div class="txt" style="position:absolute; left:76px; top:81375px;"><span id="f14" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public class IntegerManager {</span></div>
<div class="txt" style="position:absolute; left:112px; top:81422px;"><span id="f14" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static final Integer ZERO = new Integer(0);</span></div>
<div class="txt" style="position:absolute; left:112px; top:81469px;"><span id="f14" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static final Integer ONE = new Integer(1);</span></div>
<div class="txt" style="position:absolute; left:112px; top:81516px;"><span id="f14" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static final Integer TWO = new Integer(2);</span></div>
<div class="txt" style="position:absolute; left:112px; top:81563px;"><span id="f47" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">……</span></div>
<div class="txt" style="position:absolute; left:112px; top:81610px;"><span id="f14" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static final Integer NINE = new Integer(9);</span></div>
<div class="txt" style="position:absolute; left:112px; top:81657px;"><span id="f14" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">public static final Integer TEN = new Integer(10);</span></div>
<div class="txt" style="position:absolute; left:76px; top:81708px;"><span id="f14" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:81924px;" width="1440" height="1080" src="page68.png"> <img id="background" style="position:absolute; left:1440px; top:81924px;" width="1440" height="1080" src="page-000068.png">
<div class="txt" style="position:absolute; left:749px; top:81935px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:82031px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example: Integer canonicalization</span></div>
<div class="txt" style="position:absolute; left:99px; top:82171px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer i1 = new Integer(1);</span></div>
<div class="txt" style="position:absolute; left:99px; top:82210px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer i2 = new Integer(1);</span></div>
<div class="txt" style="position:absolute; left:99px; top:82248px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i1.hashCode());</span></div>
<div class="txt" style="position:absolute; left:99px; top:82286px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i2.hashCode());</span></div>
<div class="txt" style="position:absolute; left:99px; top:82325px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i1 == i2);</span></div>
<div class="txt" style="position:absolute; left:99px; top:82363px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i1.equals(i2));</span></div>
<div class="txt" style="position:absolute; left:99px; top:82440px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println("-------------------");</span></div>
<div class="txt" style="position:absolute; left:99px; top:82517px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer i3 = 1;</span></div>
<div class="txt" style="position:absolute; left:99px; top:82555px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer i4 = 1;</span></div>
<div class="txt" style="position:absolute; left:99px; top:82594px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i3.hashCode());</span></div>
<div class="txt" style="position:absolute; left:99px; top:82632px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i4.hashCode());</span></div>
<div class="txt" style="position:absolute; left:99px; top:82670px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i3 == i4);</span></div>
<div class="txt" style="position:absolute; left:99px; top:82709px;"><span id="f30" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(i3.equals(i4));</span></div>
<div class="txt" style="position:absolute; left:938px; top:82217px;"><span id="f56" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">Result:</span></div>
<div class="txt" style="position:absolute; left:938px; top:82260px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">1</span></div>
<div class="txt" style="position:absolute; left:938px; top:82303px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">1</span></div>
<div class="txt" style="position:absolute; left:938px; top:82347px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">false</span></div>
<div class="txt" style="position:absolute; left:938px; top:82390px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">true</span></div>
<div class="txt" style="position:absolute; left:938px; top:82433px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-------------------</span></div>
<div class="txt" style="position:absolute; left:938px; top:82476px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">1</span></div>
<div class="txt" style="position:absolute; left:938px; top:82520px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">1</span></div>
<div class="txt" style="position:absolute; left:938px; top:82563px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">true</span></div>
<div class="txt" style="position:absolute; left:938px; top:82606px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">true</span></div>
<div class="txt" style="position:absolute; left:246px; top:82826px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Integer</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类中，缓存了从</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">-128</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">到</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">127</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">之间的所有的整数对象</span></div>
<img id="background" style="position:absolute; left:0px; top:83146px;" width="1440" height="1080" src="page69.png"> <img id="background" style="position:absolute; left:1440px; top:83146px;" width="1440" height="1080" src="page-000069.png">
<div class="txt" style="position:absolute; left:749px; top:83157px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:83253px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example: Enumerating constants</span></div>
<div class="txt" style="position:absolute; left:76px; top:83393px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Another canonicalization technique often used is </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">replacing constant</span></div>
<div class="txt" style="position:absolute; left:112px; top:83438px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects with integers. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用整数替换常量对象</span></div>
<div class="txt" style="position:absolute; left:76px; top:83513px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, rather than use the strings "female" and "male", you</span></div>
<div class="txt" style="position:absolute; left:112px; top:83563px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">should use a constant defined in an interface:</span></div>
<div class="txt" style="position:absolute; left:112px; top:83627px;"><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public interface GENDER {</span></div>
<div class="txt" style="position:absolute; left:150px; top:83684px;"><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public static final int FEMALE=1;</span></div>
<div class="txt" style="position:absolute; left:150px; top:83741px;"><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public static final int MALE=2;</span></div>
<div class="txt" style="position:absolute; left:112px; top:83798px;"><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:83861px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Used consistently, this enumeration can provide both speed and</span></div>
<div class="txt" style="position:absolute; left:112px; top:83911px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory advantages.</span></div>
<div class="txt" style="position:absolute; left:112px; top:83976px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The enumeration requires less memory than the equivalent strings and</span></div>
<div class="txt" style="position:absolute; left:148px; top:84015px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">makes network transfers faster. </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">枚举需要的内存少于等效字符串，并使网</span></div>
<div class="txt" style="position:absolute; left:148px; top:84059px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">络传输速度更快。</span></div>
<div class="txt" style="position:absolute; left:112px; top:84123px;"><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Comparisons are faster too, as the identity comparison can be used instead</span></div>
<div class="txt" style="position:absolute; left:148px; top:84162px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of the equality comparison. </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">可使用</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">== </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">替代 </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">equals()</span></div>
<img id="background" style="position:absolute; left:0px; top:84368px;" width="1440" height="1080" src="page70.png"> <img id="background" style="position:absolute; left:1440px; top:84368px;" width="1440" height="1080" src="page-000070.png">
<div class="txt" style="position:absolute; left:1105px; top:84386px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:201px; top:84783px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(5) Avoiding Garbage Collection</span></div>
<img id="background" style="position:absolute; left:0px; top:85590px;" width="1440" height="1080" src="page71.png"> <img id="background" style="position:absolute; left:1440px; top:85590px;" width="1440" height="1080" src="page-000071.png">
<div class="txt" style="position:absolute; left:749px; top:85601px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:85697px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Various ways of reducing GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:85837px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The canonicalization techniques are one way to avoid garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:85882px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collection: fewer objects means less to garbage-collect. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">规范化</span></div>
<div class="txt" style="position:absolute; left:76px; top:85957px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Similarly, the pooling technique in that section also tends to reduce</span></div>
<div class="txt" style="position:absolute; left:112px; top:86007px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage-collection requirements, partly because you are creating</span></div>
<div class="txt" style="position:absolute; left:112px; top:86055px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">fewer objects by reusing them, and partly because you deallocate</span></div>
<div class="txt" style="position:absolute; left:112px; top:86098px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory less often by holding onto the objects you have allocated. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">采</span></div>
<div class="txt" style="position:absolute; left:112px; top:86146px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用</span><span id="f32" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">pool</span></div>
<div class="txt" style="position:absolute; left:76px; top:86221px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Another technique for reducing garbage-collection impact is to avoid</span></div>
<div class="txt" style="position:absolute; left:112px; top:86266px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">using objects where they are not needed. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">避免创建额外对象</span></div>
<img id="background" style="position:absolute; left:0px; top:86812px;" width="1440" height="1080" src="page72.png"> <img id="background" style="position:absolute; left:1440px; top:86812px;" width="1440" height="1080" src="page-000072.png">
<div class="txt" style="position:absolute; left:749px; top:86823px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:86919px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Primitive data types induce less GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:87059px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The primitive data types in Java use memory space that also needs</span></div>
<div class="txt" style="position:absolute; left:112px; top:87109px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reclaiming, but the overhead in reclaiming data-type storage is</span></div>
<div class="txt" style="position:absolute; left:112px; top:87157px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">smaller: it is reclaimed at the same time as its holding object and so</span></div>
<div class="txt" style="position:absolute; left:112px; top:87200px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">has a smaller impact. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">基本数据类型与其所在对象同时回收，影响较小</span></div>
<div class="txt" style="position:absolute; left:112px; top:87270px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Temporary primitive data types exist only on the stack and do not need to</span></div>
<div class="txt" style="position:absolute; left:148px; top:87309px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">be garbage-collected at all </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">临时基本数据类型在栈中，不需要垃圾回收</span></div>
<div class="txt" style="position:absolute; left:76px; top:87378px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, an object with just one instance variable holding an </span><span id="f32" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">int </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is</span></div>
<div class="txt" style="position:absolute; left:112px; top:87428px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reclaimed in one object reclaim.</span></div>
<div class="txt" style="position:absolute; left:76px; top:87499px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If it holds an Integer object, the garbage collector needs to reclaim two</span></div>
<div class="txt" style="position:absolute; left:112px; top:87544px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">持有</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">int</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的对象，只需要回收</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">1</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">个对象</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">持有对象</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">); </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">持有</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Integer</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对</span></div>
<div class="txt" style="position:absolute; left:112px; top:87592px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">象的对象，需要回收</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">2</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">个对象</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">持有对象和</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Integer</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对象</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<img id="background" style="position:absolute; left:0px; top:88034px;" width="1440" height="1080" src="page73.png"> <img id="background" style="position:absolute; left:1440px; top:88034px;" width="1440" height="1080" src="page-000073.png">
<div class="txt" style="position:absolute; left:749px; top:88045px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:88141px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Primitive data types induce less GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:88281px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reducing garbage collection by using primitive data types also applies</span></div>
<div class="txt" style="position:absolute; left:112px; top:88331px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">when you can hold an object in a primitive data-type format rather than</span></div>
<div class="txt" style="position:absolute; left:112px; top:88377px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">another format. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">尽量使用原始数据类型而不是其他对象数据类型</span></div>
<div class="txt" style="position:absolute; left:112px; top:88444px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, if you have a large number of objects, each with a String</span></div>
<div class="txt" style="position:absolute; left:148px; top:88487px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">instance variable holding a number (e.g., "1492", "1997"), it is better to make</span></div>
<div class="txt" style="position:absolute; left:148px; top:88530px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that instance variable an int data type and store the numbers as ints,</span></div>
<div class="txt" style="position:absolute; left:148px; top:88573px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">provided that conversion overhead does not swamp the benefits of holding</span></div>
<div class="txt" style="position:absolute; left:148px; top:88617px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the values in this alternative format.</span></div>
<div class="txt" style="position:absolute; left:76px; top:88682px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Similarly, you can use an int (or long) to represent a Date object,</span></div>
<div class="txt" style="position:absolute; left:112px; top:88732px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">providing appropriate calculations to access and update the values,</span></div>
<div class="txt" style="position:absolute; left:112px; top:88780px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">thus saving an object and the associated garbage overhead.</span></div>
<div class="txt" style="position:absolute; left:112px; top:88845px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Hint: you have a different runtime overhead instead, as those conversion</span></div>
<div class="txt" style="position:absolute; left:148px; top:88888px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">calculations may take up more time.</span></div>
<div class="txt" style="position:absolute; left:76px; top:88949px;"><span id="f11" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">使用</span><span id="f44" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">int</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">来替代</span><span id="f44" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">String</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">、</span><span id="f44" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Date</span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，但需要考虑转换的时间开销</span></div>
<img id="background" style="position:absolute; left:0px; top:89256px;" width="1440" height="1080" src="page74.png"> <img id="background" style="position:absolute; left:1440px; top:89256px;" width="1440" height="1080" src="page-000074.png">
<div class="txt" style="position:absolute; left:749px; top:89267px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:89363px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Primitive data types induce less GC</span></div>
<div class="txt" style="position:absolute; left:112px; top:89503px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">class MyClass {</span></div>
<div class="txt" style="position:absolute; left:165px; top:89557px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">int x;</span></div>
<div class="txt" style="position:absolute; left:165px; top:89611px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">boolean y;</span></div>
<div class="txt" style="position:absolute; left:112px; top:89664px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:89725px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">To define a Collection of MyClass, there are two ways:</span></div>
<div class="txt" style="position:absolute; left:112px; top:89790px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">class MyClassCollection {</span></div>
<div class="txt" style="position:absolute; left:165px; top:89844px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">int[ ] xs;</span></div>
<div class="txt" style="position:absolute; left:165px; top:89898px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">boolean[ ] ys;</span></div>
<div class="txt" style="position:absolute; left:165px; top:89951px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public int getXForElement(int i) {return xs[i];}</span></div>
<div class="txt" style="position:absolute; left:165px; top:90005px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public boolean getYForElement(int i) {return ys[i];}</span></div>
<div class="txt" style="position:absolute; left:112px; top:90059px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:112px; top:90113px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">---------------------------------------------------------</span></div>
<div class="txt" style="position:absolute; left:112px; top:90167px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">List&lt;MyClass&gt; myClassCollection = new ArrayList&lt;MyClass&gt;;</span></div>
<img id="background" style="position:absolute; left:0px; top:90478px;" width="1440" height="1080" src="page75.png"> <img id="background" style="position:absolute; left:1440px; top:90478px;" width="1440" height="1080" src="page-000075.png">
<div class="txt" style="position:absolute; left:749px; top:90489px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:90585px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Other general recommendations</span></div>
<div class="txt" style="position:absolute; left:79px; top:90713px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reduce the number of temporary objects being used, especially in</span></div>
<div class="txt" style="position:absolute; left:115px; top:90759px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">loops</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">减少正在使用的临时对象的数量，特别是在循环中</span></div>
<div class="txt" style="position:absolute; left:79px; top:90834px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Use </span><span id="f23" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuffer </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in preference to the </span><span id="f23" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">concatenation</span></div>
<div class="txt" style="position:absolute; left:115px; top:90879px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">operator (</span><span id="f23" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">+</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">). This is really a special case of the previous point. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用</span></div>
<div class="txt" style="position:absolute; left:115px; top:90927px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">StringBuffer</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">替代 </span><span id="f38" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">“+”</span></div>
<div class="txt" style="position:absolute; left:79px; top:91002px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Be aware of which methods alter objects directly without making</span></div>
<div class="txt" style="position:absolute; left:115px; top:91047px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">copies and which ones return a copy of an object. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">注意哪些方法直接</span></div>
<div class="txt" style="position:absolute; left:115px; top:91095px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">更改对象而不进行复制，哪些方法会返回对象的副本</span></div>
<div class="txt" style="position:absolute; left:115px; top:91164px;"><span id="f47" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Any </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">method that changes the string (such as </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String.trim()</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">)</span></div>
<div class="txt" style="position:absolute; left:151px; top:91207px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">returns a new </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object, whereas a method like </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Vector.setSize()</span></div>
<div class="txt" style="position:absolute; left:151px; top:91251px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">does not return a copy. If you do not need a copy, use (or create) methods</span></div>
<div class="txt" style="position:absolute; left:151px; top:91294px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that do not return a copy of the object being operated on.</span></div>
<div class="txt" style="position:absolute; left:79px; top:91360px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Avoid using generic classes that handle </span><span id="f23" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">Object </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">types when you are</span></div>
<div class="txt" style="position:absolute; left:115px; top:91405px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">dealing with basic data types. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在处理基本类型时避免使用通用的类</span></div>
<div class="txt" style="position:absolute; left:115px; top:91472px;"><span id="f47" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, there is no need to use </span><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Vector </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">to store </span><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">ints </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">by wrapping them in</span></div>
<div class="txt" style="position:absolute; left:151px; top:91511px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Integers. Instead, implement an </span><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">IntVector </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">class that holds the </span><span id="f23" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">ints </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">directly.</span></div>
<img id="background" style="position:absolute; left:0px; top:91700px;" width="1440" height="1080" src="page76.png"> <img id="background" style="position:absolute; left:1440px; top:91700px;" width="1440" height="1080" src="page-000076.png">
<div class="txt" style="position:absolute; left:1105px; top:91718px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:354px; top:92115px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(6) Object Initialization</span></div>
<img id="background" style="position:absolute; left:0px; top:92922px;" width="1440" height="1080" src="page77.png"> <img id="background" style="position:absolute; left:1440px; top:92922px;" width="1440" height="1080" src="page-000077.png">
<div class="txt" style="position:absolute; left:749px; top:92933px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:93029px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Construction and Initialization of Objects</span></div>
<div class="txt" style="position:absolute; left:76px; top:93169px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">All chained constructors are automatically called when creating an</span></div>
<div class="txt" style="position:absolute; left:112px; top:93219px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">object with new. Chaining more constructors for a particular object</span></div>
<div class="txt" style="position:absolute; left:112px; top:93267px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">causes extra overhead at object creation, as does initializing instance</span></div>
<div class="txt" style="position:absolute; left:112px; top:93310px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">variables more than once. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">利用</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">new</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法创建对象时，涉及的构造链会</span></div>
<div class="txt" style="position:absolute; left:112px; top:93358px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">自动执行。开销大。</span></div>
<div class="txt" style="position:absolute; left:76px; top:93433px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">You should check the constructor hierarchy to eliminate any multiple</span></div>
<div class="txt" style="position:absolute; left:112px; top:93478px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">initializations to instance variables. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">应该检查构造函数层次结构以消除</span></div>
<div class="txt" style="position:absolute; left:112px; top:93526px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对实例变量的任何多重初始化。</span></div>
<div class="txt" style="position:absolute; left:76px; top:93601px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A common way to avoid constructors when creating objects, namely</span></div>
<div class="txt" style="position:absolute; left:112px; top:93646px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">by creating a clone( ) of an object. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可以使用</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">clone()</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">替代构造方法，以</span></div>
<div class="txt" style="position:absolute; left:112px; top:93694px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">避免链式构造</span></div>
<div class="txt" style="position:absolute; left:112px; top:93764px;"><span id="f50" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You can create new instances of classes that implement the Cloneable</span></div>
<div class="txt" style="position:absolute; left:148px; top:93807px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">interface using the clone( ) method.</span></div>
<div class="txt" style="position:absolute; left:112px; top:93867px;"><span id="f50" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">These new instances do not call any class constructor, thus allowing you to</span></div>
<div class="txt" style="position:absolute; left:148px; top:93911px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">avoid the constructor initializations.</span></div>
<img id="background" style="position:absolute; left:0px; top:94144px;" width="1440" height="1080" src="page78.png"> <img id="background" style="position:absolute; left:1440px; top:94144px;" width="1440" height="1080" src="page-000078.png">
<div class="txt" style="position:absolute; left:33px; top:94251px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Preallocating Objects</span></div>
<div class="txt" style="position:absolute; left:749px; top:94155px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:94391px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">There may be situations in which you cannot avoid creating</span></div>
<div class="txt" style="position:absolute; left:112px; top:94441px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">particular objects in significant amounts.</span></div>
<div class="txt" style="position:absolute; left:76px; top:94511px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">You can still create the objects, but move the creation time to a part of</span></div>
<div class="txt" style="position:absolute; left:112px; top:94561px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the application when more spare cycles are available or there is more</span></div>
<div class="txt" style="position:absolute; left:112px; top:94609px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">flexibility in response times.</span></div>
<div class="txt" style="position:absolute; left:76px; top:94679px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The idea is to choose another time to create some or all of the objects</span></div>
<div class="txt" style="position:absolute; left:112px; top:94729px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(perhaps in a partially initialized stage) and store those objects until</span></div>
<div class="txt" style="position:absolute; left:112px; top:94777px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">they are needed.</span></div>
<div class="txt" style="position:absolute; left:76px; top:94919px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In one word: </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Create objects early, when there is spare time in the</span></div>
<div class="txt" style="position:absolute; left:112px; top:94964px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">application, and hold those objects until required. </span><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在应用程序中有空</span></div>
<div class="txt" style="position:absolute; left:112px; top:95012px;"><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">闲时间时尽早创建对象，并保留这些对象直到需要为止。</span></div>
<img id="background" style="position:absolute; left:0px; top:95366px;" width="1440" height="1080" src="page79.png"> <img id="background" style="position:absolute; left:1440px; top:95366px;" width="1440" height="1080" src="page-000079.png">
<div class="txt" style="position:absolute; left:749px; top:95377px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:95473px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Late (Lazy) Initialization</span></div>
<div class="txt" style="position:absolute; left:76px; top:95613px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Lazy initialization </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">means that you do not initialize objects until the first</span></div>
<div class="txt" style="position:absolute; left:112px; top:95663px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">time they are used.</span></div>
<div class="txt" style="position:absolute; left:76px; top:95733px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Typically, this comes about when you are unsure of what initial value</span></div>
<div class="txt" style="position:absolute; left:112px; top:95783px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">an instance variable might have but want to provide a default.</span></div>
<div class="txt" style="position:absolute; left:76px; top:95853px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Rather than initialize explicitly in the constructor (or class static</span></div>
<div class="txt" style="position:absolute; left:112px; top:95903px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">initializer), it is left until access time for the variable to be initialized,</span></div>
<div class="txt" style="position:absolute; left:112px; top:95957px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">using a test for </span><span id="f24" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">null </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to determine if it has been initialized.</span></div>
<div class="txt" style="position:absolute; left:76px; top:96032px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Proxy pattern can also be used to realize lazy loading or initialization</span></div>
<div class="txt" style="position:absolute; left:148px; top:96169px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public getSomething( ){</span></div>
<div class="txt" style="position:absolute; left:226px; top:96220px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if (something = = null)</span></div>
<div class="txt" style="position:absolute; left:325px; top:96272px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">something = defaultSomething( );</span></div>
<div class="txt" style="position:absolute; left:226px; top:96324px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return something;</span></div>
<div class="txt" style="position:absolute; left:148px; top:96376px;"><span id="f24" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:96588px;" width="1440" height="1080" src="page80.png"> <img id="background" style="position:absolute; left:1440px; top:96588px;" width="1440" height="1080" src="page-000080.png">
<div class="txt" style="position:absolute; left:1105px; top:96606px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:307px; top:97003px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">4 Code Tuning for Strings</span></div>
<div class="txt" style="position:absolute; left:341px; top:97262px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Compile-time and Run-time Resolution</span></div>
<div class="txt" style="position:absolute; left:499px; top:97319px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Conversion to Strings</span></div>
<div class="txt" style="position:absolute; left:490px; top:97377px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(3) Strings vs. char Arrays</span></div>
<div class="txt" style="position:absolute; left:399px; top:97435px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(4) String comparison and searching</span></div>
<div class="txt" style="position:absolute; left:627px; top:97492px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(5) Sorting</span></div>
<img id="background" style="position:absolute; left:0px; top:97810px;" width="1440" height="1080" src="page81.png"> <img id="background" style="position:absolute; left:1440px; top:97810px;" width="1440" height="1080" src="page-000081.png">
<div class="txt" style="position:absolute; left:749px; top:97821px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:97917px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Recall: Memory management in JVM</span></div>
<img id="background" style="position:absolute; left:0px; top:99032px;" width="1440" height="1080" src="page82.png"> <img id="background" style="position:absolute; left:1440px; top:99032px;" width="1440" height="1080" src="page-000082.png">
<div class="txt" style="position:absolute; left:33px; top:99139px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">String Constant Pool</span></div>
<div class="txt" style="position:absolute; left:749px; top:99043px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:99279px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">String Constant Pool </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is a special memory area in Heap that contains</span></div>
<div class="txt" style="position:absolute; left:112px; top:99324px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">references of string objects. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">字符常量池是堆中的内存区域，保存了</span></div>
<div class="txt" style="position:absolute; left:112px; top:99372px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">string</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对象</span></div>
<div class="txt" style="position:absolute; left:76px; top:99447px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using string literal: </span><span id="f26" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">String </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">s = “java”;</span></div>
<div class="txt" style="position:absolute; left:112px; top:99514px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A string written inside double quotes is called string literal.</span></div>
<div class="txt" style="position:absolute; left:112px; top:99574px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Whenever we create string literal the JVM checks string </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">constant pool. </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If</span></div>
<div class="txt" style="position:absolute; left:148px; top:99617px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the string is already present in pool then its reference is fetched.</span></div>
<div class="txt" style="position:absolute; left:112px; top:99678px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If the string is not present in pool, a new string object is created in it.</span></div>
<div class="txt" style="position:absolute; left:76px; top:99744px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using new keyword: </span><span id="f26" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">String </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">s = new String(“java”);</span></div>
<div class="txt" style="position:absolute; left:112px; top:99810px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When we create string using new keyword it goes to </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">heap.</span></div>
<img id="background" style="position:absolute; left:0px; top:100254px;" width="1440" height="1080" src="page83.png"> <img id="background" style="position:absolute; left:1440px; top:100254px;" width="1440" height="1080" src="page-000083.png">
<div class="txt" style="position:absolute; left:749px; top:100265px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:100361px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">String Constant Pool (SCP)</span></div>
<div class="txt" style="position:absolute; left:65px; top:100502px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s1 = "java";</span></div>
<div class="txt" style="position:absolute; left:65px; top:100545px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s2 = "java";</span></div>
<div class="txt" style="position:absolute; left:65px; top:100588px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s3 = new String("java");</span></div>
<div class="txt" style="position:absolute; left:65px; top:100674px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if(s1 == s2)</span></div>
<div class="txt" style="position:absolute; left:124px; top:100718px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println("true");</span></div>
<div class="txt" style="position:absolute; left:65px; top:100761px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">else</span></div>
<div class="txt" style="position:absolute; left:124px; top:100804px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println("false");</span></div>
<div class="txt" style="position:absolute; left:65px; top:100890px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if(s1 == s3)</span></div>
<div class="txt" style="position:absolute; left:124px; top:100934px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println("true");</span></div>
<div class="txt" style="position:absolute; left:65px; top:100977px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">else</span></div>
<div class="txt" style="position:absolute; left:124px; top:101020px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println("false");</span></div>
<img id="background" style="position:absolute; left:0px; top:101476px;" width="1440" height="1080" src="page84.png"> <img id="background" style="position:absolute; left:1440px; top:101476px;" width="1440" height="1080" src="page-000084.png">
<div class="txt" style="position:absolute; left:749px; top:101487px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:101583px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Code Tuning for Strings</span></div>
<div class="txt" style="position:absolute; left:435px; top:101955px;"><span id="f8" style="font-size:55px;vertical-align:baseline;color:rgba(255,255,255,1);">Minimize the number of</span></div>
<div class="txt" style="position:absolute; left:515px; top:102022px;"><span id="f8" style="font-size:55px;vertical-align:baseline;color:rgba(255,255,255,1);">temporary objects</span></div>
<div class="txt" style="position:absolute; left:451px; top:102089px;"><span id="f8" style="font-size:55px;vertical-align:baseline;color:rgba(255,255,255,1);">created on heap so that</span></div>
<div class="txt" style="position:absolute; left:520px; top:102156px;"><span id="f8" style="font-size:55px;vertical-align:baseline;color:rgba(255,255,255,1);">GC is minimized.</span></div>
<img id="background" style="position:absolute; left:0px; top:102698px;" width="1440" height="1080" src="page85.png"> <img id="background" style="position:absolute; left:1440px; top:102698px;" width="1440" height="1080" src="page-000085.png">
<div class="txt" style="position:absolute; left:749px; top:102709px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:102805px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Compile-time and Run-time Resolution</span></div>
<div class="txt" style="position:absolute; left:76px; top:102945px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When the </span><span id="f18" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">can be fully resolved at compile time</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, the</span></div>
<div class="txt" style="position:absolute; left:112px; top:102994px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">concatenation operator is </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">more efficient </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than using a </span><span id="f18" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuffer</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:76px; top:103065px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When the </span><span id="f18" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">cannot </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">be resolved at compile time, the</span></div>
<div class="txt" style="position:absolute; left:112px; top:103114px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">concatenation operator is </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">less efficient </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than using a </span><span id="f18" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuffer</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:76px; top:103185px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Comparisons of examples:</span></div>
<div class="txt" style="position:absolute; left:112px; top:103252px;"><span id="f50" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s = "hi " + "Mr. " + " " + "Buddy";</span></div>
<div class="txt" style="position:absolute; left:112px; top:103312px;"><span id="f50" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s = "hi Mr. Buddy";</span></div>
<div class="txt" style="position:absolute; left:1125px; top:103220px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,255,255,1);">Same!</span></div>
<div class="txt" style="position:absolute; left:1081px; top:103263px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,255,255,1);">Resolved at</span></div>
<div class="txt" style="position:absolute; left:1069px; top:103306px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,255,255,1);">compile time</span></div>
<div class="txt" style="position:absolute; left:112px; top:103373px;"><span id="f50" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s = (new StringBuffer( )).append("hi ").</span></div>
<div class="txt" style="position:absolute; left:148px; top:103416px;"><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">append("Mr.").append(" ").append("Buddy").toString( );</span></div>
<div class="txt" style="position:absolute; left:112px; top:103476px;"><span id="f50" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s = "hi " + title + " " + name;</span></div>
<div class="txt" style="position:absolute; left:112px; top:103537px;"><span id="f50" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String s = new String("hi " + "Mr. " + " " + "Buddy");</span></div>
<div class="txt" style="position:absolute; left:76px; top:103663px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">How many temporary objects are to be created for above examples?</span></div>
<img id="background" style="position:absolute; left:0px; top:103920px;" width="1440" height="1080" src="page86.png"> <img id="background" style="position:absolute; left:1440px; top:103920px;" width="1440" height="1080" src="page-000086.png">
<div class="txt" style="position:absolute; left:33px; top:104027px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Strings vs. char arrays</span></div>
<div class="txt" style="position:absolute; left:749px; top:103931px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:104167px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Strings are implemented in the JDK as an internal char array with</span></div>
<div class="txt" style="position:absolute; left:112px; top:104217px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">index offsets (actually a start offset and a character count).</span></div>
<div class="txt" style="position:absolute; left:220px; top:104288px;"><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">private char[] a;</span></div>
<div class="txt" style="position:absolute; left:220px; top:104354px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private int start;</span></div>
<div class="txt" style="position:absolute; left:220px; top:104414px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">private int end;</span></div>
<img id="background" style="position:absolute; left:0px; top:105142px;" width="1440" height="1080" src="page87.png"> <img id="background" style="position:absolute; left:1440px; top:105142px;" width="1440" height="1080" src="page-000087.png">
<div class="txt" style="position:absolute; left:749px; top:105153px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:105249px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Some Suggestions on Code Tuning for Strings</span></div>
<div class="txt" style="position:absolute; left:76px; top:105389px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Use efficient methods of </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">that do not copy the characters of</span></div>
<div class="txt" style="position:absolute; left:112px; top:105434px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the string, e.g., </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String.substring().</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">使用不会复制字符串字符的</span></div>
<div class="txt" style="position:absolute; left:112px; top:105482px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">String</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法</span></div>
<div class="txt" style="position:absolute; left:76px; top:105557px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Avoid using inefficient methods of String that copy the characters of</span></div>
<div class="txt" style="position:absolute; left:112px; top:105606px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the string, e.g., </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String.toUppercase() </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and</span></div>
<div class="txt" style="position:absolute; left:112px; top:105650px;"><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String.toLowercase()</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">避免使用复制字符串字符的低效</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">String</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法</span></div>
<div class="txt" style="position:absolute; left:76px; top:105725px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Use the string concatenation operator to create Strings at compile</span></div>
<div class="txt" style="position:absolute; left:112px; top:105770px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">time. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">使用字符串连接运算符</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(+)</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在编译时创建字符串</span></div>
<div class="txt" style="position:absolute; left:76px; top:105842px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Use </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuffers </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to create Strings at runtime. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">运行时使用</span></div>
<div class="txt" style="position:absolute; left:112px; top:105895px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">StringBuffers</span></div>
<div class="txt" style="position:absolute; left:76px; top:105965px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Improve access to the underlying </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String char array </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">by copying the</span></div>
<div class="txt" style="position:absolute; left:112px; top:106015px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">chars into your own array.</span></div>
<div class="txt" style="position:absolute; left:76px; top:106085px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Manipulate characters in char arrays rather than using </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">String </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and</span></div>
<div class="txt" style="position:absolute; left:112px; top:106130px;"><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">StringBuffer </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">manipulation. Reuse </span><span id="f14" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">char arrays</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">操作</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">char</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">数组中的</span></div>
<div class="txt" style="position:absolute; left:112px; top:106178px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">字符，而不是使用</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">String</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">StringBuffer</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">操作。</span></div>
<img id="background" style="position:absolute; left:0px; top:106364px;" width="1440" height="1080" src="page88.png"> <img id="background" style="position:absolute; left:1440px; top:106364px;" width="1440" height="1080" src="page-000088.png">
<div class="txt" style="position:absolute; left:1105px; top:106382px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:179px; top:106644px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">5 Code Tuning for Logics, Loops,</span></div>
<div class="txt" style="position:absolute; left:246px; top:106731px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Data Type, Expressions, and</span></div>
<div class="txt" style="position:absolute; left:551px; top:106817px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Functions</span></div>
<img id="background" style="position:absolute; left:0px; top:107586px;" width="1440" height="1080" src="page89.png"> <img id="background" style="position:absolute; left:1440px; top:107586px;" width="1440" height="1080" src="page-000089.png">
<div class="txt" style="position:absolute; left:1105px; top:107604px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:259px; top:108001px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Logic-related code tuning</span></div>
<img id="background" style="position:absolute; left:0px; top:108808px;" width="1440" height="1080" src="page90.png"> <img id="background" style="position:absolute; left:1440px; top:108808px;" width="1440" height="1080" src="page-000090.png">
<div class="txt" style="position:absolute; left:749px; top:108819px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:108915px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Stop Testing When You Know the Answer</span></div>
<div class="txt" style="position:absolute; left:488px; top:109056px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">if ( x&gt;5 &amp;&amp; x&lt;10 ) …</span></div>
<div class="txt" style="position:absolute; left:76px; top:109127px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Some languages provide a form of expression evaluation known as</span></div>
<div class="txt" style="position:absolute; left:112px; top:109172px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">“short</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">circuit evaluation”(</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">短路求值</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">) which means that the compiler</span></div>
<div class="txt" style="position:absolute; left:112px; top:109225px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">generates code that automatically stops testing as soon as it knows</span></div>
<div class="txt" style="position:absolute; left:112px; top:109273px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the answer.</span></div>
<div class="txt" style="position:absolute; left:76px; top:109343px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Short-</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">circuit evaluation is part of Java’s “conditional” operators.</span></div>
<div class="txt" style="position:absolute; left:76px; top:109412px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">如果语言不支持短路求值，则应使用下面的形式：</span></div>
<div class="txt" style="position:absolute; left:220px; top:109488px;"><span id="f31" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">if (x&gt;5) {</span></div>
<div class="txt" style="position:absolute; left:308px; top:109560px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">if (x &lt;10 ) { …}</span></div>
<div class="txt" style="position:absolute; left:220px; top:109633px;"><span id="f31" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:110030px;" width="1440" height="1080" src="page91.png"> <img id="background" style="position:absolute; left:1440px; top:110030px;" width="1440" height="1080" src="page-000091.png">
<div class="txt" style="position:absolute; left:749px; top:110041px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:110137px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Stop Testing When You Know the Answer</span></div>
<div class="txt" style="position:absolute; left:76px; top:110277px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g. for search loop:</span></div>
<div class="txt" style="position:absolute; left:553px; top:110285px;"><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">boolean found = false;</span></div>
<div class="txt" style="position:absolute; left:553px; top:110328px;"><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for (int i = 0; i &lt; iCount; i++ ) {</span></div>
<div class="txt" style="position:absolute; left:697px; top:110371px;"><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if (input[i] &lt; 0 ) {</span></div>
<div class="txt" style="position:absolute; left:841px; top:110414px;"><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">found = True;</span></div>
<div class="txt" style="position:absolute; left:697px; top:110458px;"><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:553px; top:110501px;"><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:110637px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">To stop scanning as soon as you find a negative value in the array:</span></div>
<div class="txt" style="position:absolute; left:112px; top:110703px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Add a </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">break </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">statement after the </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">found = True </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">line.</span></div>
<div class="txt" style="position:absolute; left:112px; top:110764px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Change the </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">loop to a </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">loop and check for </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">found </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">as well as for</span></div>
<div class="txt" style="position:absolute; left:148px; top:110807px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">incrementing the loop counter past </span><span id="f23" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">iCount</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<img id="background" style="position:absolute; left:0px; top:111252px;" width="1440" height="1080" src="page92.png"> <img id="background" style="position:absolute; left:1440px; top:111252px;" width="1440" height="1080" src="page-000092.png">
<div class="txt" style="position:absolute; left:749px; top:111263px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:111359px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Substitute Table Lookups for Complicated Logics</span></div>
<div class="txt" style="position:absolute; left:76px; top:111499px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In some circumstances, a table lookup may be quicker than</span></div>
<div class="txt" style="position:absolute; left:112px; top:111549px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">traversing a complicated chain of logic.</span></div>
<div class="txt" style="position:absolute; left:76px; top:111619px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The point of a complicated chain is usually to categorize something</span></div>
<div class="txt" style="position:absolute; left:112px; top:111669px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and then to take an action based on its category. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">(</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">See 6.3 Table-</span></div>
<div class="txt" style="position:absolute; left:112px; top:111717px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Driven Methods)</span></div>
<img id="background" style="position:absolute; left:0px; top:112474px;" width="1440" height="1080" src="page93.png"> <img id="background" style="position:absolute; left:1440px; top:112474px;" width="1440" height="1080" src="page-000093.png">
<div class="txt" style="position:absolute; left:749px; top:112485px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:112576px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Lazy Evaluation </span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">惰性求值</span></div>
<div class="txt" style="position:absolute; left:76px; top:112721px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Lazy evaluation: If a program uses lazy evaluation, it avoids doing</span></div>
<div class="txt" style="position:absolute; left:112px; top:112766px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">any work until the work is needed. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">直到用到的时候再求值</span></div>
<div class="txt" style="position:absolute; left:76px; top:112841px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Lazy evaluation is similar to just-in-time strategies that do the work</span></div>
<div class="txt" style="position:absolute; left:112px; top:112886px;"><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">closest to when it’s needed. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类似于及时完成策略，即仅到工作必须</span></div>
<div class="txt" style="position:absolute; left:112px; top:112934px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">完成的时候才去处理</span></div>
<div class="txt" style="position:absolute; left:76px; top:113009px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., a program contains a table of 5000 values, generates the whole</span></div>
<div class="txt" style="position:absolute; left:112px; top:113059px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">table at startup time, and then uses it as the program executes. If the</span></div>
<div class="txt" style="position:absolute; left:112px; top:113107px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">program uses only a small percentage of the entries in the table, it</span></div>
<div class="txt" style="position:absolute; left:112px; top:113155px;"><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">might make more sense to compute them as they’re needed rather</span></div>
<div class="txt" style="position:absolute; left:112px; top:113203px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than all at once. Once an entry is computed, it can still be stored for</span></div>
<div class="txt" style="position:absolute; left:112px; top:113246px;"><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">future reference (“cached”). </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在需要时再计算，同时保存结果</span><span id="f42" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(cache)</span></div>
<div class="txt" style="position:absolute; left:112px; top:113294px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">供以后使用</span></div>
<img id="background" style="position:absolute; left:0px; top:113696px;" width="1440" height="1080" src="page94.png"> <img id="background" style="position:absolute; left:1440px; top:113696px;" width="1440" height="1080" src="page-000094.png">
<div class="txt" style="position:absolute; left:1105px; top:113714px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:249px; top:114111px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Loops-related code tuning</span></div>
<img id="background" style="position:absolute; left:0px; top:114918px;" width="1440" height="1080" src="page95.png"> <img id="background" style="position:absolute; left:1440px; top:114918px;" width="1440" height="1080" src="page-000095.png">
<div class="txt" style="position:absolute; left:749px; top:114929px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:115020px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Unswitching-</span><span id="f12" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">将判断外提</span></div>
<div class="txt" style="position:absolute; left:76px; top:115165px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Switching refers to making a decision inside a loop every time it’s</span></div>
<div class="txt" style="position:absolute; left:112px; top:115215px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">executed.</span></div>
<div class="txt" style="position:absolute; left:76px; top:115285px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If the decision doesn’t change while the loop is executing, you can</span></div>
<div class="txt" style="position:absolute; left:112px; top:115330px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">unswitch the loop by making the decision outside the loop.</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">如果在循</span></div>
<div class="txt" style="position:absolute; left:112px; top:115378px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">环执行时决策没有改变，可以通过在循环外进行决策来断开循环</span></div>
<div class="txt" style="position:absolute; left:76px; top:115453px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Usually this requires turning the loop inside out, putting loops inside</span></div>
<div class="txt" style="position:absolute; left:112px; top:115503px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the conditional rather than putting the conditional inside the loop.</span></div>
<img id="background" style="position:absolute; left:0px; top:116140px;" width="1440" height="1080" src="page96.png"> <img id="background" style="position:absolute; left:1440px; top:116140px;" width="1440" height="1080" src="page-000096.png">
<div class="txt" style="position:absolute; left:33px; top:116242px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Jamming-</span><span id="f12" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">合并</span></div>
<div class="txt" style="position:absolute; left:749px; top:116151px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:116387px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Jamming, or “fusion,” is the result of combining two loops that</span></div>
<div class="txt" style="position:absolute; left:112px; top:116437px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">operate on the 287 same set of elements. The gain lies in cutting the</span></div>
<div class="txt" style="position:absolute; left:112px; top:116485px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">loop overhead from two loops to one.</span></div>
<img id="background" style="position:absolute; left:0px; top:117362px;" width="1440" height="1080" src="page97.png"> <img id="background" style="position:absolute; left:1440px; top:117362px;" width="1440" height="1080" src="page-000097.png">
<div class="txt" style="position:absolute; left:33px; top:117464px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Unrolling-</span><span id="f12" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">展开</span></div>
<div class="txt" style="position:absolute; left:749px; top:117373px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:117609px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The goal of loop unrolling is to reduce the amount of loop</span></div>
<div class="txt" style="position:absolute; left:112px; top:117659px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">housekeeping.</span></div>
<div class="txt" style="position:absolute; left:1217px; top:117990px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">Deal with the</span></div>
<div class="txt" style="position:absolute; left:1217px; top:118023px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">case</span></div>
<div class="txt" style="position:absolute; left:1217px; top:118057px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">that might fall</span></div>
<div class="txt" style="position:absolute; left:1217px; top:118090px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">through the</span></div>
<div class="txt" style="position:absolute; left:1217px; top:118124px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">cracks if the</span></div>
<div class="txt" style="position:absolute; left:1217px; top:118158px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">loop went by</span></div>
<div class="txt" style="position:absolute; left:1217px; top:118191px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">twos instead of</span></div>
<div class="txt" style="position:absolute; left:1217px; top:118225px;"><span id="f21" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">by ones.</span></div>
<img id="background" style="position:absolute; left:0px; top:118584px;" width="1440" height="1080" src="page98.png"> <img id="background" style="position:absolute; left:1440px; top:118584px;" width="1440" height="1080" src="page-000098.png">
<div class="txt" style="position:absolute; left:749px; top:118595px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:118691px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Minimizing the Work Inside Loops</span></div>
<div class="txt" style="position:absolute; left:76px; top:118831px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">To minimize the work done inside a loop.</span></div>
<div class="txt" style="position:absolute; left:112px; top:118898px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If you can evaluate a statement or part of a statement outside a loop so</span></div>
<div class="txt" style="position:absolute; left:148px; top:118941px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that only the result is used inside the loop, do so. It’s good programming</span></div>
<div class="txt" style="position:absolute; left:148px; top:118984px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">practice, and, in some cases, it improves readability.</span></div>
<img id="background" style="position:absolute; left:0px; top:119806px;" width="1440" height="1080" src="page99.png"> <img id="background" style="position:absolute; left:1440px; top:119806px;" width="1440" height="1080" src="page-000099.png">
<div class="txt" style="position:absolute; left:749px; top:119817px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:119908px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Sentinel Values</span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">哨兵值</span></div>
<div class="txt" style="position:absolute; left:76px; top:120053px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The classic example of a compound test that can be improved by use</span></div>
<div class="txt" style="position:absolute; left:112px; top:120103px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">of a sentinel is the search loop that checks both whether it has found</span></div>
<div class="txt" style="position:absolute; left:112px; top:120151px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the value it is seeking and whether it has run out of values.</span></div>
<div class="txt" style="position:absolute; left:129px; top:120770px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the loop really has three tests</span></div>
<div class="txt" style="position:absolute; left:230px; top:120813px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">for each iteration.</span></div>
<div class="txt" style="position:absolute; left:813px; top:120773px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the loop really has one test</span></div>
<div class="txt" style="position:absolute; left:894px; top:120816px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">for each iteration.</span></div>
<img id="background" style="position:absolute; left:0px; top:121028px;" width="1440" height="1080" src="page100.png"> <img id="background" style="position:absolute; left:1440px; top:121028px;" width="1440" height="1080" src="page-000100.png">
<div class="txt" style="position:absolute; left:749px; top:121039px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:121135px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Putting the Busiest Loop on the Inside</span></div>
<div class="txt" style="position:absolute; left:76px; top:121275px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When you have nested loops, think about which loop you want on</span></div>
<div class="txt" style="position:absolute; left:112px; top:121325px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the outside and which you want on the inside.</span></div>
<div class="txt" style="position:absolute; left:76px; top:121395px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Following is an example of a nested loop that can be improved.</span></div>
<div class="txt" style="position:absolute; left:314px; top:121480px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for (column = 0; column&lt;100; column++){</span></div>
<div class="txt" style="position:absolute; left:393px; top:121523px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for (row = 0; row&lt;5; row++){</span></div>
<div class="txt" style="position:absolute; left:472px; top:121566px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">sum = sum + table[row][column];</span></div>
<div class="txt" style="position:absolute; left:393px; top:121609px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:314px; top:121653px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:121755px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The key to improving the loop is that the outer loop executes much</span></div>
<div class="txt" style="position:absolute; left:112px; top:121805px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">more often than the inner loop. The loop has a total of 600 iterations.</span></div>
<div class="txt" style="position:absolute; left:112px; top:121853px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(100 for the outer loop and 100 * 5 = 500 for the inner loop)</span></div>
<img id="background" style="position:absolute; left:0px; top:122250px;" width="1440" height="1080" src="page101.png"> <img id="background" style="position:absolute; left:1440px; top:122250px;" width="1440" height="1080" src="page-000101.png">
<div class="txt" style="position:absolute; left:749px; top:122261px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:122357px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Putting the Busiest Loop on the Inside</span></div>
<div class="txt" style="position:absolute; left:76px; top:122497px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">By merely switching the inner and outer loops, you can change the</span></div>
<div class="txt" style="position:absolute; left:112px; top:122547px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">total number of iterations to 5 for the outer loop and 5 * 100 = 500 for</span></div>
<div class="txt" style="position:absolute; left:112px; top:122595px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the inner loop, for a total of 505 iterations. You’d expect to save about</span></div>
<div class="txt" style="position:absolute; left:112px; top:122643px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(600 </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">505) / 600 = 16 percent by switching the loops.</span></div>
<div class="txt" style="position:absolute; left:333px; top:122737px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for (row = 0; row&lt;5; row++){</span></div>
<div class="txt" style="position:absolute; left:412px; top:122780px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for (column = 0; column&lt;100; column++){</span></div>
<div class="txt" style="position:absolute; left:491px; top:122824px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">sum = sum + table[row][column];</span></div>
<div class="txt" style="position:absolute; left:412px; top:122867px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:333px; top:122910px;"><span id="f21" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:123472px;" width="1440" height="1080" src="page102.png"> <img id="background" style="position:absolute; left:1440px; top:123472px;" width="1440" height="1080" src="page-000102.png">
<div class="txt" style="position:absolute; left:749px; top:123483px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:123574px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Strength Reduct</span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">削减强度</span></div>
<div class="txt" style="position:absolute; left:76px; top:123719px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reducing strength means replacing an expensive operation such as</span></div>
<div class="txt" style="position:absolute; left:112px; top:123764px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">multiplication with a cheaper operation such as addition. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用多次轻量</span></div>
<div class="txt" style="position:absolute; left:112px; top:123812px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">级运算代替一次代价高昂的运算</span></div>
<div class="txt" style="position:absolute; left:76px; top:123887px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Sometimes you’ll have an expression inside a loop that depends on</span></div>
<div class="txt" style="position:absolute; left:112px; top:123937px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">multiplying the loop index by a factor. Addition is usually faster</span></div>
<div class="txt" style="position:absolute; left:112px; top:123985px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than multiplication, and if you can compute the same number by</span></div>
<div class="txt" style="position:absolute; left:112px; top:124033px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">adding the amount on each iteration of the loop rather than by</span></div>
<div class="txt" style="position:absolute; left:112px; top:124081px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">multiplying, the code will run faster.</span></div>
<img id="background" style="position:absolute; left:0px; top:124694px;" width="1440" height="1080" src="page103.png"> <img id="background" style="position:absolute; left:1440px; top:124694px;" width="1440" height="1080" src="page-000103.png">
<div class="txt" style="position:absolute; left:1105px; top:124712px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:194px; top:125109px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(3) Data type related code tuning</span></div>
<img id="background" style="position:absolute; left:0px; top:125916px;" width="1440" height="1080" src="page104.png"> <img id="background" style="position:absolute; left:1440px; top:125916px;" width="1440" height="1080" src="page-000104.png">
<div class="txt" style="position:absolute; left:749px; top:125927px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:126023px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Integers Rather Than Floating-Point Numbers</span></div>
<div class="txt" style="position:absolute; left:76px; top:126163px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer addition and multiplication tend to be faster than floating</span></div>
<div class="txt" style="position:absolute; left:112px; top:126213px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">point. Changing a loop index from a floating point to an integer, for</span></div>
<div class="txt" style="position:absolute; left:112px; top:126256px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">example, can save time. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">尽可能使用整数而不是浮点数</span></div>
<img id="background" style="position:absolute; left:0px; top:127138px;" width="1440" height="1080" src="page105.png"> <img id="background" style="position:absolute; left:1440px; top:127138px;" width="1440" height="1080" src="page-000105.png">
<div class="txt" style="position:absolute; left:749px; top:127149px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:127245px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use the Fewest Array Dimensions Possible</span></div>
<div class="txt" style="position:absolute; left:76px; top:127385px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Conventional wisdom maintains that multiple dimensions on</span></div>
<div class="txt" style="position:absolute; left:112px; top:127435px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">arrays are expensive. If you can structure your data so that it’s in a</span></div>
<div class="txt" style="position:absolute; left:112px; top:127483px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">one-dimensional array rather than a two-dimensional or three-</span></div>
<div class="txt" style="position:absolute; left:112px; top:127526px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">dimensional array, you might be able to save some time. </span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">多维数组</span></div>
<div class="txt" style="position:absolute; left:112px; top:127574px;"><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">开销大，尽可能用一维替换二维或多维</span></div>
<img id="background" style="position:absolute; left:0px; top:128360px;" width="1440" height="1080" src="page106.png"> <img id="background" style="position:absolute; left:1440px; top:128360px;" width="1440" height="1080" src="page-000106.png">
<div class="txt" style="position:absolute; left:749px; top:128371px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:128467px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Minimize Array References</span></div>
<div class="txt" style="position:absolute; left:76px; top:128607px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In addition to minimizing accesses to doubly or triply dimensioned</span></div>
<div class="txt" style="position:absolute; left:112px; top:128657px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">arrays, it’s often advantageous to minimize array accesses, period.</span></div>
<div class="txt" style="position:absolute; left:112px; top:128700px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">减少数组引用</span></div>
<div class="txt" style="position:absolute; left:76px; top:128775px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A loop that repeatedly uses one element of an array is a good</span></div>
<div class="txt" style="position:absolute; left:112px; top:128825px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">candidate for the application of this technique.</span></div>
<div class="txt" style="position:absolute; left:76px; top:129183px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The reference to discount[ discountType </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">] doesn’t change when</span></div>
<div class="txt" style="position:absolute; left:112px; top:129233px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">discountLevel changes in the inner loop. Consequently, you can</span></div>
<div class="txt" style="position:absolute; left:112px; top:129281px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">move it out of the inner loop so that you’ll have only one array access</span></div>
<div class="txt" style="position:absolute; left:112px; top:129329px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">per execution of the outer loop rather than one for each execution of</span></div>
<div class="txt" style="position:absolute; left:112px; top:129377px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the inner loop.</span></div>
<img id="background" style="position:absolute; left:0px; top:129582px;" width="1440" height="1080" src="page107.png"> <img id="background" style="position:absolute; left:1440px; top:129582px;" width="1440" height="1080" src="page-000107.png">
<div class="txt" style="position:absolute; left:749px; top:129593px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:129689px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Minimize Array References</span></div>
<img id="background" style="position:absolute; left:0px; top:130804px;" width="1440" height="1080" src="page108.png"> <img id="background" style="position:absolute; left:1440px; top:130804px;" width="1440" height="1080" src="page-000108.png">
<div class="txt" style="position:absolute; left:749px; top:130815px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:130906px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Supplementary Indexes </span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">使用辅助索引</span></div>
<div class="txt" style="position:absolute; left:62px; top:131039px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using a supplementary index means adding related data that</span></div>
<div class="txt" style="position:absolute; left:98px; top:131089px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">makes accessing a data type more efficient. You can add the related</span></div>
<div class="txt" style="position:absolute; left:98px; top:131137px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">data to the main data type, or you can store it in a parallel structure.</span></div>
<div class="txt" style="position:absolute; left:98px; top:131181px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">辅助索引是添加相关数据，使得对某种数据的访问更为高效</span></div>
<div class="txt" style="position:absolute; left:62px; top:131256px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g.,</span></div>
<div class="txt" style="position:absolute; left:98px; top:131318px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">String-Length Index </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">字符串长度索引</span></div>
<div class="txt" style="position:absolute; left:134px; top:131379px;"><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">In C, strings are terminated by a byte that’s set to 0.</span></div>
<div class="txt" style="position:absolute; left:134px; top:131425px;"><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">You can apply the idea of indexing for length to any variable-length data type.</span></div>
<div class="txt" style="position:absolute; left:169px; top:131464px;"><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">It’s often more efficient to keep track of the length of the structure rather than</span></div>
<div class="txt" style="position:absolute; left:169px; top:131502px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">computing the length each time you need it.</span></div>
<div class="txt" style="position:absolute; left:98px; top:131548px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Independent, Parallel Index Structure </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">独立的平行的索引结构</span></div>
<div class="txt" style="position:absolute; left:134px; top:131609px;"><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Sometimes it’s more efficient to manipulate an index to a data type than it is to</span></div>
<div class="txt" style="position:absolute; left:169px; top:131647px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">manipulate the data type itself.</span></div>
<div class="txt" style="position:absolute; left:134px; top:131693px;"><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">If each data item is large, you can create an auxiliary structure that consists of key</span></div>
<div class="txt" style="position:absolute; left:169px; top:131732px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">values and pointers to the detailed information. If the difference in size between</span></div>
<div class="txt" style="position:absolute; left:169px; top:131770px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">the data-structure item and the auxiliary-structure item is great enough,</span></div>
<div class="txt" style="position:absolute; left:169px; top:131808px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">sometimes you can store the key item in memory even when the data item has to</span></div>
<div class="txt" style="position:absolute; left:169px; top:131843px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">be stored externally. </span><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">对索引排序和查找会比直接对数据进行操作要快</span></div>
<img id="background" style="position:absolute; left:0px; top:132026px;" width="1440" height="1080" src="page109.png"> <img id="background" style="position:absolute; left:1440px; top:132026px;" width="1440" height="1080" src="page-000109.png">
<div class="txt" style="position:absolute; left:33px; top:132128px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Caching </span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">使用缓存</span></div>
<div class="txt" style="position:absolute; left:749px; top:132037px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:132273px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Caching means saving a few values in such a way that you can</span></div>
<div class="txt" style="position:absolute; left:112px; top:132323px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">retrieve the most commonly used values more easily than the less</span></div>
<div class="txt" style="position:absolute; left:112px; top:132366px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">commonly used values. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">保存一些值，使最常用的值更容易被获取到</span></div>
<div class="txt" style="position:absolute; left:112px; top:132436px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., If a program randomly reads records from a disk, a routine might use</span></div>
<div class="txt" style="position:absolute; left:148px; top:132479px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">a cache to save the records read most frequently. When the routine</span></div>
<div class="txt" style="position:absolute; left:148px; top:132522px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">receives a request for a record, it checks the cache to see whether it has the</span></div>
<div class="txt" style="position:absolute; left:148px; top:132565px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">record. If it does, the record is returned directly from memory rather than</span></div>
<div class="txt" style="position:absolute; left:148px; top:132605px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">from disk. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">将最频繁访问的记录放入缓存，访问时首先查找缓存</span></div>
<div class="txt" style="position:absolute; left:112px; top:132669px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">In addition to caching records on disk, you can apply caching in other</span></div>
<div class="txt" style="position:absolute; left:148px; top:132712px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">areas. In a Microsoft Windows font-proofing program, the performance</span></div>
<div class="txt" style="position:absolute; left:148px; top:132755px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">bottleneck was in retrieving the width of each character as it was</span></div>
<div class="txt" style="position:absolute; left:148px; top:132799px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">displayed. Caching the most recently used character width roughly</span></div>
<div class="txt" style="position:absolute; left:148px; top:132842px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">doubled the display speed. You can cache the results of time-consuming</span></div>
<div class="txt" style="position:absolute; left:148px; top:132885px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">computations too</span><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">especially if the parameters to the calculation are</span></div>
<div class="txt" style="position:absolute; left:148px; top:132924px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">simple. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">缓存经常用到的字符宽度</span></div>
<div class="txt" style="position:absolute; left:112px; top:132989px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You can cache the results of time-consuming computations too</span><span id="f42" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span></div>
<div class="txt" style="position:absolute; left:148px; top:133028px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">especially if the parameters to the calculation are simple. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">缓存需要耗时计</span></div>
<div class="txt" style="position:absolute; left:148px; top:133071px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">算的结果</span></div>
<img id="background" style="position:absolute; left:0px; top:133248px;" width="1440" height="1080" src="page110.png"> <img id="background" style="position:absolute; left:1440px; top:133248px;" width="1440" height="1080" src="page-000110.png">
<div class="txt" style="position:absolute; left:33px; top:133355px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Caching</span></div>
<div class="txt" style="position:absolute; left:749px; top:133259px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:133495px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Suppose, for example, that you need to compute the length of the</span></div>
<div class="txt" style="position:absolute; left:112px; top:133545px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">hypotenuse of a right triangle, given the lengths of the other two</span></div>
<div class="txt" style="position:absolute; left:112px; top:133593px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">sides. The straightforward implementation of the routine would look</span></div>
<div class="txt" style="position:absolute; left:112px; top:133636px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">like this: </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">直接计算勾股定理的例子</span></div>
<img id="background" style="position:absolute; left:0px; top:134470px;" width="1440" height="1080" src="page111.png"> <img id="background" style="position:absolute; left:1440px; top:134470px;" width="1440" height="1080" src="page-000111.png">
<div class="txt" style="position:absolute; left:33px; top:134577px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Caching</span></div>
<div class="txt" style="position:absolute; left:749px; top:134481px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:134717px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you know that the same values tend to be requested repeatedly,</span></div>
<div class="txt" style="position:absolute; left:112px; top:134767px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">you can cache values this way:</span></div>
<img id="background" style="position:absolute; left:0px; top:135692px;" width="1440" height="1080" src="page112.png"> <img id="background" style="position:absolute; left:1440px; top:135692px;" width="1440" height="1080" src="page-000112.png">
<div class="txt" style="position:absolute; left:33px; top:135799px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Caching</span></div>
<div class="txt" style="position:absolute; left:749px; top:135703px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:77px; top:136068px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The success of the cache depends on the relative costs of accessing a</span></div>
<div class="txt" style="position:absolute; left:113px; top:136118px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">cached element, creating an uncached element, and saving a new</span></div>
<div class="txt" style="position:absolute; left:113px; top:136162px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">element in the cache. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">缓存的成功取决于访问缓存元素的相对成本，创</span></div>
<div class="txt" style="position:absolute; left:113px; top:136210px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">建未缓存的元素以及将新元素保存在缓存中。</span></div>
<div class="txt" style="position:absolute; left:77px; top:136284px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Success also depends on how often the cached information is</span></div>
<div class="txt" style="position:absolute; left:113px; top:136334px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">requested. In some cases, success might also depend on caching done</span></div>
<div class="txt" style="position:absolute; left:113px; top:136378px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">by the hardware. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">成功还取决于请求缓存信息的频率</span></div>
<div class="txt" style="position:absolute; left:77px; top:136453px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Generally, the more it costs to generate a new element and the more</span></div>
<div class="txt" style="position:absolute; left:113px; top:136502px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">times the same information is requested, the more valuable a cache</span></div>
<div class="txt" style="position:absolute; left:113px; top:136550px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is. The cheaper it is to access a cached element and save new</span></div>
<div class="txt" style="position:absolute; left:113px; top:136598px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">elements in the cache, the more valuable a cache is.</span></div>
<div class="txt" style="position:absolute; left:77px; top:136669px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">As with other optimization techniques, caching adds complexity and</span></div>
<div class="txt" style="position:absolute; left:113px; top:136717px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">tends to be error prone. </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">缓存增加了复杂性并且容易出错。</span></div>
<img id="background" style="position:absolute; left:0px; top:136914px;" width="1440" height="1080" src="page113.png"> <img id="background" style="position:absolute; left:1440px; top:136914px;" width="1440" height="1080" src="page-000113.png">
<div class="txt" style="position:absolute; left:1105px; top:136932px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:171px; top:137329px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(4) Expression-related code tuning</span></div>
<img id="background" style="position:absolute; left:0px; top:138136px;" width="1440" height="1080" src="page114.png"> <img id="background" style="position:absolute; left:1440px; top:138136px;" width="1440" height="1080" src="page-000114.png">
<div class="txt" style="position:absolute; left:749px; top:138147px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:138238px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Exploit algebraic identities-</span><span id="f12" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">代数恒等式</span></div>
<div class="txt" style="position:absolute; left:76px; top:138383px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">You can use algebraic identities to replace costly operations with</span></div>
<div class="txt" style="position:absolute; left:112px; top:138428px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">cheaper ones. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">通过代数恒等式，用低代价的操作替代复杂操作</span></div>
<div class="txt" style="position:absolute; left:76px; top:138503px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, the following expressions are logically equivalent:</span></div>
<div class="txt" style="position:absolute; left:112px; top:138570px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">not a and not b</span></div>
<div class="txt" style="position:absolute; left:112px; top:138630px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">not (a or b)</span></div>
<div class="txt" style="position:absolute; left:112px; top:138690px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the second expression can save a </span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">not </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">operation.</span></div>
<div class="txt" style="position:absolute; left:76px; top:138756px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., sqrt(x)&lt;sqrt(y) vs. x&lt;y</span></div>
<img id="background" style="position:absolute; left:0px; top:139358px;" width="1440" height="1080" src="page115.png"> <img id="background" style="position:absolute; left:1440px; top:139358px;" width="1440" height="1080" src="page-000115.png">
<div class="txt" style="position:absolute; left:749px; top:139369px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:139460px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use strength reduction</span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">削弱运算强度</span></div>
<div class="txt" style="position:absolute; left:76px; top:139605px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">strength reduction means replacing an expensive operation with a</span></div>
<div class="txt" style="position:absolute; left:112px; top:139650px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">cheaper one. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用代价低的运算代替代价高的运算</span></div>
<div class="txt" style="position:absolute; left:76px; top:139725px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Here are some possible substitutions:</span></div>
<div class="txt" style="position:absolute; left:112px; top:139792px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace multiplication with addition.</span></div>
<div class="txt" style="position:absolute; left:112px; top:139852px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace exponentiation with multiplication.</span></div>
<div class="txt" style="position:absolute; left:112px; top:139913px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace trigonometric routines with their trigonometric identities.</span></div>
<div class="txt" style="position:absolute; left:112px; top:139973px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace longlong integers with longs or ints (but watch for performance</span></div>
<div class="txt" style="position:absolute; left:148px; top:140016px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">issues associated with using native-length vs. non-native</span><span id="f11" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">–</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">length integers)</span></div>
<div class="txt" style="position:absolute; left:112px; top:140077px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace floating-point numbers with fixed-point numbers or integers.</span></div>
<div class="txt" style="position:absolute; left:112px; top:140137px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace double-precision floating points with single-precision numbers.</span></div>
<div class="txt" style="position:absolute; left:112px; top:140198px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Replace integer multiplication-by-two and division-by-two with shift</span></div>
<div class="txt" style="position:absolute; left:148px; top:140241px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">operations.</span></div>
<img id="background" style="position:absolute; left:0px; top:140580px;" width="1440" height="1080" src="page116.png"> <img id="background" style="position:absolute; left:1440px; top:140580px;" width="1440" height="1080" src="page-000116.png">
<div class="txt" style="position:absolute; left:749px; top:140591px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:140687px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Initialize at compile time</span></div>
<div class="txt" style="position:absolute; left:76px; top:140827px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you’re using a </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">named constant or a magic number </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in a routine call</span></div>
<div class="txt" style="position:absolute; left:112px; top:140877px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and it’s the only argument, that’s a clue that you could precompute</span></div>
<div class="txt" style="position:absolute; left:112px; top:140925px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the number, put it into a constant, and avoid the routine call. The</span></div>
<div class="txt" style="position:absolute; left:112px; top:140973px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">same principle applies to multiplications, divisions, additions, and</span></div>
<div class="txt" style="position:absolute; left:112px; top:141016px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">other operations. </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对于固定常量或值提前计算出来</span></div>
<div class="txt" style="position:absolute; left:76px; top:141091px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Log() is time-consuming routine .</span></div>
<div class="txt" style="position:absolute; left:212px; top:141183px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static double log2(double value) {</span></div>
<div class="txt" style="position:absolute; left:291px; top:141226px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Math.log(value) / Math.log(2);</span></div>
<div class="txt" style="position:absolute; left:212px; top:141269px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:216px; top:141400px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public final static double log2=0.69314718;</span></div>
<div class="txt" style="position:absolute; left:216px; top:141444px;"><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">……</span></div>
<div class="txt" style="position:absolute; left:216px; top:141487px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static double log2(double value) {</span></div>
<div class="txt" style="position:absolute; left:294px; top:141530px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return Math.log(value) / log2;</span></div>
<div class="txt" style="position:absolute; left:216px; top:141573px;"><span id="f30" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:141802px;" width="1440" height="1080" src="page117.png"> <img id="background" style="position:absolute; left:1440px; top:141802px;" width="1440" height="1080" src="page-000117.png">
<div class="txt" style="position:absolute; left:749px; top:141813px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:141909px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use correct type of constants</span></div>
<div class="txt" style="position:absolute; left:76px; top:142049px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Use named constants and literals that are the same type as the</span></div>
<div class="txt" style="position:absolute; left:112px; top:142099px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">variables they’re assigned to. When a constant and its related</span></div>
<div class="txt" style="position:absolute; left:112px; top:142147px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">variable are different types, the compiler has to do a type</span></div>
<div class="txt" style="position:absolute; left:112px; top:142195px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">conversion to assign the constant to the variable.</span></div>
<div class="txt" style="position:absolute; left:76px; top:142265px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A good compiler does the type conversion at compile time so that it</span></div>
<div class="txt" style="position:absolute; left:112px; top:142315px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">doesn’t affect run</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-time performance. But a less advanced compiler</span></div>
<div class="txt" style="position:absolute; left:112px; top:142363px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">or an interpreter generates code for a runtime conversion.</span></div>
<div class="txt" style="position:absolute; left:121px; top:142424px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">所使用的具名常量和被赋值的相应变量具有相同的类型，避免编译器进行类</span></div>
<div class="txt" style="position:absolute; left:112px; top:142467px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">型转换</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">额外的开销</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<img id="background" style="position:absolute; left:0px; top:143024px;" width="1440" height="1080" src="page118.png"> <img id="background" style="position:absolute; left:1440px; top:143024px;" width="1440" height="1080" src="page-000118.png">
<div class="txt" style="position:absolute; left:749px; top:143035px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:143131px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Use the Correct Type of Constants</span></div>
<div class="txt" style="position:absolute; left:76px; top:143271px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the first case, the initializations look like this:</span></div>
<div class="txt" style="position:absolute; left:112px; top:143338px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">x=5</span></div>
<div class="txt" style="position:absolute; left:112px; top:143398px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">i = 3.14</span></div>
<div class="txt" style="position:absolute; left:112px; top:143459px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">assuming x is a floating point variable and i is an integer, require type</span></div>
<div class="txt" style="position:absolute; left:148px; top:143502px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">conversions.</span></div>
<div class="txt" style="position:absolute; left:76px; top:143567px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the second case, they look like this:</span></div>
<div class="txt" style="position:absolute; left:112px; top:143634px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">x = 3.14</span></div>
<div class="txt" style="position:absolute; left:112px; top:143695px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">i=5</span></div>
<div class="txt" style="position:absolute; left:112px; top:143755px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">don’t require type conversions.</span></div>
<img id="background" style="position:absolute; left:0px; top:144246px;" width="1440" height="1080" src="page119.png"> <img id="background" style="position:absolute; left:1440px; top:144246px;" width="1440" height="1080" src="page-000119.png">
<div class="txt" style="position:absolute; left:33px; top:144353px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Precompute Results</span></div>
<div class="txt" style="position:absolute; left:749px; top:144257px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:144493px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A common low-level design decision is the choice of whether to</span></div>
<div class="txt" style="position:absolute; left:112px; top:144543px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">compute results on the fly or compute them once, save them, and</span></div>
<div class="txt" style="position:absolute; left:112px; top:144591px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">look them up as needed.</span></div>
<div class="txt" style="position:absolute; left:76px; top:144661px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If the results are used many times, it’s often cheaper to compute</span></div>
<div class="txt" style="position:absolute; left:112px; top:144706px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">them once and look them up the rest of the time. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">如果某结果被多次</span></div>
<div class="txt" style="position:absolute; left:112px; top:144754px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">使用，计算一次且在其余时间检索并运用这个结果可节省时间</span></div>
<div class="txt" style="position:absolute; left:76px; top:144829px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">At the simplest level, you might compute part of an expression</span></div>
<div class="txt" style="position:absolute; left:112px; top:144879px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">outside a loop rather than inside. At a more complicated level, you</span></div>
<div class="txt" style="position:absolute; left:112px; top:144927px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">might compute a lookup table once when program execution</span></div>
<div class="txt" style="position:absolute; left:112px; top:144975px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">begins, using it every time thereafter, or you might store results in</span></div>
<div class="txt" style="position:absolute; left:112px; top:145018px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">a data file or embed them in a program. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">简单形式：在循环外计算一</span></div>
<div class="txt" style="position:absolute; left:112px; top:145070px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">部分表达式；复杂形式：在开始前，通过表格、文件等形式记录下会</span></div>
<div class="txt" style="position:absolute; left:112px; top:145114px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">多次用到的结果</span></div>
<img id="background" style="position:absolute; left:0px; top:145468px;" width="1440" height="1080" src="page120.png"> <img id="background" style="position:absolute; left:1440px; top:145468px;" width="1440" height="1080" src="page-000120.png">
<div class="txt" style="position:absolute; left:33px; top:145575px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Precompute Results</span></div>
<div class="txt" style="position:absolute; left:749px; top:145479px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:145715px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Optimizing a program by precomputation can take several forms:</span></div>
<div class="txt" style="position:absolute; left:112px; top:145782px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Computing results before the program executes and wiring them into</span></div>
<div class="txt" style="position:absolute; left:148px; top:145825px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">constants that are assigned at compile time</span></div>
<div class="txt" style="position:absolute; left:112px; top:145885px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Computing results before the program executes and hard-coding them</span></div>
<div class="txt" style="position:absolute; left:148px; top:145929px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">into variables used at run time</span></div>
<div class="txt" style="position:absolute; left:112px; top:145989px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Computing results before the program executes and putting them into a</span></div>
<div class="txt" style="position:absolute; left:148px; top:146032px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">file that’s loaded at run time</span></div>
<div class="txt" style="position:absolute; left:112px; top:146093px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Computing results once, at program startup, and then referencing them</span></div>
<div class="txt" style="position:absolute; left:148px; top:146136px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">each time they’re needed</span></div>
<div class="txt" style="position:absolute; left:112px; top:146196px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Computing as much as possible before a loop begins, minimizing the</span></div>
<div class="txt" style="position:absolute; left:148px; top:146240px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">work done inside the loop</span></div>
<div class="txt" style="position:absolute; left:112px; top:146300px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Computing results the first time they’re needed and storing them so that</span></div>
<div class="txt" style="position:absolute; left:148px; top:146343px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">you can retrieve them when they’re needed again</span></div>
<img id="background" style="position:absolute; left:0px; top:146690px;" width="1440" height="1080" src="page121.png"> <img id="background" style="position:absolute; left:1440px; top:146690px;" width="1440" height="1080" src="page-000121.png">
<div class="txt" style="position:absolute; left:749px; top:146701px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:146797px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Eliminate Common Subexpressions</span><span id="f11" style="font-size:48px;vertical-align:baseline;color:rgba(0,0,0,1);">删除公共表达式</span></div>
<div class="txt" style="position:absolute; left:76px; top:146937px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If you find an expression that’s repeated several times, assign it to a</span></div>
<div class="txt" style="position:absolute; left:112px; top:146987px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">variable and refer to the variable rather than recomputing the</span></div>
<div class="txt" style="position:absolute; left:112px; top:147035px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">expression in several places.</span></div>
<div class="txt" style="position:absolute; left:76px; top:147105px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The loan-calculation example has a common subexpression that you</span></div>
<div class="txt" style="position:absolute; left:112px; top:147155px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">could eliminate. Here’s the original code:</span></div>
<img id="background" style="position:absolute; left:0px; top:147912px;" width="1440" height="1080" src="page122.png"> <img id="background" style="position:absolute; left:1440px; top:147912px;" width="1440" height="1080" src="page-000122.png">
<div class="txt" style="position:absolute; left:1105px; top:147930px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:205px; top:148327px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">(5) Function-related code tuning</span></div>
<img id="background" style="position:absolute; left:0px; top:149134px;" width="1440" height="1080" src="page123.png"> <img id="background" style="position:absolute; left:1440px; top:149134px;" width="1440" height="1080" src="page-000123.png">
<div class="txt" style="position:absolute; left:33px; top:149241px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Routines</span></div>
<div class="txt" style="position:absolute; left:749px; top:149145px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:76px; top:149381px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">One of the most powerful tools in code tuning is a good routine</span></div>
<div class="txt" style="position:absolute; left:112px; top:149426px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">decomposition. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">良好的子程序分解是调优的强大工具</span></div>
<div class="txt" style="position:absolute; left:112px; top:149496px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Small, well-defined routines save space because they take the place of</span></div>
<div class="txt" style="position:absolute; left:148px; top:149539px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">doing jobs separately in multiple places.</span></div>
<div class="txt" style="position:absolute; left:112px; top:149599px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">They make a program easy to optimize because you can refactor code in</span></div>
<div class="txt" style="position:absolute; left:148px; top:149643px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">one routine and thus improve every routine that calls it.</span></div>
<div class="txt" style="position:absolute; left:112px; top:149703px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Small routines are relatively easy to rewrite in assembler. Long, tortuous</span></div>
<div class="txt" style="position:absolute; left:148px; top:149746px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">routines are hard enough to understand on their own; in assembler they’re</span></div>
<div class="txt" style="position:absolute; left:148px; top:149790px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">impossible.</span></div>
<div class="txt" style="position:absolute; left:112px; top:149846px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">小巧而良好定义的子程序节省空间、易于优化、易于重写</span></div>
<img id="background" style="position:absolute; left:0px; top:150356px;" width="1440" height="1080" src="page124.png"> <img id="background" style="position:absolute; left:1440px; top:150356px;" width="1440" height="1080" src="page-000124.png">
<div class="txt" style="position:absolute; left:1105px; top:150374px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:156px; top:150771px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">6 Code Tuning for I/O and logging</span></div>
<div class="txt" style="position:absolute; left:709px; top:151030px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">8</span></div>
<img id="background" style="position:absolute; left:0px; top:151578px;" width="1440" height="1080" src="page125.png"> <img id="background" style="position:absolute; left:1440px; top:151578px;" width="1440" height="1080" src="page-000125.png">
<div class="txt" style="position:absolute; left:749px; top:151589px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:151685px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Code Tuning for I/O and logging</span></div>
<div class="txt" style="position:absolute; left:76px; top:151825px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">See 7.4</span></div>
<img id="background" style="position:absolute; left:0px; top:152800px;" width="1440" height="1080" src="page126.png"> <img id="background" style="position:absolute; left:1440px; top:152800px;" width="1440" height="1080" src="page-000126.png">
<div class="txt" style="position:absolute; left:1105px; top:152818px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:190px; top:153129px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">7 Code Tuning for Data structure</span></div>
<div class="txt" style="position:absolute; left:477px; top:153215px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">and algorithms</span></div>
<div class="txt" style="position:absolute; left:699px; top:153474px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">11</span></div>
<img id="background" style="position:absolute; left:0px; top:154022px;" width="1440" height="1080" src="page127.png"> <img id="background" style="position:absolute; left:1440px; top:154022px;" width="1440" height="1080" src="page-000127.png">
<div class="txt" style="position:absolute; left:749px; top:154033px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.3 Code Tuning for Performance Optimization</span></div>
<div class="txt" style="position:absolute; left:33px; top:154129px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Code Tuning for Data structure and algorithms</span></div>
<div class="txt" style="position:absolute; left:76px; top:154269px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Learning from the courses “Data Structure” and “Algorithm”</span></div>
<img id="background" style="position:absolute; left:0px; top:155244px;" width="1440" height="1080" src="page128.png"> <img id="background" style="position:absolute; left:1440px; top:155244px;" width="1440" height="1080" src="page-000128.png">
<div class="txt" style="position:absolute; left:1105px; top:155262px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:590px; top:155659px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">The end</span></div>
<div class="txt" style="position:absolute; left:604px; top:155913px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">May 19, 2019</span></div>
</body></html>