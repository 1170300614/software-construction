<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head> <body onload="start()"><div style="background:#5c5c5f; color:#FFF"> <p align="center">&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;[&#x6DF1;&#x5BB9;Pubmed&#x6587;&#x732E;&#x68C0;&#x7D22;] &nbsp 1. &#x6B64;&#x5904;&#x53F3;&#x952E;&#xFF1A;&#x9009;&#x83DC;&#x5355;&#x3010;&#x7FFB;&#x6210;&#x4E2D;&#x6587;&#xFF08;&#x7B80;&#x4F53;&#xFF09;&#x3011; &nbsp &nbsp &nbsp  2. &#x7FFB;&#x8BD1;&#x540E;&#xFF0C;&#x6B64;&#x5904;&#x53F3;&#x952E;&#xFF1A;&#x9009;&#x83DC;&#x5355;&#x3010;&#x6253;&#x5370;...&#x3011;&#x6210;PDF&#x683C;&#x5F0F; <br>&#x5EFA;&#x8BAE;&#x5C4F;&#x5E55;&#x5206;&#x8FA8;&#x7387;&#xFF1A;1920X1080&#xFF1B;&#x5982;&#x679C;&#x5C4F;&#x5E55;&#x592A;&#x5C0F;&#xFF0C;&#x53EF;&#x4EE5;&#x6309;Ctrl + &#x6216; Ctrl -&#x7F29;&#x653E;&#x7F51;&#x9875;&#x3002;</p></div><style type="text/css"> .txt { white-space:nowrap; }	 #f0 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f1 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f2 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f3 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f4 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f5 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f6 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f7 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f8 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f9 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f10 { font-family:sans-serif; font-weight:normal; font-style:normal; }  #f11 { font-family:sans-serif; font-weight:normal; font-style:normal; }  #f12 { font-family:sans-serif; font-weight:normal; font-style:normal; } 	#f13 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f14 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f15 { font-family:sans-serif; font-weight:normal; font-style:normal; } 	#f16 { font-family:sans-serif; font-weight:normal; font-style:normal; }	 #f17 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f18 { font-family:sans-serif; font-weight:normal; font-style:normal; } #f19 { font-family:sans-serif; font-weight:normal; font-style:normal; }		#f20 { font-family:sans-serif; font-weight:normal; font-style:normal; }		</style><img id="background" style="position:absolute; left:0px; top:50px;" width="1440" height="1080" src="page1.png"> <img id="background" style="position:absolute; left:1440px; top:50px;" width="1440" height="1080" src="page-000001.png">
<div class="txt" style="position:absolute; left:1105px; top:68px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:263px; top:275px;"><span id="f9" style="font-size:55px;vertical-align:baseline;color:rgba(0,0,0,1);">Chapter 8: Software Construction for</span></div>
<div class="txt" style="position:absolute; left:562px; top:342px;"><span id="f9" style="font-size:55px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance</span></div>
<div class="txt" style="position:absolute; left:123px; top:413px;"><span id="f17" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods</span></div>
<div class="txt" style="position:absolute; left:188px; top:500px;"><span id="f17" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:596px; top:719px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Xu Hanchuan</span></div>
<div class="txt" style="position:absolute; left:585px; top:772px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(255,98,176,1);">xhc@hit.edu.cn</span></div>
<div class="txt" style="position:absolute; left:604px; top:877px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">May 13, 2019</span></div>
<img id="background" style="position:absolute; left:0px; top:1050px;" width="1440" height="1080" src="page2.png"> <img id="background" style="position:absolute; left:1440px; top:1050px;" width="1440" height="1080" src="page-000002.png">
<div class="txt" style="position:absolute; left:33px; top:1157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Outline</span></div>
<div class="txt" style="position:absolute; left:426px; top:1067px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:1297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">1 Performance Metrics</span></div>
<div class="txt" style="position:absolute; left:76px; top:1369px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">2 Memory Allocation</span></div>
<div class="txt" style="position:absolute; left:112px; top:1436px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Three modes of object management: Static, Stack-based, and Heap-based</span></div>
<div class="txt" style="position:absolute; left:76px; top:1501px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">3 Java Memory Model</span></div>
<div class="txt" style="position:absolute; left:76px; top:1573px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">4 Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:112px; top:1640px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Living without Automatic GC</span></div>
<div class="txt" style="position:absolute; left:112px; top:1701px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Living with Automatic GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:1766px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">5 Basic Algorithms of Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:112px; top:1833px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting</span></div>
<div class="txt" style="position:absolute; left:112px; top:1894px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Sweep</span></div>
<div class="txt" style="position:absolute; left:112px; top:1954px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Compact</span></div>
<div class="txt" style="position:absolute; left:112px; top:2015px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying</span></div>
<img id="background" style="position:absolute; left:0px; top:2050px;" width="1440" height="1080" src="page3.png"> <img id="background" style="position:absolute; left:1440px; top:2050px;" width="1440" height="1080" src="page-000003.png">
<div class="txt" style="position:absolute; left:33px; top:2157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Outline</span></div>
<div class="txt" style="position:absolute; left:426px; top:2067px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:2297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">6 Garbage Collection in JVM</span></div>
<div class="txt" style="position:absolute; left:76px; top:2369px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">7 Garbage Collection Tuning in JVM</span></div>
<div class="txt" style="position:absolute; left:76px; top:2441px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">8 Using I/O Efficiently in Java</span></div>
<div class="txt" style="position:absolute; left:76px; top:2513px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Summary</span></div>
<img id="background" style="position:absolute; left:0px; top:3050px;" width="1440" height="1080" src="page4.png"> <img id="background" style="position:absolute; left:1440px; top:3050px;" width="1440" height="1080" src="page-000004.png">
<div class="txt" style="position:absolute; left:1105px; top:3068px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:361px; top:3465px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">1 Performance Metrics</span></div>
<img id="background" style="position:absolute; left:0px; top:4050px;" width="1440" height="1080" src="page5.png"> <img id="background" style="position:absolute; left:1440px; top:4050px;" width="1440" height="1080" src="page-000005.png">
<div class="txt" style="position:absolute; left:426px; top:4067px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:4157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:4297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance is the amount of work accomplished by a computer</span></div>
<div class="txt" style="position:absolute; left:112px; top:4347px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">system.</span></div>
<div class="txt" style="position:absolute; left:112px; top:4412px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Short response time for a given piece of work</span></div>
<div class="txt" style="position:absolute; left:112px; top:4472px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Low utilization of computing resource(s) </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">–</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">CPU, memory, disk, etc.</span></div>
<img id="background" style="position:absolute; left:0px; top:5050px;" width="1440" height="1080" src="page6.png"> <img id="background" style="position:absolute; left:1440px; top:5050px;" width="1440" height="1080" src="page-000006.png">
<div class="txt" style="position:absolute; left:426px; top:5067px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:5157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Runtime program performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:5297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Time performance</span></div>
<div class="txt" style="position:absolute; left:112px; top:5364px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Execution time </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">for a single statement, for a complex structure (such as a</span></div>
<div class="txt" style="position:absolute; left:148px; top:5407px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">loop, I/O, network communication, etc), for the whole program;</span></div>
<div class="txt" style="position:absolute; left:112px; top:5467px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Distribution of execution time </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of different statements/structures (relative</span></div>
<div class="txt" style="position:absolute; left:148px; top:5511px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">time distribution)</span></div>
<div class="txt" style="position:absolute; left:112px; top:5571px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Time bottleneck </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of a program’s execution</span></div>
<div class="txt" style="position:absolute; left:76px; top:5637px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Space performance</span></div>
<div class="txt" style="position:absolute; left:112px; top:5704px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory consumption </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">for a single variable, for a complex data structure,</span></div>
<div class="txt" style="position:absolute; left:148px; top:5747px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and for the whole program;</span></div>
<div class="txt" style="position:absolute; left:112px; top:5807px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Distribution of memory consumption </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of different variables/data</span></div>
<div class="txt" style="position:absolute; left:148px; top:5851px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">structures (relative space distribution)</span></div>
<div class="txt" style="position:absolute; left:112px; top:5911px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Space bottleneck </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of a program’s execution</span></div>
<div class="txt" style="position:absolute; left:112px; top:5971px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Evolution of memory consumption </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">along with time</span></div>
<img id="background" style="position:absolute; left:0px; top:6050px;" width="1440" height="1080" src="page7.png"> <img id="background" style="position:absolute; left:1440px; top:6050px;" width="1440" height="1080" src="page-000007.png">
<div class="txt" style="position:absolute; left:426px; top:6067px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:6157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Factors influencing runtime performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:6297px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Space performance:</span></div>
<div class="txt" style="position:absolute; left:112px; top:6364px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory allocation</span></div>
<div class="txt" style="position:absolute; left:112px; top:6424px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:6490px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Time performance:</span></div>
<div class="txt" style="position:absolute; left:112px; top:6557px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Basic statements</span></div>
<div class="txt" style="position:absolute; left:112px; top:6617px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Algorithms</span></div>
<div class="txt" style="position:absolute; left:112px; top:6678px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Data structure</span></div>
<div class="txt" style="position:absolute; left:112px; top:6738px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">I/O</span></div>
<div class="txt" style="position:absolute; left:112px; top:6799px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Network communication</span></div>
<div class="txt" style="position:absolute; left:112px; top:6859px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Concurrency / multi-thread / lock</span></div>
<div class="txt" style="position:absolute; left:76px; top:6925px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">In general, a operation is considered as expensive if this operation</span></div>
<div class="txt" style="position:absolute; left:112px; top:6975px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">has a long runtime or a high memory consumption.</span></div>
<img id="background" style="position:absolute; left:0px; top:7050px;" width="1440" height="1080" src="page8.png"> <img id="background" style="position:absolute; left:1440px; top:7050px;" width="1440" height="1080" src="page-000008.png">
<div class="txt" style="position:absolute; left:426px; top:7067px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:7157px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">How to get memory consumption?</span></div>
<div class="txt" style="position:absolute; left:56px; top:7286px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The total used / free memory of an program can be obtained in the</span></div>
<div class="txt" style="position:absolute; left:92px; top:7335px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">program via </span><span id="f16" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">java.lang.Runtime.getRuntime()</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, and the runtime</span></div>
<div class="txt" style="position:absolute; left:92px; top:7383px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">has several method which relates to the memory.</span></div>
<div class="txt" style="position:absolute; left:122px; top:7458px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public class MemoryPerformanceTest {</span></div>
<div class="txt" style="position:absolute; left:194px; top:7534px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) {</span></div>
<div class="txt" style="position:absolute; left:264px; top:7573px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">List&lt;Person&gt; list = new ArrayList&lt;Person&gt;();</span></div>
<div class="txt" style="position:absolute; left:264px; top:7611px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">for (int i = 0; i &lt;= 1000000; i++) {</span></div>
<div class="txt" style="position:absolute; left:334px; top:7650px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">list.add(new Person("Jim", "Knopf"));</span></div>
<div class="txt" style="position:absolute; left:264px; top:7688px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:264px; top:7765px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">// Get the Java runtime</span></div>
<div class="txt" style="position:absolute; left:264px; top:7803px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Runtime runtime = </span><span id="f39" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,255,1);">Runtime.getRuntime();</span></div>
<div class="txt" style="position:absolute; left:264px; top:7842px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">// Run the garbage collector</span></div>
<div class="txt" style="position:absolute; left:264px; top:7880px;"><span id="f39" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,255,1);">runtime.gc();</span></div>
<div class="txt" style="position:absolute; left:264px; top:7918px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">// Calculate the used memory</span></div>
<div class="txt" style="position:absolute; left:264px; top:7957px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">long memory = </span><span id="f39" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,255,1);">runtime.totalMemory() - runtime.freeMemory();</span></div>
<div class="txt" style="position:absolute; left:264px; top:7995px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println("Used memory is byets:" + memory);</span></div>
<div class="txt" style="position:absolute; left:194px; top:8034px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:122px; top:8072px;"><span id="f16" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:9666px;" width="1440" height="1080" src="page9.png"> <img id="background" style="position:absolute; left:1440px; top:9666px;" width="1440" height="1080" src="page-000009.png">
<div class="txt" style="position:absolute; left:426px; top:9683px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:9773px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">How to get execution time?</span></div>
<div class="txt" style="position:absolute; left:76px; top:9913px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Use </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">System.currentTimeMillis() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to get the start time and the</span></div>
<div class="txt" style="position:absolute; left:112px; top:9963px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">end time and calculate the difference.</span></div>
<div class="txt" style="position:absolute; left:112px; top:10070px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">class TimeTest{</span></div>
<div class="txt" style="position:absolute; left:182px; top:10124px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) {</span></div>
<div class="txt" style="position:absolute; left:252px; top:10178px;"><span id="f21" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,255,1);">long startTime = System.currentTimeMillis();</span></div>
<div class="txt" style="position:absolute; left:252px; top:10232px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">long total = 0;</span></div>
<div class="txt" style="position:absolute; left:252px; top:10285px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">for (int i = 0; i &lt; 10000000; i++) {</span></div>
<div class="txt" style="position:absolute; left:322px; top:10339px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">total += i;</span></div>
<div class="txt" style="position:absolute; left:252px; top:10393px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:252px; top:10447px;"><span id="f21" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,255,1);">long stopTime = System.currentTimeMillis();</span></div>
<div class="txt" style="position:absolute; left:252px; top:10500px;"><span id="f21" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,255,1);">long elapsedTime = stopTime - startTime;</span></div>
<div class="txt" style="position:absolute; left:252px; top:10554px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(elapsedTime);</span></div>
<div class="txt" style="position:absolute; left:182px; top:10608px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:112px; top:10662px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:10868px;" width="1440" height="1080" src="page10.png"> <img id="background" style="position:absolute; left:1440px; top:10868px;" width="1440" height="1080" src="page-000010.png">
<div class="txt" style="position:absolute; left:1105px; top:10886px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:381px; top:11283px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">2 Memory Allocation</span></div>
<img id="background" style="position:absolute; left:0px; top:12070px;" width="1440" height="1080" src="page11.png"> <img id="background" style="position:absolute; left:1440px; top:12070px;" width="1440" height="1080" src="page-000011.png">
<div class="txt" style="position:absolute; left:426px; top:12087px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:12177px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Recall: Memory handling in OS</span></div>
<div class="txt" style="position:absolute; left:76px; top:12317px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Native memory </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is the memory which is available to a process, e.g.</span></div>
<div class="txt" style="position:absolute; left:112px; top:12367px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the Java process.</span></div>
<div class="txt" style="position:absolute; left:76px; top:12437px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Native memory is controlled by OS </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and based on physical memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:12487px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and other physical devices, e.g. disks, flash memory, etc.</span></div>
<div class="txt" style="position:absolute; left:112px; top:12552px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">CPU computes the instructions to execute and stores its computation</span></div>
<div class="txt" style="position:absolute; left:148px; top:12595px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">results into registers. It can access the normal memory over the memory</span></div>
<div class="txt" style="position:absolute; left:148px; top:12638px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">bus.</span></div>
<div class="txt" style="position:absolute; left:112px; top:12699px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">OS normally uses virtual memory </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to map the</span></div>
<div class="txt" style="position:absolute; left:148px; top:12742px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">physical memory to memory which each</span></div>
<div class="txt" style="position:absolute; left:148px; top:12785px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">process can see. It assigns memory to each</span></div>
<div class="txt" style="position:absolute; left:148px; top:12828px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">process in a virtual memory space for this</span></div>
<div class="txt" style="position:absolute; left:148px; top:12871px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">process and maps access to this virtual memory</span></div>
<div class="txt" style="position:absolute; left:148px; top:12913px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to the real physical memory. </span><span id="f13" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">OS</span><span id="f37" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">通过虚拟内存机制</span></div>
<div class="txt" style="position:absolute; left:112px; top:12970px;"><span id="f37" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">管理物理内存的使用，将物理内存映射为虚拟内存，</span></div>
<div class="txt" style="position:absolute; left:112px; top:13024px;"><span id="f37" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">为每个进程分配虚拟内存空间。</span></div>
<img id="background" style="position:absolute; left:0px; top:13272px;" width="1440" height="1080" src="page12.png"> <img id="background" style="position:absolute; left:1440px; top:13272px;" width="1440" height="1080" src="page-000012.png">
<div class="txt" style="position:absolute; left:426px; top:13289px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:13379px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory Management</span></div>
<div class="txt" style="position:absolute; left:76px; top:13519px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Memory management </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is a form of resource management applied to</span></div>
<div class="txt" style="position:absolute; left:112px; top:13569px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">computer memory.</span></div>
<div class="txt" style="position:absolute; left:112px; top:13634px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The essential requirement of memory management is to provide ways to</span></div>
<div class="txt" style="position:absolute; left:148px; top:13677px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">dynamically allocate portions of memory to programs at their request</span></div>
<div class="txt" style="position:absolute; left:148px; top:13720px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(memory allocation)</span></div>
<div class="txt" style="position:absolute; left:112px; top:13781px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Free it for reuse when no longer needed (garbage </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">collection).</span></div>
<div class="txt" style="position:absolute; left:76px; top:13907px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Modern general-purpose computer systems manage memory at two</span></div>
<div class="txt" style="position:absolute; left:112px; top:13957px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">levels:</span></div>
<div class="txt" style="position:absolute; left:112px; top:14022px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">OS level</span></div>
<div class="txt" style="position:absolute; left:112px; top:14082px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Application level</span></div>
<img id="background" style="position:absolute; left:0px; top:14474px;" width="1440" height="1080" src="page13.png"> <img id="background" style="position:absolute; left:1440px; top:14474px;" width="1440" height="1080" src="page-000013.png">
<div class="txt" style="position:absolute; left:426px; top:14491px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:14581px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What is the problem?</span></div>
<div class="txt" style="position:absolute; left:76px; top:14721px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Memory is a scarce and precious resource!</span></div>
<div class="txt" style="position:absolute; left:76px; top:14793px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If we had unbounded amounts of memory, </span><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">we’d </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">never worry.</span></div>
<div class="txt" style="position:absolute; left:76px; top:14865px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">The PROBLEM is that we </span><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">don’t </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">have unbounded memory.</span></div>
<img id="background" style="position:absolute; left:0px; top:15676px;" width="1440" height="1080" src="page14.png"> <img id="background" style="position:absolute; left:1440px; top:15676px;" width="1440" height="1080" src="page-000014.png">
<div class="txt" style="position:absolute; left:426px; top:15693px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:15783px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What can we do?</span></div>
<div class="txt" style="position:absolute; left:76px; top:15920px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Dynamically allocate and deallocate memory. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">动态分配和释放内存</span></div>
<div class="txt" style="position:absolute; left:76px; top:15992px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">REUSE deallocated memory. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">重用释放的内存</span></div>
<div class="txt" style="position:absolute; left:112px; top:16062px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Allocation </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">means finding a free piece of memory in the heap and</span></div>
<div class="txt" style="position:absolute; left:148px; top:16105px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">reserving it for the representation of an object.</span></div>
<div class="txt" style="position:absolute; left:112px; top:16165px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Deallocation </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">means changing the status of a piece of memory from</span></div>
<div class="txt" style="position:absolute; left:148px; top:16209px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocated to free.</span></div>
<div class="txt" style="position:absolute; left:76px; top:16274px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Dynamical memory allocation is available in many languages, e.g.,</span></div>
<div class="txt" style="position:absolute; left:112px; top:16324px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">using languages features:</span></div>
<div class="txt" style="position:absolute; left:112px; top:16389px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f36" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">New() or Constructors </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocates a new object</span></div>
<div class="txt" style="position:absolute; left:112px; top:16449px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f36" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Delete()</span></div>
<div class="txt" style="position:absolute; left:652px; top:16450px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">deallocated the object X</span></div>
<div class="txt" style="position:absolute; left:76px; top:16515px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Such features allows programmer to handle allocation themselves.</span></div>
<img id="background" style="position:absolute; left:0px; top:16878px;" width="1440" height="1080" src="page15.png"> <img id="background" style="position:absolute; left:1440px; top:16878px;" width="1440" height="1080" src="page-000015.png">
<div class="txt" style="position:absolute; left:426px; top:16895px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:16985px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Object Model</span></div>
<div class="txt" style="position:absolute; left:76px; top:17125px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects are represented in memory by some number of bits stored</span></div>
<div class="txt" style="position:absolute; left:112px; top:17170px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">contiguously(</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">连续地</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">) in memory.</span></div>
<div class="txt" style="position:absolute; left:112px; top:17240px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">They consist of a header (not visible to the user program, </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">called mutator</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">)</span></div>
<div class="txt" style="position:absolute; left:148px; top:17283px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and zero or more fields.</span></div>
<div class="txt" style="position:absolute; left:76px; top:17349px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects can contain references to other objects.</span></div>
<div class="txt" style="position:absolute; left:112px; top:17415px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A reference to an object is usually implemented merely by the memory</span></div>
<div class="txt" style="position:absolute; left:148px; top:17459px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">address of the piece of memory where the object is stored.</span></div>
<div class="txt" style="position:absolute; left:76px; top:17596px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Basic operation for allocating space to new objects:</span></div>
<div class="txt" style="position:absolute; left:112px; top:17663px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Create a new object;</span></div>
<div class="txt" style="position:absolute; left:112px; top:17724px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Attach it to the reference x;</span></div>
<div class="txt" style="position:absolute; left:112px; top:17784px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Initialize its fields.</span></div>
<div class="txt" style="position:absolute; left:112px; top:17844px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., </span><span id="f40" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Student Peter = new Student(“18S01558”,”Computer”);</span></div>
<img id="background" style="position:absolute; left:0px; top:18080px;" width="1440" height="1080" src="page16.png"> <img id="background" style="position:absolute; left:1440px; top:18080px;" width="1440" height="1080" src="page-000016.png">
<div class="txt" style="position:absolute; left:426px; top:18097px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:18187px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Object Model</span></div>
<div class="txt" style="position:absolute; left:76px; top:18327px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Objects </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">are typically allocated in the </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">heap.</span></div>
<div class="txt" style="position:absolute; left:76px; top:18399px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Object Reference </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is a pointer to an object (typically merely the</span></div>
<div class="txt" style="position:absolute; left:112px; top:18449px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">heap address of the start of the object).</span></div>
<div class="txt" style="position:absolute; left:76px; top:18519px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Variables contain object references (ignoring primitive data).</span></div>
<div class="txt" style="position:absolute; left:76px; top:18591px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Each object can contain a number of variables and thereby</span></div>
<div class="txt" style="position:absolute; left:112px; top:18641px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reference other objects.</span></div>
<div class="txt" style="position:absolute; left:76px; top:18711px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A reference is attached to at most one object, an object may be</span></div>
<div class="txt" style="position:absolute; left:112px; top:18761px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">attached to two or more references.</span></div>
<img id="background" style="position:absolute; left:0px; top:19282px;" width="1440" height="1080" src="page17.png"> <img id="background" style="position:absolute; left:1440px; top:19282px;" width="1440" height="1080" src="page-000017.png">
<div class="txt" style="position:absolute; left:1105px; top:19300px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:153px; top:19697px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Three modes of object management</span></div>
<img id="background" style="position:absolute; left:0px; top:20484px;" width="1440" height="1080" src="page18.png"> <img id="background" style="position:absolute; left:1440px; top:20484px;" width="1440" height="1080" src="page-000018.png">
<div class="txt" style="position:absolute; left:426px; top:20501px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:20591px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Static &amp; dynamic allocation</span></div>
<div class="txt" style="position:absolute; left:76px; top:20731px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Static allocation </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">— </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">allocation takes place when a program starts </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">–</span></div>
<div class="txt" style="position:absolute; left:112px; top:20781px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">basically memory is laid out by the compiler</span></div>
<div class="txt" style="position:absolute; left:76px; top:20923px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Dynamic allocation </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">— </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">allocate new objects while the program is</span></div>
<div class="txt" style="position:absolute; left:112px; top:20973px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">executing.</span></div>
<div class="txt" style="position:absolute; left:112px; top:21038px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A simple form of dynamic allocation is </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">stack allocation </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">where objects are</span></div>
<div class="txt" style="position:absolute; left:148px; top:21081px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocated on the program stack and deallocated using a stack discipline.</span></div>
<div class="txt" style="position:absolute; left:112px; top:21141px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Heap allocation </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is the most general form of allocation: objects are</span></div>
<div class="txt" style="position:absolute; left:148px; top:21185px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocated in the heap.</span></div>
<img id="background" style="position:absolute; left:0px; top:21686px;" width="1440" height="1080" src="page19.png"> <img id="background" style="position:absolute; left:1440px; top:21686px;" width="1440" height="1080" src="page-000019.png">
<div class="txt" style="position:absolute; left:426px; top:21703px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:21793px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Three modes of object management</span></div>
<div class="txt" style="position:absolute; left:76px; top:21933px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The form of object management (particular in OO) is only one of</span></div>
<div class="txt" style="position:absolute; left:112px; top:21983px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">three commonly found modes:</span></div>
<div class="txt" style="position:absolute; left:112px; top:22048px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Static</span></div>
<div class="txt" style="position:absolute; left:112px; top:22108px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack-based</span></div>
<div class="txt" style="position:absolute; left:112px; top:22169px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Heap-based (free)</span></div>
<div class="txt" style="position:absolute; left:76px; top:22234px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The choice between these modes determines how an entity can</span></div>
<div class="txt" style="position:absolute; left:112px; top:22284px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">become attached to an object:</span></div>
<div class="txt" style="position:absolute; left:112px; top:22349px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">An </span><span id="f33" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">entity </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is a name in the code representing a run-time value, or a</span></div>
<div class="txt" style="position:absolute; left:148px; top:22392px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">succession of run-time values. Such values are either objects or (possibly</span></div>
<div class="txt" style="position:absolute; left:148px; top:22436px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">void) references to objects. Entities include </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">attributes, </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">formal routine</span></div>
<div class="txt" style="position:absolute; left:148px; top:22475px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">arguments, local entities </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">of routines and </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Result. </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Entity</span><span id="f53" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">是指属性、参数、</span></div>
<div class="txt" style="position:absolute; left:148px; top:22518px;"><span id="f53" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">局部变量和结果等在代码中的名字，其值为对象或对对象的引用。</span></div>
<div class="txt" style="position:absolute; left:112px; top:22582px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The term </span><span id="f33" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">attached </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">describes associations between entities and objects: at</span></div>
<div class="txt" style="position:absolute; left:148px; top:22626px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">some stage during execution, an entity x is attached to an object O if the</span></div>
<div class="txt" style="position:absolute; left:148px; top:22669px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">value of x is either O (for x of expanded type) or a reference to O (for x of</span></div>
<div class="txt" style="position:absolute; left:148px; top:22708px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">reference type). </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Attach</span><span id="f53" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">将</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">entity</span><span id="f53" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">同</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">object</span><span id="f53" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">关联</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">/</span><span id="f53" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">绑定在一起</span></div>
<img id="background" style="position:absolute; left:0px; top:22888px;" width="1440" height="1080" src="page20.png"> <img id="background" style="position:absolute; left:1440px; top:22888px;" width="1440" height="1080" src="page-000020.png">
<div class="txt" style="position:absolute; left:33px; top:22995px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Static mode</span></div>
<div class="txt" style="position:absolute; left:426px; top:22905px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:65px; top:23124px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the static mode, an entity may become</span></div>
<div class="txt" style="position:absolute; left:101px; top:23173px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">attached to at most one run-time object during</span></div>
<div class="txt" style="position:absolute; left:101px; top:23221px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the entire execution of the software. </span><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">在程序执行期内</span></div>
<div class="txt" style="position:absolute; left:97px; top:23285px;"><span id="f13" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">entity</span><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">至多</span><span id="f13" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">attach</span><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">一个运行时对象。</span></div>
<div class="txt" style="position:absolute; left:65px; top:23349px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This is the scheme promoted by languages such</span></div>
<div class="txt" style="position:absolute; left:101px; top:23399px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">as Fortran, designed to allow an implementation </span><span id="f8" style="font-size:36px;vertical-align:sub;color:rgba(0,0,0,1);">Fixed Memory Area</span></div>
<div class="txt" style="position:absolute; left:101px; top:23447px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">technique which will allocate space for all</span></div>
<div class="txt" style="position:absolute; left:101px; top:23495px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects (and attach them to the corresponding</span></div>
<div class="txt" style="position:absolute; left:101px; top:23543px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">entities) once and for all, at program loading time or at the</span></div>
<div class="txt" style="position:absolute; left:101px; top:23591px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">beginning of execution. </span><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">该技术在程序加载时或开始时一劳永逸地为所有对象分</span></div>
<div class="txt" style="position:absolute; left:101px; top:23634px;"><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">配空间（并将它们附加到相应的实体）</span></div>
<div class="txt" style="position:absolute; left:101px; top:23693px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">It precludes recursion</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">, since a recursive routine must be permitted to</span></div>
<div class="txt" style="position:absolute; left:137px; top:23736px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">have several incarnations active at once, each with its own incarnations of</span></div>
<div class="txt" style="position:absolute; left:137px; top:23778px;"><span id="f48" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the routine’s entities. </span><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">不支持递归</span></div>
<div class="txt" style="position:absolute; left:101px; top:23840px;"><span id="f43" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">It also precludes dynamically created data structures</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">, since the compiler</span></div>
<div class="txt" style="position:absolute; left:137px; top:23883px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">must be able to deduce the exact size of every data structure from the</span></div>
<div class="txt" style="position:absolute; left:137px; top:23925px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">software text. </span><span id="f20" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">不支持动态创建数据结构</span></div>
<img id="background" style="position:absolute; left:0px; top:24090px;" width="1440" height="1080" src="page21.png"> <img id="background" style="position:absolute; left:1440px; top:24090px;" width="1440" height="1080" src="page-000021.png">
<div class="txt" style="position:absolute; left:426px; top:24107px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:24197px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack-based mode</span></div>
<div class="txt" style="position:absolute; left:76px; top:24337px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Stack </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">is where the method invocations and the local variables are</span></div>
<div class="txt" style="position:absolute; left:112px; top:24387px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">stored.</span></div>
<div class="txt" style="position:absolute; left:112px; top:24448px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If a method is called, </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">its stack frame(</span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">栈帧</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">) </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is put onto the top of the call</span></div>
<div class="txt" style="position:absolute; left:148px; top:24495px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">stack.</span></div>
<div class="txt" style="position:absolute; left:112px; top:24555px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The stack frame holds the state of the method including which line of code</span></div>
<div class="txt" style="position:absolute; left:148px; top:24599px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is executing and the values of all local variables.</span></div>
<div class="txt" style="position:absolute; left:112px; top:24659px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The method at the top of the stack is always the</span></div>
<div class="txt" style="position:absolute; left:148px; top:24702px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">current running method for that stack.</span></div>
<img id="background" style="position:absolute; left:0px; top:25292px;" width="1440" height="1080" src="page22.png"> <img id="background" style="position:absolute; left:1440px; top:25292px;" width="1440" height="1080" src="page-000022.png">
<div class="txt" style="position:absolute; left:426px; top:25309px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:25399px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack-based mode</span></div>
<div class="txt" style="position:absolute; left:76px; top:25539px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An entity may at run time become attached to several objects in</span></div>
<div class="txt" style="position:absolute; left:112px; top:25589px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">succession, and the run-time mechanisms allocate and deallocate</span></div>
<div class="txt" style="position:absolute; left:112px; top:25635px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">these objects in last-in, first-out order in the stack.</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">一个</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">entity</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">在运行时</span></div>
<div class="txt" style="position:absolute; left:112px; top:25680px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">可以先后</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">attach</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">多个对象，运行时机制以堆栈中的后进先出顺序分配和释放这</span></div>
<div class="txt" style="position:absolute; left:112px; top:25723px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">些对象。</span></div>
<div class="txt" style="position:absolute; left:76px; top:25793px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When an object is deallocated, the corresponding entity becomes</span></div>
<div class="txt" style="position:absolute; left:112px; top:25842px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">attached again to the object to which it was previously attached, if</span></div>
<div class="txt" style="position:absolute; left:112px; top:25888px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">any.</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">当一个对象被释放时，相应的</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">entity</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">会再次</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">attach</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">到之前</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">attached</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">的对象</span></div>
<div class="txt" style="position:absolute; left:112px; top:25934px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">（如果有的话）</span><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">。</span></div>
<img id="background" style="position:absolute; left:0px; top:26494px;" width="1440" height="1080" src="page23.png"> <img id="background" style="position:absolute; left:1440px; top:26494px;" width="1440" height="1080" src="page-000023.png">
<div class="txt" style="position:absolute; left:426px; top:26511px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:26601px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack-based mode</span></div>
<img id="background" style="position:absolute; left:0px; top:27696px;" width="1440" height="1080" src="page24.png"> <img id="background" style="position:absolute; left:1440px; top:27696px;" width="1440" height="1080" src="page-000024.png">
<div class="txt" style="position:absolute; left:426px; top:27713px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:27803px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Heap-based mode</span></div>
<div class="txt" style="position:absolute; left:76px; top:27943px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">A heap </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">which is a part of memory that is split into many pieces</span></div>
<div class="txt" style="position:absolute; left:112px; top:27993px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">each of which either contains the representation of an object or is</span></div>
<div class="txt" style="position:absolute; left:112px; top:28036px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">unused (in which case we say it is free). </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">将内存分为多份，每份保存</span></div>
<div class="txt" style="position:absolute; left:112px; top:28084px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对象或未使用</span></div>
<div class="txt" style="position:absolute; left:76px; top:28159px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Heap-based mode is also called </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">free mode. </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This is the fully</span></div>
<div class="txt" style="position:absolute; left:112px; top:28209px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">dynamic mode in which objects are created dynamically through</span></div>
<div class="txt" style="position:absolute; left:112px; top:28252px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">explicit requests. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">也称为自由模式，可通过显式请求动态创建对象的</span></div>
<div class="txt" style="position:absolute; left:112px; top:28300px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">完全动态模式。</span></div>
<div class="txt" style="position:absolute; left:76px; top:28375px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An entity may become successively attached to any number of</span></div>
<div class="txt" style="position:absolute; left:112px; top:28425px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">objects; the pattern of object creations is usually not predictable at</span></div>
<div class="txt" style="position:absolute; left:112px; top:28473px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">compile time. Objects may, furthermore, contain references to</span></div>
<div class="txt" style="position:absolute; left:112px; top:28519px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">other objects. </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">一个</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">entity</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">可先后</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">attached</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">任意数量的对象</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">; </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象创建的模式</span></div>
<div class="txt" style="position:absolute; left:112px; top:28564px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">在编译时通常是不可预测的， 对象还可以包含对其他对象的引用。</span></div>
<div class="txt" style="position:absolute; left:76px; top:28633px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The free mode allows developers to create the sophisticated</span></div>
<div class="txt" style="position:absolute; left:112px; top:28679px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">dynamic data structures. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">支持创建复杂的动态数据结构。</span></div>
<img id="background" style="position:absolute; left:0px; top:28898px;" width="1440" height="1080" src="page25.png"> <img id="background" style="position:absolute; left:1440px; top:28898px;" width="1440" height="1080" src="page-000025.png">
<div class="txt" style="position:absolute; left:426px; top:28915px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:29005px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Heap-based mode</span></div>
<img id="background" style="position:absolute; left:0px; top:30100px;" width="1440" height="1080" src="page26.png"> <img id="background" style="position:absolute; left:1440px; top:30100px;" width="1440" height="1080" src="page-000026.png">
<div class="txt" style="position:absolute; left:426px; top:30117px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:30207px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Three modes of object management</span></div>
<div class="txt" style="position:absolute; left:76px; top:30347px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Some applications can manage with a bounded amount of memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:30392px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">using static allocation combined with stack allocation. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">某些程序利用</span></div>
<div class="txt" style="position:absolute; left:112px; top:30440px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">静态和</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">stack</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">分配结合的方式</span></div>
<div class="txt" style="position:absolute; left:76px; top:30512px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Others use dynamic allocation of memory because: </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">有些利用动态分配</span></div>
<div class="txt" style="position:absolute; left:112px; top:30582px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Some objects live longer than the method that creates them.</span></div>
<div class="txt" style="position:absolute; left:112px; top:30642px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Recursive data structures such as lists and trees.</span></div>
<div class="txt" style="position:absolute; left:112px; top:30703px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Avoids fixed hard limits on data structure sizes.</span></div>
<img id="background" style="position:absolute; left:0px; top:31302px;" width="1440" height="1080" src="page27.png"> <img id="background" style="position:absolute; left:1440px; top:31302px;" width="1440" height="1080" src="page-000027.png">
<div class="txt" style="position:absolute; left:1105px; top:31320px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:366px; top:31717px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">3 Java Memory Model</span></div>
<img id="background" style="position:absolute; left:0px; top:32504px;" width="1440" height="1080" src="page28.png"> <img id="background" style="position:absolute; left:1440px; top:32504px;" width="1440" height="1080" src="page-000028.png">
<div class="txt" style="position:absolute; left:426px; top:32521px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:48px; top:32611px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory in Java</span></div>
<div class="txt" style="position:absolute; left:76px; top:32751px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Java memory model specifies how the Java virtual machine (JVM)</span></div>
<div class="txt" style="position:absolute; left:112px; top:32801px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">works with the computer's memory (RAM).</span></div>
<div class="txt" style="position:absolute; left:76px; top:32871px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">JVM is a model of a whole computer so this model naturally includes a</span></div>
<div class="txt" style="position:absolute; left:112px; top:32921px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory model (Java memory model).</span></div>
<div class="txt" style="position:absolute; left:112px; top:32982px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">New objects created and placed in the heap. </span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象创建在</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">heap</span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中</span></div>
<div class="txt" style="position:absolute; left:112px; top:33046px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Once your application have no reference anymore to an object the Java</span></div>
<div class="txt" style="position:absolute; left:148px; top:33089px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collector is allowed to delete this object and remove the memory so</span></div>
<div class="txt" style="position:absolute; left:148px; top:33129px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that your application can use this memory again. </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Java</span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">支持对象的自动回收</span></div>
<div class="txt" style="position:absolute; left:76px; top:33270px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The original Java memory model was insufficient, so the Java memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:33320px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">model was revised in Java 1.5.</span></div>
<div class="txt" style="position:absolute; left:76px; top:33390px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This version of the Java memory model is still in use in Java 8.</span></div>
<img id="background" style="position:absolute; left:0px; top:33706px;" width="1440" height="1080" src="page29.png"> <img id="background" style="position:absolute; left:1440px; top:33706px;" width="1440" height="1080" src="page-000029.png">
<div class="txt" style="position:absolute; left:426px; top:33723px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:33813px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The Internal Java Memory Model</span></div>
<div class="txt" style="position:absolute; left:76px; top:33953px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Java memory model used internally in the JVM divides</span></div>
<div class="txt" style="position:absolute; left:112px; top:34003px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory between </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">thread stacks and the heap.</span></div>
<img id="background" style="position:absolute; left:0px; top:34908px;" width="1440" height="1080" src="page30.png"> <img id="background" style="position:absolute; left:1440px; top:34908px;" width="1440" height="1080" src="page-000030.png">
<div class="txt" style="position:absolute; left:426px; top:34925px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:35015px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The Internal Java Memory Model: </span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(255,0,0,1);">Stack</span></div>
<div class="txt" style="position:absolute; left:65px; top:35144px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Each thread running in JVM has its own thread stack. </span><span id="f17" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,255,1);">每个线程有自己的栈</span></div>
<div class="txt" style="position:absolute; left:101px; top:35210px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The thread stack contains information about what methods the thread has</span></div>
<div class="txt" style="position:absolute; left:137px; top:35254px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">called to reach the current point of execution.</span></div>
<div class="txt" style="position:absolute; left:101px; top:35314px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It is called "call stack". As the thread executes its code, the call stack</span></div>
<div class="txt" style="position:absolute; left:137px; top:35357px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">changes.</span></div>
<div class="txt" style="position:absolute; left:65px; top:35423px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The thread stack also contains all local variables for each method</span></div>
<div class="txt" style="position:absolute; left:101px; top:35468px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">being executed (all methods on the call stack). </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">栈中包含所有方法的</span></div>
<div class="txt" style="position:absolute; left:101px; top:35516px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">局部变量</span></div>
<div class="txt" style="position:absolute; left:101px; top:35585px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A thread can only access it‘s own thread stack. </span><span id="f17" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">线程只能访问自己的线程栈</span></div>
<div class="txt" style="position:absolute; left:101px; top:35646px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Local variables created by a thread are invisible to all other threads than</span></div>
<div class="txt" style="position:absolute; left:137px; top:35688px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the thread who created it. </span><span id="f17" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">线程创建的局部变量其他线程不可见</span></div>
<div class="txt" style="position:absolute; left:101px; top:35750px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Even if two threads are executing the exact same code, the two threads</span></div>
<div class="txt" style="position:absolute; left:137px; top:35793px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">will still create the local variables of that code in each their own thread</span></div>
<div class="txt" style="position:absolute; left:137px; top:35835px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">stack. </span><span id="f17" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">即使两个线程的代码一样，创建的同名变量仍然在各自的栈中</span></div>
<div class="txt" style="position:absolute; left:101px; top:35896px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Thus, each thread has its own version of each local variable. </span><span id="f17" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">每个线程有自己</span></div>
<div class="txt" style="position:absolute; left:137px; top:35936px;"><span id="f17" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">版本的局部变量</span></div>
<img id="background" style="position:absolute; left:0px; top:36110px;" width="1440" height="1080" src="page31.png"> <img id="background" style="position:absolute; left:1440px; top:36110px;" width="1440" height="1080" src="page-000031.png">
<div class="txt" style="position:absolute; left:426px; top:36127px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:36217px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The Internal Java Memory Model: </span><span id="f11" style="font-size:60px;vertical-align:baseline;color:rgba(255,0,0,1);">Heap</span></div>
<div class="txt" style="position:absolute; left:76px; top:36357px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">All local variables of primitive types (boolean, byte, short, char, int,</span></div>
<div class="txt" style="position:absolute; left:112px; top:36407px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">long, float, double) are fully stored on the thread stack and are thus</span></div>
<div class="txt" style="position:absolute; left:112px; top:36450px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">not visible to other threads. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">基本类型的局部变量保存在线程栈中</span></div>
<div class="txt" style="position:absolute; left:76px; top:36525px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">One thread may pass a copy of a primitive variable to another</span></div>
<div class="txt" style="position:absolute; left:112px; top:36570px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">thread, but it cannot share the primitive local variable itself.</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">一个线程</span></div>
<div class="txt" style="position:absolute; left:112px; top:36621px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可能会将基本类型变量的副本传递给另一个线程，但它本身不能共享</span></div>
<div class="txt" style="position:absolute; left:112px; top:36666px;"><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">基本类型局部变量。</span></div>
<div class="txt" style="position:absolute; left:76px; top:36741px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">The heap contains all objects created in your Java application,</span></div>
<div class="txt" style="position:absolute; left:112px; top:36789px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">regardless of what thread created the object. </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象类型数据保存在堆中</span></div>
<div class="txt" style="position:absolute; left:76px; top:36861px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This includes the object versions of the primitive types (e.g. Byte,</span></div>
<div class="txt" style="position:absolute; left:112px; top:36911px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Integer, Long, etc).</span></div>
<div class="txt" style="position:absolute; left:76px; top:36981px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It does not matter if an object was created and assigned to a local</span></div>
<div class="txt" style="position:absolute; left:112px; top:37031px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">variable, or created as a member variable of another object, the object</span></div>
<div class="txt" style="position:absolute; left:112px; top:37077px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is still stored on the heap. </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">如果对象被指派到某个局部变量，或者作为其</span></div>
<div class="txt" style="position:absolute; left:112px; top:37122px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">他对象的成员变量，创建的对象仍然在堆中。</span></div>
<img id="background" style="position:absolute; left:0px; top:37312px;" width="1440" height="1080" src="page32.png"> <img id="background" style="position:absolute; left:1440px; top:37312px;" width="1440" height="1080" src="page-000032.png">
<div class="txt" style="position:absolute; left:426px; top:37329px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:37419px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Some key points about Java Memory Model</span></div>
<div class="txt" style="position:absolute; left:56px; top:37548px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A local variable may be of a primitive type, in which case it is totally kept</span></div>
<div class="txt" style="position:absolute; left:92px; top:37593px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">on the thread stack</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">基本数据类型的局部变量保存在线程栈中</span></div>
<div class="txt" style="position:absolute; left:56px; top:37668px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A local variable may also be a reference to an object. In that case the</span></div>
<div class="txt" style="position:absolute; left:92px; top:37717px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reference (the local variable) is stored on the thread stack, but the object</span></div>
<div class="txt" style="position:absolute; left:92px; top:37761px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">itself if stored on the heap</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">局部变量引用了对象，引用保存在栈中，对象</span></div>
<div class="txt" style="position:absolute; left:92px; top:37809px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">本身存储在堆中</span></div>
<div class="txt" style="position:absolute; left:56px; top:37884px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An object may contain methods and these methods may contain local</span></div>
<div class="txt" style="position:absolute; left:92px; top:37933px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">variables. These local variables are also stored on the thread stack, even if</span></div>
<div class="txt" style="position:absolute; left:92px; top:37977px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the object that the method belongs to is stored on the heap</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对象包含的方</span></div>
<div class="txt" style="position:absolute; left:92px; top:38025px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">法和方法包含的局部变量存储在栈中</span></div>
<div class="txt" style="position:absolute; left:56px; top:38100px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f39" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An object‘s member variables are stored on the heap along with the</span></div>
<div class="txt" style="position:absolute; left:92px; top:38149px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">object itself. That is true both when the member variable is of a primitive</span></div>
<div class="txt" style="position:absolute; left:92px; top:38197px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">type, and if it is a reference to an object. </span><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">对象的成员变量同对象一起存储在堆中，</span></div>
<div class="txt" style="position:absolute; left:92px; top:38240px;"><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">不论成员变量的类型是基本类型还是对象类型</span><span id="f15" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">对其他对象的引用</span><span id="f15" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:56px; top:38305px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Static class variables are also stored on the heap along with the class</span></div>
<div class="txt" style="position:absolute; left:92px; top:38354px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">definition</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">静态的类变量同类的定义一起保存在堆中</span></div>
<img id="background" style="position:absolute; left:0px; top:38514px;" width="1440" height="1080" src="page33.png"> <img id="background" style="position:absolute; left:1440px; top:38514px;" width="1440" height="1080" src="page-000033.png">
<div class="txt" style="position:absolute; left:426px; top:38531px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:38621px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Some key points about Java Memory Model</span></div>
<div class="txt" style="position:absolute; left:76px; top:38761px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects on the heap can be accessed by all threads that have a</span></div>
<div class="txt" style="position:absolute; left:112px; top:38806px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">reference to the object. </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">堆中的对象可以被所有拥有引用的线程访问</span></div>
<div class="txt" style="position:absolute; left:76px; top:38881px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When a thread has access to an object, it can also get access to that</span></div>
<div class="txt" style="position:absolute; left:112px; top:38931px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">object's member variables.</span></div>
<div class="txt" style="position:absolute; left:76px; top:39001px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If two threads call a method on the same object at the same time,</span></div>
<div class="txt" style="position:absolute; left:112px; top:39051px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">they will both have access to</span></div>
<div class="txt" style="position:absolute; left:112px; top:39099px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the object's member variables,</span></div>
<div class="txt" style="position:absolute; left:112px; top:39147px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">but each thread will have its</span></div>
<div class="txt" style="position:absolute; left:112px; top:39195px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">own copy of the local variables.</span></div>
<div class="txt" style="position:absolute; left:144px; top:39259px;"><span id="f16" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">如果两个线程同时调用同一个对</span></div>
<div class="txt" style="position:absolute; left:144px; top:39298px;"><span id="f16" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">象上的一个方法，它们都可以访</span></div>
<div class="txt" style="position:absolute; left:144px; top:39336px;"><span id="f16" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">问该对象的成员变量，但是每个</span></div>
<div class="txt" style="position:absolute; left:144px; top:39372px;"><span id="f16" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">线程都有自己的局部变量副本。</span></div>
<img id="background" style="position:absolute; left:0px; top:39716px;" width="1440" height="1080" src="page34.png"> <img id="background" style="position:absolute; left:1440px; top:39716px;" width="1440" height="1080" src="page-000034.png">
<div class="txt" style="position:absolute; left:426px; top:39733px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:39823px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory Structure of Java Virtual Machine (JVM)</span></div>
<div class="txt" style="position:absolute; left:76px; top:39963px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Stacks</span></div>
<div class="txt" style="position:absolute; left:76px; top:40035px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Native Stacks</span></div>
<div class="txt" style="position:absolute; left:76px; top:40107px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Heap</span></div>
<div class="txt" style="position:absolute; left:76px; top:40179px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Program Counter Register (PC)</span></div>
<div class="txt" style="position:absolute; left:76px; top:40251px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Method Area</span></div>
<img id="background" style="position:absolute; left:0px; top:40918px;" width="1440" height="1080" src="page35.png"> <img id="background" style="position:absolute; left:1440px; top:40918px;" width="1440" height="1080" src="page-000035.png">
<div class="txt" style="position:absolute; left:426px; top:40935px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:41025px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory Structure of Java Virtual Machine (JVM)</span></div>
<div class="txt" style="position:absolute; left:76px; top:41165px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The stack is used to:</span></div>
<div class="txt" style="position:absolute; left:112px; top:41232px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Pass arguments to methods</span></div>
<div class="txt" style="position:absolute; left:112px; top:41292px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Return a result from a method</span></div>
<div class="txt" style="position:absolute; left:112px; top:41353px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Store intermediate results while evaluating expressions</span></div>
<div class="txt" style="position:absolute; left:112px; top:41413px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Store local variables</span></div>
<div class="txt" style="position:absolute; left:76px; top:41479px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The heap is used to:</span></div>
<div class="txt" style="position:absolute; left:112px; top:41546px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects</span></div>
<div class="txt" style="position:absolute; left:112px; top:41606px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Arrays</span></div>
<div class="txt" style="position:absolute; left:112px; top:41666px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">By using “</span><span id="f39" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">new</span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">” operators</span></div>
<img id="background" style="position:absolute; left:0px; top:42120px;" width="1440" height="1080" src="page36.png"> <img id="background" style="position:absolute; left:1440px; top:42120px;" width="1440" height="1080" src="page-000036.png">
<div class="txt" style="position:absolute; left:426px; top:42137px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:42227px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory Structure of Java Virtual Machine (JVM)</span></div>
<div class="txt" style="position:absolute; left:76px; top:42364px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Native Stacks </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">本地方法栈</span></div>
<div class="txt" style="position:absolute; left:112px; top:42434px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Manage native methods( coded in C) used by JVM</span></div>
<div class="txt" style="position:absolute; left:76px; top:42497px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Program Counter Register (PC) </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">程序计数器</span></div>
<div class="txt" style="position:absolute; left:112px; top:42566px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If the current thread is executing a java method, PC records the Java</span></div>
<div class="txt" style="position:absolute; left:148px; top:42609px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">bytecode address of the executed method.</span></div>
<div class="txt" style="position:absolute; left:112px; top:42670px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If the current thread is executing a native method, PC is empty.</span></div>
<div class="txt" style="position:absolute; left:76px; top:42733px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Method Area </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法区</span></div>
<div class="txt" style="position:absolute; left:112px; top:42802px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The method area is also called </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">the permanent area</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">. It mainly contains the</span></div>
<div class="txt" style="position:absolute; left:148px; top:42846px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">definition information of </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">constants and classes</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<img id="background" style="position:absolute; left:0px; top:43322px;" width="1440" height="1080" src="page37.png"> <img id="background" style="position:absolute; left:1440px; top:43322px;" width="1440" height="1080" src="page-000037.png">
<div class="txt" style="position:absolute; left:426px; top:43339px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:43429px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory Structure of Java Virtual Machine (JVM)</span></div>
<div class="txt" style="position:absolute; left:76px; top:43569px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Besides OO concepts, JVM also supports multi-threading. Threads</span></div>
<div class="txt" style="position:absolute; left:112px; top:43619px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">are directly supported by the JVM.</span></div>
<div class="txt" style="position:absolute; left:76px; top:43689px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Two kinds of runtime data areas:</span></div>
<div class="txt" style="position:absolute; left:112px; top:43756px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Shared between all threads</span></div>
<div class="txt" style="position:absolute; left:112px; top:43816px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Private to a single thread</span></div>
<div class="txt" style="position:absolute; left:744px; top:43796px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">To be discussed detailedly in Chapter 10</span></div>
<div class="txt" style="position:absolute; left:312px; top:43932px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Shared</span></div>
<div class="txt" style="position:absolute; left:235px; top:44060px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage Collected</span></div>
<div class="txt" style="position:absolute; left:342px; top:44103px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Heap</span></div>
<div class="txt" style="position:absolute; left:280px; top:44247px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Method area</span></div>
<div class="txt" style="position:absolute; left:691px; top:43932px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Thread </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">i</span></div>
<div class="txt" style="position:absolute; left:640px; top:44018px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">pc</span></div>
<div class="txt" style="position:absolute; left:1070px; top:43932px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Thread </span><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">j</span></div>
<div class="txt" style="position:absolute; left:999px; top:44018px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">pc</span></div>
<div class="txt" style="position:absolute; left:659px; top:44160px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Java</span></div>
<div class="txt" style="position:absolute; left:652px; top:44203px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack</span></div>
<div class="txt" style="position:absolute; left:795px; top:44138px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Native</span></div>
<div class="txt" style="position:absolute; left:787px; top:44182px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Method</span></div>
<div class="txt" style="position:absolute; left:801px; top:44225px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack</span></div>
<div class="txt" style="position:absolute; left:1018px; top:44160px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Java</span></div>
<div class="txt" style="position:absolute; left:1011px; top:44203px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack</span></div>
<div class="txt" style="position:absolute; left:1155px; top:44138px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Native</span></div>
<div class="txt" style="position:absolute; left:1146px; top:44182px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Method</span></div>
<div class="txt" style="position:absolute; left:1161px; top:44225px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Stack</span></div>
<img id="background" style="position:absolute; left:0px; top:44524px;" width="1440" height="1080" src="page38.png"> <img id="background" style="position:absolute; left:1440px; top:44524px;" width="1440" height="1080" src="page-000038.png">
<div class="txt" style="position:absolute; left:1105px; top:44542px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:386px; top:44939px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">4 Garbage Collection</span></div>
<img id="background" style="position:absolute; left:0px; top:45726px;" width="1440" height="1080" src="page39.png"> <img id="background" style="position:absolute; left:1440px; top:45726px;" width="1440" height="1080" src="page-000039.png">
<div class="txt" style="position:absolute; left:426px; top:45743px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:45833px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Space reclamation in static modes</span></div>
<div class="txt" style="position:absolute; left:76px; top:45970px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the static mode, the problem does not exist: </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">静态模式中不存在内</span></div>
<div class="txt" style="position:absolute; left:112px; top:46018px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">存空间回收问题</span></div>
<div class="txt" style="position:absolute; left:112px; top:46088px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For every object, there is exactly one attached entity;</span></div>
<div class="txt" style="position:absolute; left:112px; top:46148px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Execution needs to retain the object’s space as long as the entity is active.</span></div>
<div class="txt" style="position:absolute; left:112px; top:46209px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">So there is no possibility for reclamation in the proper sense.</span></div>
<div class="txt" style="position:absolute; left:76px; top:46346px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The ability to create objects dynamically, as in the stack-based and</span></div>
<div class="txt" style="position:absolute; left:112px; top:46392px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">heap-based modes, raises the question: </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">动态模式</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(stack-based,</span></div>
<div class="txt" style="position:absolute; left:112px; top:46440px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">heap-based)</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">则需要考虑内存空间回收问题</span></div>
<div class="txt" style="position:absolute; left:112px; top:46509px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">What to do when an object becomes unused: is it possible to reclaim its</span></div>
<div class="txt" style="position:absolute; left:148px; top:46552px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">memory space, so as to use it again for one or more new objects in later</span></div>
<div class="txt" style="position:absolute; left:148px; top:46596px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">creation instructions?</span></div>
<img id="background" style="position:absolute; left:0px; top:46928px;" width="1440" height="1080" src="page40.png"> <img id="background" style="position:absolute; left:1440px; top:46928px;" width="1440" height="1080" src="page-000040.png">
<div class="txt" style="position:absolute; left:426px; top:46945px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:47035px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Space reclamation in stack-based modes</span></div>
<div class="txt" style="position:absolute; left:76px; top:47175px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">With the stack-based mode, the objects attached to an entity may</span></div>
<div class="txt" style="position:absolute; left:112px; top:47225px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">be allocated on a stack.</span></div>
<div class="txt" style="position:absolute; left:112px; top:47290px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Block-structured language make things particularly simple: object</span></div>
<div class="txt" style="position:absolute; left:148px; top:47333px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocation occurs at the same time for all entities declared in a given block,</span></div>
<div class="txt" style="position:absolute; left:148px; top:47372px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allowing the use of a single stack for a whole program. </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">基于块结构的语言</span></div>
<div class="txt" style="position:absolute; left:148px; top:47418px;"><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中：在给定块中声明的所有实体同时发生对象分配，从而允许为整个程序</span></div>
<div class="txt" style="position:absolute; left:148px; top:47459px;"><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">使用单个堆栈。</span></div>
<img id="background" style="position:absolute; left:0px; top:48130px;" width="1440" height="1080" src="page41.png"> <img id="background" style="position:absolute; left:1440px; top:48130px;" width="1440" height="1080" src="page-000041.png">
<div class="txt" style="position:absolute; left:426px; top:48147px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:48237px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Space reclamation in heap-based (free) modes</span></div>
<div class="txt" style="position:absolute; left:76px; top:48377px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">With the free mode, things cease to be so simple.</span></div>
<div class="txt" style="position:absolute; left:76px; top:48449px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The problem comes from the very power of the mechanism: since</span></div>
<div class="txt" style="position:absolute; left:112px; top:48499px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the pattern of object creation is unknown at compile time, it is not</span></div>
<div class="txt" style="position:absolute; left:112px; top:48547px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">possible to predict when a given object may become useless. </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Heap</span></div>
<div class="txt" style="position:absolute; left:112px; top:48590px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">模式中，对象的创建在编译时未知，所以无法预测对象何时无用</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可回</span></div>
<div class="txt" style="position:absolute; left:112px; top:48638px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">收</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<img id="background" style="position:absolute; left:0px; top:49332px;" width="1440" height="1080" src="page42.png"> <img id="background" style="position:absolute; left:1440px; top:49332px;" width="1440" height="1080" src="page-000042.png">
<div class="txt" style="position:absolute; left:426px; top:49349px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:49439px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Reachable Objects vs. Unreachable Objects</span></div>
<div class="txt" style="position:absolute; left:76px; top:49579px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">At any point during the execution of a system, </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">the set of origins /</span></div>
<div class="txt" style="position:absolute; left:112px; top:49629px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">roots </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is made of the following objects:</span></div>
<div class="txt" style="position:absolute; left:112px; top:49694px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The system’s root object.</span></div>
<div class="txt" style="position:absolute; left:112px; top:49754px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Any object attached to a local entity or formal argument of a routine</span></div>
<div class="txt" style="position:absolute; left:148px; top:49797px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">currently being executed (including the local entity result for a function).</span></div>
<div class="txt" style="position:absolute; left:112px; top:49854px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">根集合由系统的</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">root</span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象以及局部</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">entity</span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">、子程序的参数或返回值构成</span></div>
<div class="txt" style="position:absolute; left:76px; top:49921px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">What are the roots of a computation? </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Root</span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的确定是语言相关的</span></div>
<div class="txt" style="position:absolute; left:112px; top:49990px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Determining roots is, in general, language-dependent</span></div>
<div class="txt" style="position:absolute; left:112px; top:50051px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Depends on the run-time structure defined by the underlying language.</span></div>
<div class="txt" style="position:absolute; left:76px; top:50116px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In common language implementations roots include</span></div>
<div class="txt" style="position:absolute; left:112px; top:50183px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Words in the </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">static area</span></div>
<div class="txt" style="position:absolute; left:112px; top:50244px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Registers</span></div>
<div class="txt" style="position:absolute; left:112px; top:50304px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Words on the </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">execution stack </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that point into the heap.</span></div>
<img id="background" style="position:absolute; left:0px; top:50534px;" width="1440" height="1080" src="page43.png"> <img id="background" style="position:absolute; left:1440px; top:50534px;" width="1440" height="1080" src="page-000043.png">
<div class="txt" style="position:absolute; left:426px; top:50551px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:50641px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The roots of a computation</span></div>
<div class="txt" style="position:absolute; left:76px; top:50781px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Any dependent, direct or indirect, of these origins/roots is</span></div>
<div class="txt" style="position:absolute; left:112px; top:50831px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">reachable, </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and any other object is </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">unreachable:</span></div>
<div class="txt" style="position:absolute; left:112px; top:50896px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For an unreachable object, it is possible to reclaim the memory it occupies</span></div>
<div class="txt" style="position:absolute; left:148px; top:50939px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(for example to recycle it for other objects) without affecting the correct</span></div>
<div class="txt" style="position:absolute; left:148px; top:50982px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">semantics of the system’s execution</span></div>
<div class="txt" style="position:absolute; left:76px; top:51048px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The first step towards addressing the problem of memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:51098px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">management under the free mode is </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">to separate the reachable</span></div>
<div class="txt" style="position:absolute; left:112px; top:51141px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">objects from the unreachable ones. </span><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">free</span><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">模式下管理内存，第一步</span></div>
<div class="txt" style="position:absolute; left:112px; top:51189px;"><span id="f31" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">是区分可达对象和不可达对象</span></div>
<img id="background" style="position:absolute; left:0px; top:51736px;" width="1440" height="1080" src="page44.png"> <img id="background" style="position:absolute; left:1440px; top:51736px;" width="1440" height="1080" src="page-000044.png">
<div class="txt" style="position:absolute; left:426px; top:51753px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:51843px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Live objects vs. dead objects</span></div>
<div class="txt" style="position:absolute; left:76px; top:51983px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The objects and references can be considered a directed graph:</span></div>
<div class="txt" style="position:absolute; left:112px; top:52050px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The live objects of the graph are those reachable from a root.</span></div>
<div class="txt" style="position:absolute; left:112px; top:52110px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The process executing a computation is </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">called the mutator </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">because it is</span></div>
<div class="txt" style="position:absolute; left:148px; top:52149px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">viewed as dynamically changing the object graph. </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">执行计算的过程称为变</span></div>
<div class="txt" style="position:absolute; left:148px; top:52193px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">化器，因为它在动态更改对象图。</span></div>
<div class="txt" style="position:absolute; left:976px; top:52324px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Live objects (in color)</span></div>
<div class="txt" style="position:absolute; left:987px; top:52367px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and dead objects (in</span></div>
<div class="txt" style="position:absolute; left:981px; top:52410px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">black) in a combined</span></div>
<div class="txt" style="position:absolute; left:984px; top:52454px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">stack-based and free</span></div>
<div class="txt" style="position:absolute; left:1096px; top:52497px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">model</span></div>
<img id="background" style="position:absolute; left:0px; top:52938px;" width="1440" height="1080" src="page45.png"> <img id="background" style="position:absolute; left:1440px; top:52938px;" width="1440" height="1080" src="page-000045.png">
<div class="txt" style="position:absolute; left:426px; top:52955px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:53045px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Tracing reachable/unreachable objects</span></div>
<div class="txt" style="position:absolute; left:76px; top:53185px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">We can formalize our definition of reachability:</span></div>
<div class="txt" style="position:absolute; left:87px; top:53259px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">live = { N </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);"> </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects | (</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);"> </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">r </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);"> </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Roots . r </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">→ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">N) </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);"> </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);"> </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">M </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);"> </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">live . M </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">→ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">N) }</span></div>
<div class="txt" style="position:absolute; left:76px; top:53401px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">We can encode this definition simply:</span></div>
<div class="txt" style="position:absolute; left:112px; top:53468px;"><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Step1: Start at the roots; the live set is empty</span></div>
<div class="txt" style="position:absolute; left:112px; top:53528px;"><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Step2: Add any object that a root points at to the live set</span></div>
<div class="txt" style="position:absolute; left:112px; top:53589px;"><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Step3: Repeat</span></div>
<div class="txt" style="position:absolute; left:256px; top:53632px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Add any object a live object points at to the live set</span></div>
<div class="txt" style="position:absolute; left:256px; top:53675px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Until no new live objects are found</span></div>
<div class="txt" style="position:absolute; left:112px; top:53736px;"><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Step4: Any objects not in the live set are garbage</span></div>
<img id="background" style="position:absolute; left:0px; top:54140px;" width="1440" height="1080" src="page46.png"> <img id="background" style="position:absolute; left:1440px; top:54140px;" width="1440" height="1080" src="page-000046.png">
<div class="txt" style="position:absolute; left:426px; top:54157px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:54247px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">What is garbage?</span></div>
<div class="txt" style="position:absolute; left:76px; top:54387px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Almost all garbage collectors assume the following definition of</span></div>
<div class="txt" style="position:absolute; left:112px; top:54437px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">live objects called </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">liveness by reachability: </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">if you can get to an</span></div>
<div class="txt" style="position:absolute; left:112px; top:54480px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">object, then it is live. </span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">如果一个对象是可达的，则为存活对象。</span></div>
<div class="txt" style="position:absolute; left:76px; top:54627px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">More formally, an object is live if and only if:</span></div>
<div class="txt" style="position:absolute; left:112px; top:54690px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">It is referenced in a predefined variable called a root, </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">被</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">root</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中的对象指向</span></div>
<div class="txt" style="position:absolute; left:112px; top:54754px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Or, it is referenced in a variable contained in a live object (i.e. it is</span></div>
<div class="txt" style="position:absolute; left:148px; top:54793px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">transitively referenced from a root). </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">被</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">live</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中的对象指向</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">从</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">root</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">间接指向</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:76px; top:54935px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Non-live objects are called </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">dead objects, </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">i.e. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">garbage.</span></div>
<img id="background" style="position:absolute; left:0px; top:55342px;" width="1440" height="1080" src="page47.png"> <img id="background" style="position:absolute; left:1440px; top:55342px;" width="1440" height="1080" src="page-000047.png">
<div class="txt" style="position:absolute; left:426px; top:55359px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:55449px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:55589px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Identifying garbage and deallocating the memory it occupies is</span></div>
<div class="txt" style="position:absolute; left:112px; top:55639px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">called </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Garbage Collection(GC).</span></div>
<div class="txt" style="position:absolute; left:76px; top:55781px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Why is garbage collection needed?</span></div>
<div class="txt" style="position:absolute; left:112px; top:55848px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Language requirement</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: many OO languages assume GC, e.g. allocated</span></div>
<div class="txt" style="position:absolute; left:148px; top:55891px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objects may survive much longer than the method that created them</span></div>
<div class="txt" style="position:absolute; left:112px; top:55951px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Problem requirement</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: the nature of the problem may make it very</span></div>
<div class="txt" style="position:absolute; left:148px; top:55995px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">hard/impossible to determine when something is garbage</span></div>
<img id="background" style="position:absolute; left:0px; top:56544px;" width="1440" height="1080" src="page48.png"> <img id="background" style="position:absolute; left:1440px; top:56544px;" width="1440" height="1080" src="page-000048.png">
<div class="txt" style="position:absolute; left:426px; top:56561px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:56651px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:56791px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">We can try to handle the garbage collection housekeeping chores</span></div>
<div class="txt" style="position:absolute; left:112px; top:56841px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">related to object allocation and deallocation ourselves.</span></div>
<div class="txt" style="position:absolute; left:76px; top:56983px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Such housekeeping can be simple but for many applications the</span></div>
<div class="txt" style="position:absolute; left:112px; top:57033px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">chores become complex </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and error prone.</span></div>
<div class="txt" style="position:absolute; left:76px; top:57175px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Can we do it ourselves?</span></div>
<div class="txt" style="position:absolute; left:76px; top:57247px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Should it be automatic??</span></div>
<img id="background" style="position:absolute; left:0px; top:57746px;" width="1440" height="1080" src="page49.png"> <img id="background" style="position:absolute; left:1440px; top:57746px;" width="1440" height="1080" src="page-000049.png">
<div class="txt" style="position:absolute; left:1105px; top:57764px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:240px; top:58161px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Living without Automatic GC</span></div>
<img id="background" style="position:absolute; left:0px; top:58948px;" width="1440" height="1080" src="page50.png"> <img id="background" style="position:absolute; left:1440px; top:58948px;" width="1440" height="1080" src="page-000050.png">
<div class="txt" style="position:absolute; left:426px; top:58965px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:59055px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Living without automatic GC: Doing it yourself</span></div>
<div class="txt" style="position:absolute; left:76px; top:59195px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Defensive programming</span></div>
<div class="txt" style="position:absolute; left:76px; top:59267px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Pairing Principle</span></div>
<div class="txt" style="position:absolute; left:76px; top:59339px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Ownership concept</span></div>
<div class="txt" style="position:absolute; left:76px; top:59411px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Monitoring technique</span></div>
<div class="txt" style="position:absolute; left:76px; top:59483px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Administrator technique</span></div>
<div class="txt" style="position:absolute; left:76px; top:59555px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Tools</span></div>
<img id="background" style="position:absolute; left:0px; top:60150px;" width="1440" height="1080" src="page51.png"> <img id="background" style="position:absolute; left:1440px; top:60150px;" width="1440" height="1080" src="page-000051.png">
<div class="txt" style="position:absolute; left:426px; top:60167px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:60257px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Defensive programming</span></div>
<div class="txt" style="position:absolute; left:76px; top:60397px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Defensive strategies for doing without GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:60541px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Sharing:</span></div>
<div class="txt" style="position:absolute; left:112px; top:60608px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying objects instead of sharing (defensive copying)</span></div>
<div class="txt" style="position:absolute; left:112px; top:60668px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Transform a global deallocation decision to a local one</span></div>
<div class="txt" style="position:absolute; left:76px; top:60806px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Can be wasteful of space, but can be useful.</span></div>
<div class="txt" style="position:absolute; left:76px; top:60950px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Example:</span></div>
<div class="txt" style="position:absolute; left:112px; top:61017px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Everyone gets their own set of lights: turn your lights off when leaving.</span></div>
<div class="txt" style="position:absolute; left:148px; top:61056px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(Simple, but obviously wasteful.) </span><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">每个人拥有自己的灯光系统，自己负责自</span></div>
<div class="txt" style="position:absolute; left:148px; top:61099px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">己灯光的开关</span></div>
<img id="background" style="position:absolute; left:0px; top:61352px;" width="1440" height="1080" src="page52.png"> <img id="background" style="position:absolute; left:1440px; top:61352px;" width="1440" height="1080" src="page-000052.png">
<div class="txt" style="position:absolute; left:426px; top:61369px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:61459px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Pairing Principle</span></div>
<div class="txt" style="position:absolute; left:76px; top:61599px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For each </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">new() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">pair it with a </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">delete()</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, make sure there is a one-to-</span></div>
<div class="txt" style="position:absolute; left:112px; top:61649px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">one correspondence.</span></div>
<div class="txt" style="position:absolute; left:76px; top:61719px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For every </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">new() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">check that the corresponding </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">delete() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is there.</span></div>
<div class="txt" style="position:absolute; left:76px; top:61791px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">One way is to have the allocating object also be the deallocating</span></div>
<div class="txt" style="position:absolute; left:112px; top:61836px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">object. </span><span id="f34" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">一种策略：让产生内存分配的对象也作为释放该内存的对象</span></div>
<div class="txt" style="position:absolute; left:76px; top:61911px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Example</span></div>
<div class="txt" style="position:absolute; left:112px; top:61974px;"><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If you turned the light on, YOU turn it off. </span><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">谁开的灯，谁负责关闭</span></div>
<div class="txt" style="position:absolute; left:112px; top:62038px;"><span id="f38" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Allocate in the constructor; deallocate in the destructor.</span></div>
<div class="txt" style="position:absolute; left:414px; top:62133px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Class A {</span></div>
<div class="txt" style="position:absolute; left:474px; top:62176px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Xclass X;</span></div>
<div class="txt" style="position:absolute; left:474px; top:62219px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">void A() { X = new Xclass;}</span></div>
<div class="txt" style="position:absolute; left:474px; top:62262px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">void ~A() { delete X;}</span></div>
<div class="txt" style="position:absolute; left:474px; top:62306px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">...</span></div>
<div class="txt" style="position:absolute; left:414px; top:62349px;"><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:62554px;" width="1440" height="1080" src="page53.png"> <img id="background" style="position:absolute; left:1440px; top:62554px;" width="1440" height="1080" src="page-000053.png">
<div class="txt" style="position:absolute; left:426px; top:62571px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:62661px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Ownership Concept</span></div>
<div class="txt" style="position:absolute; left:76px; top:62801px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Observation: Objects are often passed around</span></div>
<div class="txt" style="position:absolute; left:112px; top:62868px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Thus it is often an object other than the creator who must do the</span></div>
<div class="txt" style="position:absolute; left:148px; top:62911px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">deallocation.</span></div>
<div class="txt" style="position:absolute; left:76px; top:62977px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Ownership Concept</span></div>
<div class="txt" style="position:absolute; left:112px; top:63043px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Initially, the allocating object is the owner of the newly allocated object.</span></div>
<div class="txt" style="position:absolute; left:148px; top:63087px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When passing a reference to the allocated object, the ownership can also</span></div>
<div class="txt" style="position:absolute; left:148px; top:63130px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">be passed. (The previous owner should throw away the reference </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">it may</span></div>
<div class="txt" style="position:absolute; left:148px; top:63173px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">become dangling very soon!)</span></div>
<div class="txt" style="position:absolute; left:112px; top:63234px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Only the owner is allowed to deallocate the object; the last owner does the</span></div>
<div class="txt" style="position:absolute; left:148px; top:63277px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">deallocation.</span></div>
<div class="txt" style="position:absolute; left:112px; top:63337px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Each owner either passes on the ownership rights </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">or deallocates.</span></div>
<div class="txt" style="position:absolute; left:112px; top:63397px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f39" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">只有拥有者被允许释放该对象，最后的拥有者执行释放，每个拥有者或者</span></div>
<div class="txt" style="position:absolute; left:148px; top:63437px;"><span id="f39" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">传递所有权或者释放。</span></div>
<img id="background" style="position:absolute; left:0px; top:63756px;" width="1440" height="1080" src="page54.png"> <img id="background" style="position:absolute; left:1440px; top:63756px;" width="1440" height="1080" src="page-000054.png">
<div class="txt" style="position:absolute; left:426px; top:63773px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:63863px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Monitoring Technique</span></div>
<div class="txt" style="position:absolute; left:76px; top:64003px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A simple mechanism to help find bugs is to maintain a table of</span></div>
<div class="txt" style="position:absolute; left:112px; top:64048px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">allocated objects. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可通过维护一个对象分配表发现内存分配错误</span></div>
<div class="txt" style="position:absolute; left:76px; top:64195px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">Malloc() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is replaced by a version that store the address of newly</span></div>
<div class="txt" style="position:absolute; left:112px; top:64245px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">allocated objects in a table.</span></div>
<div class="txt" style="position:absolute; left:76px; top:64315px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">Free() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is replaced by a version that checks the table before</span></div>
<div class="txt" style="position:absolute; left:112px; top:64365px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">freeing.</span></div>
<div class="txt" style="position:absolute; left:76px; top:64432px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">分配和释放前都要检查内存分配表</span></div>
<div class="txt" style="position:absolute; left:76px; top:64507px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Such monitoring can help find bugs:</span></div>
<div class="txt" style="position:absolute; left:112px; top:64570px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">memory leaks </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(the table will fill with a particular type of object), </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">内存泄漏</span></div>
<div class="txt" style="position:absolute; left:112px; top:64634px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">dangling references </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(the table can be checked to see, if a reference is valid</span></div>
<div class="txt" style="position:absolute; left:148px; top:64673px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">before using it) </span><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">悬挂引用</span></div>
<div class="txt" style="position:absolute; left:112px; top:64738px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">double deallocations </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(free will protest if a non-allocated object is freed).</span></div>
<div class="txt" style="position:absolute; left:148px; top:64777px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">重复释放</span></div>
<img id="background" style="position:absolute; left:0px; top:64958px;" width="1440" height="1080" src="page55.png"> <img id="background" style="position:absolute; left:1440px; top:64958px;" width="1440" height="1080" src="page-000055.png">
<div class="txt" style="position:absolute; left:426px; top:64975px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:65065px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Multiple Owners: Shared Objects</span></div>
<div class="txt" style="position:absolute; left:76px; top:65205px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Handling Shared Objects Using Reference Counting</span></div>
<div class="txt" style="position:absolute; left:112px; top:65272px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">We could attempt to handle shared objects by trying to keep track of</span></div>
<div class="txt" style="position:absolute; left:148px; top:65315px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">multiple owners, e.g., by expanding the monitoring table by a count field.</span></div>
<div class="txt" style="position:absolute; left:112px; top:65375px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">For every new owner, we must increment the count.</span></div>
<div class="txt" style="position:absolute; left:112px; top:65436px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">And decrement it every time an owner is done with the object.</span></div>
<div class="txt" style="position:absolute; left:112px; top:65496px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When the last owner is done (the count goes to zero), the object is</span></div>
<div class="txt" style="position:absolute; left:148px; top:65540px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">deallocated.</span></div>
<div class="txt" style="position:absolute; left:112px; top:65596px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">通过计数器来记录对象的引用数目</span></div>
<div class="txt" style="position:absolute; left:112px; top:65733px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Requires extra code for deallocation, allocation, copying of references, etc.</span></div>
<img id="background" style="position:absolute; left:0px; top:66160px;" width="1440" height="1080" src="page56.png"> <img id="background" style="position:absolute; left:1440px; top:66160px;" width="1440" height="1080" src="page-000056.png">
<div class="txt" style="position:absolute; left:426px; top:66177px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:66267px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Dangers of Explicit Deallocation</span></div>
<div class="txt" style="position:absolute; left:76px; top:66407px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">With explicit deallocation, the programmer ends up:</span></div>
<div class="txt" style="position:absolute; left:112px; top:66474px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Doing too little</span></div>
<div class="txt" style="position:absolute; left:148px; top:66530px;"><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage objects are not deallocated and slowly but surely clutters memory and</span></div>
<div class="txt" style="position:absolute; left:184px; top:66569px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">so the program runs out of memory (</span><span id="f13" style="font-size:31px;vertical-align:baseline;color:rgba(255,0,0,1);">such a failure to delete garbage objects is</span></div>
<div class="txt" style="position:absolute; left:184px; top:66604px;"><span id="f13" style="font-size:31px;vertical-align:baseline;color:rgba(255,0,0,1);">called a memory leak</span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">). </span><span id="f26" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">清理内存过于缓慢，造成可用内存不足</span><span id="f13" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f26" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">内存泄露</span><span id="f13" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:112px; top:66657px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Doing too much</span></div>
<div class="txt" style="position:absolute; left:148px; top:66714px;"><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Throwing away a non-garbage object. Subsequent use of a live reference to the</span></div>
<div class="txt" style="position:absolute; left:184px; top:66752px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">object will cause the program to fail in inexplicable ways. Such a reference is a</span></div>
<div class="txt" style="position:absolute; left:184px; top:66791px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">dangling reference.</span></div>
<div class="txt" style="position:absolute; left:148px; top:66837px;"><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Throwing away a garbage object twice! Likely to break the memory manager.</span></div>
<div class="txt" style="position:absolute; left:148px; top:66879px;"><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f26" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,255,1);">清理了非垃圾对象，造成悬挂指针；重复释放，破坏了内存管理</span></div>
<img id="background" style="position:absolute; left:0px; top:67362px;" width="1440" height="1080" src="page57.png"> <img id="background" style="position:absolute; left:1440px; top:67362px;" width="1440" height="1080" src="page-000057.png">
<div class="txt" style="position:absolute; left:426px; top:67379px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:67469px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The REAL bad thing about explicit deallocation</span></div>
<div class="txt" style="position:absolute; left:76px; top:67609px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The problems are real and omnipresent in explicit deallocation</span></div>
<div class="txt" style="position:absolute; left:112px; top:67659px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">systems and they cause the real problem</span></div>
<div class="txt" style="position:absolute; left:112px; top:67720px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Memory leaks </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">内存泄露</span></div>
<div class="txt" style="position:absolute; left:112px; top:67780px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Dangling references </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">悬挂引用</span></div>
<div class="txt" style="position:absolute; left:112px; top:67841px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Double deallocation </span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">重复释放</span></div>
<div class="txt" style="position:absolute; left:76px; top:67980px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Wasting huge amounts of debugging time! </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">浪费调试时间</span></div>
<div class="txt" style="position:absolute; left:76px; top:68054px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Despite this, programs may still fail in mysterious ways long after</span></div>
<div class="txt" style="position:absolute; left:112px; top:68104px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">being put into production.</span></div>
<div class="txt" style="position:absolute; left:76px; top:68174px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Finding and fixing MM bugs can account for 40% of debug time.</span></div>
<img id="background" style="position:absolute; left:0px; top:68564px;" width="1440" height="1080" src="page58.png"> <img id="background" style="position:absolute; left:1440px; top:68564px;" width="1440" height="1080" src="page-000058.png">
<div class="txt" style="position:absolute; left:1105px; top:68582px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:293px; top:68979px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Living with Automatic GC</span></div>
<img id="background" style="position:absolute; left:0px; top:69766px;" width="1440" height="1080" src="page59.png"> <img id="background" style="position:absolute; left:1440px; top:69766px;" width="1440" height="1080" src="page-000059.png">
<div class="txt" style="position:absolute; left:426px; top:69783px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:69873px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Why AUTOMATIC Garbage Collection?</span></div>
<div class="txt" style="position:absolute; left:76px; top:70013px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Because human programmers just can’t get it right:</span></div>
<div class="txt" style="position:absolute; left:112px; top:70080px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Too little is collected leading to memory leaks</span></div>
<div class="txt" style="position:absolute; left:112px; top:70140px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Too much is collected leading to broken programs.</span></div>
<img id="background" style="position:absolute; left:0px; top:70968px;" width="1440" height="1080" src="page60.png"> <img id="background" style="position:absolute; left:1440px; top:70968px;" width="1440" height="1080" src="page-000060.png">
<div class="txt" style="position:absolute; left:426px; top:70985px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:71075px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory leaks?</span></div>
<div class="txt" style="position:absolute; left:76px; top:71215px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Human programmers can:</span></div>
<div class="txt" style="position:absolute; left:112px; top:71282px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Forget to delete an object when it is no longer needed.</span></div>
<div class="txt" style="position:absolute; left:112px; top:71342px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Return a newly allocated object </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">but when will it be deallocated?</span></div>
<div class="txt" style="position:absolute; left:112px; top:71403px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Not figure out when a shared objects should be deleted.</span></div>
<div class="txt" style="position:absolute; left:76px; top:71540px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Sharing is a significant problem</span></div>
<div class="txt" style="position:absolute; left:112px; top:71607px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Can be handled by using the principle last one to leave the room turns off</span></div>
<div class="txt" style="position:absolute; left:148px; top:71650px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the light.</span></div>
<div class="txt" style="position:absolute; left:76px; top:71776px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">However, this is easily forgotten, and, worse, in a large building, it</span></div>
<div class="txt" style="position:absolute; left:112px; top:71826px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">can be close to impossible to detect that you are the last!</span></div>
<img id="background" style="position:absolute; left:0px; top:72170px;" width="1440" height="1080" src="page61.png"> <img id="background" style="position:absolute; left:1440px; top:72170px;" width="1440" height="1080" src="page-000061.png">
<div class="txt" style="position:absolute; left:426px; top:72187px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:72277px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Dangling Reference/Pointers</span></div>
<div class="txt" style="position:absolute; left:76px; top:72417px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Eager human programmers can delete objects too early leading to</span></div>
<div class="txt" style="position:absolute; left:112px; top:72467px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">dangling reference/pointers</span></div>
<div class="txt" style="position:absolute; left:76px; top:72597px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Consider an object that is shared between two different parts of a</span></div>
<div class="txt" style="position:absolute; left:112px; top:72647px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">program each having its own pointer to the object. If one of the</span></div>
<div class="txt" style="position:absolute; left:112px; top:72695px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">pointers is deleted then the other pointer is left pointing to a non-</span></div>
<div class="txt" style="position:absolute; left:112px; top:72743px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">existent object </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">we say that it is a dangling pointer.</span></div>
<div class="txt" style="position:absolute; left:112px; top:72869px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Memory leaks and dangling pointers are two sides of the same coin</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: The</span></div>
<div class="txt" style="position:absolute; left:148px; top:72912px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">difficulty is managing objects in the presences of sharing.</span></div>
<img id="background" style="position:absolute; left:0px; top:73372px;" width="1440" height="1080" src="page62.png"> <img id="background" style="position:absolute; left:1440px; top:73372px;" width="1440" height="1080" src="page-000062.png">
<div class="txt" style="position:absolute; left:1105px; top:73390px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:234px; top:73701px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">5 Basic Algorithms of Garbage</span></div>
<div class="txt" style="position:absolute; left:557px; top:73787px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Collection</span></div>
<img id="background" style="position:absolute; left:0px; top:74574px;" width="1440" height="1080" src="page63.png"> <img id="background" style="position:absolute; left:1440px; top:74574px;" width="1440" height="1080" src="page-000063.png">
<div class="txt" style="position:absolute; left:426px; top:74591px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:74681px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Cost Metrics for GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:74816px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Execution time</span></div>
<div class="txt" style="position:absolute; left:112px; top:74879px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">total execution time</span></div>
<div class="txt" style="position:absolute; left:112px; top:74935px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">distribution of GC execution</span></div>
<div class="txt" style="position:absolute; left:148px; top:74974px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">time</span></div>
<div class="txt" style="position:absolute; left:112px; top:75030px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">time to allocate a new object</span></div>
<div class="txt" style="position:absolute; left:735px; top:74816px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Delay time</span></div>
<div class="txt" style="position:absolute; left:771px; top:74879px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">length of disruptive pauses</span></div>
<div class="txt" style="position:absolute; left:771px; top:74939px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">zombie times</span></div>
<div class="txt" style="position:absolute; left:76px; top:75158px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory usage</span></div>
<div class="txt" style="position:absolute; left:112px; top:75221px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">additional memory overhead</span></div>
<div class="txt" style="position:absolute; left:112px; top:75277px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">fragmentation</span></div>
<div class="txt" style="position:absolute; left:112px; top:75333px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">virtual memory and cache</span></div>
<div class="txt" style="position:absolute; left:148px; top:75372px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">performance</span></div>
<div class="txt" style="position:absolute; left:735px; top:75179px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Other important metrics</span></div>
<div class="txt" style="position:absolute; left:771px; top:75242px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">comprehensiveness</span></div>
<div class="txt" style="position:absolute; left:771px; top:75298px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">implementation simplicity and</span></div>
<div class="txt" style="position:absolute; left:807px; top:75337px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">robustness</span></div>
<img id="background" style="position:absolute; left:0px; top:75776px;" width="1440" height="1080" src="page64.png"> <img id="background" style="position:absolute; left:1440px; top:75776px;" width="1440" height="1080" src="page-000064.png">
<div class="txt" style="position:absolute; left:426px; top:75793px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:75883px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The basic algorithms of GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:76023px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The main task of GC is to separate the reachable objects from the</span></div>
<div class="txt" style="position:absolute; left:112px; top:76068px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">unreachable ones( live objects from dead objects). </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的主要任务是</span></div>
<div class="txt" style="position:absolute; left:112px; top:76116px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">区分可达对象和不可达对象</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">存活对象与死亡对象</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span></div>
<div class="txt" style="position:absolute; left:76px; top:76260px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting: </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">引用计数</span></div>
<div class="txt" style="position:absolute; left:112px; top:76330px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Keep a note on each object, indicating the number of live references to the</span></div>
<div class="txt" style="position:absolute; left:148px; top:76373px;"><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">object. If an object’s reference count goes to zero, throw the object out (it’s</span></div>
<div class="txt" style="position:absolute; left:148px; top:76416px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">dead).</span></div>
<div class="txt" style="position:absolute; left:76px; top:76540px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Sweep: </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">标记</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">-</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">清除</span></div>
<div class="txt" style="position:absolute; left:112px; top:76609px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Put a note on objects you need (roots).</span></div>
<div class="txt" style="position:absolute; left:112px; top:76670px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Then recursively put a note on anything needed by a live object.</span></div>
<div class="txt" style="position:absolute; left:112px; top:76730px;"><span id="f34" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Afterwards, check all objects and throw out objects without notes.</span></div>
<img id="background" style="position:absolute; left:0px; top:76978px;" width="1440" height="1080" src="page65.png"> <img id="background" style="position:absolute; left:1440px; top:76978px;" width="1440" height="1080" src="page-000065.png">
<div class="txt" style="position:absolute; left:426px; top:76995px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:77085px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The basic algorithms of GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:77222px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Compact: </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">标记</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">-</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">压缩</span></div>
<div class="txt" style="position:absolute; left:112px; top:77292px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Put notes on objects you need.</span></div>
<div class="txt" style="position:absolute; left:112px; top:77352px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Move anything with a note on it to the back of the garage.</span></div>
<div class="txt" style="position:absolute; left:112px; top:77413px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Burn everything at the front of the garage (it’s all dead).</span></div>
<div class="txt" style="position:absolute; left:76px; top:77548px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying: </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">复制</span></div>
<div class="txt" style="position:absolute; left:112px; top:77617px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Move objects you need to a new garage.</span></div>
<div class="txt" style="position:absolute; left:112px; top:77678px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Then recursively move anything needed by an object in the new garage.</span></div>
<div class="txt" style="position:absolute; left:112px; top:77738px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Afterwards, burn down the old garage (any objects in it are dead)!</span></div>
<img id="background" style="position:absolute; left:0px; top:78180px;" width="1440" height="1080" src="page66.png"> <img id="background" style="position:absolute; left:1440px; top:78180px;" width="1440" height="1080" src="page-000066.png">
<div class="txt" style="position:absolute; left:1105px; top:78198px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:413px; top:78595px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting</span></div>
<img id="background" style="position:absolute; left:0px; top:79382px;" width="1440" height="1080" src="page67.png"> <img id="background" style="position:absolute; left:1440px; top:79382px;" width="1440" height="1080" src="page-000067.png">
<div class="txt" style="position:absolute; left:426px; top:79399px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:79489px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting</span></div>
<div class="txt" style="position:absolute; left:76px; top:79629px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting: a mechanism to share ownership</span></div>
<div class="txt" style="position:absolute; left:76px; top:79773px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Goal: to identify when you are the only owner, and thus you can</span></div>
<div class="txt" style="position:absolute; left:112px; top:79823px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">make the disposal decision.</span></div>
<div class="txt" style="position:absolute; left:76px; top:79893px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Basic idea: count the number of references from live objects.</span></div>
<div class="txt" style="position:absolute; left:112px; top:79960px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Each object has a reference count (RC)</span></div>
<div class="txt" style="position:absolute; left:112px; top:80020px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When a reference is copied, the referent’s RC is incremented</span></div>
<div class="txt" style="position:absolute; left:112px; top:80081px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When a reference is deleted, the referent’s RC is decremented</span></div>
<div class="txt" style="position:absolute; left:112px; top:80141px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">An object can be reclaimed when its RC = 0</span></div>
<img id="background" style="position:absolute; left:0px; top:80584px;" width="1440" height="1080" src="page68.png"> <img id="background" style="position:absolute; left:1440px; top:80584px;" width="1440" height="1080" src="page-000068.png">
<div class="txt" style="position:absolute; left:426px; top:80601px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:80691px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting</span></div>
<div class="txt" style="position:absolute; left:76px; top:80828px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Recursive freeing </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">递归释放</span></div>
<div class="txt" style="position:absolute; left:112px; top:80898px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Once an object’s RC=0, it can be freed.</span></div>
<div class="txt" style="position:absolute; left:112px; top:80958px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">But object may contain references to further objects.</span></div>
<div class="txt" style="position:absolute; left:112px; top:81019px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Before this object is freed, the RCs of its constituents should also be freed.</span></div>
<div class="txt" style="position:absolute; left:122px; top:81092px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">New() {</span></div>
<div class="txt" style="position:absolute; left:161px; top:81135px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if free_list == nil</span></div>
<div class="txt" style="position:absolute; left:200px; top:81178px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">abort "Memory exhausted"</span></div>
<div class="txt" style="position:absolute; left:161px; top:81221px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">newcell = allocate()</span></div>
<div class="txt" style="position:absolute; left:161px; top:81264px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">RC(newcell) = 1</span></div>
<div class="txt" style="position:absolute; left:161px; top:81308px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return newcell</span></div>
<div class="txt" style="position:absolute; left:122px; top:81351px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:122px; top:81416px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Update(R, S) {</span></div>
<div class="txt" style="position:absolute; left:161px; top:81459px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">RC(S) = RC(S) + 1</span></div>
<div class="txt" style="position:absolute; left:161px; top:81502px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">delete(*R)</span></div>
<div class="txt" style="position:absolute; left:161px; top:81545px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">*R = S</span></div>
<div class="txt" style="position:absolute; left:122px; top:81589px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:794px; top:81092px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">delete(T) {</span></div>
<div class="txt" style="position:absolute; left:833px; top:81135px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">RC(T) = RC(T) - 1</span></div>
<div class="txt" style="position:absolute; left:833px; top:81178px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if RC(T) == 0 {</span></div>
<div class="txt" style="position:absolute; left:873px; top:81221px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for U in Children(T)</span></div>
<div class="txt" style="position:absolute; left:912px; top:81264px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">delete(*U)</span></div>
<div class="txt" style="position:absolute; left:873px; top:81308px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">free(T)</span></div>
<div class="txt" style="position:absolute; left:833px; top:81351px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:794px; top:81394px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:794px; top:81459px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">free(N) {</span></div>
<div class="txt" style="position:absolute; left:833px; top:81502px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">next(N) = free_list;</span></div>
<div class="txt" style="position:absolute; left:833px; top:81545px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">free_list = N;</span></div>
<div class="txt" style="position:absolute; left:794px; top:81589px;"><span id="f25" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:81786px;" width="1440" height="1080" src="page69.png"> <img id="background" style="position:absolute; left:1440px; top:81786px;" width="1440" height="1080" src="page-000069.png">
<div class="txt" style="position:absolute; left:426px; top:81803px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:81893px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting</span></div>
<div class="txt" style="position:absolute; left:387px; top:82100px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">R</span></div>
<div class="txt" style="position:absolute; left:804px; top:82092px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">root</span></div>
<div class="txt" style="position:absolute; left:250px; top:82243px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">T</span></div>
<div class="txt" style="position:absolute; left:575px; top:82241px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">S</span></div>
<div class="txt" style="position:absolute; left:552px; top:82479px;"><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">R</span></div>
<div class="txt" style="position:absolute; left:965px; top:82471px;"><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">root</span></div>
<div class="txt" style="position:absolute; left:416px; top:82620px;"><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">T</span></div>
<div class="txt" style="position:absolute; left:739px; top:82618px;"><span id="f11" style="font-size:39px;vertical-align:baseline;color:rgba(0,0,0,1);">S</span></div>
<div class="txt" style="position:absolute; left:495px; top:82799px;"><span id="f18" style="font-size:31px;vertical-align:baseline;color:rgba(255,0,0,1);">Update(left(R), S)</span></div>
<img id="background" style="position:absolute; left:0px; top:82988px;" width="1440" height="1080" src="page70.png"> <img id="background" style="position:absolute; left:1440px; top:82988px;" width="1440" height="1080" src="page-000070.png">
<div class="txt" style="position:absolute; left:426px; top:83005px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:83095px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">A pitfall of reference counting: </span><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(192,0,0,1);">reference cycles</span></div>
<div class="txt" style="position:absolute; left:69px; top:83229px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">reference cycles, </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">an object which refers directly or indirectly to itself.</span></div>
<div class="txt" style="position:absolute; left:70px; top:83313px;"><span id="f38" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">objA = new Class(); //RC(M1)=1</span></div>
<div class="txt" style="position:absolute; left:70px; top:83356px;"><span id="f38" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">objB = new Class(); //RC(M2)=1</span></div>
<div class="txt" style="position:absolute; left:70px; top:83399px;"><span id="f38" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">objA.instance = objB; //RC(M2)=2</span></div>
<div class="txt" style="position:absolute; left:70px; top:83442px;"><span id="f38" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">objB.instance = objA; //RC(M1)=2</span></div>
<div class="txt" style="position:absolute; left:865px; top:83306px;"><span id="f48" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objA</span></div>
<div class="txt" style="position:absolute; left:779px; top:83397px;"><span id="f48" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">objcB</span></div>
<div class="txt" style="position:absolute; left:1318px; top:83362px;"><span id="f45" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">1</span><span id="f45" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">21</span></div>
<div class="txt" style="position:absolute; left:1266px; top:83459px;"><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">M1</span></div>
<div class="txt" style="position:absolute; left:70px; top:83529px;"><span id="f38" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">objA = null; //RC(M1)=1</span></div>
<div class="txt" style="position:absolute; left:70px; top:83572px;"><span id="f38" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">objB = null; //RC(M2)=1</span></div>
<div class="txt" style="position:absolute; left:69px; top:83661px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Both of the chunks above are garbage;</span></div>
<div class="txt" style="position:absolute; left:1044px; top:83532px;"><span id="f45" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">1</span><span id="f45" style="font-size:31px;vertical-align:sub;color:rgba(0,0,0,1);">21</span></div>
<div class="txt" style="position:absolute; left:986px; top:83628px;"><span id="f45" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">M2</span></div>
<div class="txt" style="position:absolute; left:69px; top:83733px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Both of the chunks above have a reference count of 1</span></div>
<div class="txt" style="position:absolute; left:69px; top:83805px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Neither chunk will be reclaimed</span></div>
<div class="txt" style="position:absolute; left:69px; top:83877px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Reference counting fails conservatively</span></div>
<div class="txt" style="position:absolute; left:105px; top:83940px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f12" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">it may not collect all the garbage </span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">可能不会收集所有的垃圾</span></div>
<div class="txt" style="position:absolute; left:105px; top:84000px;"><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f12" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">but it will never throw away non-garbage </span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">永远不会扔掉非垃圾</span></div>
<img id="background" style="position:absolute; left:0px; top:84190px;" width="1440" height="1080" src="page71.png"> <img id="background" style="position:absolute; left:1440px; top:84190px;" width="1440" height="1080" src="page-000071.png">
<div class="txt" style="position:absolute; left:426px; top:84207px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:84297px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Advantages of reference counting</span></div>
<div class="txt" style="position:absolute; left:76px; top:84434px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Simple to implement </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">实现简单</span></div>
<div class="txt" style="position:absolute; left:76px; top:84506px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Costs distributed throughout program </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">代价均匀分布</span></div>
<div class="txt" style="position:absolute; left:76px; top:84581px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Good locality of reference: only touch old and new targets‘ RCs</span></div>
<div class="txt" style="position:absolute; left:76px; top:84653px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Works well because few objects are shared and many are</span></div>
<div class="txt" style="position:absolute; left:112px; top:84703px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">short-lived</span></div>
<div class="txt" style="position:absolute; left:76px; top:84773px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Zombie time minimized</span></div>
<div class="txt" style="position:absolute; left:112px; top:84840px;"><span id="f32" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the zombie time is the time from when an object becomes garbage until</span></div>
<div class="txt" style="position:absolute; left:148px; top:84879px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">it is collected </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象从变成“垃圾”到被回收的时间</span></div>
<div class="txt" style="position:absolute; left:76px; top:84949px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Immediate finalization is possible (due to near zero zombie time)</span></div>
<img id="background" style="position:absolute; left:0px; top:85392px;" width="1440" height="1080" src="page72.png"> <img id="background" style="position:absolute; left:1440px; top:85392px;" width="1440" height="1080" src="page-000072.png">
<div class="txt" style="position:absolute; left:426px; top:85409px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:85499px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Disadvantages of reference counting</span></div>
<div class="txt" style="position:absolute; left:76px; top:85639px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Not comprehensive (does not collect all garbage): cannot reclaim</span></div>
<div class="txt" style="position:absolute; left:112px; top:85689px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">cyclic data structures</span></div>
<div class="txt" style="position:absolute; left:76px; top:85759px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">High cost of manipulating RCs: cost is ever-present even if no</span></div>
<div class="txt" style="position:absolute; left:112px; top:85809px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage is collected</span></div>
<div class="txt" style="position:absolute; left:76px; top:85879px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Bad for concurrency; RC manipulations must be atomic </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">— </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">need</span></div>
<div class="txt" style="position:absolute; left:112px; top:85929px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Compare&amp;Swap operation</span></div>
<div class="txt" style="position:absolute; left:76px; top:85999px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Tightly coupled interface to mutator</span></div>
<div class="txt" style="position:absolute; left:76px; top:86071px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">High space overheads</span></div>
<div class="txt" style="position:absolute; left:76px; top:86143px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Recursive freeing cascade is only bounded by heap size</span></div>
<div class="txt" style="position:absolute; left:76px; top:86215px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">has problems with reference cycles (so in JVM GC, RC is not used!)</span></div>
<img id="background" style="position:absolute; left:0px; top:86594px;" width="1440" height="1080" src="page73.png"> <img id="background" style="position:absolute; left:1440px; top:86594px;" width="1440" height="1080" src="page-000073.png">
<div class="txt" style="position:absolute; left:1105px; top:86612px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:245px; top:87009px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Sweep&amp;Mark-Compact</span></div>
<img id="background" style="position:absolute; left:0px; top:87796px;" width="1440" height="1080" src="page74.png"> <img id="background" style="position:absolute; left:1440px; top:87796px;" width="1440" height="1080" src="page-000074.png">
<div class="txt" style="position:absolute; left:426px; top:87813px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:87903px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Sweep</span></div>
<div class="txt" style="position:absolute; left:76px; top:88043px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-sweep is such a tracing algorithm </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">— </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">it works by following</span></div>
<div class="txt" style="position:absolute; left:112px; top:88088px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(tracing) references from live objects to find other live objects. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">通过</span></div>
<div class="txt" style="position:absolute; left:112px; top:88136px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">跟踪活动对象的引用来查找其他活动对象。</span></div>
<div class="txt" style="position:absolute; left:76px; top:88259px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Implementation of the live set:</span></div>
<div class="txt" style="position:absolute; left:112px; top:88326px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Each object has a mark-bit associated with it, indicating whether it is a</span></div>
<div class="txt" style="position:absolute; left:148px; top:88365px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">member of the live set. </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">每个对象都有一个标志，标志是否属于</span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">live</span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">集</span></div>
<div class="txt" style="position:absolute; left:76px; top:88435px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">There are two phases:</span></div>
<div class="txt" style="position:absolute; left:112px; top:88502px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Mark phase:</span></div>
<div class="txt" style="position:absolute; left:148px; top:88558px;"><span id="f46" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">starting from the roots, the graph is traced and the mark-bit is set in each</span></div>
<div class="txt" style="position:absolute; left:184px; top:88597px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">unmarked object encountered.</span></div>
<div class="txt" style="position:absolute; left:148px; top:88643px;"><span id="f46" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">At the end of the mark phase, unmarked objects are garbage.</span></div>
<div class="txt" style="position:absolute; left:112px; top:88693px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Sweep phase</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: starting from the bottom, the heap is swept</span></div>
<div class="txt" style="position:absolute; left:148px; top:88749px;"><span id="f46" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">mark-bit not set: the object is reclaimed</span></div>
<div class="txt" style="position:absolute; left:148px; top:88795px;"><span id="f46" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">mark-bit set:the mark-bit is cleared</span></div>
<img id="background" style="position:absolute; left:0px; top:88998px;" width="1440" height="1080" src="page75.png"> <img id="background" style="position:absolute; left:1440px; top:88998px;" width="1440" height="1080" src="page-000075.png">
<div class="txt" style="position:absolute; left:426px; top:89015px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:89105px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Sweep</span></div>
<div class="txt" style="position:absolute; left:283px; top:89285px;"><span id="f28" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">root</span></div>
<div class="txt" style="position:absolute; left:999px; top:89754px;"><span id="f29" style="font-size:25px;vertical-align:baseline;color:rgba(0,0,0,1);">mark-bit</span></div>
<img id="background" style="position:absolute; left:0px; top:90200px;" width="1440" height="1080" src="page76.png"> <img id="background" style="position:absolute; left:1440px; top:90200px;" width="1440" height="1080" src="page-000076.png">
<div class="txt" style="position:absolute; left:426px; top:90217px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:90307px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Sweep</span></div>
<div class="txt" style="position:absolute; left:186px; top:90443px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">root</span></div>
<div class="txt" style="position:absolute; left:197px; top:90801px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">root</span></div>
<div class="txt" style="position:absolute; left:583px; top:90816px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">After GC</span></div>
<div class="txt" style="position:absolute; left:1246px; top:90617px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,255,255,1);">live</span></div>
<div class="txt" style="position:absolute; left:1207px; top:90723px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,255,255,1);">garbage</span></div>
<div class="txt" style="position:absolute; left:1247px; top:90833px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">free</span></div>
<div class="txt" style="position:absolute; left:1205px; top:90929px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">reference</span></div>
<img id="background" style="position:absolute; left:0px; top:91402px;" width="1440" height="1080" src="page77.png"> <img id="background" style="position:absolute; left:1440px; top:91402px;" width="1440" height="1080" src="page-000077.png">
<div class="txt" style="position:absolute; left:426px; top:91419px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:91509px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Compact</span></div>
<div class="txt" style="position:absolute; left:65px; top:91638px;"><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-Compact:</span></div>
<div class="txt" style="position:absolute; left:101px; top:91704px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Put notes on objects you need (as Mark-Sweep).</span></div>
<div class="txt" style="position:absolute; left:101px; top:91765px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Move anything with a note on it to the back of the garage.</span></div>
<div class="txt" style="position:absolute; left:101px; top:91825px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f39" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Burn everything at the front of the garage (it’s all dead).</span></div>
<div class="txt" style="position:absolute; left:416px; top:91880px;"><span id="f10" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,0,1);">root</span></div>
<div class="txt" style="position:absolute; left:694px; top:92099px;"><span id="f10" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,0,1);">After GC</span></div>
<div class="txt" style="position:absolute; left:1149px; top:92024px;"><span id="f8" style="font-size:26px;vertical-align:baseline;color:rgba(255,255,255,1);">live</span></div>
<div class="txt" style="position:absolute; left:1122px; top:92094px;"><span id="f8" style="font-size:26px;vertical-align:baseline;color:rgba(255,255,255,1);">garbage</span></div>
<div class="txt" style="position:absolute; left:1149px; top:92168px;"><span id="f8" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,0,1);">free</span></div>
<div class="txt" style="position:absolute; left:1121px; top:92232px;"><span id="f10" style="font-size:24px;vertical-align:baseline;color:rgba(0,0,0,1);">reference</span></div>
<img id="background" style="position:absolute; left:0px; top:92604px;" width="1440" height="1080" src="page78.png"> <img id="background" style="position:absolute; left:1440px; top:92604px;" width="1440" height="1080" src="page-000078.png">
<div class="txt" style="position:absolute; left:426px; top:92621px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:92711px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The mark-stack</span></div>
<div class="txt" style="position:absolute; left:76px; top:92851px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The simplest solution is to implement marking recursively: walk a</span></div>
<div class="txt" style="position:absolute; left:112px; top:92896px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">minimum spanning tree of the object graph </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">1</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">：递归遍历进行标</span></div>
<div class="txt" style="position:absolute; left:112px; top:92944px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">记，遍历对象图的最小生成树</span></div>
<div class="txt" style="position:absolute; left:112px; top:92996px;"><span id="f29" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">mark(N) {</span></div>
<div class="txt" style="position:absolute; left:200px; top:93044px;"><span id="f29" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">if markBit(N) == UNMARKED {</span></div>
<div class="txt" style="position:absolute; left:288px; top:93092px;"><span id="f29" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">markBit(N) = MARKED</span></div>
<div class="txt" style="position:absolute; left:288px; top:93140px;"><span id="f29" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">for M in Children(N)</span></div>
<div class="txt" style="position:absolute; left:376px; top:93188px;"><span id="f29" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">mark(*M)</span></div>
<div class="txt" style="position:absolute; left:200px; top:93237px;"><span id="f29" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:112px; top:93285px;"><span id="f29" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:93355px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A more efficient method is to use a marking stack: repeat until the</span></div>
<div class="txt" style="position:absolute; left:112px; top:93400px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">marking stack is empty. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">2</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">：标记栈，重复直到标记栈为空</span></div>
<div class="txt" style="position:absolute; left:112px; top:93470px;"><span id="f51" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Pop the top item</span></div>
<div class="txt" style="position:absolute; left:112px; top:93530px;"><span id="f51" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If it is unmarked, mark it.</span></div>
<div class="txt" style="position:absolute; left:112px; top:93591px;"><span id="f51" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If it is a branch point in the graph, push any unmarked children onto the</span></div>
<div class="txt" style="position:absolute; left:148px; top:93634px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">stack</span></div>
<img id="background" style="position:absolute; left:0px; top:93806px;" width="1440" height="1080" src="page79.png"> <img id="background" style="position:absolute; left:1440px; top:93806px;" width="1440" height="1080" src="page-000079.png">
<div class="txt" style="position:absolute; left:426px; top:93823px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:93911px;"><span id="f8" style="font-size:64px;vertical-align:baseline;color:rgba(0,0,0,1);">The mark-stack</span></div>
<div class="txt" style="position:absolute; left:76px; top:94042px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">New() {</span></div>
<div class="txt" style="position:absolute; left:116px; top:94086px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if free_pool.empty</span></div>
<div class="txt" style="position:absolute; left:155px; top:94129px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">markHeap()</span></div>
<div class="txt" style="position:absolute; left:155px; top:94172px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">sweep()</span></div>
<div class="txt" style="position:absolute; left:116px; top:94215px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">newobj = allocate()</span></div>
<div class="txt" style="position:absolute; left:116px; top:94258px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">return newobj</span></div>
<div class="txt" style="position:absolute; left:76px; top:94302px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:76px; top:94431px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">markHeap() {</span></div>
<div class="txt" style="position:absolute; left:116px; top:94474px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">markStack = empty</span></div>
<div class="txt" style="position:absolute; left:116px; top:94518px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for R in Roots</span></div>
<div class="txt" style="position:absolute; left:155px; top:94561px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">markBit(R) = MARKED</span></div>
<div class="txt" style="position:absolute; left:155px; top:94604px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">markStack.push(R)</span></div>
<div class="txt" style="position:absolute; left:155px; top:94647px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">mark()</span></div>
<div class="txt" style="position:absolute; left:76px; top:94690px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:681px; top:94042px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">mark() {</span></div>
<div class="txt" style="position:absolute; left:720px; top:94086px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while markStack not empty {</span></div>
<div class="txt" style="position:absolute; left:760px; top:94129px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">N = pop(markStack)</span></div>
<div class="txt" style="position:absolute; left:760px; top:94172px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">for M in Children(N)</span></div>
<div class="txt" style="position:absolute; left:799px; top:94215px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if markBit(M)== UNMARKED {</span></div>
<div class="txt" style="position:absolute; left:839px; top:94258px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">markBit(M) = MARKED</span></div>
<div class="txt" style="position:absolute; left:839px; top:94302px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if not atom(*M)</span></div>
<div class="txt" style="position:absolute; left:878px; top:94345px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">push(markStack,*M)</span></div>
<div class="txt" style="position:absolute; left:799px; top:94388px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:720px; top:94431px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:681px; top:94474px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:681px; top:94539px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">sweep() {</span></div>
<div class="txt" style="position:absolute; left:720px; top:94582px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">N = Heap_bottom</span></div>
<div class="txt" style="position:absolute; left:720px; top:94626px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while N &lt; Heap_top</span></div>
<div class="txt" style="position:absolute; left:760px; top:94669px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if markBit(N) == UNMARKED</span></div>
<div class="txt" style="position:absolute; left:799px; top:94712px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">free (N)</span></div>
<div class="txt" style="position:absolute; left:760px; top:94755px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">else markBit(N) = UNMARKED</span></div>
<div class="txt" style="position:absolute; left:720px; top:94799px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">N += N.size</span></div>
<div class="txt" style="position:absolute; left:681px; top:94842px;"><span id="f13" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:95008px;" width="1440" height="1080" src="page80.png"> <img id="background" style="position:absolute; left:1440px; top:95008px;" width="1440" height="1080" src="page-000080.png">
<div class="txt" style="position:absolute; left:426px; top:95025px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:95115px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Advantages of mark-sweep</span></div>
<div class="txt" style="position:absolute; left:76px; top:95255px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Comprehensive: cyclic garbage collected naturally</span></div>
<div class="txt" style="position:absolute; left:76px; top:95399px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">No run-time overhead on pointer manipulations</span></div>
<div class="txt" style="position:absolute; left:76px; top:95543px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Loosely coupled to mutator</span></div>
<div class="txt" style="position:absolute; left:76px; top:95687px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Does not move objects</span></div>
<div class="txt" style="position:absolute; left:112px; top:95754px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">does not break any mutator invariants</span></div>
<div class="txt" style="position:absolute; left:112px; top:95814px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">optimiser-friendly</span></div>
<div class="txt" style="position:absolute; left:112px; top:95875px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">requires only one reference to each live object to be discovered</span></div>
<div class="txt" style="position:absolute; left:148px; top:95918px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(rather than having to find every reference)</span></div>
<img id="background" style="position:absolute; left:0px; top:96210px;" width="1440" height="1080" src="page81.png"> <img id="background" style="position:absolute; left:1440px; top:96210px;" width="1440" height="1080" src="page-000081.png">
<div class="txt" style="position:absolute; left:426px; top:96227px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:96317px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Disadvantages of mark-sweep</span></div>
<div class="txt" style="position:absolute; left:76px; top:96457px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Stop/start nature leads to disruptive pauses and long zombie times.</span></div>
<div class="txt" style="position:absolute; left:76px; top:96529px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Complexity is O(heap) rather than O(live)</span></div>
<div class="txt" style="position:absolute; left:112px; top:96596px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">every live object is visited in mark phase</span></div>
<div class="txt" style="position:absolute; left:112px; top:96656px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">every object, alive or dead, is visited in sweep phase</span></div>
<div class="txt" style="position:absolute; left:76px; top:96719px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Degrades with residency (heap occupancy) </span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">堆占用高时性能降低</span></div>
<div class="txt" style="position:absolute; left:112px; top:96789px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the collector needs headroom in the heap to avoid thrashing</span></div>
<div class="txt" style="position:absolute; left:112px; top:96849px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Example: lots of marking to do if heap is full and we do this often</span></div>
<div class="txt" style="position:absolute; left:76px; top:96912px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Fragmentation and mark-stack overflow are issues </span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">造成碎片</span></div>
<div class="txt" style="position:absolute; left:76px; top:96987px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Tracing collectors must be able to find roots (unlike reference</span></div>
<div class="txt" style="position:absolute; left:112px; top:97032px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">counting) </span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">需要找到</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">root</span></div>
<div class="txt" style="position:absolute; left:112px; top:97102px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">This needs some understanding of the run-time system or cooperation</span></div>
<div class="txt" style="position:absolute; left:148px; top:97145px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">from the compiler.</span></div>
<img id="background" style="position:absolute; left:0px; top:97412px;" width="1440" height="1080" src="page82.png"> <img id="background" style="position:absolute; left:1440px; top:97412px;" width="1440" height="1080" src="page-000082.png">
<div class="txt" style="position:absolute; left:1105px; top:97430px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:267px; top:97827px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">Fragmentation and Copying</span></div>
<img id="background" style="position:absolute; left:0px; top:98614px;" width="1440" height="1080" src="page83.png"> <img id="background" style="position:absolute; left:1440px; top:98614px;" width="1440" height="1080" src="page-000083.png">
<div class="txt" style="position:absolute; left:426px; top:98631px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:98721px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Fragmentation</span></div>
<div class="txt" style="position:absolute; left:76px; top:98861px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Fragmentation: inability to use available memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:98928px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(192,0,0,1);">External</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: allocated memory scattered into blocks; free blocks cannot be</span></div>
<div class="txt" style="position:absolute; left:148px; top:98971px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">coalesced</span></div>
<div class="txt" style="position:absolute; left:112px; top:99031px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(192,0,0,1);">Internal</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">: memory manager allocated more space than actually required </span><span id="f23" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span></div>
<div class="txt" style="position:absolute; left:148px; top:99075px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">common causes are headers, rounding sizes up</span></div>
<div class="txt" style="position:absolute; left:76px; top:99140px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Fragmentation is a problem for explicit memory managers as well;</span></div>
<div class="txt" style="position:absolute; left:112px; top:99190px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">free() is often not free.</span></div>
<div class="txt" style="position:absolute; left:650px; top:99333px;"><span id="f30" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocate()</span></div>
<img id="background" style="position:absolute; left:0px; top:99816px;" width="1440" height="1080" src="page84.png"> <img id="background" style="position:absolute; left:1440px; top:99816px;" width="1440" height="1080" src="page-000084.png">
<div class="txt" style="position:absolute; left:33px; top:99923px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying</span></div>
<div class="txt" style="position:absolute; left:426px; top:99833px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:100063px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">GC is a set-partitioning problem</span></div>
<div class="txt" style="position:absolute; left:112px; top:100130px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A mark-bit is one way of defining two sets.</span></div>
<div class="txt" style="position:absolute; left:76px; top:100256px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-compact physically moves members of the live set to a</span></div>
<div class="txt" style="position:absolute; left:112px; top:100306px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">different part of the heap</span></div>
<div class="txt" style="position:absolute; left:112px; top:100371px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the free pointer marks the dividing line between live data and memory</span></div>
<div class="txt" style="position:absolute; left:148px; top:100414px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">that can be overwritten</span></div>
<div class="txt" style="position:absolute; left:76px; top:100480px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying collection is a simpler solution: </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">it picks out live objects</span></div>
<div class="txt" style="position:absolute; left:112px; top:100529px;"><span id="f33" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">and copies them to a ‘fresh’ heap</span></div>
<img id="background" style="position:absolute; left:0px; top:101018px;" width="1440" height="1080" src="page85.png"> <img id="background" style="position:absolute; left:1440px; top:101018px;" width="1440" height="1080" src="page-000085.png">
<div class="txt" style="position:absolute; left:426px; top:101035px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:101125px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying garbage collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:101265px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Divide heap into 2 halves called semi-spaces and named</span></div>
<div class="txt" style="position:absolute; left:112px; top:101315px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Fromspace </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(192,0,0,1);">Tospace</span></div>
<div class="txt" style="position:absolute; left:76px; top:101457px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Allocate objects in Tospace</span></div>
<div class="txt" style="position:absolute; left:76px; top:101529px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When Tospace is full</span></div>
<div class="txt" style="position:absolute; left:112px; top:101592px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Flip(</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">翻转</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">) the roles of the semi-spaces</span></div>
<div class="txt" style="position:absolute; left:112px; top:101656px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Pick out all live data in Fromspace and copy them to Tospace</span></div>
<div class="txt" style="position:absolute; left:112px; top:101717px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Preserve sharing by leaving a forwarding address in the Fromspace</span></div>
<div class="txt" style="position:absolute; left:148px; top:101760px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">replica</span></div>
<div class="txt" style="position:absolute; left:112px; top:101820px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Use Tospace objects as a work queue</span></div>
<img id="background" style="position:absolute; left:0px; top:102220px;" width="1440" height="1080" src="page86.png"> <img id="background" style="position:absolute; left:1440px; top:102220px;" width="1440" height="1080" src="page-000086.png">
<div class="txt" style="position:absolute; left:426px; top:102237px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:102327px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying garbage collection</span></div>
<div class="txt" style="position:absolute; left:1258px; top:102650px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,255,255,1);">live</span></div>
<div class="txt" style="position:absolute; left:541px; top:102768px;"><span id="f11" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">GC</span></div>
<div class="txt" style="position:absolute; left:1218px; top:102756px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,255,255,1);">garbage</span></div>
<div class="txt" style="position:absolute; left:1258px; top:102866px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">free</span></div>
<div class="txt" style="position:absolute; left:1250px; top:102954px;"><span id="f11" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">move</span></div>
<img id="background" style="position:absolute; left:0px; top:103422px;" width="1440" height="1080" src="page87.png"> <img id="background" style="position:absolute; left:1440px; top:103422px;" width="1440" height="1080" src="page-000087.png">
<div class="txt" style="position:absolute; left:426px; top:103439px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:801px; top:103485px;"><span id="f12" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">ReRgeisgteisrtsers</span></div>
<div class="txt" style="position:absolute; left:33px; top:103529px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying GC Example</span><span id="f12" style="font-size:35px;vertical-align:sub;color:rgba(0,0,0,1);">AA </span><span id="f12" style="font-size:35px;vertical-align:sub;color:rgba(0,0,255,1);">A'</span></div>
<div class="txt" style="position:absolute; left:481px; top:103700px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,255,1);">B' </span><span id="f12" style="font-size:35px;vertical-align:super;color:rgba(0,0,0,1);">BB</span></div>
<div class="txt" style="position:absolute; left:980px; top:103696px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">CC</span></div>
<div class="txt" style="position:absolute; left:882px; top:103723px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,255,1);">C'</span></div>
<div class="txt" style="position:absolute; left:324px; top:103837px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">DD</span></div>
<div class="txt" style="position:absolute; left:396px; top:103866px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,255,1);">D'</span></div>
<div class="txt" style="position:absolute; left:522px; top:103837px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">EE</span></div>
<div class="txt" style="position:absolute; left:591px; top:103867px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,255,1);">E'</span></div>
<div class="txt" style="position:absolute; left:734px; top:103859px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">FF </span><span id="f12" style="font-size:35px;vertical-align:sub;color:rgba(0,0,255,1);">F'</span></div>
<div class="txt" style="position:absolute; left:911px; top:103855px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">GG </span><span id="f12" style="font-size:35px;vertical-align:sub;color:rgba(0,0,255,1);">G'</span></div>
<div class="txt" style="position:absolute; left:980px; top:103920px;"><span id="f12" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">FrFomrosmpsapcaece</span></div>
<div class="txt" style="position:absolute; left:365px; top:104013px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">A'</span></div>
<div class="txt" style="position:absolute; left:506px; top:104013px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">B'</span></div>
<div class="txt" style="position:absolute; left:642px; top:104013px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">C' </span><span id="f12" style="font-size:35px;vertical-align:super;color:rgba(0,0,0,1);">D'</span></div>
<div class="txt" style="position:absolute; left:883px; top:104013px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">E'</span></div>
<div class="txt" style="position:absolute; left:1008px; top:104009px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">F'</span></div>
<div class="txt" style="position:absolute; left:344px; top:104182px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">G'</span></div>
<div class="txt" style="position:absolute; left:502px; top:104301px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">scan=free</span></div>
<div class="txt" style="position:absolute; left:386px; top:104344px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">so collection is complete</span></div>
<div class="txt" style="position:absolute; left:1018px; top:104187px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">frferee</span></div>
<div class="txt" style="position:absolute; left:1018px; top:104218px;"><span id="f12" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">scsacnan</span></div>
<div class="txt" style="position:absolute; left:1008px; top:104420px;"><span id="f12" style="font-size:12px;vertical-align:baseline;color:rgba(0,0,0,1);">ToTsopsapcaece</span></div>
<img id="background" style="position:absolute; left:0px; top:104624px;" width="1440" height="1080" src="page88.png"> <img id="background" style="position:absolute; left:1440px; top:104624px;" width="1440" height="1080" src="page-000088.png">
<div class="txt" style="position:absolute; left:426px; top:104641px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:104731px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying garbage collection</span></div>
<div class="txt" style="position:absolute; left:224px; top:104887px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">flip(){</span></div>
<div class="txt" style="position:absolute; left:294px; top:104922px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Fromspace, Tospace = Tospace, Fromspace</span></div>
<div class="txt" style="position:absolute; left:294px; top:104957px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">top_of_space = Tospace + space_size</span></div>
<div class="txt" style="position:absolute; left:294px; top:104991px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">scan = free = Tospace</span></div>
<div class="txt" style="position:absolute; left:294px; top:105026px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">for R in Roots {R = copy(R)}</span></div>
<div class="txt" style="position:absolute; left:294px; top:105060px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">while scan &lt; free {</span></div>
<div class="txt" style="position:absolute; left:364px; top:105095px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">for P in Children(scan) {*P = copy(*P)}</span></div>
<div class="txt" style="position:absolute; left:364px; top:105129px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">scan = scan + size (scan)</span></div>
<div class="txt" style="position:absolute; left:294px; top:105164px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:224px; top:105199px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:224px; top:105306px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">copy(P) {</span></div>
<div class="txt" style="position:absolute; left:294px; top:105360px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">if forwarded(P){return forwarding_address(P)}</span></div>
<div class="txt" style="position:absolute; left:294px; top:105394px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">else {</span></div>
<div class="txt" style="position:absolute; left:364px; top:105429px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">addr = free</span></div>
<div class="txt" style="position:absolute; left:364px; top:105464px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">move(P,free)</span></div>
<div class="txt" style="position:absolute; left:364px; top:105498px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">free = free + size(P)</span></div>
<div class="txt" style="position:absolute; left:364px; top:105533px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">forwarding_address(P) = addr</span></div>
<div class="txt" style="position:absolute; left:364px; top:105567px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">return addr</span></div>
<div class="txt" style="position:absolute; left:294px; top:105602px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:224px; top:105636px;"><span id="f10" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:105826px;" width="1440" height="1080" src="page89.png"> <img id="background" style="position:absolute; left:1440px; top:105826px;" width="1440" height="1080" src="page-000089.png">
<div class="txt" style="position:absolute; left:426px; top:105843px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:105933px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Advantages of copying GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:106073px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Compaction for free</span></div>
<div class="txt" style="position:absolute; left:76px; top:106145px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Allocation is very cheap for all object sizes</span></div>
<div class="txt" style="position:absolute; left:112px; top:106212px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">out-of-space check is pointer comparison</span></div>
<div class="txt" style="position:absolute; left:112px; top:106272px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">simply increment free pointer to allocate</span></div>
<div class="txt" style="position:absolute; left:76px; top:106338px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Only live data is processed (commonly a small fraction of the heap)</span></div>
<div class="txt" style="position:absolute; left:76px; top:106410px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Fixed space overheads</span></div>
<div class="txt" style="position:absolute; left:112px; top:106477px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">free and scan pointers</span></div>
<div class="txt" style="position:absolute; left:112px; top:106537px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">forwarding addresses can be written over user data</span></div>
<div class="txt" style="position:absolute; left:76px; top:106603px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Comprehensive: cyclic garbage collected naturally</span></div>
<div class="txt" style="position:absolute; left:76px; top:106675px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Simple to implement a reasonably efficient copying GC</span></div>
<img id="background" style="position:absolute; left:0px; top:107028px;" width="1440" height="1080" src="page90.png"> <img id="background" style="position:absolute; left:1440px; top:107028px;" width="1440" height="1080" src="page-000090.png">
<div class="txt" style="position:absolute; left:426px; top:107045px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:107135px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Disadvantages of copying GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:107275px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Stop-and-copy may be disruptive</span></div>
<div class="txt" style="position:absolute; left:76px; top:107344px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Degrades with residency </span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">堆空间的使用性能降低</span></div>
<div class="txt" style="position:absolute; left:76px; top:107419px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Requires twice the address space of other simple collectors</span></div>
<div class="txt" style="position:absolute; left:112px; top:107486px;"><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">touch twice as many pages</span></div>
<div class="txt" style="position:absolute; left:112px; top:107546px;"><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">trade-off against fragmentation</span></div>
<div class="txt" style="position:absolute; left:76px; top:107612px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Cost of copying large objects</span></div>
<div class="txt" style="position:absolute; left:76px; top:107684px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Long-lived data may be repeatedly copied</span></div>
<div class="txt" style="position:absolute; left:76px; top:107828px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">All references must be updated</span></div>
<div class="txt" style="position:absolute; left:76px; top:107900px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Moving objects may break mutator invariants</span></div>
<div class="txt" style="position:absolute; left:76px; top:107972px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Breadth-first copying may disturb locality patterns</span></div>
<img id="background" style="position:absolute; left:0px; top:108230px;" width="1440" height="1080" src="page91.png"> <img id="background" style="position:absolute; left:1440px; top:108230px;" width="1440" height="1080" src="page-000091.png">
<div class="txt" style="position:absolute; left:426px; top:108247px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:108332px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Complexity: caveat emptor</span><span id="f46" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">买者自负</span></div>
<div class="txt" style="position:absolute; left:76px; top:108474px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Claim: “Copying is always better than mark</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-</span><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">sweep GC” </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">复制具有</span></div>
<div class="txt" style="position:absolute; left:112px; top:108522px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">更好的效果</span></div>
<div class="txt" style="position:absolute; left:76px; top:108669px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The collectors we've seen so far are very simple minded</span></div>
<div class="txt" style="position:absolute; left:112px; top:108719px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Let us compare their basic performance…</span></div>
<div class="txt" style="position:absolute; left:76px; top:108858px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Copying is more expensive than setting a bit </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">复制代价高于标记</span></div>
<div class="txt" style="position:absolute; left:76px; top:108933px;"><span id="f10" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Efficient implementations of mark-sweep are dominated by cost of</span></div>
<div class="txt" style="position:absolute; left:112px; top:108978px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">mark phase </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">标记</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">-</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">移除方法的有效实现主要在于标记阶段的成本</span></div>
<div class="txt" style="position:absolute; left:112px; top:109048px;"><span id="f40" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">linear scanning less expensive than tracing, and</span></div>
<div class="txt" style="position:absolute; left:112px; top:109108px;"><span id="f40" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">cost of sweep can be reduced further</span></div>
<img id="background" style="position:absolute; left:0px; top:109432px;" width="1440" height="1080" src="page92.png"> <img id="background" style="position:absolute; left:1440px; top:109432px;" width="1440" height="1080" src="page-000092.png">
<div class="txt" style="position:absolute; left:426px; top:109449px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:109539px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Mark-sweep vs. copying</span></div>
<div class="txt" style="position:absolute; left:122px; top:109674px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">M </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">heap size</span></div>
<div class="txt" style="position:absolute; left:122px; top:109722px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">R </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">live memory (residency)</span></div>
<div class="txt" style="position:absolute; left:122px; top:109771px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">r </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">= </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">R/M</span></div>
<div class="txt" style="position:absolute; left:122px; top:109843px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Time</span></div>
<div class="txt" style="position:absolute; left:122px; top:109898px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">t</span><span id="f13" style="font-size:24px;vertical-align:sub;color:rgba(0,0,0,1);">Copy </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">= aR</span></div>
<div class="txt" style="position:absolute; left:122px; top:109951px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">t</span><span id="f13" style="font-size:24px;vertical-align:sub;color:rgba(0,0,0,1);">MS </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">= bR + cM</span></div>
<div class="txt" style="position:absolute; left:122px; top:110026px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Space recovered</span></div>
<div class="txt" style="position:absolute; left:122px; top:110080px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">m</span><span id="f13" style="font-size:24px;vertical-align:sub;color:rgba(0,0,0,1);">Copy </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">= M/</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">2 </span><span id="f37" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">R</span></div>
<div class="txt" style="position:absolute; left:122px; top:110133px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">m</span><span id="f13" style="font-size:24px;vertical-align:sub;color:rgba(0,0,0,1);">MS </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">= M </span><span id="f37" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">R</span></div>
<div class="txt" style="position:absolute; left:651px; top:110156px;"><span id="f69" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,134,1);">1/</span><span id="f70" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,134,1);">c</span></div>
<div class="txt" style="position:absolute; left:122px; top:110208px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Efficiency </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">m/t</span></div>
<div class="txt" style="position:absolute; left:122px; top:110263px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">e</span><span id="f13" style="font-size:24px;vertical-align:sub;color:rgba(0,0,0,1);">Copy </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">= </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(1-2</span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">r</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">)/2</span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">ar</span></div>
<div class="txt" style="position:absolute; left:122px; top:110316px;"><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">e</span><span id="f13" style="font-size:24px;vertical-align:sub;color:rgba(0,0,0,1);">MS </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">= </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(1-</span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">r</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">)/(</span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">br + c</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">)</span></div>
<div class="txt" style="position:absolute; left:672px; top:110336px;"><span id="f69" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">0</span></div>
<div class="txt" style="position:absolute; left:699px; top:110372px;"><span id="f69" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">0</span></div>
<div class="txt" style="position:absolute; left:997px; top:110051px;"><span id="f69" style="font-size:28px;vertical-align:baseline;color:rgba(255,0,0,1);">Copying</span></div>
<div class="txt" style="position:absolute; left:947px; top:110080px;"><span id="f69" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,134,1);">Mark-Sweep</span></div>
<div class="txt" style="position:absolute; left:901px; top:110372px;"><span id="f70" style="font-size:28px;vertical-align:baseline;color:rgba(255,0,0,1);">r*</span></div>
<div class="txt" style="position:absolute; left:1006px; top:110372px;"><span id="f69" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">0.5 </span><span id="f69" style="font-size:28px;vertical-align:sub;color:rgba(0,0,0,1);">residency, </span><span id="f70" style="font-size:28px;vertical-align:sub;color:rgba(0,0,0,1);">r</span></div>
<div class="txt" style="position:absolute; left:1339px; top:110372px;"><span id="f69" style="font-size:28px;vertical-align:baseline;color:rgba(0,0,0,1);">1</span></div>
<img id="background" style="position:absolute; left:0px; top:110634px;" width="1440" height="1080" src="page93.png"> <img id="background" style="position:absolute; left:1440px; top:110634px;" width="1440" height="1080" src="page-000093.png">
<div class="txt" style="position:absolute; left:1105px; top:110652px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:265px; top:111049px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">6 Garbage Collection in JVM</span></div>
<img id="background" style="position:absolute; left:0px; top:111836px;" width="1440" height="1080" src="page94.png"> <img id="background" style="position:absolute; left:1440px; top:111836px;" width="1440" height="1080" src="page-000094.png">
<div class="txt" style="position:absolute; left:426px; top:111853px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:111943px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Java Garbage Collector</span></div>
<div class="txt" style="position:absolute; left:76px; top:112083px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Java garbage collector can logically separate the heap into</span></div>
<div class="txt" style="position:absolute; left:112px; top:112133px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">different areas, so that the GC can faster identify objects which can</span></div>
<div class="txt" style="position:absolute; left:112px; top:112176px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">get removed. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Java</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">垃圾回收将堆划分成不同的区域</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(generation</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">代</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，</span></div>
<div class="txt" style="position:absolute; left:112px; top:112224px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">以便</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">可以更快地识别可以删除的对象</span></div>
<div class="txt" style="position:absolute; left:76px; top:112299px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The JVM automatically re-collects the memory which is not used</span></div>
<div class="txt" style="position:absolute; left:112px; top:112349px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">any more.</span></div>
<div class="txt" style="position:absolute; left:112px; top:112414px;"><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The memory for objects which are not referred any more will be</span></div>
<div class="txt" style="position:absolute; left:148px; top:112457px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">automatically released by the garbage collector.</span></div>
<div class="txt" style="position:absolute; left:112px; top:112517px;"><span id="f41" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">To see that the garbage collector starts working add the command line</span></div>
<div class="txt" style="position:absolute; left:148px; top:112560px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">argument </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">"</span><span id="f49" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,255,1);">-verbose:gc</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">" to your virtual machine.</span></div>
<img id="background" style="position:absolute; left:0px; top:113038px;" width="1440" height="1080" src="page95.png"> <img id="background" style="position:absolute; left:1440px; top:113038px;" width="1440" height="1080" src="page-000095.png">
<div class="txt" style="position:absolute; left:426px; top:113055px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:113145px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage Collection in JVM</span></div>
<div class="txt" style="position:absolute; left:76px; top:113285px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The HotSpot VM (Sun JVM) has three major spaces: </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">young</span></div>
<div class="txt" style="position:absolute; left:112px; top:113335px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">generation, old generation, and permanent/metaspace generation.</span></div>
<div class="txt" style="position:absolute; left:112px; top:113400px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When a Java application allocates Java objects, those objects are allocated</span></div>
<div class="txt" style="position:absolute; left:148px; top:113439px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">in the young generation space. </span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">新对象分配到</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">young generation</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中</span></div>
<div class="txt" style="position:absolute; left:112px; top:113503px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects that survive, that is, those that remain live, after some number of</span></div>
<div class="txt" style="position:absolute; left:148px; top:113547px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">minor garbage collections are promoted into the old generation space. </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span></div>
<div class="txt" style="position:absolute; left:148px; top:113586px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">后仍然存活的对象，提升到</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">old generation</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中</span></div>
<div class="txt" style="position:absolute; left:112px; top:113650px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The permanent generation space holds VM and Java class metadata as</span></div>
<div class="txt" style="position:absolute; left:148px; top:113690px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">well as interned Strings and class static variables </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">PermGen/Metaspace</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中</span></div>
<div class="txt" style="position:absolute; left:148px; top:113733px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">保存</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">VM</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">class</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">的元数据，以及类的静态变量</span></div>
<div class="txt" style="position:absolute; left:1188px; top:113859px;"><span id="f44" style="font-size:35px;vertical-align:baseline;color:rgba(0,0,0,1);">metaspace</span></div>
<img id="background" style="position:absolute; left:0px; top:114240px;" width="1440" height="1080" src="page96.png"> <img id="background" style="position:absolute; left:1440px; top:114240px;" width="1440" height="1080" src="page-000096.png">
<div class="txt" style="position:absolute; left:426px; top:114257px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:114347px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage Collection in JVM</span></div>
<img id="background" style="position:absolute; left:0px; top:115442px;" width="1440" height="1080" src="page97.png"> <img id="background" style="position:absolute; left:1440px; top:115442px;" width="1440" height="1080" src="page-000097.png">
<div class="txt" style="position:absolute; left:426px; top:115459px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:115549px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Generational Collection GC algorithms</span></div>
<div class="txt" style="position:absolute; left:76px; top:115689px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Generational Collection GC algorithms</span></div>
<div class="txt" style="position:absolute; left:112px; top:115756px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The various GC algorithms discussed above have their own advantages</span></div>
<div class="txt" style="position:absolute; left:148px; top:115799px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and disadvantages. It’s wise to use appropriate algorithm according to the</span></div>
<div class="txt" style="position:absolute; left:148px; top:115842px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">characteristics of GC objects.</span></div>
<div class="txt" style="position:absolute; left:76px; top:115908px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Generational Collection divides memory space into several pieces</span></div>
<div class="txt" style="position:absolute; left:112px; top:115958px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(young generation, old (tenured) generation, and permanent</span></div>
<div class="txt" style="position:absolute; left:112px; top:116006px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">generation) /metaspace and use different GC algorithms according</span></div>
<div class="txt" style="position:absolute; left:112px; top:116054px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to the characteristics of each memory pieces, in order to improve</span></div>
<div class="txt" style="position:absolute; left:112px; top:116097px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the efficiency of garbage collection. </span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">根据不同代的不同特征，采用不</span></div>
<div class="txt" style="position:absolute; left:112px; top:116145px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">同的</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">算法</span></div>
<img id="background" style="position:absolute; left:0px; top:116644px;" width="1440" height="1080" src="page98.png"> <img id="background" style="position:absolute; left:1440px; top:116644px;" width="1440" height="1080" src="page-000098.png">
<div class="txt" style="position:absolute; left:426px; top:116661px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:116751px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The Yong and Old Generations</span></div>
<div class="txt" style="position:absolute; left:76px; top:116891px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the young generation</span></div>
<div class="txt" style="position:absolute; left:112px; top:116958px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Each time garbage collection will find a large number of objects die, and</span></div>
<div class="txt" style="position:absolute; left:148px; top:116997px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">only a small amount survive. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">每次</span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">会发现大量死亡对象，少量存活对象</span></div>
<div class="txt" style="position:absolute; left:112px; top:117061px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">So the </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">copying algorithm is appropriate </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">which only needs to pay the cost of</span></div>
<div class="txt" style="position:absolute; left:148px; top:117101px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">copying a small amount of living objects. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">复制算法适合，代价低</span></div>
<div class="txt" style="position:absolute; left:76px; top:117170px;"><span id="f12" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In the old generation</span></div>
<div class="txt" style="position:absolute; left:112px; top:117237px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Because objects have a high survival rate and no additional memory space to</span></div>
<div class="txt" style="position:absolute; left:148px; top:117280px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">be allocated, the </span><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">Mark-Sweep or Mark-Compact </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">algorithm must be used for</span></div>
<div class="txt" style="position:absolute; left:148px; top:117320px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">collection. </span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对象存活率高，适合采用标记算法</span></div>
<img id="background" style="position:absolute; left:0px; top:117846px;" width="1440" height="1080" src="page99.png"> <img id="background" style="position:absolute; left:1440px; top:117846px;" width="1440" height="1080" src="page-000099.png">
<div class="txt" style="position:absolute; left:426px; top:117863px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:117953px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The PermGen and Metaspace</span></div>
<div class="txt" style="position:absolute; left:76px; top:118093px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">PermGen (Permanent Generation) is a special heap space separated</span></div>
<div class="txt" style="position:absolute; left:112px; top:118143px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">from the main memory heap.</span></div>
<div class="txt" style="position:absolute; left:76px; top:118213px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The JVM keeps track of loaded </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">class metadata </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in the PermGen.</span></div>
<div class="txt" style="position:absolute; left:112px; top:118263px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Additionally, the JVM stores all the static content in this memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:118311px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">section. This includes </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">all the static methods, primitive variables, and</span></div>
<div class="txt" style="position:absolute; left:112px; top:118359px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">references to the static objects. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Furthermore, it contains data about</span></div>
<div class="txt" style="position:absolute; left:112px; top:118407px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">bytecode, names and JIT information. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Before Java 7, </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">the String Pool</span></div>
<div class="txt" style="position:absolute; left:112px; top:118450px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">was also part of this memory. </span><span id="f41" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">PermGen</span><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">中保存类的定义、静态方法</span></div>
<div class="txt" style="position:absolute; left:112px; top:118498px;"><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">、静态对象的引用等内容</span></div>
<div class="txt" style="position:absolute; left:76px; top:118573px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">With its limited memory size, PermGen is involved in generating the</span></div>
<div class="txt" style="position:absolute; left:112px; top:118622px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">famous </span><span id="f55" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">OutOfMemoryError. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Simply put, the class loaders </span><span id="f60" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">aren’t</span></div>
<div class="txt" style="position:absolute; left:112px; top:118671px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collected properly and, as a result, generated a memory leak.</span></div>
<div class="txt" style="position:absolute; left:112px; top:118719px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Therefore, we receive a memory space error; this happens mostly on</span></div>
<div class="txt" style="position:absolute; left:112px; top:118762px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">development environment while creating new class loaders. </span><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">缺点：</span></div>
<div class="txt" style="position:absolute; left:112px; top:118810px;"><span id="f41" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">PermGen</span><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的容量是固定的</span><span id="f41" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">缺省或指定</span><span id="f41" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">)</span><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">， 固定的容量容易导致运行时</span></div>
<div class="txt" style="position:absolute; left:112px; top:118858px;"><span id="f44" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的内存溢出错误</span></div>
<img id="background" style="position:absolute; left:0px; top:119048px;" width="1440" height="1080" src="page100.png"> <img id="background" style="position:absolute; left:1440px; top:119048px;" width="1440" height="1080" src="page-000100.png">
<div class="txt" style="position:absolute; left:426px; top:119065px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:119155px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The PermGen and Meatspace</span></div>
<div class="txt" style="position:absolute; left:76px; top:119295px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Simply put, Metaspace is a new memory space </span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">starting from the Java</span></div>
<div class="txt" style="position:absolute; left:112px; top:119345px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">8 version; it has replaced the older PermGen memory space. The most</span></div>
<div class="txt" style="position:absolute; left:112px; top:119393px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">significant difference is how it handles the memory allocation. </span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Java 8</span></div>
<div class="txt" style="position:absolute; left:112px; top:119436px;"><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">开始，用</span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Metaspace</span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">替代了</span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">PermGen</span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，区别在内存分配方面</span></div>
<div class="txt" style="position:absolute; left:76px; top:119511px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">As a result, this native memory region grows automatically by default.</span></div>
<div class="txt" style="position:absolute; left:112px; top:119561px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Additionally, the garbage collection process also gains some benefits</span></div>
<div class="txt" style="position:absolute; left:112px; top:119609px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">from this change. The garbage collector now automatically triggers</span></div>
<div class="txt" style="position:absolute; left:112px; top:119657px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">cleaning of the dead classes once the class metadata usage reaches its</span></div>
<div class="txt" style="position:absolute; left:112px; top:119700px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">maximum metaspace size. </span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Metaspace</span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的容量是自动增长的，此外，当</span></div>
<div class="txt" style="position:absolute; left:112px; top:119748px;"><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类的元数据使用达到了</span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">metaspace</span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">最大值时，会自动触发</span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:119823px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Therefore, with this improvement, JVM reduces the chance to get</span></div>
<div class="txt" style="position:absolute; left:112px; top:119868px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the </span><span id="f63" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">OutOfMemory </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">error. </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">降低了</span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">OutOfMemory </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的风险</span></div>
<div class="txt" style="position:absolute; left:76px; top:119943px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Despite all of this improvements, we still need to monitor and tune</span></div>
<div class="txt" style="position:absolute; left:112px; top:119988px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">up the metaspace to avoid memory leaks. </span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">但仍然需要监控和调优，避</span></div>
<div class="txt" style="position:absolute; left:112px; top:120036px;"><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">免内存泄漏</span></div>
<img id="background" style="position:absolute; left:0px; top:120250px;" width="1440" height="1080" src="page101.png"> <img id="background" style="position:absolute; left:1440px; top:120250px;" width="1440" height="1080" src="page-000101.png">
<div class="txt" style="position:absolute; left:426px; top:120267px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:120357px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">When Garbage Collection occurs</span></div>
<div class="txt" style="position:absolute; left:76px; top:120497px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It is important to understand that a garbage collection occurs when</span></div>
<div class="txt" style="position:absolute; left:112px; top:120547px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">any one of the three spaces, young generation, old generation, or</span></div>
<div class="txt" style="position:absolute; left:112px; top:120595px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">permanent/meatspace generation, is in a state where it can no</span></div>
<div class="txt" style="position:absolute; left:112px; top:120643px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">longer satisfy an allocation event.</span></div>
<div class="txt" style="position:absolute; left:76px; top:120713px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In other words, a garbage collection occurs when any one of those</span></div>
<div class="txt" style="position:absolute; left:112px; top:120763px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">three spaces is considered full and there is some request for</span></div>
<div class="txt" style="position:absolute; left:112px; top:120806px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">additional space that is not available. </span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">三个空间任何一个已满，且存</span></div>
<div class="txt" style="position:absolute; left:112px; top:120854px;"><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在对空间的额外需求时，会发生</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span></div>
<img id="background" style="position:absolute; left:0px; top:121452px;" width="1440" height="1080" src="page102.png"> <img id="background" style="position:absolute; left:1440px; top:121452px;" width="1440" height="1080" src="page-000102.png">
<div class="txt" style="position:absolute; left:426px; top:121469px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:121559px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Minor, Major and Full Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:121699px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Minor Collection for young generation</span></div>
<div class="txt" style="position:absolute; left:76px; top:121771px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Major Collection for old generation</span></div>
<div class="txt" style="position:absolute; left:76px; top:121840px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">Full Collection for young</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">、</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">old and permanent generation</span></div>
<div class="txt" style="position:absolute; left:76px; top:121915px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When the young generation space does not have enough room</span></div>
<div class="txt" style="position:absolute; left:112px; top:121965px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">available to satisfy a Java object allocation, the HotSpot VM performs</span></div>
<div class="txt" style="position:absolute; left:112px; top:122013px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">a minor garbage collection to free up space. Minor garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:122061px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collections tend to be short in duration relative to full garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:122104px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collections. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">年轻代中内存不够时，发生</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Minor GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:122179px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Objects that remain live for some number of minor garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:122229px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collections eventually get promoted (copied) to the old generation</span></div>
<div class="txt" style="position:absolute; left:112px; top:122272px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">space. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Minor GC</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">后存活的对象升级到老年代</span></div>
<div class="txt" style="position:absolute; left:76px; top:122347px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When the old generation space no longer has available space for</span></div>
<div class="txt" style="position:absolute; left:112px; top:122397px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">promoted objects, the HotSpot VM performs a full garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:122440px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collection. </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">老年代空间不够时，进行</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">full GC</span></div>
<img id="background" style="position:absolute; left:0px; top:122654px;" width="1440" height="1080" src="page103.png"> <img id="background" style="position:absolute; left:1440px; top:122654px;" width="1440" height="1080" src="page-000103.png">
<div class="txt" style="position:absolute; left:426px; top:122671px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:122761px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Minor, Major and Full Garbage Collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:122901px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It actually performs a full garbage collection when it determines</span></div>
<div class="txt" style="position:absolute; left:112px; top:122951px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">there is not enough available space for object promotions from the</span></div>
<div class="txt" style="position:absolute; left:112px; top:122999px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">next minor garbage collection. This is a less costly approach rather</span></div>
<div class="txt" style="position:absolute; left:112px; top:123047px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than being in the middle of a minor garbage collection and</span></div>
<div class="txt" style="position:absolute; left:112px; top:123095px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">discovering that the promotion of an object will fail.</span></div>
<div class="txt" style="position:absolute; left:76px; top:123165px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Recovering from an object promotion failure is an expensive</span></div>
<div class="txt" style="position:absolute; left:112px; top:123215px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">operation. A full garbage collection also occurs when the</span></div>
<div class="txt" style="position:absolute; left:112px; top:123263px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">permanent generation space does not have enough available space</span></div>
<div class="txt" style="position:absolute; left:112px; top:123306px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to store additional VM or class metadata. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">full GC</span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">针对年轻代、老年</span></div>
<div class="txt" style="position:absolute; left:112px; top:123354px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">代和永久代，当没有空间提供给</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">minor GC</span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">将对象提升到老年代中，</span></div>
<div class="txt" style="position:absolute; left:112px; top:123402px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">或者永久代中无空间保存</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">class</span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">元数据时发生。</span></div>
<img id="background" style="position:absolute; left:0px; top:123856px;" width="1440" height="1080" src="page104.png"> <img id="background" style="position:absolute; left:1440px; top:123856px;" width="1440" height="1080" src="page-000104.png">
<div class="txt" style="position:absolute; left:1105px; top:123874px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:140px; top:124271px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">7 Garbage Collection Tuning in JVM</span></div>
<img id="background" style="position:absolute; left:0px; top:125058px;" width="1440" height="1080" src="page105.png"> <img id="background" style="position:absolute; left:1440px; top:125058px;" width="1440" height="1080" src="page-000105.png">
<div class="txt" style="position:absolute; left:426px; top:125075px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:125165px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance Considerations in GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:125305px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance Considerations</span></div>
<div class="txt" style="position:absolute; left:112px; top:125371px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">Throughput </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is the percentage of total time not spent in garbage collection</span></div>
<div class="txt" style="position:absolute; left:148px; top:125415px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">considered over long periods of time. Throughput includes time spent in</span></div>
<div class="txt" style="position:absolute; left:148px; top:125454px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocation (but tuning for speed of allocation is generally not needed). </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">吞吐</span></div>
<div class="txt" style="position:absolute; left:148px; top:125498px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">量</span><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">:</span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">总时间中非用于垃圾回收的时间</span></div>
<div class="txt" style="position:absolute; left:112px; top:125562px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f34" style="font-size:33px;vertical-align:baseline;color:rgba(0,0,0,1);">Pauses </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">are the times when an application appears unresponsive because</span></div>
<div class="txt" style="position:absolute; left:148px; top:125601px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collection is occurring. </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">暂停</span><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">: </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">由于</span><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">导致的暂停次数</span></div>
<div class="txt" style="position:absolute; left:76px; top:125671px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Users have different requirements of garbage collection. For</span></div>
<div class="txt" style="position:absolute; left:112px; top:125720px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">example, some consider the right metric for a web server to be</span></div>
<div class="txt" style="position:absolute; left:112px; top:125768px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">throughput because pauses during garbage collection may be</span></div>
<div class="txt" style="position:absolute; left:112px; top:125816px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">tolerable or simply obscured by network latencies. However, in an</span></div>
<div class="txt" style="position:absolute; left:112px; top:125864px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">interactive graphics program, even short pauses may negatively</span></div>
<div class="txt" style="position:absolute; left:112px; top:125908px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">affect the user experience. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">不同用户有不同的</span><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">需求，</span><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">E.g.</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，</span><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Web</span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用</span></div>
<div class="txt" style="position:absolute; left:112px; top:125956px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">户追求高吞吐量，而图形交互程序则追求低暂停。</span></div>
<img id="background" style="position:absolute; left:0px; top:126260px;" width="1440" height="1080" src="page106.png"> <img id="background" style="position:absolute; left:1440px; top:126260px;" width="1440" height="1080" src="page-000106.png">
<div class="txt" style="position:absolute; left:426px; top:126277px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:126367px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance Considerations in GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:126507px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Some users are sensitive to other considerations.</span></div>
<div class="txt" style="position:absolute; left:112px; top:126573px;"><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f16" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">Footprint </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is the working set of a process, measured in pages and cache</span></div>
<div class="txt" style="position:absolute; left:148px; top:126617px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">lines. On systems with limited physical memory or many processes,</span></div>
<div class="txt" style="position:absolute; left:148px; top:126656px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">footprint may dictate </span><span id="f16" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">scalability(</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">可伸缩性</span><span id="f16" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">).</span></div>
<div class="txt" style="position:absolute; left:112px; top:126717px;"><span id="f14" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f16" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">Promptness(</span><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">及时性</span><span id="f16" style="font-size:33px;vertical-align:baseline;color:rgba(255,0,0,1);">) </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is the time between when an object becomes dead and</span></div>
<div class="txt" style="position:absolute; left:148px; top:126764px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">when the memory becomes available, an important consideration for</span></div>
<div class="txt" style="position:absolute; left:148px; top:126807px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">distributed systems, including Remote Method Invocation (RMI).</span></div>
<img id="background" style="position:absolute; left:0px; top:127462px;" width="1440" height="1080" src="page107.png"> <img id="background" style="position:absolute; left:1440px; top:127462px;" width="1440" height="1080" src="page-000107.png">
<div class="txt" style="position:absolute; left:426px; top:127479px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:127569px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Performance Considerations in GC</span></div>
<div class="txt" style="position:absolute; left:76px; top:127709px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">I</span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">n general, choosing the size for a particular generation is a trade-</span></div>
<div class="txt" style="position:absolute; left:112px; top:127759px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">off between these considerations. </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, a very large young</span></div>
<div class="txt" style="position:absolute; left:112px; top:127807px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">generation may maximize throughput, but does so at the expense of</span></div>
<div class="txt" style="position:absolute; left:112px; top:127855px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">footprint, promptness, and pause times. Young generation pauses</span></div>
<div class="txt" style="position:absolute; left:112px; top:127903px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">can be minimized by using a small young generation at the expense</span></div>
<div class="txt" style="position:absolute; left:112px; top:127951px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">of throughput. </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The sizing of one generation does not affect the</span></div>
<div class="txt" style="position:absolute; left:112px; top:127994px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collection frequency and pause times for another generation</span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">需要</span></div>
<div class="txt" style="position:absolute; left:112px; top:128045px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">根据各种情况权衡代的容量，一个代的容量不影响其他代的回收频率</span></div>
<div class="txt" style="position:absolute; left:112px; top:128090px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">和暂停时间。</span></div>
<div class="txt" style="position:absolute; left:76px; top:128165px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">There is no one right way to choose the size of a generation. The</span></div>
<div class="txt" style="position:absolute; left:112px; top:128215px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">best choice is determined by the way the application uses memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:128258px;"><span id="f14" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">as well as user requirements. </span><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">没有普适的容量设置准则，应根据应</span></div>
<div class="txt" style="position:absolute; left:112px; top:128306px;"><span id="f27" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用的内存使用和用户需求进行具体问题具体分析。</span></div>
<img id="background" style="position:absolute; left:0px; top:128664px;" width="1440" height="1080" src="page108.png"> <img id="background" style="position:absolute; left:1440px; top:128664px;" width="1440" height="1080" src="page-000108.png">
<div class="txt" style="position:absolute; left:426px; top:128681px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:128771px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage Collection Tuning in JVM</span></div>
<div class="txt" style="position:absolute; left:76px; top:128911px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A best practice is to tune the time spent doing garbage collection to</span></div>
<div class="txt" style="position:absolute; left:112px; top:128956px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">within 5% of execution time. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">最佳做法是将</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">时间控制在执行时间</span></div>
<div class="txt" style="position:absolute; left:112px; top:129004px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">5%</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">之内</span></div>
<div class="txt" style="position:absolute; left:76px; top:129151px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">The JVM runs with fixed available memory. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Once this memory is</span></div>
<div class="txt" style="position:absolute; left:112px; top:129200px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">exceeded you will receive "</span><span id="f33" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">java.lang.OutOfMemoryError</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">".</span></div>
<div class="txt" style="position:absolute; left:234px; top:129270px;"><span id="f33" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">"Exception in thread java.lang.OutOfMemoryError:</span></div>
<div class="txt" style="position:absolute; left:540px; top:129313px;"><span id="f33" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">Java heap space".</span></div>
<div class="txt" style="position:absolute; left:76px; top:129379px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The JVM tries to make an intelligent choice about the available</span></div>
<div class="txt" style="position:absolute; left:112px; top:129429px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory at startup but you can overwrite the default with the</span></div>
<div class="txt" style="position:absolute; left:112px; top:129472px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">following settings. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">JVM</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">在启动时提供了缺省的设置，可根据具体需</span></div>
<div class="txt" style="position:absolute; left:112px; top:129520px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">求自行重新设定。</span></div>
<img id="background" style="position:absolute; left:0px; top:129866px;" width="1440" height="1080" src="page109.png"> <img id="background" style="position:absolute; left:1440px; top:129866px;" width="1440" height="1080" src="page-000109.png">
<div class="txt" style="position:absolute; left:426px; top:129883px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:129973px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Tuning JVM's garbage collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:130113px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Specifying VM heap size</span></div>
<div class="txt" style="position:absolute; left:76px; top:130185px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Choosing a garbage collection scheme</span></div>
<div class="txt" style="position:absolute; left:76px; top:130257px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Using </span><span id="f19" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,255,1);">verbose </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collection to determine heap size</span></div>
<div class="txt" style="position:absolute; left:76px; top:130329px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Automatically logging low memory conditions</span></div>
<div class="txt" style="position:absolute; left:76px; top:130401px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Manually requesting garbage collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:130473px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Requesting thread stacks</span></div>
<img id="background" style="position:absolute; left:0px; top:131068px;" width="1440" height="1080" src="page110.png"> <img id="background" style="position:absolute; left:1440px; top:131068px;" width="1440" height="1080" src="page-000110.png">
<div class="txt" style="position:absolute; left:426px; top:131085px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:131175px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Tuning VM Heap Size</span></div>
<img id="background" style="position:absolute; left:0px; top:132270px;" width="1440" height="1080" src="page111.png"> <img id="background" style="position:absolute; left:1440px; top:132270px;" width="1440" height="1080" src="page-000111.png">
<div class="txt" style="position:absolute; left:426px; top:132287px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:132377px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Tuning VM Heap Size</span></div>
<div class="txt" style="position:absolute; left:76px; top:132517px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Java heap is where the objects of a Java program live. It is a</span></div>
<div class="txt" style="position:absolute; left:112px; top:132567px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">repository for live objects, dead objects, and free memory.</span></div>
<div class="txt" style="position:absolute; left:112px; top:132632px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">When an object can no longer be reached from any pointer in the running</span></div>
<div class="txt" style="position:absolute; left:148px; top:132675px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">program, it is considered "garbage" and ready for collection.</span></div>
<div class="txt" style="position:absolute; left:76px; top:132741px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The JVM heap size determines how often and how long the VM</span></div>
<div class="txt" style="position:absolute; left:112px; top:132786px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">spends collecting garbage. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">JVM</span><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">堆大小决定了虚拟机收集垃圾的频率</span></div>
<div class="txt" style="position:absolute; left:112px; top:132834px;"><span id="f26" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">和时间长短。</span></div>
<div class="txt" style="position:absolute; left:112px; top:132903px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">An acceptable rate for garbage collection is application-specific and</span></div>
<div class="txt" style="position:absolute; left:148px; top:132947px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">should be adjusted after analyzing the actual time and frequency of</span></div>
<div class="txt" style="position:absolute; left:148px; top:132986px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collections. </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">对于特定的程序，应分析实际情况后进行调整</span></div>
<div class="txt" style="position:absolute; left:112px; top:133050px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If you set a large heap size, full garbage collection is slower, but it occurs</span></div>
<div class="txt" style="position:absolute; left:148px; top:133090px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">less frequently. </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">较大的堆，</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">速度慢，</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">频率低</span></div>
<div class="txt" style="position:absolute; left:112px; top:133154px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If you set your heap size in accordance with your memory needs, full</span></div>
<div class="txt" style="position:absolute; left:148px; top:133193px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collection is faster, but occurs more frequently.</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">如果根据内存需求</span></div>
<div class="txt" style="position:absolute; left:148px; top:133237px;"><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">设置堆大小，则完整垃圾回收速度会更快，但会更频繁地发生。</span></div>
<img id="background" style="position:absolute; left:0px; top:133472px;" width="1440" height="1080" src="page112.png"> <img id="background" style="position:absolute; left:1440px; top:133472px;" width="1440" height="1080" src="page-000112.png">
<div class="txt" style="position:absolute; left:426px; top:133489px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:133579px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Tuning VM Heap Size</span></div>
<div class="txt" style="position:absolute; left:76px; top:133719px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xmx </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xms </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">command line options specify the initial and</span></div>
<div class="txt" style="position:absolute; left:112px; top:133769px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">maximum total size of the young generation and old generation</span></div>
<div class="txt" style="position:absolute; left:112px; top:133817px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">spaces. This initial and maximum size is also referred to as the Java</span></div>
<div class="txt" style="position:absolute; left:112px; top:133865px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">heap size.</span></div>
<div class="txt" style="position:absolute; left:112px; top:133926px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Java </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">–</span><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Xms 1024M </span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">年轻代和老年代之和的初始值</span></div>
<div class="txt" style="position:absolute; left:112px; top:133987px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Java </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">–</span><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Xmx 2048M </span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">年轻代和老年代之和的最大值</span></div>
<div class="txt" style="position:absolute; left:76px; top:134056px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xms </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is smaller than </span><span id="f15" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xmx</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">, the amount of space consumed by</span></div>
<div class="txt" style="position:absolute; left:112px; top:134106px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">young and old generation spaces is allowed to grow or contract</span></div>
<div class="txt" style="position:absolute; left:112px; top:134154px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">depending on the needs of the application.</span></div>
<div class="txt" style="position:absolute; left:112px; top:134218px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The growth of the Java heap will never be larger than </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">–</span><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Xmx</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">, and the Java</span></div>
<div class="txt" style="position:absolute; left:148px; top:134262px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">heap will never contract smaller than </span><span id="f28" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">–</span><span id="f15" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Xms</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:112px; top:134322px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Growing or contracting the size of either the young generation space or</span></div>
<div class="txt" style="position:absolute; left:148px; top:134366px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">old generation space requires a full garbage collection.</span></div>
<div class="txt" style="position:absolute; left:112px; top:134426px;"><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Full garbage collections can reduce throughput and induce larger than</span></div>
<div class="txt" style="position:absolute; left:148px; top:134469px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">desired latencies.</span></div>
<img id="background" style="position:absolute; left:0px; top:134674px;" width="1440" height="1080" src="page113.png"> <img id="background" style="position:absolute; left:1440px; top:134674px;" width="1440" height="1080" src="page-000113.png">
<div class="txt" style="position:absolute; left:426px; top:134691px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:134781px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Tuning VM Heap Size</span></div>
<div class="txt" style="position:absolute; left:76px; top:134921px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The young generation space is specified using any one of the</span></div>
<div class="txt" style="position:absolute; left:112px; top:134971px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">following command line options:</span></div>
<div class="txt" style="position:absolute; left:112px; top:135035px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX: NewSize=&lt;n&gt;[g|m|k] </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The initial and minimum size of the</span></div>
<div class="txt" style="position:absolute; left:148px; top:135079px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">young generation space. &lt;n&gt; is the size. [g|m|k] indicates whether the</span></div>
<div class="txt" style="position:absolute; left:148px; top:135118px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">size should be interpreted as gigabytes, megabytes, or kilobytes. </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">最小值</span></div>
<div class="txt" style="position:absolute; left:112px; top:135182px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX: MaxNewSize=&lt;n&gt;[g|m|k] </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The maximum size of the young</span></div>
<div class="txt" style="position:absolute; left:148px; top:135222px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">generation space. </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">最大值</span></div>
<div class="txt" style="position:absolute; left:112px; top:135286px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xmn&lt;n&gt;[g|m|k] </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Sets the initial, minimum, and maximum size of the</span></div>
<div class="txt" style="position:absolute; left:148px; top:135326px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">young generation space to the same value. </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">初始、最小、最大为同一值</span></div>
<img id="background" style="position:absolute; left:0px; top:135876px;" width="1440" height="1080" src="page114.png"> <img id="background" style="position:absolute; left:1440px; top:135876px;" width="1440" height="1080" src="page-000114.png">
<div class="txt" style="position:absolute; left:426px; top:135893px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:135983px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Tuning VM Heap Size</span></div>
<div class="txt" style="position:absolute; left:76px; top:136123px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The size of the old generation space is implicitly set based on the</span></div>
<div class="txt" style="position:absolute; left:112px; top:136168px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">size of the young generation space. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">老年代大小同年轻代大小相关</span></div>
<div class="txt" style="position:absolute; left:112px; top:136237px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The initial old generation space size is the value of </span><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xms minus -</span></div>
<div class="txt" style="position:absolute; left:148px; top:136281px;"><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">XX:NewSize</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:112px; top:136341px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The maximum old generation space size is the value of </span><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xmx minus -</span></div>
<div class="txt" style="position:absolute; left:148px; top:136384px;"><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">XX:MaxNewSize</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:112px; top:136445px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If </span><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xms </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and </span><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xmx </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">are set to the same value and </span><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xmn </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is used, or -</span></div>
<div class="txt" style="position:absolute; left:148px; top:136488px;"><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">XX:NewSize </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">is the same value </span><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">as -XX:MaxNewSize</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">, then the old</span></div>
<div class="txt" style="position:absolute; left:148px; top:136531px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">generation size is </span><span id="f22" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">-Xmx (or -Xms) minus -Xmn</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">.</span></div>
<div class="txt" style="position:absolute; left:252px; top:136666px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">If the garbage collector has become a bottleneck, you</span></div>
<div class="txt" style="position:absolute; left:330px; top:136714px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">may wish to customize the generation sizes.</span></div>
<div class="txt" style="position:absolute; left:257px; top:136761px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Check the </span><span id="f68" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">verbose </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collector output, and then</span></div>
<div class="txt" style="position:absolute; left:238px; top:136810px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">explore the sensitivity of your individual performance</span></div>
<div class="txt" style="position:absolute; left:341px; top:136858px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">metric to the garbage collector parameters.</span></div>
<img id="background" style="position:absolute; left:0px; top:137078px;" width="1440" height="1080" src="page115.png"> <img id="background" style="position:absolute; left:1440px; top:137078px;" width="1440" height="1080" src="page-000115.png">
<div class="txt" style="position:absolute; left:426px; top:137095px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:137185px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Tuning VM Heap Size</span></div>
<div class="txt" style="position:absolute; left:76px; top:137322px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The size of the Metaspace</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">：</span></div>
<div class="txt" style="position:absolute; left:112px; top:137388px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:MaxMetaspaceSize</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">，最大空间，默认没有限制。</span></div>
<div class="txt" style="position:absolute; left:112px; top:137448px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:MetaspaceSize</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">，初始空间大小，达到该值就会触发垃圾收集。同时</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span></div>
<div class="txt" style="position:absolute; left:148px; top:137495px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">会对该值进行调整：如果释放了大量的空间，就适当降低该值；如果释放了</span></div>
<div class="txt" style="position:absolute; left:148px; top:137535px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">很少的空间，那么在不超过</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">MaxMetaspaceSize</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">时，适当提高该值。</span></div>
<div class="txt" style="position:absolute; left:112px; top:137599px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:MinMetaspaceFreeRatio is the minimum percentage of class metadata</span></div>
<div class="txt" style="position:absolute; left:148px; top:137638px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">capacity free after garbage collection </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">在</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">之后，最小的</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Metaspace</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">剩余空</span></div>
<div class="txt" style="position:absolute; left:148px; top:137682px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">间容量的百分比。</span></div>
<div class="txt" style="position:absolute; left:112px; top:137746px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:MaxMetaspaceFreeRatio is the maximum percentage of class metadata</span></div>
<div class="txt" style="position:absolute; left:148px; top:137789px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">capacity free after a garbage collection to avoid a reduction in the amount of</span></div>
<div class="txt" style="position:absolute; left:148px; top:137828px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">space </span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">在</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">GC</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">之后，最大的</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Metaspace</span><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">剩余空间容量的百分比。</span></div>
<img id="background" style="position:absolute; left:0px; top:138280px;" width="1440" height="1080" src="page116.png"> <img id="background" style="position:absolute; left:1440px; top:138280px;" width="1440" height="1080" src="page-000116.png">
<div class="txt" style="position:absolute; left:426px; top:138297px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:138387px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(1) Tuning VM Heap Size</span></div>
<div class="txt" style="position:absolute; left:76px; top:138527px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:MinHeapFreeRatio=&lt;n&gt;</span></div>
<div class="txt" style="position:absolute; left:112px; top:138590px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">设置堆内存的最小空闲比例，在使用率小于 </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">n </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的情况下，</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">heap </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">进行收缩 ，</span></div>
<div class="txt" style="position:absolute; left:148px; top:138633px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Xmx==Xms </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的情况下无效</span></div>
<div class="txt" style="position:absolute; left:76px; top:138703px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:MaxHeapFreeRatio=&lt;n&gt;</span></div>
<div class="txt" style="position:absolute; left:112px; top:138765px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">设置堆内存的最大空闲比例，在使用率大于 </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">n </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的情况下 ，</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">heap </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">进行扩张 ，</span></div>
<div class="txt" style="position:absolute; left:148px; top:138809px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Xmx==Xms </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的情况下无效</span></div>
<div class="txt" style="position:absolute; left:76px; top:138878px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:NewRatio=&lt;n&gt;</span></div>
<div class="txt" style="position:absolute; left:112px; top:138941px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">指定</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Old Generation heap size </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">与 </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Young Generation </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的比例</span></div>
<div class="txt" style="position:absolute; left:76px; top:139011px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:SurvivorRatio=&lt;n&gt;</span></div>
<div class="txt" style="position:absolute; left:112px; top:139074px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">指 定 </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Young Generation </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">中 </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Eden Space </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">与一个 </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Survivor Space </span><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">的 </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">heap size</span></div>
<div class="txt" style="position:absolute; left:148px; top:139117px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">比例</span></div>
<img id="background" style="position:absolute; left:0px; top:139482px;" width="1440" height="1080" src="page117.png"> <img id="background" style="position:absolute; left:1440px; top:139482px;" width="1440" height="1080" src="page-000117.png">
<div class="txt" style="position:absolute; left:426px; top:139499px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:139589px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Choosing a Garbage Collection Scheme</span></div>
<div class="txt" style="position:absolute; left:76px; top:139729px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Depending on which JVM you are using, you can choose from</span></div>
<div class="txt" style="position:absolute; left:112px; top:139779px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">several garbage collection schemes to manage your system memory.</span></div>
<div class="txt" style="position:absolute; left:76px; top:139849px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Some garbage collection schemes are more appropriate for a given</span></div>
<div class="txt" style="position:absolute; left:112px; top:139899px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">type of application.</span></div>
<div class="txt" style="position:absolute; left:76px; top:139969px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Once you have an understanding of the workload of the application</span></div>
<div class="txt" style="position:absolute; left:112px; top:140019px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and the different garbage collection algorithms utilized by the JVM,</span></div>
<div class="txt" style="position:absolute; left:112px; top:140062px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">you can optimize the configuration of the garbage collection.</span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">一旦理</span></div>
<div class="txt" style="position:absolute; left:112px; top:140110px;"><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">解了应用程序的工作负载以及</span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">JVM</span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">使用的不同垃圾收集算法，就可以</span></div>
<div class="txt" style="position:absolute; left:112px; top:140158px;"><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">优化垃圾收集的配置。取决于：应用的需求和</span><span id="f28" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">JVM</span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的版本。</span></div>
<img id="background" style="position:absolute; left:0px; top:140684px;" width="1440" height="1080" src="page118.png"> <img id="background" style="position:absolute; left:1440px; top:140684px;" width="1440" height="1080" src="page-000118.png">
<div class="txt" style="position:absolute; left:426px; top:140701px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:140791px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Choosing a Garbage Collection Scheme</span></div>
<div class="txt" style="position:absolute; left:76px; top:140931px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">JVM has four types of </span><span id="f14" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">GC </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementations:</span></div>
<div class="txt" style="position:absolute; left:112px; top:140998px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Serial Garbage Collector</span></div>
<div class="txt" style="position:absolute; left:112px; top:141058px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Parallel Garbage Collector</span></div>
<div class="txt" style="position:absolute; left:112px; top:141119px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">CMS Garbage Collector</span></div>
<div class="txt" style="position:absolute; left:112px; top:141179px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">G1 Garbage Collector</span></div>
<img id="background" style="position:absolute; left:0px; top:141886px;" width="1440" height="1080" src="page119.png"> <img id="background" style="position:absolute; left:1440px; top:141886px;" width="1440" height="1080" src="page-000119.png">
<div class="txt" style="position:absolute; left:426px; top:141903px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:141993px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Choosing a Garbage Collection Scheme</span></div>
<div class="txt" style="position:absolute; left:76px; top:142133px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">The serial garbage collector is </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the simplest GC implementation, as it</span></div>
<div class="txt" style="position:absolute; left:112px; top:142183px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">basically works with a single thread. As a result, this GC</span></div>
<div class="txt" style="position:absolute; left:112px; top:142231px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementation freezes all application threads when it runs. Hence,</span></div>
<div class="txt" style="position:absolute; left:112px; top:142279px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">it is not a good idea to use it in multi-threaded applications like</span></div>
<div class="txt" style="position:absolute; left:112px; top:142322px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">server environments. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">串行收集器，使用一个线程进行垃圾回收，执</span></div>
<div class="txt" style="position:absolute; left:112px; top:142370px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">行时会冻结所有的应用线程，不适合多线程应用。</span></div>
<div class="txt" style="position:absolute; left:76px; top:142445px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The Serial GC is the garbage collector of choice for most applications</span></div>
<div class="txt" style="position:absolute; left:112px; top:142495px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">that do not have small pause time requirements and run on client-</span></div>
<div class="txt" style="position:absolute; left:112px; top:142538px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">style machines. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">适合不要求低暂停时间和单机程序。</span></div>
<div class="txt" style="position:absolute; left:76px; top:142613px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f36" style="font-size:24px;vertical-align:baseline;color:rgba(255,0,0,1);">-XX:+UseSerialGC</span></div>
<img id="background" style="position:absolute; left:0px; top:143088px;" width="1440" height="1080" src="page120.png"> <img id="background" style="position:absolute; left:1440px; top:143088px;" width="1440" height="1080" src="page-000120.png">
<div class="txt" style="position:absolute; left:426px; top:143105px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:143195px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Choosing a Garbage Collection Scheme</span></div>
<div class="txt" style="position:absolute; left:76px; top:143335px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">The throughput (parallel) collector </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">performs minor collections (on</span></div>
<div class="txt" style="position:absolute; left:112px; top:143385px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the young generation) in parallel, which can significantly reduce</span></div>
<div class="txt" style="position:absolute; left:112px; top:143433px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collection overhead. (but major collections are performed</span></div>
<div class="txt" style="position:absolute; left:112px; top:143476px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">using a single thread) </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">对年轻代的回收采用并行方式</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">(</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">多个线程</span><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">) </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，对</span></div>
<div class="txt" style="position:absolute; left:112px; top:143524px;"><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">老年代的回收还是单线程</span></div>
<div class="txt" style="position:absolute; left:76px; top:143599px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f33" style="font-size:24px;vertical-align:baseline;color:rgba(255,0,0,1);">-XX:+UseParallelGC</span></div>
<div class="txt" style="position:absolute; left:76px; top:143731px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f38" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It’s the default GC of the JVM and sometimes called Throughput</span></div>
<div class="txt" style="position:absolute; left:112px; top:143781px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Collectors. But it also freezes other application threads while</span></div>
<div class="txt" style="position:absolute; left:112px; top:143829px;"><span id="f22" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">performing GC.</span></div>
<img id="background" style="position:absolute; left:0px; top:144290px;" width="1440" height="1080" src="page121.png"> <img id="background" style="position:absolute; left:1440px; top:144290px;" width="1440" height="1080" src="page-000121.png">
<div class="txt" style="position:absolute; left:426px; top:144307px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:144397px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Choosing a Garbage Collection Scheme</span></div>
<div class="txt" style="position:absolute; left:76px; top:144537px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f14" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">Concurrent Mark Sweep (CMS) </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">implementation uses multiple</span></div>
<div class="txt" style="position:absolute; left:112px; top:144587px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collector threads for garbage collection. It’s designed for</span></div>
<div class="txt" style="position:absolute; left:112px; top:144635px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">applications that prefer shorter garbage collection pauses, and that</span></div>
<div class="txt" style="position:absolute; left:112px; top:144683px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">can afford to share processor resources with the garbage collector</span></div>
<div class="txt" style="position:absolute; left:112px; top:144726px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">while the application is running. </span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">利用多垃圾回收线程，适用于短回</span></div>
<div class="txt" style="position:absolute; left:112px; top:144774px;"><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">收暂停，且能够在应用程序运行时与垃圾收集器共享处理器资源。</span></div>
<div class="txt" style="position:absolute; left:76px; top:144849px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Simply put, applications using this type of GC respond slower on</span></div>
<div class="txt" style="position:absolute; left:112px; top:144894px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">average but do not stop responding to perform garbage collection.</span><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">应</span></div>
<div class="txt" style="position:absolute; left:112px; top:144942px;"><span id="f23" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用程序平均响应较慢，但不会停止响应以执行垃圾收集。</span></div>
<div class="txt" style="position:absolute; left:76px; top:145017px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f35" style="font-size:24px;vertical-align:baseline;color:rgba(255,0,0,1);">-XX:+UseParNewGC</span></div>
<img id="background" style="position:absolute; left:0px; top:145492px;" width="1440" height="1080" src="page122.png"> <img id="background" style="position:absolute; left:1440px; top:145492px;" width="1440" height="1080" src="page-000122.png">
<div class="txt" style="position:absolute; left:426px; top:145509px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:145599px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(2) Choosing a Garbage Collection Scheme</span></div>
<div class="txt" style="position:absolute; left:76px; top:145739px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">G1 (Garbage First) Garbage Collector </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">is designed for applications</span></div>
<div class="txt" style="position:absolute; left:112px; top:145789px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">running on multi-</span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">processor machines with large memory space. It’s</span></div>
<div class="txt" style="position:absolute; left:112px; top:145832px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">available since </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">JDK7 Update 4 </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and in later releases. </span><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">适用于运行在多</span></div>
<div class="txt" style="position:absolute; left:112px; top:145880px;"><span id="f24" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">处理器大内存空间的应用程序。</span></div>
<div class="txt" style="position:absolute; left:76px; top:145955px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Unlike other collectors, </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">G1 </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collector partitions the heap into a set of</span></div>
<div class="txt" style="position:absolute; left:112px; top:146005px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">equal-sized heap regions, each a contiguous range of virtual</span></div>
<div class="txt" style="position:absolute; left:112px; top:146052px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory. When performing garbage collections, </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">G1 </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">shows a</span></div>
<div class="txt" style="position:absolute; left:112px; top:146100px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">concurrent global marking phase (i.e. phase 1 known as </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">Marking) </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to</span></div>
<div class="txt" style="position:absolute; left:112px; top:146149px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">determine the liveness of objects throughout the heap.</span></div>
<div class="txt" style="position:absolute; left:76px; top:146219px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">After the mark phase is completed, </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">G1 </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">knows which regions are</span></div>
<div class="txt" style="position:absolute; left:112px; top:146269px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">mostly empty. It collects in these areas first, which usually yields a</span></div>
<div class="txt" style="position:absolute; left:112px; top:146316px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">significant amount of free space (i.e. phase 2 known as </span><span id="f13" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">Sweeping). </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It is</span></div>
<div class="txt" style="position:absolute; left:112px; top:146365px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">why this method of garbage collection is called Garbage-First.</span></div>
<div class="txt" style="position:absolute; left:76px; top:146435px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f54" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">-XX:+UseG1GC</span></div>
<img id="background" style="position:absolute; left:0px; top:146694px;" width="1440" height="1080" src="page123.png"> <img id="background" style="position:absolute; left:1440px; top:146694px;" width="1440" height="1080" src="page-000123.png">
<div class="txt" style="position:absolute; left:426px; top:146711px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:146801px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(3) Using verbose garbage collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:146941px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The verbose garbage collection option (verbosegc) enables you to</span></div>
<div class="txt" style="position:absolute; left:112px; top:146991px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">measure exactly how much time and resources are put into garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:147039px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">collection.</span></div>
<div class="txt" style="position:absolute; left:587px; top:147110px;"><span id="f19" style="font-size:26px;vertical-align:baseline;color:rgba(0,0,0,1);">-verbose:gc</span></div>
<div class="txt" style="position:absolute; left:76px; top:147181px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">To determine the most effective heap size, turn on verbose garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:147231px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collection and redirect the output to a log file for diagnostic</span></div>
<div class="txt" style="position:absolute; left:112px; top:147274px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">purposes. -Xloggc:</span><span id="f29" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">日志文件路径</span></div>
<div class="txt" style="position:absolute; left:76px; top:147349px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">From log file:</span></div>
<div class="txt" style="position:absolute; left:112px; top:147416px;"><span id="f33" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">How often is garbage collection taking place?</span></div>
<div class="txt" style="position:absolute; left:112px; top:147476px;"><span id="f33" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">How long is garbage collection taking? Full garbage collection should not</span></div>
<div class="txt" style="position:absolute; left:148px; top:147519px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">take longer than 3 to 5 seconds.</span></div>
<div class="txt" style="position:absolute; left:112px; top:147580px;"><span id="f33" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">What is your average memory footprint? In other words, what does the</span></div>
<div class="txt" style="position:absolute; left:148px; top:147623px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">heap settle back down to after each full garbage collection? If the heap</span></div>
<div class="txt" style="position:absolute; left:148px; top:147666px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">always settles to 85 percent free, you might set the heap size smaller.</span></div>
<img id="background" style="position:absolute; left:0px; top:147896px;" width="1440" height="1080" src="page124.png"> <img id="background" style="position:absolute; left:1440px; top:147896px;" width="1440" height="1080" src="page-000124.png">
<div class="txt" style="position:absolute; left:426px; top:147913px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:148003px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">(4) Manually request garbage collection</span></div>
<div class="txt" style="position:absolute; left:76px; top:148143px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">You can manually request that the JVM perform garbage</span></div>
<div class="txt" style="position:absolute; left:112px; top:148193px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">collection.</span></div>
<div class="txt" style="position:absolute; left:76px; top:148263px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">When you perform garbage collection, the JVM often examines</span></div>
<div class="txt" style="position:absolute; left:112px; top:148313px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">every living object in the heap.</span></div>
<div class="txt" style="position:absolute; left:76px; top:148383px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Garbage Collect calls the JVM’s </span><span id="f22" style="font-size:26px;vertical-align:baseline;color:rgba(255,0,0,1);">System.gc() </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method to perform</span></div>
<div class="txt" style="position:absolute; left:112px; top:148433px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">garbage collection. The JVM implementation then decides whether</span></div>
<div class="txt" style="position:absolute; left:112px; top:148481px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">or not the request actually triggers garbage collection.</span></div>
<img id="background" style="position:absolute; left:0px; top:149098px;" width="1440" height="1080" src="page125.png"> <img id="background" style="position:absolute; left:1440px; top:149098px;" width="1440" height="1080" src="page-000125.png">
<div class="txt" style="position:absolute; left:1105px; top:149116px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:236px; top:149513px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">8 Using I/O Efficiently in Java</span></div>
<img id="background" style="position:absolute; left:0px; top:150300px;" width="1440" height="1080" src="page126.png"> <img id="background" style="position:absolute; left:1440px; top:150300px;" width="1440" height="1080" src="page-000126.png">
<div class="txt" style="position:absolute; left:426px; top:150317px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:150407px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Speeding up I/O</span></div>
<div class="txt" style="position:absolute; left:76px; top:150547px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In software systems, the reading-writing speed of I/O is slower</span></div>
<div class="txt" style="position:absolute; left:112px; top:150592px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">than that of memory. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">I/O</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">读写速度远低于内存</span></div>
<div class="txt" style="position:absolute; left:76px; top:150667px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Therefore, I/O reading and writing on many occasions will become</span></div>
<div class="txt" style="position:absolute; left:112px; top:150712px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">bottleneck of a system. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">I/O</span><span id="f21" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">读写会成为系统的性能瓶颈</span></div>
<div class="txt" style="position:absolute; left:76px; top:150787px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Speeding up I/O has a great advantage to enhance the overall</span></div>
<div class="txt" style="position:absolute; left:112px; top:150837px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">performance of the system.</span></div>
<div class="txt" style="position:absolute; left:76px; top:150979px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A main technique to speed up I/O is </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">buffer.</span></div>
<img id="background" style="position:absolute; left:0px; top:151502px;" width="1440" height="1080" src="page127.png"> <img id="background" style="position:absolute; left:1440px; top:151502px;" width="1440" height="1080" src="page-000127.png">
<div class="txt" style="position:absolute; left:33px; top:151609px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffer</span></div>
<div class="txt" style="position:absolute; left:426px; top:151519px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:151749px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Data buffer (or just buffer) is a region of a physical memory storage</span></div>
<div class="txt" style="position:absolute; left:112px; top:151799px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">used to temporarily store data while it is being moved from one place</span></div>
<div class="txt" style="position:absolute; left:112px; top:151842px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to another. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">数据缓冲区是物理内存空间，用来临时存储数据</span></div>
<div class="txt" style="position:absolute; left:76px; top:151917px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Typically, the data is stored in a buffer as it is retrieved from an input</span></div>
<div class="txt" style="position:absolute; left:112px; top:151967px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">device (such as a microphone) or just before it is sent to an output</span></div>
<div class="txt" style="position:absolute; left:112px; top:152015px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">device (such as speakers).</span></div>
<div class="txt" style="position:absolute; left:76px; top:152085px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffers can be implemented in a fixed memory location in hardware</span><span id="f25" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span></div>
<div class="txt" style="position:absolute; left:112px; top:152135px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">or by using a virtual data buffer in software, pointing at a location in</span></div>
<div class="txt" style="position:absolute; left:112px; top:152183px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the physical memory. In all cases, the data stored in a data buffer are</span></div>
<div class="txt" style="position:absolute; left:112px; top:152231px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">stored on a physical storage medium.</span></div>
<div class="txt" style="position:absolute; left:76px; top:152301px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A majority of buffers are implemented in software, which typically use</span></div>
<div class="txt" style="position:absolute; left:112px; top:152351px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the faster RAM to store temporary data, due to the much faster access</span></div>
<div class="txt" style="position:absolute; left:112px; top:152394px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">time compared with hard disk drives. </span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">通常用软件实现</span><span id="f37" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">buffer</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">机制，利</span></div>
<div class="txt" style="position:absolute; left:112px; top:152442px;"><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">用速度快的</span><span id="f37" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">RAM</span></div>
<img id="background" style="position:absolute; left:0px; top:152704px;" width="1440" height="1080" src="page128.png"> <img id="background" style="position:absolute; left:1440px; top:152704px;" width="1440" height="1080" src="page-000128.png">
<div class="txt" style="position:absolute; left:33px; top:152811px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffer</span></div>
<div class="txt" style="position:absolute; left:426px; top:152721px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:152951px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffers are typically used when there is a difference between the rate</span></div>
<div class="txt" style="position:absolute; left:112px; top:153001px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">at which data is received and the rate at which it can be processed, or</span></div>
<div class="txt" style="position:absolute; left:112px; top:153049px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in the case that these rates are variable, for example in a printer</span></div>
<div class="txt" style="position:absolute; left:112px; top:153092px;"><span id="f8" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">spooler or in online video streaming</span><span id="f17" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">. </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">缓冲区通常用于接收数据的速率</span></div>
<div class="txt" style="position:absolute; left:112px; top:153143px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">与处理数据速率之间存在较大差异的情况下，或者在速率可变的情况</span></div>
<div class="txt" style="position:absolute; left:112px; top:153188px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">下（例如打印机池或在线视频流）。</span></div>
<div class="txt" style="position:absolute; left:76px; top:153263px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">上层应用组件不需要等待下层组件真实地接受全部数据，即可返回操</span></div>
<div class="txt" style="position:absolute; left:112px; top:153308px;"><span id="f20" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">作，加快了上层组件的处理速度，从而提升系统整体性能。</span></div>
<img id="background" style="position:absolute; left:0px; top:153906px;" width="1440" height="1080" src="page129.png"> <img id="background" style="position:absolute; left:1440px; top:153906px;" width="1440" height="1080" src="page-000129.png">
<div class="txt" style="position:absolute; left:426px; top:153923px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:154013px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Using Buffer to speed up I/O</span></div>
<div class="txt" style="position:absolute; left:76px; top:154153px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">E.g., FileWriter in Java</span></div>
<div class="txt" style="position:absolute; left:65px; top:154257px;"><span id="f15" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Writer writer = new FileWriter(new File(“file.txt”));</span></div>
<div class="txt" style="position:absolute; left:65px; top:154314px;"><span id="f17" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">long begin = System.currentTimeMillis();</span></div>
<div class="txt" style="position:absolute; left:65px; top:154372px;"><span id="f17" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">for (int i=0; i&lt; CIRCLE; i++){</span></div>
<div class="txt" style="position:absolute; left:135px; top:154430px;"><span id="f17" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">writer.write(i);</span></div>
<div class="txt" style="position:absolute; left:65px; top:154487px;"><span id="f17" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:814px; top:154412px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Set CIRCLE to 100,000</span></div>
<div class="txt" style="position:absolute; left:616px; top:154455px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Running time of the original program is 63ms;</span></div>
<div class="txt" style="position:absolute; left:587px; top:154498px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Running time of the program with buffer is 20ms;</span></div>
<div class="txt" style="position:absolute; left:65px; top:154545px;"><span id="f17" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Writer.close();</span></div>
<div class="txt" style="position:absolute; left:65px; top:154602px;"><span id="f15" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(“testFileWriter spend:” +</span></div>
<div class="txt" style="position:absolute; left:497px; top:154660px;"><span id="f17" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">(System.currentTimeNillis() - begin));</span></div>
<div class="txt" style="position:absolute; left:65px; top:154837px;"><span id="f15" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Writer writer = new BufferedWriter(new FileWriter(new File(“file.txt”)));</span></div>
<img id="background" style="position:absolute; left:0px; top:155108px;" width="1440" height="1080" src="page130.png"> <img id="background" style="position:absolute; left:1440px; top:155108px;" width="1440" height="1080" src="page-000130.png">
<div class="txt" style="position:absolute; left:426px; top:155125px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:155215px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">A brief, sad history of I/O in Java</span></div>
<img id="background" style="position:absolute; left:0px; top:156310px;" width="1440" height="1080" src="page131.png"> <img id="background" style="position:absolute; left:1440px; top:156310px;" width="1440" height="1080" src="page-000131.png">
<div class="txt" style="position:absolute; left:33px; top:156417px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">1: Stream</span></div>
<div class="txt" style="position:absolute; left:426px; top:156327px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:65px; top:156592px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">/**</span></div>
<div class="txt" style="position:absolute; left:65px; top:156635px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Reads all lines from a text file and prints them.</span></div>
<div class="txt" style="position:absolute; left:65px; top:156678px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Uses Java 1.0-era (circa 1996) Streams to read the file.</span></div>
<div class="txt" style="position:absolute; left:65px; top:156721px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">*/</span></div>
<div class="txt" style="position:absolute; left:65px; top:156764px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class StreamCat {</span></div>
<div class="txt" style="position:absolute; left:144px; top:156808px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) throws IOException {</span></div>
<div class="txt" style="position:absolute; left:223px; top:156851px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">DataInputStream dis = new DataInputStream(</span></div>
<div class="txt" style="position:absolute; left:302px; top:156894px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">new FileInputStream(args[0]));</span></div>
<div class="txt" style="position:absolute; left:243px; top:156937px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">// Don't do this! DataInputStream.readLine is DEPRECATED!</span></div>
<div class="txt" style="position:absolute; left:223px; top:156980px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String line;</span></div>
<div class="txt" style="position:absolute; left:223px; top:157024px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while ((line = </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(255,0,0,1);">dis.readLine()) </span><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">!= null)</span></div>
<div class="txt" style="position:absolute; left:302px; top:157067px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(line);</span></div>
<div class="txt" style="position:absolute; left:144px; top:157110px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:65px; top:157153px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:157512px;" width="1440" height="1080" src="page132.png"> <img id="background" style="position:absolute; left:1440px; top:157512px;" width="1440" height="1080" src="page-000132.png">
<div class="txt" style="position:absolute; left:33px; top:157619px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">2: Reader</span></div>
<div class="txt" style="position:absolute; left:426px; top:157529px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:110px; top:157839px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">/**</span></div>
<div class="txt" style="position:absolute; left:110px; top:157882px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Reads all lines from a text file and prints them.</span></div>
<div class="txt" style="position:absolute; left:110px; top:157926px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Uses Java 1.1-era (circa 1997) Streams to read the file.</span></div>
<div class="txt" style="position:absolute; left:110px; top:157969px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">*/</span></div>
<div class="txt" style="position:absolute; left:110px; top:158012px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class ReaderCat {</span></div>
<div class="txt" style="position:absolute; left:189px; top:158055px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) throws IOException {</span></div>
<div class="txt" style="position:absolute; left:268px; top:158098px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">try (BufferedReader rd = new BufferedReader(</span></div>
<div class="txt" style="position:absolute; left:446px; top:158142px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">new FileReader(args[0]))) {</span></div>
<div class="txt" style="position:absolute; left:367px; top:158185px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">String line;</span></div>
<div class="txt" style="position:absolute; left:367px; top:158228px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while ((line = rd.readLine()) != null) {</span></div>
<div class="txt" style="position:absolute; left:446px; top:158271px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(line);</span></div>
<div class="txt" style="position:absolute; left:446px; top:158314px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">// you could also wrap System.out in a PrintWriter</span></div>
<div class="txt" style="position:absolute; left:367px; top:158358px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:268px; top:158401px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:189px; top:158444px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:110px; top:158487px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:158714px;" width="1440" height="1080" src="page133.png"> <img id="background" style="position:absolute; left:1440px; top:158714px;" width="1440" height="1080" src="page-000133.png">
<div class="txt" style="position:absolute; left:33px; top:158821px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">3: Nio</span></div>
<div class="txt" style="position:absolute; left:426px; top:158731px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:110px; top:159041px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">/**</span></div>
<div class="txt" style="position:absolute; left:110px; top:159084px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Reads all lines from a text file and prints them.</span></div>
<div class="txt" style="position:absolute; left:110px; top:159128px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Uses nio FileChannel and ByteBuffer.</span></div>
<div class="txt" style="position:absolute; left:110px; top:159171px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">*/</span></div>
<div class="txt" style="position:absolute; left:110px; top:159214px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class NioCat {</span></div>
<div class="txt" style="position:absolute; left:189px; top:159257px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) throws IOException {</span></div>
<div class="txt" style="position:absolute; left:268px; top:159300px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer buf = ByteBuffer.allocate(512);</span></div>
<div class="txt" style="position:absolute; left:268px; top:159344px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">try (FileChannel ch = FileChannel.open(Paths.get(args[0]),</span></div>
<div class="txt" style="position:absolute; left:446px; top:159387px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">StandardOpenOption.READ)) {</span></div>
<div class="txt" style="position:absolute; left:347px; top:159430px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int n;</span></div>
<div class="txt" style="position:absolute; left:347px; top:159473px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while ((n = ch.read(buf)) &gt; -1) {</span></div>
<div class="txt" style="position:absolute; left:426px; top:159516px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.print(new String(buf.array(), 0, n));</span></div>
<div class="txt" style="position:absolute; left:426px; top:159560px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">buf.clear();</span></div>
<div class="txt" style="position:absolute; left:347px; top:159603px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:268px; top:159646px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:189px; top:159689px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:110px; top:159733px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:159916px;" width="1440" height="1080" src="page134.png"> <img id="background" style="position:absolute; left:1440px; top:159916px;" width="1440" height="1080" src="page-000134.png">
<div class="txt" style="position:absolute; left:33px; top:160023px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">4: Scanner</span></div>
<div class="txt" style="position:absolute; left:426px; top:159933px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:110px; top:160243px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">/**</span></div>
<div class="txt" style="position:absolute; left:110px; top:160286px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Reads all lines from a text file and prints them</span></div>
<div class="txt" style="position:absolute; left:110px; top:160330px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Uses Java 5 scanner.</span></div>
<div class="txt" style="position:absolute; left:110px; top:160373px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">*/</span></div>
<div class="txt" style="position:absolute; left:110px; top:160416px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class ScannerCat {</span></div>
<div class="txt" style="position:absolute; left:189px; top:160459px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) throws IOException {</span></div>
<div class="txt" style="position:absolute; left:268px; top:160502px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">try (Scanner s = new Scanner(new File(args[0]))) {</span></div>
<div class="txt" style="position:absolute; left:347px; top:160546px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while (s.hasNextLine())</span></div>
<div class="txt" style="position:absolute; left:426px; top:160589px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">System.out.println(s.nextLine());</span></div>
<div class="txt" style="position:absolute; left:268px; top:160632px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:189px; top:160675px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:110px; top:160719px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:161118px;" width="1440" height="1080" src="page135.png"> <img id="background" style="position:absolute; left:1440px; top:161118px;" width="1440" height="1080" src="page-000135.png">
<div class="txt" style="position:absolute; left:33px; top:161225px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">5: Lines</span></div>
<div class="txt" style="position:absolute; left:426px; top:161135px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:65px; top:161445px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">/**</span></div>
<div class="txt" style="position:absolute; left:65px; top:161488px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Reads all lines from a text file and prints them. Uses Files,</span></div>
<div class="txt" style="position:absolute; left:65px; top:161532px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">* Java 8-era Stream API (not IO Streams!) and method references.</span></div>
<div class="txt" style="position:absolute; left:65px; top:161575px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">*/</span></div>
<div class="txt" style="position:absolute; left:65px; top:161618px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public class LinesCat {</span></div>
<div class="txt" style="position:absolute; left:144px; top:161661px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void main(String[] args) throws IOException {</span></div>
<div class="txt" style="position:absolute; left:223px; top:161704px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">Files.lines(Paths.get(args[0])).forEach(System.out::println);</span></div>
<div class="txt" style="position:absolute; left:144px; top:161748px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:65px; top:161791px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:162320px;" width="1440" height="1080" src="page136.png"> <img id="background" style="position:absolute; left:1440px; top:162320px;" width="1440" height="1080" src="page-000136.png">
<div class="txt" style="position:absolute; left:426px; top:162337px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:162427px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Java I/O Recommendations</span></div>
<div class="txt" style="position:absolute; left:76px; top:162567px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Everyday use </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffered{Reader, Writer}</span></div>
<div class="txt" style="position:absolute; left:76px; top:162639px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Casual use - Scanner</span></div>
<div class="txt" style="position:absolute; left:112px; top:162706px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Easy but not general and swallows exceptions</span></div>
<div class="txt" style="position:absolute; left:76px; top:162771px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Stream integration </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Files.lines</span></div>
<div class="txt" style="position:absolute; left:112px; top:162838px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">No parallelism support yet</span></div>
<div class="txt" style="position:absolute; left:76px; top:162901px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Async </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">– </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">java.nio.AsynchronousFileChannel </span><span id="f35" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">异步文件通道</span></div>
<div class="txt" style="position:absolute; left:76px; top:162976px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Many niche APIs, e.g. memory mapping, line numbering</span></div>
<div class="txt" style="position:absolute; left:112px; top:163039px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Search them out as needed </span><span id="f35" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">还有很多有用的</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">API,</span><span id="f35" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">根据需要使用</span></div>
<div class="txt" style="position:absolute; left:76px; top:163108px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Consider Okio if third party API allowed</span></div>
<img id="background" style="position:absolute; left:0px; top:163522px;" width="1440" height="1080" src="page137.png"> <img id="background" style="position:absolute; left:1440px; top:163522px;" width="1440" height="1080" src="page-000137.png">
<div class="txt" style="position:absolute; left:426px; top:163539px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:163629px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">NIO: New I/O</span></div>
<div class="txt" style="position:absolute; left:76px; top:163769px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Prior to the J2SE 1.4 release of Java, I/O had become a bottleneck.</span></div>
<div class="txt" style="position:absolute; left:76px; top:163841px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The old java.io stream classes had too many software layers to be</span></div>
<div class="txt" style="position:absolute; left:112px; top:163886px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">fast: </span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">旧的</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">java io stream</span><span id="f19" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">类有太多的软件层，影响速度</span></div>
<div class="txt" style="position:absolute; left:112px; top:163956px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The specification implied much copying of small chunks of data;</span></div>
<div class="txt" style="position:absolute; left:112px; top:164016px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">There was no way to multiplex data from multiple sources without</span></div>
<div class="txt" style="position:absolute; left:148px; top:164059px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">incurring thread context switches;</span></div>
<div class="txt" style="position:absolute; left:112px; top:164120px;"><span id="f29" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">There was no way to exploit modern OS tricks for high performance I/O,</span></div>
<div class="txt" style="position:absolute; left:148px; top:164163px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">like memory mapped files.</span></div>
<img id="background" style="position:absolute; left:0px; top:164724px;" width="1440" height="1080" src="page138.png"> <img id="background" style="position:absolute; left:1440px; top:164724px;" width="1440" height="1080" src="page-000138.png">
<div class="txt" style="position:absolute; left:426px; top:164741px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:164831px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">NIO: New I/O</span></div>
<div class="txt" style="position:absolute; left:76px; top:164971px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">New I/O changes that by providing:</span></div>
<div class="txt" style="position:absolute; left:112px; top:165038px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A hierarchy of dedicated buffer classes that allow data to be moved from</span></div>
<div class="txt" style="position:absolute; left:148px; top:165081px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the JVM to the OS with minimal memory-to-memory copying, and</span></div>
<div class="txt" style="position:absolute; left:148px; top:165124px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">without expensive overheads like switching byte order; effectively buffer</span></div>
<div class="txt" style="position:absolute; left:148px; top:165163px;"><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">classes give Java a “window” on system memory. </span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">通过一组</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">buffer</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">类，允</span></div>
<div class="txt" style="position:absolute; left:148px; top:165207px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">许将数据从</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">JVM</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">移动到</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">OS</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">，只需最少的内存间复制。</span></div>
<div class="txt" style="position:absolute; left:112px; top:165271px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A unified family of channel classes that allow data to be fed directly from</span></div>
<div class="txt" style="position:absolute; left:148px; top:165314px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">buffers to files and sockets, without going through the intermediaries of</span></div>
<div class="txt" style="position:absolute; left:148px; top:165353px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the old stream classes. </span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">统一的通道类，允许数据直接从缓冲区输入到文件</span></div>
<div class="txt" style="position:absolute; left:148px; top:165397px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">和</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">sockets.</span></div>
<div class="txt" style="position:absolute; left:112px; top:165461px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">A family of classes to directly implement selection (AKA readiness testing,</span></div>
<div class="txt" style="position:absolute; left:148px; top:165504px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">AKA multiplexing) over a set of channels.</span></div>
<div class="txt" style="position:absolute; left:112px; top:165561px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">NIO also provides file locking for the first time in Java. </span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">首次在</span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">Java</span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">中提供</span></div>
<div class="txt" style="position:absolute; left:148px; top:165604px;"><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,255,1);">了文件锁定</span></div>
<img id="background" style="position:absolute; left:0px; top:165926px;" width="1440" height="1080" src="page139.png"> <img id="background" style="position:absolute; left:1440px; top:165926px;" width="1440" height="1080" src="page-000139.png">
<div class="txt" style="position:absolute; left:426px; top:165943px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:166033px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">NIO: New I/O</span></div>
<img id="background" style="position:absolute; left:0px; top:167128px;" width="1440" height="1080" src="page140.png"> <img id="background" style="position:absolute; left:1440px; top:167128px;" width="1440" height="1080" src="page-000140.png">
<div class="txt" style="position:absolute; left:426px; top:167145px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:167235px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffers in NIO</span></div>
<div class="txt" style="position:absolute; left:76px; top:167375px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A Buffer object is a container for a fixed amount of data.</span></div>
<div class="txt" style="position:absolute; left:76px; top:167447px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It behaves something like a byte [] array, but is encapsulated in</span></div>
<div class="txt" style="position:absolute; left:112px; top:167497px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">such a way that the internal storage can be a block of system</span></div>
<div class="txt" style="position:absolute; left:112px; top:167545px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">memory.</span></div>
<div class="txt" style="position:absolute; left:112px; top:167610px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Thus adding data to, or extracting it from, a buffer can be a very direct</span></div>
<div class="txt" style="position:absolute; left:148px; top:167653px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">way of getting information between a Java program and the underlying</span></div>
<div class="txt" style="position:absolute; left:148px; top:167696px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">operating system.</span></div>
<div class="txt" style="position:absolute; left:112px; top:167757px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f25" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">All modern OS’s provide virtual memory systems that allow memory</span></div>
<div class="txt" style="position:absolute; left:148px; top:167800px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">space to be mapped to files, so this also enables a very direct and high-</span></div>
<div class="txt" style="position:absolute; left:148px; top:167843px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">performance route to the file system.</span></div>
<div class="txt" style="position:absolute; left:112px; top:167904px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The data in a buffer can also be efficiently read from, or written to, a</span></div>
<div class="txt" style="position:absolute; left:148px; top:167947px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">socket or pipe, enabling high performance communication.</span></div>
<div class="txt" style="position:absolute; left:76px; top:168012px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The buffer APIs allow you to read or write from a specific location</span></div>
<div class="txt" style="position:absolute; left:112px; top:168062px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in the buffer directly; they also allow relative reads and writes,</span></div>
<div class="txt" style="position:absolute; left:112px; top:168110px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">similar to sequential file access.</span></div>
<img id="background" style="position:absolute; left:0px; top:168330px;" width="1440" height="1080" src="page141.png"> <img id="background" style="position:absolute; left:1440px; top:168330px;" width="1440" height="1080" src="page-000141.png">
<div class="txt" style="position:absolute; left:426px; top:168347px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:168437px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The java.nio.Buffer Hierarchy</span></div>
<img id="background" style="position:absolute; left:0px; top:169532px;" width="1440" height="1080" src="page142.png"> <img id="background" style="position:absolute; left:1440px; top:169532px;" width="1440" height="1080" src="page-000142.png">
<div class="txt" style="position:absolute; left:426px; top:169549px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:169639px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Fields of Buffer</span></div>
<div class="txt" style="position:absolute; left:76px; top:169776px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">容量</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(Capacity)</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">：</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The maximum number of data elements a buffer</span></div>
<div class="txt" style="position:absolute; left:112px; top:169829px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">can hold, which is set when buffer is created and cannot be</span></div>
<div class="txt" style="position:absolute; left:112px; top:169872px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">changed. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">缓冲区能够容纳的数据元素的最大数量，在缓冲区创建时被</span></div>
<div class="txt" style="position:absolute; left:112px; top:169920px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">设定，不能改变。</span></div>
<div class="txt" style="position:absolute; left:76px; top:169992px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">上界</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(Limit)</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">： </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The first element of the buffer that cannot be read or</span></div>
<div class="txt" style="position:absolute; left:112px; top:170045px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">written. In other words, the count of existing elements in the</span></div>
<div class="txt" style="position:absolute; left:112px; top:170088px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">buffer. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">缓冲区的第一个不能被读或写的元素。或者说，缓冲区中现存</span></div>
<div class="txt" style="position:absolute; left:112px; top:170136px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">元素的计数。</span></div>
<div class="txt" style="position:absolute; left:76px; top:170208px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">位置</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(Position)</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">： </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The index of the next element to be read or</span></div>
<div class="txt" style="position:absolute; left:112px; top:170261px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">written which is automatically updated by the corresponding get ()</span></div>
<div class="txt" style="position:absolute; left:112px; top:170304px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and put () methods. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">下一个要被读或写的元素的索引，会自动由相应</span></div>
<div class="txt" style="position:absolute; left:112px; top:170352px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">的 </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">get( )</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">和 </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">put( )</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法更新。</span></div>
<div class="txt" style="position:absolute; left:76px; top:170424px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">标记</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">(Mark)</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">： </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">An index that specifies a particular position in the</span></div>
<div class="txt" style="position:absolute; left:112px; top:170477px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">buffer, and then recovers to that position by calling the reset ()</span></div>
<div class="txt" style="position:absolute; left:112px; top:170520px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">method. </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">Buffer</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">中一个特定的</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">position</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">，之后可以通过调用</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">reset()</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">方法</span></div>
<div class="txt" style="position:absolute; left:112px; top:170568px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">恢复到这个</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">position</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,255,1);">。</span></div>
<img id="background" style="position:absolute; left:0px; top:170734px;" width="1440" height="1080" src="page143.png"> <img id="background" style="position:absolute; left:1440px; top:170734px;" width="1440" height="1080" src="page-000143.png">
<div class="txt" style="position:absolute; left:426px; top:170751px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:170841px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffer Objects (Empty/Fill)</span></div>
<img id="background" style="position:absolute; left:0px; top:171936px;" width="1440" height="1080" src="page144.png"> <img id="background" style="position:absolute; left:1440px; top:171936px;" width="1440" height="1080" src="page-000144.png">
<div class="txt" style="position:absolute; left:426px; top:171953px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:172043px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">File Position and Limit</span></div>
<div class="txt" style="position:absolute; left:76px; top:172183px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The </span><span id="f15" style="font-size:37px;vertical-align:baseline;color:rgba(0,0,0,1);">limit </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">property defines either the last space available for</span></div>
<div class="txt" style="position:absolute; left:112px; top:172233px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">writing, or how much data has been written to the file.</span></div>
<div class="txt" style="position:absolute; left:112px; top:172298px;"><span id="f19" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">After finishing writing a flip() method can be called to set limit to the</span></div>
<div class="txt" style="position:absolute; left:148px; top:172341px;"><span id="f13" style="font-size:36px;vertical-align:baseline;color:rgba(255,0,0,1);">current value of position, and reset position to zero, ready for reading.</span></div>
<div class="txt" style="position:absolute; left:76px; top:172407px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Various operations implicitly work on the data between position</span></div>
<div class="txt" style="position:absolute; left:112px; top:172456px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">and limit.</span></div>
<img id="background" style="position:absolute; left:0px; top:173138px;" width="1440" height="1080" src="page145.png"> <img id="background" style="position:absolute; left:1440px; top:173138px;" width="1440" height="1080" src="page-000145.png">
<div class="txt" style="position:absolute; left:426px; top:173155px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:173245px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">File Position and Limit</span></div>
<div class="txt" style="position:absolute; left:76px; top:173385px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Apart from forms with an index parameter, these are all relative</span></div>
<div class="txt" style="position:absolute; left:112px; top:173435px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">operations: they get data from, or insert data into, the buffer</span></div>
<div class="txt" style="position:absolute; left:112px; top:173483px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">starting at the current position in the buffer; they also update the</span></div>
<div class="txt" style="position:absolute; left:112px; top:173531px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">position to point to the position after the read or written data. The</span></div>
<div class="txt" style="position:absolute; left:112px; top:173579px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">position property is like the file pointer in sequential file access.</span></div>
<div class="txt" style="position:absolute; left:76px; top:173649px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The superclass Buffer has methods for explicitly manipulating the</span></div>
<div class="txt" style="position:absolute; left:112px; top:173699px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">position and related properties of buffers, e.g:</span></div>
<div class="txt" style="position:absolute; left:112px; top:173764px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">int position()</span></div>
<div class="txt" style="position:absolute; left:112px; top:173824px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffer position(int newPosition)</span></div>
<div class="txt" style="position:absolute; left:112px; top:173885px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">int limit()</span></div>
<div class="txt" style="position:absolute; left:112px; top:173945px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Buffer limit(int newLimit)</span></div>
<div class="txt" style="position:absolute; left:112px; top:174006px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The ByteBuffer or Buffer references returned by these various methods are</span></div>
<div class="txt" style="position:absolute; left:148px; top:174049px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">simply references to this buffer object, not new buffers. They are provided</span></div>
<div class="txt" style="position:absolute; left:148px; top:174092px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">to support cryptic invocation chaining. Feel free to ignore them.</span></div>
<img id="background" style="position:absolute; left:0px; top:174340px;" width="1440" height="1080" src="page146.png"> <img id="background" style="position:absolute; left:1440px; top:174340px;" width="1440" height="1080" src="page-000146.png">
<div class="txt" style="position:absolute; left:426px; top:174357px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:174447px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">The ByteBuffer Class</span></div>
<div class="txt" style="position:absolute; left:76px; top:174587px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The most important buffer class in practice is probably the</span></div>
<div class="txt" style="position:absolute; left:112px; top:174637px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,0,0,1);">ByteBuffer class. </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This represents a fixed-size vector of primitive</span></div>
<div class="txt" style="position:absolute; left:112px; top:174685px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">bytes.</span></div>
<div class="txt" style="position:absolute; left:76px; top:174755px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Important methods on this class include:</span></div>
<div class="txt" style="position:absolute; left:112px; top:174822px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">byte get()</span></div>
<div class="txt" style="position:absolute; left:112px; top:174882px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">byte get(int index)</span></div>
<div class="txt" style="position:absolute; left:112px; top:174943px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer get(byte [] dst)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175003px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer get(byte [] dst, int offset, int length)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175064px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer put(byte b)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175124px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer put(int index, byte b)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175185px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer put(byte [] src)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175245px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer put(byte [] src, int offset, int length)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175306px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer put(ByteBuffer src)</span></div>
<img id="background" style="position:absolute; left:0px; top:175542px;" width="1440" height="1080" src="page147.png"> <img id="background" style="position:absolute; left:1440px; top:175542px;" width="1440" height="1080" src="page-000147.png">
<div class="txt" style="position:absolute; left:426px; top:175559px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:175649px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Creating Buffers</span></div>
<div class="txt" style="position:absolute; left:76px; top:175789px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Four factory methods can be used to create a new ByteBuffer:</span></div>
<div class="txt" style="position:absolute; left:112px; top:175856px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer allocate(int capacity)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175916px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer allocateDirect(int capacity)</span></div>
<div class="txt" style="position:absolute; left:112px; top:175977px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer wrap(byte [] array)</span></div>
<div class="txt" style="position:absolute; left:112px; top:176037px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer wrap(byte [] array, int offset, length)</span></div>
<div class="txt" style="position:absolute; left:76px; top:176103px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">These are all static methods of the ByteBuffer class.</span></div>
<div class="txt" style="position:absolute; left:112px; top:176170px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocate() creates a ByteBuffer with an ordinary Java backing array of size</span></div>
<div class="txt" style="position:absolute; left:148px; top:176213px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">capacity.</span></div>
<div class="txt" style="position:absolute; left:112px; top:176273px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocateDirect()</span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">perhaps the most interesting case</span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">creates a direct</span></div>
<div class="txt" style="position:absolute; left:148px; top:176317px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer, backed by capacity bytes of system memory.</span></div>
<div class="txt" style="position:absolute; left:112px; top:176377px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f31" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The wrap() methods create ByteBuffer’s backed by all or part of an array</span></div>
<div class="txt" style="position:absolute; left:148px; top:176420px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">allocated by the user.</span></div>
<div class="txt" style="position:absolute; left:76px; top:176486px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The other typed buffer classes (CharBuffer, etc) have similar</span></div>
<div class="txt" style="position:absolute; left:112px; top:176536px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">factory methods, except allocateDirect() method.</span></div>
<img id="background" style="position:absolute; left:0px; top:176744px;" width="1440" height="1080" src="page148.png"> <img id="background" style="position:absolute; left:1440px; top:176744px;" width="1440" height="1080" src="page-000148.png">
<div class="txt" style="position:absolute; left:426px; top:176761px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:176851px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Other Primitive Types in ByteBuffer</span></div>
<div class="txt" style="position:absolute; left:76px; top:176991px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">It is possible to write other primitive types (char, int, double, etc)</span></div>
<div class="txt" style="position:absolute; left:112px; top:177041px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">to a ByteBuffer by methods like:</span></div>
<div class="txt" style="position:absolute; left:112px; top:177106px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer putChar(char value)</span></div>
<div class="txt" style="position:absolute; left:112px; top:177166px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer putChar(int index, char value)</span></div>
<div class="txt" style="position:absolute; left:112px; top:177227px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer putInt(int value)</span></div>
<div class="txt" style="position:absolute; left:112px; top:177287px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer putInt(int index, int value)</span></div>
<div class="txt" style="position:absolute; left:112px; top:177348px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">–</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">…</span></div>
<div class="txt" style="position:absolute; left:76px; top:177413px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The putChar() methods do absolute or relative writes of the two</span></div>
<div class="txt" style="position:absolute; left:112px; top:177463px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">bytes in a Java char, the putInt() methods write 4 bytes, and so on.</span></div>
<div class="txt" style="position:absolute; left:112px; top:177528px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Of course there are corresponding getChar(), getInt(), … methods.</span></div>
<img id="background" style="position:absolute; left:0px; top:177946px;" width="1440" height="1080" src="page149.png"> <img id="background" style="position:absolute; left:1440px; top:177946px;" width="1440" height="1080" src="page-000149.png">
<div class="txt" style="position:absolute; left:426px; top:177963px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:178053px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Other Primitive Types in ByteBuffer</span></div>
<div class="txt" style="position:absolute; left:76px; top:178193px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">These give you fun, unsafe ways of coercing bytes of one primitive</span></div>
<div class="txt" style="position:absolute; left:112px; top:178243px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">type to another type, by writing data as one type and reading them</span></div>
<div class="txt" style="position:absolute; left:112px; top:178291px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">as another.</span></div>
<div class="txt" style="position:absolute; left:76px; top:178361px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">But actually this isn’t the interesting bit—</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">this was always possible</span></div>
<div class="txt" style="position:absolute; left:112px; top:178411px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">with the old java.io DataStream’s.</span></div>
<div class="txt" style="position:absolute; left:76px; top:178481px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The interesting bit is that the new ByteBuffer class has a method</span></div>
<div class="txt" style="position:absolute; left:112px; top:178531px;"><span id="f18" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">that allows you to set the byte order…</span></div>
<img id="background" style="position:absolute; left:0px; top:179148px;" width="1440" height="1080" src="page150.png"> <img id="background" style="position:absolute; left:1440px; top:179148px;" width="1440" height="1080" src="page-000150.png">
<div class="txt" style="position:absolute; left:426px; top:179165px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:179255px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">View Buffers</span></div>
<div class="txt" style="position:absolute; left:76px; top:179395px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer has no methods for bulk transfer of arrays other than</span></div>
<div class="txt" style="position:absolute; left:112px; top:179445px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">type byte[].</span></div>
<div class="txt" style="position:absolute; left:76px; top:179515px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Instead, create a view of (a portion of) a ByteBuffer as any other</span></div>
<div class="txt" style="position:absolute; left:112px; top:179565px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">kind of typed buffer, then use the bulk transfer methods on that</span></div>
<div class="txt" style="position:absolute; left:112px; top:179613px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">view. Following methods of ByteBuffer create views:</span></div>
<div class="txt" style="position:absolute; left:112px; top:179678px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">CharBuffer asCharBuffer()</span></div>
<div class="txt" style="position:absolute; left:112px; top:179738px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">IntBuffer asIntBuffer()</span></div>
<div class="txt" style="position:absolute; left:112px; top:179799px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">–</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">…</span></div>
<div class="txt" style="position:absolute; left:112px; top:179859px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">To create a view of just a portion of a ByteBuffer, set position and limit</span></div>
<div class="txt" style="position:absolute; left:148px; top:179902px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">appropriately beforehand</span><span id="f26" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the created view only covers the region</span></div>
<div class="txt" style="position:absolute; left:148px; top:179946px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">between these.</span></div>
<div class="txt" style="position:absolute; left:112px; top:180006px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You cannot create views of typed buffers other than ByteBuffer.</span></div>
<div class="txt" style="position:absolute; left:112px; top:180067px;"><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">You can create another buffer that represents a subsection of any buffer</span></div>
<div class="txt" style="position:absolute; left:148px; top:180110px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(without changing element type) by using the slice() method.</span></div>
<img id="background" style="position:absolute; left:0px; top:180350px;" width="1440" height="1080" src="page151.png"> <img id="background" style="position:absolute; left:1440px; top:180350px;" width="1440" height="1080" src="page-000151.png">
<div class="txt" style="position:absolute; left:426px; top:180367px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:180457px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">View Buffers</span></div>
<div class="txt" style="position:absolute; left:76px; top:180597px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For example, writing an array of floats to a byte buffer, starting at</span></div>
<div class="txt" style="position:absolute; left:112px; top:180647px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">the current position:</span></div>
<div class="txt" style="position:absolute; left:112px; top:180712px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">float [] array ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:180772px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">–</span><span id="f20" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">…</span></div>
<div class="txt" style="position:absolute; left:112px; top:180833px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">FloatBuffer floatBuf = byteBuf.asFloatBuffer() ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:180893px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">floatBuf.put(array) ;</span></div>
<img id="background" style="position:absolute; left:0px; top:181552px;" width="1440" height="1080" src="page152.png"> <img id="background" style="position:absolute; left:1440px; top:181552px;" width="1440" height="1080" src="page-000152.png">
<div class="txt" style="position:absolute; left:33px; top:181659px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Channels</span></div>
<div class="txt" style="position:absolute; left:426px; top:181569px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:76px; top:181799px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">A channel is a new abstraction in java.nio.</span></div>
<div class="txt" style="position:absolute; left:112px; top:181866px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">In the package java.nio.channels.</span></div>
<div class="txt" style="position:absolute; left:76px; top:181931px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Channels are a high-level version of the file-descriptors familiar</span></div>
<div class="txt" style="position:absolute; left:112px; top:181981px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">from POSIX-compliant operating systems.</span></div>
<div class="txt" style="position:absolute; left:112px; top:182046px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">So a channel is a handle for performing I/O operations and various</span></div>
<div class="txt" style="position:absolute; left:148px; top:182089px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">control operations on an open file or socket.</span></div>
<div class="txt" style="position:absolute; left:76px; top:182155px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">For those familiar with conventional Java I/O, java.nio associates a</span></div>
<div class="txt" style="position:absolute; left:112px; top:182205px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">channel with any RandomAccessFile, FileInputStream,</span></div>
<div class="txt" style="position:absolute; left:112px; top:182253px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">FileOutputStream, Socket, ServerSocket or DatagramSocket object.</span></div>
<div class="txt" style="position:absolute; left:112px; top:182318px;"><span id="f15" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The channel becomes a peer to the conventional Java handle objects; the</span></div>
<div class="txt" style="position:absolute; left:148px; top:182361px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">conventional objects still exist, and in general retain their role</span><span id="f37" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">the</span></div>
<div class="txt" style="position:absolute; left:148px; top:182404px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">channel just provides extra NIO-specific functionality.</span></div>
<div class="txt" style="position:absolute; left:76px; top:182470px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">NIO buffer objects can written to or read from channels directly</span></div>
<img id="background" style="position:absolute; left:0px; top:182754px;" width="1440" height="1080" src="page153.png"> <img id="background" style="position:absolute; left:1440px; top:182754px;" width="1440" height="1080" src="page-000153.png">
<div class="txt" style="position:absolute; left:426px; top:182771px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:182861px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Simplified Channel Hierarchy</span></div>
<div class="txt" style="position:absolute; left:586px; top:183021px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">&lt;&lt;&lt;Interface&gt;&gt;&gt;</span></div>
<div class="txt" style="position:absolute; left:630px; top:183047px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">Channel</span></div>
<div class="txt" style="position:absolute; left:364px; top:183196px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">&lt;&lt;&lt;interface&gt;&gt;&gt;</span></div>
<div class="txt" style="position:absolute; left:385px; top:183222px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteChannel</span></div>
<div class="txt" style="position:absolute; left:782px; top:183201px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">SelectableChannel</span></div>
<div class="txt" style="position:absolute; left:266px; top:183426px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">FileChannel</span></div>
<div class="txt" style="position:absolute; left:475px; top:183425px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">DatagramChannel</span></div>
<div class="txt" style="position:absolute; left:737px; top:183422px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">SocketChannel</span></div>
<div class="txt" style="position:absolute; left:964px; top:183424px;"><span id="f11" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">ServerSocketChannel</span></div>
<div class="txt" style="position:absolute; left:201px; top:183620px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Some of the “inheritance” arcs here are indirect: we missed</span></div>
<div class="txt" style="position:absolute; left:201px; top:183668px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">out some interesting intervening classes and interfaces.</span></div>
<img id="background" style="position:absolute; left:0px; top:183956px;" width="1440" height="1080" src="page154.png"> <img id="background" style="position:absolute; left:1440px; top:183956px;" width="1440" height="1080" src="page-000154.png">
<div class="txt" style="position:absolute; left:426px; top:183973px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:184063px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Opening Channels</span></div>
<div class="txt" style="position:absolute; left:76px; top:184203px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Socket channel classes have static factory methods called open(),</span></div>
<div class="txt" style="position:absolute; left:112px; top:184253px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">e.g.:</span></div>
<div class="txt" style="position:absolute; left:112px; top:184318px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">SocketChannel sc = SocketChannel.open() ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:184378px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Sc.connect(new InetSocketAddress(hostname, portnumber)) ;</span></div>
<div class="txt" style="position:absolute; left:76px; top:184444px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">File channels cannot be created directly; first use conventional Java</span></div>
<div class="txt" style="position:absolute; left:112px; top:184494px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">I/O mechanisms to create a FileInputStream, FileOutputStream, or</span></div>
<div class="txt" style="position:absolute; left:112px; top:184542px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">RandomAccessFile, then apply the new getChannel() method to get</span></div>
<div class="txt" style="position:absolute; left:112px; top:184590px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">an associated NIO channel, e.g.:</span></div>
<div class="txt" style="position:absolute; left:112px; top:184655px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f27" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">RandomAccessFile raf = new RandomAccessFile(filename, “r”) ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:184715px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">FileChannel fc = raf.getChannel() ;</span></div>
<img id="background" style="position:absolute; left:0px; top:185158px;" width="1440" height="1080" src="page155.png"> <img id="background" style="position:absolute; left:1440px; top:185158px;" width="1440" height="1080" src="page-000155.png">
<div class="txt" style="position:absolute; left:426px; top:185175px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:185265px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Using Channels</span></div>
<div class="txt" style="position:absolute; left:76px; top:185405px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Any channel that implements the ByteChannel interface</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">i.e. all</span></div>
<div class="txt" style="position:absolute; left:112px; top:185455px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">channels except ServerSocketChannel</span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">provide a read() and a</span></div>
<div class="txt" style="position:absolute; left:112px; top:185503px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">write() instance method:</span></div>
<div class="txt" style="position:absolute; left:112px; top:185568px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">int read(ByteBuffer dst)</span></div>
<div class="txt" style="position:absolute; left:112px; top:185628px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">int write(ByteBuffer src)</span></div>
<div class="txt" style="position:absolute; left:112px; top:185689px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">These may look reminiscent of the read() and write() system calls in UNIX:</span></div>
<div class="txt" style="position:absolute; left:148px; top:185745px;"><span id="f29" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">int read(int fd, void* buf, int count)</span></div>
<div class="txt" style="position:absolute; left:148px; top:185792px;"><span id="f29" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">int write(int fd, void* buf, int count)</span></div>
<div class="txt" style="position:absolute; left:112px; top:185841px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The Java read() attempts to read from the channel as many bytes as there</span></div>
<div class="txt" style="position:absolute; left:148px; top:185885px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">are remaining to be written in the dst buffer. Returns number of bytes</span></div>
<div class="txt" style="position:absolute; left:148px; top:185928px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">actually read, or -1 if end-of-stream. Also updates dst buffer position.</span></div>
<div class="txt" style="position:absolute; left:112px; top:185988px;"><span id="f22" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Similarly write() attempts to write to the channel as many bytes as there</span></div>
<div class="txt" style="position:absolute; left:148px; top:186032px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">are remaining in the src buffer. Returns number of bytes actually read,</span></div>
<div class="txt" style="position:absolute; left:148px; top:186075px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">and updates src buffer position.</span></div>
<img id="background" style="position:absolute; left:0px; top:186360px;" width="1440" height="1080" src="page156.png"> <img id="background" style="position:absolute; left:1440px; top:186360px;" width="1440" height="1080" src="page-000156.png">
<div class="txt" style="position:absolute; left:426px; top:186377px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:186467px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example: Copying one Channel to Another</span></div>
<div class="txt" style="position:absolute; left:76px; top:186607px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This example assumes a source channel src and a destination</span></div>
<div class="txt" style="position:absolute; left:112px; top:186657px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">channel dest:</span></div>
<div class="txt" style="position:absolute; left:112px; top:186722px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer buffer = ByteBuffer.allocateDirect(BUF_SIZE) ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:186782px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">while(src.read(buffer) != -1) {</span></div>
<div class="txt" style="position:absolute; left:112px; top:186843px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f24" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">buffer.flip() ; // Prepare read buffer for “draining”</span></div>
<div class="txt" style="position:absolute; left:112px; top:186903px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">while(buffer.hasRemaining())</span></div>
<div class="txt" style="position:absolute; left:112px; top:186964px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">–</span></div>
<div class="txt" style="position:absolute; left:256px; top:186964px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">dest.write(buffer) ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:187024px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">buffer.clear() ; // Empty buffer, ready to read next chunk.</span></div>
<div class="txt" style="position:absolute; left:112px; top:187085px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">–</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:187562px;" width="1440" height="1080" src="page157.png"> <img id="background" style="position:absolute; left:1440px; top:187562px;" width="1440" height="1080" src="page-000157.png">
<div class="txt" style="position:absolute; left:426px; top:187579px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:187669px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Example: Copying one Channel to Another</span></div>
<div class="txt" style="position:absolute; left:112px; top:187810px;"><span id="f11" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Note a write() call (or a read() call) may or may not succeed in transferring</span></div>
<div class="txt" style="position:absolute; left:148px; top:187853px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">whole buffer in a single call. Hence need for inner while loop.</span></div>
<div class="txt" style="position:absolute; left:112px; top:187913px;"><span id="f11" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Example introduces two new methods on Buffer: hasRemaining() returns</span></div>
<div class="txt" style="position:absolute; left:148px; top:187957px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">true if position &lt; limit; clear() sets position to 0 and limit to buffer’s</span></div>
<div class="txt" style="position:absolute; left:148px; top:188000px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">capacity.</span></div>
<div class="txt" style="position:absolute; left:112px; top:188060px;"><span id="f11" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Because copying is a common operation on files, FileChannel provides a</span></div>
<div class="txt" style="position:absolute; left:148px; top:188104px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">couple of special methods to do just this:</span></div>
<div class="txt" style="position:absolute; left:148px; top:188160px;"><span id="f17" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">long transferTo(long position, long count, WriteableByteChannel target)</span></div>
<div class="txt" style="position:absolute; left:148px; top:188206px;"><span id="f17" style="font-size:31px;vertical-align:baseline;color:rgba(255,130,44,1);">• </span><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">long transferFrom(ReadableByteChannel src, long position, long count)</span></div>
<img id="background" style="position:absolute; left:0px; top:188764px;" width="1440" height="1080" src="page158.png"> <img id="background" style="position:absolute; left:1440px; top:188764px;" width="1440" height="1080" src="page-000158.png">
<div class="txt" style="position:absolute; left:426px; top:188781px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:188871px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Memory-Mapped Files</span></div>
<div class="txt" style="position:absolute; left:76px; top:189011px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">In modern operating systems one can exploit the virtual memory</span></div>
<div class="txt" style="position:absolute; left:112px; top:189061px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">system to map a physical file into a region of program memory.</span></div>
<div class="txt" style="position:absolute; left:112px; top:189126px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Once the file is mapped, accesses to the file can be extremely fast: one</span></div>
<div class="txt" style="position:absolute; left:148px; top:189169px;"><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">doesn’t have to go through read() and write() system calls.</span></div>
<div class="txt" style="position:absolute; left:112px; top:189229px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">One application might be a Web Server, where you want to read a whole</span></div>
<div class="txt" style="position:absolute; left:148px; top:189273px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">file quickly and send it to a socket.</span></div>
<div class="txt" style="position:absolute; left:112px; top:189333px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">Problems arise if the file structure is changed while it is mapped</span><span id="f21" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">—</span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">use this</span></div>
<div class="txt" style="position:absolute; left:148px; top:189376px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">technique only for fixed-size files.</span></div>
<div class="txt" style="position:absolute; left:76px; top:189442px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This low-level optimization is now available in Java. FileChannel</span></div>
<div class="txt" style="position:absolute; left:112px; top:189492px;"><span id="f15" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">has a method:</span></div>
<div class="txt" style="position:absolute; left:112px; top:189557px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">MappedByteBuffer map(MapMode mode, long position, long size)</span></div>
<div class="txt" style="position:absolute; left:112px; top:189617px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">mode should be one of MapMode.READ_ONLY,</span></div>
<div class="txt" style="position:absolute; left:148px; top:189661px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">MapMode.READ_WRITE, MapMode.PRIVATE.</span></div>
<div class="txt" style="position:absolute; left:112px; top:189721px;"><span id="f18" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The returned MappedByteBuffer can be used wherever an ordinary</span></div>
<div class="txt" style="position:absolute; left:148px; top:189764px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer can.</span></div>
<img id="background" style="position:absolute; left:0px; top:189966px;" width="1440" height="1080" src="page159.png"> <img id="background" style="position:absolute; left:1440px; top:189966px;" width="1440" height="1080" src="page-000159.png">
<div class="txt" style="position:absolute; left:426px; top:189983px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:190073px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Scatter/Gather</span></div>
<div class="txt" style="position:absolute; left:76px; top:190213px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Often called vectored I/O, this just means you can pass an array of</span></div>
<div class="txt" style="position:absolute; left:112px; top:190263px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">buffers to a read or write operation; the overloaded channel</span></div>
<div class="txt" style="position:absolute; left:112px; top:190311px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">instance methods have signatures:</span></div>
<div class="txt" style="position:absolute; left:112px; top:190376px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">long read(ByteBuffer [] dsts)</span></div>
<div class="txt" style="position:absolute; left:112px; top:190436px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">long read(ByteBuffer [] dsts, int offset, int length)</span></div>
<div class="txt" style="position:absolute; left:112px; top:190497px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">long write(ByteBuffer [] srcs)</span></div>
<div class="txt" style="position:absolute; left:112px; top:190557px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">long write(ByteBuffer [] srcs, int offset, int length)</span></div>
<div class="txt" style="position:absolute; left:76px; top:190623px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The first form of read() attempts to read enough data to fill all</span></div>
<div class="txt" style="position:absolute; left:112px; top:190673px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">buffers in the array, and divides it between them, in order.</span></div>
<div class="txt" style="position:absolute; left:76px; top:190743px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The first form of write() attempts to concatenate the remaining data</span></div>
<div class="txt" style="position:absolute; left:112px; top:190793px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in all buffers and write it.</span></div>
<div class="txt" style="position:absolute; left:112px; top:190858px;"><span id="f17" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">The arguments offset and length select a subset of buffers from the arrays</span></div>
<div class="txt" style="position:absolute; left:148px; top:190901px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">(not, say, an interval within buffers).</span></div>
<img id="background" style="position:absolute; left:0px; top:191168px;" width="1440" height="1080" src="page160.png"> <img id="background" style="position:absolute; left:1440px; top:191168px;" width="1440" height="1080" src="page-000160.png">
<div class="txt" style="position:absolute; left:426px; top:191185px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:191275px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">SocketChannels</span></div>
<div class="txt" style="position:absolute; left:76px; top:191415px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">As mentioned at the beginning of this section, socket channels are</span></div>
<div class="txt" style="position:absolute; left:112px; top:191465px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">created directly with their own factory methods</span></div>
<div class="txt" style="position:absolute; left:112px; top:191530px;"><span id="f16" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">If you want to manage a socked connection as a NIO channel this is the</span></div>
<div class="txt" style="position:absolute; left:148px; top:191573px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">only option. Creating NIO socket channel implicitly creates a peer</span></div>
<div class="txt" style="position:absolute; left:148px; top:191616px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">java.net socket object, but (contrary to the situation with file handles) the</span></div>
<div class="txt" style="position:absolute; left:148px; top:191659px;"><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">converse is not true.</span></div>
<div class="txt" style="position:absolute; left:76px; top:191725px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">As with file channels, socket channels can be more complicated to</span></div>
<div class="txt" style="position:absolute; left:112px; top:191775px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">work with than the traditional java.net socket classes, but provide</span></div>
<div class="txt" style="position:absolute; left:112px; top:191823px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">much of the hard-boiled flexibility you get programming sockets</span></div>
<div class="txt" style="position:absolute; left:112px; top:191871px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">in C.</span></div>
<div class="txt" style="position:absolute; left:76px; top:191941px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The most notable new facilities are that now socket</span></div>
<div class="txt" style="position:absolute; left:112px; top:191991px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">communications can be non-blocking, they can be interrupted, and</span></div>
<div class="txt" style="position:absolute; left:112px; top:192039px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">there is a selection mechanism that allows a single thread to do</span></div>
<div class="txt" style="position:absolute; left:112px; top:192087px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">multiplex servicing of any number of channels.</span></div>
<img id="background" style="position:absolute; left:0px; top:192370px;" width="1440" height="1080" src="page161.png"> <img id="background" style="position:absolute; left:1440px; top:192370px;" width="1440" height="1080" src="page-000161.png">
<div class="txt" style="position:absolute; left:426px; top:192387px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:192477px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Basic Socket Channel Operations</span></div>
<div class="txt" style="position:absolute; left:76px; top:192617px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">Typical use of a server socket channel follows a pattern like:</span></div>
<div class="txt" style="position:absolute; left:112px; top:192682px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">ServerSocketChannel ssc = ServerSocketChannel.open() ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:192736px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">ssc.socket().bind( new InetSocketAddress(port) ) ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:192789px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">while(true) {</span></div>
<div class="txt" style="position:absolute; left:253px; top:192843px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">SocketChannel sc = ssc.accept() ;</span></div>
<div class="txt" style="position:absolute; left:253px; top:192897px;"><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">… process a transaction with client through </span><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">sc </span><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">…}</span></div>
<div class="txt" style="position:absolute; left:76px; top:192958px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The client does something like:</span></div>
<div class="txt" style="position:absolute; left:112px; top:193023px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">SocketChannel sc = SocketChannel.open() ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:193076px;"><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">sc.connect( new InetSocketAddr(serverName, port) ) ;</span></div>
<div class="txt" style="position:absolute; left:112px; top:193130px;"><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">… initiate a transaction with server through </span><span id="f15" style="font-size:14px;vertical-align:baseline;color:rgba(0,0,0,1);">sc </span><span id="f31" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">…</span></div>
<div class="txt" style="position:absolute; left:76px; top:193191px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">The elided code above will typically be using read() and write()</span></div>
<div class="txt" style="position:absolute; left:112px; top:193241px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">calls on the SocketChannel to exchange data between client and</span></div>
<div class="txt" style="position:absolute; left:112px; top:193289px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">server.</span></div>
<div class="txt" style="position:absolute; left:112px; top:193354px;"><span id="f57" style="font-size:36px;vertical-align:baseline;color:rgba(255,130,44,1);">– </span><span id="f8" style="font-size:36px;vertical-align:baseline;color:rgba(0,0,0,1);">So there are four important operations: accept(), connect(), write(), read() .</span></div>
<img id="background" style="position:absolute; left:0px; top:193572px;" width="1440" height="1080" src="page162.png"> <img id="background" style="position:absolute; left:1440px; top:193572px;" width="1440" height="1080" src="page-000162.png">
<div class="txt" style="position:absolute; left:426px; top:193589px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:33px; top:193679px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">Other Features of Channels</span></div>
<div class="txt" style="position:absolute; left:76px; top:193819px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">File channels provide a quite general file locking facility. This is</span></div>
<div class="txt" style="position:absolute; left:112px; top:193869px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">presumably important to many applications (database</span></div>
<div class="txt" style="position:absolute; left:112px; top:193917px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">applications), but less obviously so to HPC operations, so we don’t</span></div>
<div class="txt" style="position:absolute; left:112px; top:193965px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">discuss it here.</span></div>
<div class="txt" style="position:absolute; left:76px; top:194035px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">There is a DatagramChannel for sending UDP</span><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">–</span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">style messages.</span></div>
<div class="txt" style="position:absolute; left:112px; top:194085px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">This may well be important for high performance communications,</span></div>
<div class="txt" style="position:absolute; left:112px; top:194133px;"><span id="f16" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">but we don’t have time to discuss it.</span></div>
<div class="txt" style="position:absolute; left:76px; top:194203px;"><span id="f11" style="font-size:40px;vertical-align:baseline;color:rgba(255,130,44,1);">▪ </span><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">There is a special channel implementation representing a kind of</span></div>
<div class="txt" style="position:absolute; left:112px; top:194253px;"><span id="f13" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">pipe, which can be used for inter-thread communication.</span></div>
<img id="background" style="position:absolute; left:0px; top:194774px;" width="1440" height="1080" src="page163.png"> <img id="background" style="position:absolute; left:1440px; top:194774px;" width="1440" height="1080" src="page-000163.png">
<div class="txt" style="position:absolute; left:33px; top:194881px;"><span id="f8" style="font-size:60px;vertical-align:baseline;color:rgba(0,0,0,1);">An example</span></div>
<div class="txt" style="position:absolute; left:426px; top:194791px;"><span id="f8" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">8.1 Metrics, Principles, and Methods of Construction for Performance</span></div>
<div class="txt" style="position:absolute; left:65px; top:194999px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">public static void nioCopyFile(String resource, String destination)</span></div>
<div class="txt" style="position:absolute; left:302px; top:195042px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">throws IOException {</span></div>
<div class="txt" style="position:absolute; left:223px; top:195085px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">FileInputStream fis = new FileInputStream(resource);</span></div>
<div class="txt" style="position:absolute; left:223px; top:195129px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">FileOutputStream fos = new FileOutputStream(destination);</span></div>
<div class="txt" style="position:absolute; left:223px; top:195172px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">FileChannel readChannel = fis.getChannel();</span></div>
<div class="txt" style="position:absolute; left:223px; top:195215px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">FileChannel writeChannel = fos.getChannel();</span></div>
<div class="txt" style="position:absolute; left:223px; top:195258px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">ByteBuffer buffer = ByteBuffer.allocate(1024*8);</span></div>
<div class="txt" style="position:absolute; left:223px; top:195302px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">while (true) {</span></div>
<div class="txt" style="position:absolute; left:302px; top:195345px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">buffer.clear();</span></div>
<div class="txt" style="position:absolute; left:302px; top:195388px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">int len = readChannel.read(buffer);</span></div>
<div class="txt" style="position:absolute; left:302px; top:195431px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">if (len == -1) {</span></div>
<div class="txt" style="position:absolute; left:381px; top:195474px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">break;</span></div>
<div class="txt" style="position:absolute; left:302px; top:195518px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:302px; top:195561px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">buffer.flip();</span></div>
<div class="txt" style="position:absolute; left:302px; top:195604px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">writeChannel.write(buffer);</span></div>
<div class="txt" style="position:absolute; left:223px; top:195647px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<div class="txt" style="position:absolute; left:223px; top:195690px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">readChannel.close();</span></div>
<div class="txt" style="position:absolute; left:223px; top:195734px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">writeChannel.close();</span></div>
<div class="txt" style="position:absolute; left:144px; top:195777px;"><span id="f11" style="font-size:15px;vertical-align:baseline;color:rgba(0,0,0,1);">}</span></div>
<img id="background" style="position:absolute; left:0px; top:195976px;" width="1440" height="1080" src="page164.png"> <img id="background" style="position:absolute; left:1440px; top:195976px;" width="1440" height="1080" src="page-000164.png">
<div class="txt" style="position:absolute; left:1105px; top:195994px;"><span id="f9" style="font-size:31px;vertical-align:baseline;color:rgba(0,0,0,1);">Software Construction</span></div>
<div class="txt" style="position:absolute; left:590px; top:196391px;"><span id="f9" style="font-size:72px;vertical-align:baseline;color:rgba(0,0,0,1);">The end</span></div>
<div class="txt" style="position:absolute; left:604px; top:196645px;"><span id="f9" style="font-size:40px;vertical-align:baseline;color:rgba(0,0,0,1);">May 13, 2019</span></div>
</body></html>